(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[9349],{35099:function(It,$,z){"use strict";var ie=z(67294),re=z(83280),m=z(23185),de=z(4322),Z=z(24770),ce=z(89182),fe=function(J,Xe){var et={};for(var Ze in J)Object.prototype.hasOwnProperty.call(J,Ze)&&Xe.indexOf(Ze)<0&&(et[Ze]=J[Ze]);if(J!=null&&typeof Object.getOwnPropertySymbols=="function")for(var yt=0,Ze=Object.getOwnPropertySymbols(J);yt<Ze.length;yt++)Xe.indexOf(Ze[yt])<0&&Object.prototype.propertyIsEnumerable.call(J,Ze[yt])&&(et[Ze[yt]]=J[Ze[yt]]);return et},Le=(0,ie.forwardRef)(function(J,Xe){var et=J.chartRef,Ze=J.style,yt=Ze===void 0?{height:"inherit"}:Ze,rr=J.className,bt=J.loading,Xt=J.loadingTemplate,Ct=J.errorTemplate,at=fe(J,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),it=(0,m.Z)(re.aC,at),Vt=it.chart,q=it.container;return(0,ie.useEffect)(function(){(0,de.J)(et,Vt.current)},[Vt.current]),(0,ie.useImperativeHandle)(Xe,function(){return{getChart:function(){return Vt.current}}}),ie.createElement(Z.Z,{errorTemplate:Ct},bt&&ie.createElement(ce.Z,{loadingTemplate:Xt,theme:J.theme}),ie.createElement("div",{className:rr,style:yt,ref:q}))});$.Z=Le},65337:function(It,$,z){"use strict";var ie=z(67294),re=z(83280),m=z(23185),de=z(4322),Z=z(24770),ce=z(89182),fe=function(J,Xe){var et={};for(var Ze in J)Object.prototype.hasOwnProperty.call(J,Ze)&&Xe.indexOf(Ze)<0&&(et[Ze]=J[Ze]);if(J!=null&&typeof Object.getOwnPropertySymbols=="function")for(var yt=0,Ze=Object.getOwnPropertySymbols(J);yt<Ze.length;yt++)Xe.indexOf(Ze[yt])<0&&Object.prototype.propertyIsEnumerable.call(J,Ze[yt])&&(et[Ze[yt]]=J[Ze[yt]]);return et},Le=(0,ie.forwardRef)(function(J,Xe){var et=J.chartRef,Ze=J.style,yt=Ze===void 0?{height:"inherit"}:Ze,rr=J.className,bt=J.loading,Xt=J.loadingTemplate,Ct=J.errorTemplate,at=fe(J,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),it=(0,m.Z)(re.Kj,at),Vt=it.chart,q=it.container;return(0,ie.useEffect)(function(){(0,de.J)(et,Vt.current)},[Vt.current]),(0,ie.useImperativeHandle)(Xe,function(){return{getChart:function(){return Vt.current}}}),ie.createElement(Z.Z,{errorTemplate:Ct},bt&&ie.createElement(ce.Z,{loadingTemplate:Xt,theme:J.theme}),ie.createElement("div",{className:rr,style:yt,ref:q}))});$.Z=Le},90829:function(It,$,z){"use strict";var ie=z(67294),re=z(83280),m=z(23185),de=z(4322),Z=z(24770),ce=z(89182),fe=function(J,Xe){var et={};for(var Ze in J)Object.prototype.hasOwnProperty.call(J,Ze)&&Xe.indexOf(Ze)<0&&(et[Ze]=J[Ze]);if(J!=null&&typeof Object.getOwnPropertySymbols=="function")for(var yt=0,Ze=Object.getOwnPropertySymbols(J);yt<Ze.length;yt++)Xe.indexOf(Ze[yt])<0&&Object.prototype.propertyIsEnumerable.call(J,Ze[yt])&&(et[Ze[yt]]=J[Ze[yt]]);return et},Le=(0,ie.forwardRef)(function(J,Xe){var et=J.chartRef,Ze=J.style,yt=Ze===void 0?{height:"inherit"}:Ze,rr=J.className,bt=J.loading,Xt=J.loadingTemplate,Ct=J.errorTemplate,at=fe(J,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),it=(0,m.Z)(re.TZ,at),Vt=it.chart,q=it.container;return(0,ie.useEffect)(function(){(0,de.J)(et,Vt.current)},[Vt.current]),(0,ie.useImperativeHandle)(Xe,function(){return{getChart:function(){return Vt.current}}}),ie.createElement(Z.Z,{errorTemplate:Ct},bt&&ie.createElement(ce.Z,{loadingTemplate:Xt,theme:J.theme}),ie.createElement("div",{className:rr,style:yt,ref:q}))});$.Z=Le},93343:function(It,$,z){"use strict";var ie=z(67294),re=z(83280),m=z(23185),de=z(4322),Z=z(24770),ce=z(89182),fe=function(J,Xe){var et={};for(var Ze in J)Object.prototype.hasOwnProperty.call(J,Ze)&&Xe.indexOf(Ze)<0&&(et[Ze]=J[Ze]);if(J!=null&&typeof Object.getOwnPropertySymbols=="function")for(var yt=0,Ze=Object.getOwnPropertySymbols(J);yt<Ze.length;yt++)Xe.indexOf(Ze[yt])<0&&Object.prototype.propertyIsEnumerable.call(J,Ze[yt])&&(et[Ze[yt]]=J[Ze[yt]]);return et},Le=(0,ie.forwardRef)(function(J,Xe){var et=J.chartRef,Ze=J.style,yt=Ze===void 0?{height:"inherit"}:Ze,rr=J.className,bt=J.loading,Xt=J.loadingTemplate,Ct=J.errorTemplate,at=fe(J,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),it=(0,m.Z)(re.m,at),Vt=it.chart,q=it.container;return(0,ie.useEffect)(function(){(0,de.J)(et,Vt.current)},[Vt.current]),(0,ie.useImperativeHandle)(Xe,function(){return{getChart:function(){return Vt.current}}}),ie.createElement(Z.Z,{errorTemplate:Ct},bt&&ie.createElement(ce.Z,{loadingTemplate:Xt,theme:J.theme}),ie.createElement("div",{className:rr,style:yt,ref:q}))});$.Z=Le},92688:function(It,$,z){"use strict";var ie=z(67294),re=z(83280),m=z(23185),de=z(4322),Z=z(24770),ce=z(89182),fe=function(J,Xe){var et={};for(var Ze in J)Object.prototype.hasOwnProperty.call(J,Ze)&&Xe.indexOf(Ze)<0&&(et[Ze]=J[Ze]);if(J!=null&&typeof Object.getOwnPropertySymbols=="function")for(var yt=0,Ze=Object.getOwnPropertySymbols(J);yt<Ze.length;yt++)Xe.indexOf(Ze[yt])<0&&Object.prototype.propertyIsEnumerable.call(J,Ze[yt])&&(et[Ze[yt]]=J[Ze[yt]]);return et},Le=(0,ie.forwardRef)(function(J,Xe){var et=J.chartRef,Ze=J.style,yt=Ze===void 0?{height:"inherit"}:Ze,rr=J.className,bt=J.loading,Xt=J.loadingTemplate,Ct=J.errorTemplate,at=fe(J,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),it=(0,m.Z)(re.kB,at),Vt=it.chart,q=it.container;return(0,ie.useEffect)(function(){(0,de.J)(et,Vt.current)},[Vt.current]),(0,ie.useImperativeHandle)(Xe,function(){return{getChart:function(){return Vt.current}}}),ie.createElement(Z.Z,{errorTemplate:Ct},bt&&ie.createElement(ce.Z,{loadingTemplate:Xt,theme:J.theme}),ie.createElement("div",{className:rr,style:yt,ref:q}))});$.Z=Le},64335:function(It,$,z){"use strict";var ie=z(67294),re=(0,ie.createContext)({});$.Z=re},21349:function(It,$,z){"use strict";var ie=z(84305),re=z(75901),m=z(94184),de=z.n(m),Z=z(67294),ce=z(64335),fe=z(53645),Le=z.n(fe),J=function(et){var Ze=(0,Z.useContext)(ce.Z),yt=et.children,rr=et.contentWidth,bt=et.className,Xt=et.style,Ct=(0,Z.useContext)(re.ZP.ConfigContext),at=Ct.getPrefixCls,it=et.prefixCls||at("pro"),Vt=rr||Ze.contentWidth,q="".concat(it,"-grid-content");return Z.createElement("div",{className:de()(q,bt,{wide:Vt==="Fixed"}),style:Xt},Z.createElement("div",{className:"".concat(it,"-grid-content-children")},yt))};$.Z=J},75553:function(It,$,z){"use strict";z.d($,{zP:function(){return nP},JE:function(){return d3},ns:function(){return rP}});var ie={};z.r(ie),z.d(ie,{add:function(){return Se},adjoint:function(){return Sr},clone:function(){return Lr},copy:function(){return $r},create:function(){return ar},determinant:function(){return qr},equals:function(){return Ye},exactEquals:function(){return Rt},frob:function(){return Vi},fromQuat:function(){return Wo},fromQuat2:function(){return wo},fromRotation:function(){return vo},fromRotationTranslation:function(){return Ho},fromRotationTranslationScale:function(){return mo},fromRotationTranslationScaleOrigin:function(){return xi},fromScaling:function(){return uo},fromTranslation:function(){return Bi},fromValues:function(){return zn},fromXRotation:function(){return Ni},fromYRotation:function(){return ss},fromZRotation:function(){return Ka},frustum:function(){return na},getRotation:function(){return ms},getScaling:function(){return Bo},getTranslation:function(){return Qo},identity:function(){return ir},invert:function(){return Vr},lookAt:function(){return Ut},mul:function(){return Fe},multiply:function(){return Nr},multiplyScalar:function(){return Ve},multiplyScalarAndAdd:function(){return ct},ortho:function(){return wl},orthoNO:function(){return bo},orthoZO:function(){return Te},perspective:function(){return ri},perspectiveFromFieldOfView:function(){return _a},perspectiveNO:function(){return Jo},perspectiveZO:function(){return zi},rotate:function(){return Wr},rotateX:function(){return Qr},rotateY:function(){return $n},rotateZ:function(){return ui},scale:function(){return ei},set:function(){return tr},str:function(){return mn},sub:function(){return nt},subtract:function(){return oe},targetTo:function(){return At},translate:function(){return ci},transpose:function(){return Sn}});var re=z(67294),m=(0,re.createContext)({});function de(){return(0,re.useContext)(m)}var Z={},ce={},fe=function(i){return ce[i]},Le=function(i,r){ce[i]=r},J=function(i){return Z[i]},Xe=function(i,r){Z[i]=r},et={},Ze={},yt=34,rr=10,bt=13;function Xt(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function Ct(e,i){var r=Xt(e);return function(n,a){return i(r(n),a,e)}}function at(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function it(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function Vt(e){return e<0?"-"+it(-e,6):e>9999?"+"+it(e,6):it(e,4)}function q(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Vt(e.getUTCFullYear(),4)+"-"+it(e.getUTCMonth()+1,2)+"-"+it(e.getUTCDate(),2)+(a?"T"+it(i,2)+":"+it(r,2)+":"+it(n,2)+"."+it(a,3)+"Z":n?"T"+it(i,2)+":"+it(r,2)+":"+it(n,2)+"Z":r||i?"T"+it(i,2)+":"+it(r,2)+"Z":"")}function $t(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(T,O){var k,j,X=a(T,function(te,Ee){if(k)return k(te,Ee-1);j=te,k=O?Ct(te,O):Xt(te)});return X.columns=j||[],X}function a(T,O){var k=[],j=T.length,X=0,te=0,Ee,Ne=j<=0,$e=!1;T.charCodeAt(j-1)===rr&&--j,T.charCodeAt(j-1)===bt&&--j;function ot(){if(Ne)return Ze;if($e)return $e=!1,et;var _t,qt=X,or;if(T.charCodeAt(qt)===yt){for(;X++<j&&T.charCodeAt(X)!==yt||T.charCodeAt(++X)===yt;);return(_t=X)>=j?Ne=!0:(or=T.charCodeAt(X++))===rr?$e=!0:or===bt&&($e=!0,T.charCodeAt(X)===rr&&++X),T.slice(qt+1,_t-1).replace(/""/g,'"')}for(;X<j;){if((or=T.charCodeAt(_t=X++))===rr)$e=!0;else if(or===bt)$e=!0,T.charCodeAt(X)===rr&&++X;else if(or!==r)continue;return T.slice(qt,_t)}return Ne=!0,T.slice(qt,j)}for(;(Ee=ot())!==Ze;){for(var Et=[];Ee!==et&&Ee!==Ze;)Et.push(Ee),Ee=ot();O&&(Et=O(Et,te++))==null||k.push(Et)}return k}function s(T,O){return T.map(function(k){return O.map(function(j){return C(k[j])}).join(e)})}function f(T,O){return O==null&&(O=at(T)),[O.map(C).join(e)].concat(s(T,O)).join(`
`)}function v(T,O){return O==null&&(O=at(T)),s(T,O).join(`
`)}function g(T){return T.map(x).join(`
`)}function x(T){return T.map(C).join(e)}function C(T){return T==null?"":T instanceof Date?q(T):i.test(T+="")?'"'+T.replace(/"/g,'""')+'"':T}return{parse:n,parseRows:a,format:f,formatBody:v,formatRows:g,formatRow:x,formatValue:C}}var ft=$t(","),Je=ft.parse,wt=ft.parseRows,Qe=ft.format,Qt=ft.formatBody,Er=ft.formatRows,Fr=ft.formatRow,Jr=ft.formatValue,A=z(96156),Ce=z(85061),De=z(38163),Tt=z.n(De);function gt(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Bt(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?gt(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Kt(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,f=i.coordinates,v=[];return Array.isArray(e)?(e.forEach(function(g,x){var C=[];if(r&&n&&(C=[parseFloat(g[r]),parseFloat(g[n])]),r&&n&&a&&s){var T=[parseFloat(g[r]),parseFloat(g[n])],O=[parseFloat(g[a]),parseFloat(g[s])];C=[T,O]}if(f){var k="Polygon";Array.isArray(f[0])||(k="Point"),Array.isArray(f[0])&&!Array.isArray(f[0][0])&&(k="LineString");var j={type:k,coordinates:(0,Ce.Z)(g[f])};Tt()(j,!0),C=j.coordinates}var X=Bt(Bt({},g),{},{_id:x,coordinates:C});v.push(X)}),{dataArray:v}):{dataArray:[]}}var Cr=[{lng1:100,lat1:30,lng2:130,lat2:30}],Qn={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function vn(e,i){var r=Je(e);return Kt(r,i)}var fi=63710088e-1,Gn={centimeters:fi*100,centimetres:fi*100,degrees:fi/111325,feet:fi*3.28084,inches:fi*39.37,kilometers:fi/1e3,kilometres:fi/1e3,meters:fi,metres:fi,miles:fi/1609.344,millimeters:fi*1e3,millimetres:fi*1e3,nauticalmiles:fi/1852,radians:1,yards:fi*1.0936},ii={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/fi,yards:1.0936133},hi={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Wn(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function pi(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return la(i).geometry;case"LineString":return ca(i).geometry;case"Polygon":return Oi(i).geometry;case"MultiPoint":return Ci(i).geometry;case"MultiLineString":return qn(i).geometry;case"MultiPolygon":return Zi(i).geometry;default:throw new Error(e+" is invalid")}}function la(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!wn(e[0])||!wn(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Wn(n,i,r)}function Gi(e,i,r){return r===void 0&&(r={}),xa(e.map(function(n){return la(n,i)}),r)}function Oi(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<s[s.length-1].length;f++)if(s[s.length-1][f]!==s[0][f])throw new Error("First and last Position are not equivalent.")}var v={type:"Polygon",coordinates:e};return Wn(v,i,r)}function $i(e,i,r){return r===void 0&&(r={}),xa(e.map(function(n){return Oi(n,i)}),r)}function ca(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Wn(n,i,r)}function wi(e,i,r){return r===void 0&&(r={}),xa(e.map(function(n){return ca(n,i)}),r)}function xa(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function qn(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Wn(n,i,r)}function Ci(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Wn(n,i,r)}function Zi(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Wn(n,i,r)}function Qi(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Wn(n,i,r)}function Zo(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function me(e,i){i===void 0&&(i="kilometers");var r=Gn[i];if(!r)throw new Error(i+" units is invalid");return e*r}function Dn(e,i){i===void 0&&(i="kilometers");var r=Gn[i];if(!r)throw new Error(i+" units is invalid");return e/r}function Xa(e,i){return Nt(Dn(e,i))}function cs(e){var i=e%360;return i<0&&(i+=360),i}function Nt(e){var i=e%(2*Math.PI);return i*180/Math.PI}function nr(e){var i=e%360;return i*Math.PI/180}function Ar(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return me(Dn(e,i),r)}function en(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=hi[i];if(!n)throw new Error("invalid original units");var a=hi[r];if(!a)throw new Error("invalid final units");return e/n*a}function wn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Bn(e){return!!e&&e.constructor===Object}function di(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!wn(i))throw new Error("bbox must only contain numbers")})}function Jn(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function cn(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Li(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ri(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ri(e[0]);throw new Error("coordinates must only contain numbers")}function oo(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function ys(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Yo(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Va(e){return e.type==="Feature"?e.geometry:e}function Aa(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function H(e,i,r){if(e!==null)for(var n,a,s,f,v,g,x,C=0,T=0,O,k=e.type,j=k==="FeatureCollection",X=k==="Feature",te=j?e.features.length:1,Ee=0;Ee<te;Ee++){x=j?e.features[Ee].geometry:X?e.geometry:e,O=x?x.type==="GeometryCollection":!1,v=O?x.geometries.length:1;for(var Ne=0;Ne<v;Ne++){var $e=0,ot=0;if(f=O?x.geometries[Ne]:x,f!==null){g=f.coordinates;var Et=f.type;switch(C=r&&(Et==="Polygon"||Et==="MultiPolygon")?1:0,Et){case null:break;case"Point":if(i(g,T,Ee,$e,ot)===!1)return!1;T++,$e++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(i(g[n],T,Ee,$e,ot)===!1)return!1;T++,Et==="MultiPoint"&&$e++}Et==="LineString"&&$e++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(a=0;a<g[n].length-C;a++){if(i(g[n][a],T,Ee,$e,ot)===!1)return!1;T++}Et==="MultiLineString"&&$e++,Et==="Polygon"&&ot++}Et==="Polygon"&&$e++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(ot=0,a=0;a<g[n].length;a++){for(s=0;s<g[n][a].length-C;s++){if(i(g[n][a][s],T,Ee,$e,ot)===!1)return!1;T++}ot++}$e++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(H(f.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Q(e,i,r,n){var a=r;return H(e,function(s,f,v,g,x){f===0&&r===void 0?a=s:a=i(a,s,f,v,g,x)},n),a}function ae(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function ye(e,i,r){var n=r;return ae(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Pe(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function He(e,i,r){var n=r;return Pe(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function rt(e){var i=[];return H(e,function(r){i.push(r)}),i}function he(e,i){var r,n,a,s,f,v,g,x,C,T,O=0,k=e.type==="FeatureCollection",j=e.type==="Feature",X=k?e.features.length:1;for(r=0;r<X;r++){for(v=k?e.features[r].geometry:j?e.geometry:e,x=k?e.features[r].properties:j?e.properties:{},C=k?e.features[r].bbox:j?e.bbox:void 0,T=k?e.features[r].id:j?e.id:void 0,g=v?v.type==="GeometryCollection":!1,f=g?v.geometries.length:1,a=0;a<f;a++){if(s=g?v.geometries[a]:v,s===null){if(i(null,O,x,C,T)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,O,x,C,T)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],O,x,C,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}O++}}function ke(e,i,r){var n=r;return he(e,function(a,s,f,v,g){s===0&&r===void 0?n=a:n=i(n,a,s,f,v,g)}),n}function vt(e,i){he(e,function(r,n,a,s,f){var v=r===null?null:r.type;switch(v){case null:case"Point":case"LineString":case"Polygon":return i(Wn(r,a,{bbox:s,id:f}),n,0)===!1?!1:void 0}var g;switch(v){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var x=0;x<r.coordinates.length;x++){var C=r.coordinates[x],T={type:g,coordinates:C};if(i(Wn(T,a),n,x)===!1)return!1}})}function dr(e,i,r){var n=r;return vt(e,function(a,s,f){s===0&&f===0&&r===void 0?n=a:n=i(n,a,s,f)}),n}function Ft(e,i){vt(e,function(r,n,a){var s=0;if(!!r.geometry){var f=r.geometry.type;if(!(f==="Point"||f==="MultiPoint")){var v,g=0,x=0,C=0;if(H(r,function(T,O,k,j,X){if(v===void 0||n>g||j>x||X>C){v=T,g=n,x=j,C=X,s=0;return}var te=lineString([v,T],r.properties);if(i(te,n,a,X,s)===!1)return!1;s++,v=T})===!1)return!1}}})}function zt(e,i,r){var n=r,a=!1;return Ft(e,function(s,f,v,g,x){a===!1&&r===void 0?n=s:n=i(n,s,f,v,g,x),a=!0}),n}function vr(e,i){if(!e)throw new Error("geojson is required");vt(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,f=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var v=0;v<f.length;v++)if(i(lineString(f[v],r.properties),n,a,v)===!1)return!1;break}}})}function En(e,i,r){var n=r;return vr(e,function(a,s,f,v){s===0&&r===void 0?n=a:n=i(n,a,s,f,v)}),n}function pn(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,f=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":f=f||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=g.length+s-1),lineString([g[s],g[s+1]],f,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s-1),lineString([g[a][s],g[a][s+1]],f,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s-1),lineString([g[n][s],g[n][s+1]],f,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s-1),lineString([g[n][a][s],g[n][a][s+1]],f,i)}throw new Error("geojson is invalid")}function Ot(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,f=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":f=f||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":return point(g,f,i);case"MultiPoint":return n<0&&(n=g.length+n),point(g[n],f,i);case"LineString":return s<0&&(s=g.length+s),point(g[s],f,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s),point(g[a][s],f,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s),point(g[n][s],f,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s),point(g[n][a][s],f,i)}throw new Error("geojson is invalid")}function tn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Zr(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?tn(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Hr(e,i){var r=[],n={};if(!e.features)return e.features=[],{dataArray:[]};if(e.features=e.features.filter(function(s){var f=s.geometry;return s!=null&&f&&f.type&&f.coordinates&&f.coordinates.length>0}),Tt()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return vt(e,function(s,f){var v=Li(s),g=f,x=Zr(Zr({},s.properties),{},{coordinates:v,_id:g});r.push(x)}),{dataArray:r,featureKeys:n}}function gi(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function rn(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var nn=z(28481),Wi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function vi(e){this.message=e}vi.prototype=new Error,vi.prototype.name="InvalidCharacterError";function Ti(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new vi("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,f=0;s=i.charAt(f++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=Wi.indexOf(s);return r}function _i(e){e=String(e);for(var i,r,n,a,s="",f=0,v=e.length%3;f<e.length;){if((r=e.charCodeAt(f++))>255||(n=e.charCodeAt(f++))>255||(a=e.charCodeAt(f++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=Wi.charAt(i>>18&63)+Wi.charAt(i>>12&63)+Wi.charAt(i>>6&63)+Wi.charAt(i&63)}return v?s.slice(0,v-3)+"===".substring(v):s}var ht=z(6610),Pt=z(5991),Ma=function(){function e(i,r){(0,ht.Z)(this,e),this.buffers=i,this.type=r}return(0,Pt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),Ai;typeof window=="undefined"?Ai={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ai=window;var Mi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ji=Mi?my.getSystemInfoSync().pixelRatio:Ai.devicePixelRatio,Pr=z(10379),an=z(46070),mt=z(77608),aa=(0,Pt.Z)(function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"cancelBubble",void 0),(0,A.Z)(this,"cancelable",void 0),(0,A.Z)(this,"target",void 0),(0,A.Z)(this,"currentTarget",void 0),(0,A.Z)(this,"preventDefault",void 0),(0,A.Z)(this,"stopPropagation",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),ue=z(63349);function ns(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ta(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function ta(e,i){if(!!e){if(typeof e=="string")return bu(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bu(e,i)}}function bu(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ga=new WeakMap,Pa=function(){function e(){(0,ht.Z)(this,e),Ga.set(this,{})}return(0,Pt.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=Ga.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),Ga.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=Ga.get(this);if(s){var f=s[r];if(f&&f.length>0){for(var v=f.length;v--;v>0)if(f[v]===n){f.splice(v,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=Ga.get(this)[r.type];if(n){var a=ns(n),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f(r)}}catch(v){a.e(v)}finally{a.f()}}}}]),e}();function eo(e){var i=oa();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function oa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Io=function(e){(0,Pr.Z)(r,e);var i=eo(r);function r(){var n;return(0,ht.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,Pt.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(f){return f===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(Pa);function qo(e){var i=Du();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Du(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yo=function(e){(0,Pr.Z)(r,e);var i=qo(r);function r(){var n;return(0,ht.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"className",void 0),(0,A.Z)((0,ue.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,Pt.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(Io),jo=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,sa,to,Vo,ro;if(jo){var Rs=my.getSystemInfoSync();sa=Rs.screenWidth,to=Rs.screenHeight,Vo=Rs.windowWidth,ro=Rs.windowHeight}else{var Pl=Ai.innerWidth,_s=Ai.innerHeight;sa=Pl,to=_s,Vo=Pl,ro=_s}var ne={width:sa,height:to,availWidth:Vo,availHeight:ro,availLeft:0,availTop:0},be=ne.availWidth,Ke=ne.availHeight,Lt={style:[]};function Rr(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return Lt}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return Lt}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function In(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:be+"px",height:Ke+"px",margin:"0px",padding:"0px"})}function Pi(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=be,e.clientHeight=Ke),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function so(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=be,e.offsetHeight=Ke)}function Da(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=be,e.scrollHeight=Ke)}function Ha(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Ko(e){var i=xs();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function xs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function co(){}var Oo=function(e){(0,Pr.Z)(r,e);var i=Ko(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,ht.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"className",void 0),(0,A.Z)((0,ue.Z)(n),"children",void 0),(0,A.Z)((0,ue.Z)(n),"focus",void 0),(0,A.Z)((0,ue.Z)(n),"blur",void 0),(0,A.Z)((0,ue.Z)(n),"insertBefore",void 0),(0,A.Z)((0,ue.Z)(n),"appendChild",void 0),(0,A.Z)((0,ue.Z)(n),"removeChild",void 0),(0,A.Z)((0,ue.Z)(n),"remove",void 0),(0,A.Z)((0,ue.Z)(n),"innerHTML",void 0),(0,A.Z)((0,ue.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=co,n.blur=co,n.insertBefore=co,n.appendChild=co,n.removeChild=co,n.remove=co,n.innerHTML="",n.tagName=a.toUpperCase(),Rr((0,ue.Z)(n),s),In((0,ue.Z)(n)),Ha((0,ue.Z)(n)),Pi((0,ue.Z)(n)),so((0,ue.Z)(n)),Da((0,ue.Z)(n)),n}return(0,Pt.Z)(r)}(yo);function bs(e){var i=Ls();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Ls(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zs=function(e){(0,Pr.Z)(r,e);var i=bs(r);function r(n){return(0,ht.Z)(this,r),i.call(this,n)}return(0,Pt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Oo);function au(e){var i=Es();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Es(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ba=function(e){(0,Pr.Z)(r,e);var i=au(r);function r(){return(0,ht.Z)(this,r),i.call(this,"video")}return(0,Pt.Z)(r)}(Zs),Ca={},fs={};function of(e,i){Ca=e,Ca.id=i,"tagName"in Ca||(Ca.tagName="CANVAS"),Ca.type="canvas",Mixin.parentNode(Ca),Mixin.style(Ca),Mixin.classList(Ca),Mixin.clientRegion(Ca),Mixin.offsetRegion(Ca),Ca.focus=function(){},Ca.blur=function(){}}function Il(e,i){var r=1024,n=1024;fs={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in fs||(fs.tagName="CANVAS"),Mixin.parentNode(fs),Mixin.style(fs),Mixin.classList(fs),Mixin.clientRegion(fs),Mixin.offsetRegion(fs),fs.getContext=function(a){if(a==="2d")return e},fs.focus=function(){},fs.blur=function(){}}function qs(){return Ca}function ac(){return fs}var Ju=(0,Pt.Z)(function e(){(0,ht.Z)(this,e);var i=qs(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Rr(r),Ha(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),Ks={href:"",protocol:"",host:""};function pl(e){var i=_();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function _(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P=function(e){(0,Pr.Z)(r,e);var i=pl(r);function r(){return(0,ht.Z)(this,r),i.call(this,"body",0)}return(0,Pt.Z)(r,[{key:"addEventListener",value:function(a,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,f){}},{key:"dispatchEvent",value:function(a){}}]),r}(Oo),F=function(e){(0,Pr.Z)(r,e);var i=pl(r);function r(){return(0,ht.Z)(this,r),i.call(this,"html",0)}return(0,Pt.Z)(r,[{key:"addEventListener",value:function(a,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(Oo),R={},K={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Ks,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new Ju:i==="video"?new ba:new Oo(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){R[i]||(R[i]=[]),R[i].push(r)},removeEventListener:function(i,r){var n=R[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=R[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new aa(i)}};K.documentElement=new F,K.head=new Oo("head"),K.body=new P;var xe=Object,We=z(90484),pt=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"_w",void 0),(0,A.Z)(this,"_h",void 0),(0,A.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,We.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Pt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),dt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,sr,cr,Pn;if(dt){var ai=my.getSystemInfoSync();sr=ai.system,cr=ai.platform,Pn=ai.language}else{var kn={versions:function(){var e=Ai.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ai.navigator.browserLanguage||Ai.navigator.language).toLowerCase()};kn.versions.android?cr="android":kn.versions.trident?cr="IE":kn.versions.presto?cr="Opera":kn.versions.webKit?cr="webKit":kn.versions.gecko?cr="Firefox":kn.versions.mobile?cr="mobile":kn.versions.ios?cr="ios":kn.versions.iPhone?cr="iPhone":kn.versions.iPad?cr="ipad":kn.versions.webApp?cr="webApp":kn.versions.weixin?cr="weixin":kn.versions.qq&&(cr="qq"),sr=Ai.navigator.userAgent,Pn=kn.language}var Xi=sr.toLowerCase().indexOf("android")!==-1,ga=Xi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",wa="Mozilla/5.0 (".concat(ga,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Pn),Hi={platform:cr,language:Pn,appVersion:"5.0 (".concat(ga,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:wa},Ss={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},ou=0,el=0;function sf(e){var i=Date.now(),r=Math.max(ou+23,i);return el=setTimeout(function(){e(ou=r)},r-i),el}function dl(e){var i=qs();return i.requestAnimationFrame?i.requestAnimationFrame(e):sf(e)}function Dc(e){var i=qs();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Fu=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,ht.Z)(this,e),(0,A.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,Pt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=Bu(n),f="data:".concat(a,";base64, ");return f+s}}]),e}();function Bu(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return _i(i)}var Nu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},fo={};function zf(e){var i=Uf();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Uf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var is=new Map,Fc=new Map,zu=new Map,su={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function uf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Ol(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,uf.call(this,"readystatechange",i)}var Di=function(e){(0,Pr.Z)(r,e);var i=zf(r);function r(){var n;return(0,ht.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"onabort",void 0),(0,A.Z)((0,ue.Z)(n),"onerror",void 0),(0,A.Z)((0,ue.Z)(n),"onload",void 0),(0,A.Z)((0,ue.Z)(n),"onloadstart",void 0),(0,A.Z)((0,ue.Z)(n),"onprogress",void 0),(0,A.Z)((0,ue.Z)(n),"ontimeout",void 0),(0,A.Z)((0,ue.Z)(n),"onloadend",void 0),(0,A.Z)((0,ue.Z)(n),"onreadystatechange",void 0),(0,A.Z)((0,ue.Z)(n),"readyState",void 0),(0,A.Z)((0,ue.Z)(n),"response",void 0),(0,A.Z)((0,ue.Z)(n),"responseText",void 0),(0,A.Z)((0,ue.Z)(n),"_responseType",void 0),(0,A.Z)((0,ue.Z)(n),"responseXML",void 0),(0,A.Z)((0,ue.Z)(n),"status",void 0),(0,A.Z)((0,ue.Z)(n),"statusText",void 0),(0,A.Z)((0,ue.Z)(n),"upload",void 0),(0,A.Z)((0,ue.Z)(n),"withCredentials",void 0),(0,A.Z)((0,ue.Z)(n),"timeout",void 0),(0,A.Z)((0,ue.Z)(n),"_url",void 0),(0,A.Z)((0,ue.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,is.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,Pt.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=zu.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=Fc.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return Fc.get("responseHeader")[a]}},{key:"open",value:function(a,s,f){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var f=is.get("requestHeader");f[a]=s,is.set("requestHeader",f)}},{key:"addEventListener",value:function(a,s){var f=this;typeof s=="function"&&(this["on"+a]=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v.target=v.target||f,s.call(f,v)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(Pa);(0,A.Z)(Di,"UNSEND",void 0),(0,A.Z)(Di,"OPENED",void 0),(0,A.Z)(Di,"HEADERS_RECEIVED",void 0),(0,A.Z)(Di,"LOADING",void 0),(0,A.Z)(Di,"DONE",void 0),Di.UNSEND=0,Di.OPENED=1,Di.HEADERS_RECEIVED=2,Di.LOADING=3,Di.DONE=4;function Rl(e){var i=bh();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function bh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vl=function(e){(0,Pr.Z)(r,e);var i=Rl(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"touches",void 0),(0,A.Z)((0,ue.Z)(a),"targetTouches",void 0),(0,A.Z)((0,ue.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=qs(),a.currentTarget=qs(),a}return(0,Pt.Z)(r)}(aa);function Bc(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,f=i.clientX,v=f===void 0?0:f,g=i.clientY,x=g===void 0?0:g;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=v,e.y=x)}function Zf(e){return function(i){var r=new vl(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return Bc(n)}),r.touches.forEach(function(n){return Bc(n)}),r.targetTouches.forEach(function(n){return Bc(n)}),K.dispatchEvent(r)}}function Eh(e){return function(i){i.type=e,K.dispatchEvent(i)}}var jf=Zf("touchstart"),Nc=Zf("touchmove"),oc=Zf("touchend"),sc=Eh("mapCameaParams");function Ll(e){var i=ml();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function ml(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kl=function(e){(0,Pr.Z)(r,e);var i=Ll(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"buttons",void 0),(0,A.Z)((0,ue.Z)(a),"which",void 0),(0,A.Z)((0,ue.Z)(a),"pointerId",void 0),(0,A.Z)((0,ue.Z)(a),"bubbles",void 0),(0,A.Z)((0,ue.Z)(a),"button",void 0),(0,A.Z)((0,ue.Z)(a),"width",void 0),(0,A.Z)((0,ue.Z)(a),"height",void 0),(0,A.Z)((0,ue.Z)(a),"pressure",void 0),(0,A.Z)((0,ue.Z)(a),"isPrimary",void 0),(0,A.Z)((0,ue.Z)(a),"pointerType",void 0),(0,A.Z)((0,ue.Z)(a),"altKey",void 0),(0,A.Z)((0,ue.Z)(a),"ctrlKey",void 0),(0,A.Z)((0,ue.Z)(a),"metaKey",void 0),(0,A.Z)((0,ue.Z)(a),"shiftKey",void 0),a.target=qs(),a.currentTarget=qs(),a}return(0,Pt.Z)(r)}(aa),tl=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],$s=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],lf="touch";function cf(e,i,r){for(var n=new kl(e),a=0;a<tl.length;a++){var s=tl[a];n[s]=i[s]||$s[a]}return n.type=e,n.target=qs(),n.currentTarget=qs(),n.buttons=Vf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=uc(i),n.pointerType=lf,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Vf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var uu=null;function uc(e){return uu===e.identifier}function zc(e){uu===null&&(uu=e.identifier)}function ff(e){uu===e.identifier&&(uu=null)}function Dl(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?zc(a):(e==="pointerup"||e==="pointercancel")&&ff(a);var s=cf(e,a,i);K.dispatchEvent(s)}}}var np=Dl("pointerdown"),hf=Dl("pointermove"),Fl=Dl("pointerup");function pf(e){var i=df();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function df(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bl=function(e){(0,Pr.Z)(r,e);var i=pf(r);function r(n){return(0,ht.Z)(this,r),i.call(this,n)}return(0,Pt.Z)(r)}(aa);function Uc(e){return function(i){i.type=e,K.dispatchEvent(i)}}var Sh=Uc("mousedown"),Ch=Uc("mousemove"),lc=Uc("mouseup"),Ah=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Nl=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ji=Ah||Nl,cc={atob:Ti,btoa:_i,devicePixelRatio:ji,Blob:Ma,document:K,Element:yo,Event:aa,EventTarget:Pa,HTMLCanvasElement:xe,HTMLElement:Oo,HTMLMediaElement:Zs,HTMLVideoElement:ba,Image:Ju,ImageData:pt,navigator:Hi,Node:Io,requestAnimationFrame:dl,cancelAnimationFrame:Dc,screen:ne,XMLHttpRequest:Di,performance:Ss,URL:Fu,WebGLRenderingContext:Nu,WebGL2RenderingContext:fo,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};K.addEventListener(i,r,n)},removeEventListener:function(i,r,n){K.removeEventListener(i,r)},dispatchEvent:function(i){K.dispatchEvent(i)},innerWidth:ne.availWidth,innerHeight:ne.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},fa=Ji?cc:Ai,Uu=Ji?Di:Ai.XMLHttpRequest,Yi=Ji?Ks:Ai.location;function Ia(e){var i=e;return typeof e=="string"&&(i=fa.document.getElementById(e)),i}function Cs(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Zc(e){return Cs(e).split(/\s+/)}function rl(e){var i,r,n=fa==null||(i=fa.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function Wa(e,i,r){var n=fa.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function fc(e){var i=e.parentNode;i&&i.removeChild(e)}function zl(e,i){if(e.classList!==void 0)for(var r=Zc(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!jc(e,i)){var s=_o(e);Zu(e,(s?s+" ":"")+i)}}function nl(e,i){e.classList!==void 0?e.classList.remove(i):Zu(e,Cs((" "+_o(e)+" ").replace(" "+i+" "," ")))}function jc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=_o(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function Zu(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function _o(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Ul(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var hc=rl(["transform","WebkitTransform"]);function xo(e,i){e.style[hc]=i}function yn(){if(typeof Event=="function")fa.dispatchEvent(new Event("resize"));else{var e=fa.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,fa,0),fa.dispatchEvent(e)}}function ho(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function il(){var e,i=fa.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),f=(0,nn.Z)(s,2),v=f[0],g=f[1];return v==="initial-scale"});return n?n.split("=")[1]*1:1}var Fa=il()<1?1:fa.devicePixelRatio;function lu(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function ks(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Vc(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function Yr(e){if(e.length===0)throw new Error("mean requires at least one data point");return Vc(e)/e.length}function vf(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var pc={min:ks,max:lu,mean:Yr,sum:Vc,mode:vf};function ju(e,i){return e.map(function(r){return r[i]})}function Ba(e,i){return pc[e](i)}var As=z(14665);function Gc(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Vu=z(51814);function as(e,i,r){return(0,Vu.Z)()?as=Reflect.construct.bind():as=function(a,s,f){var v=[null];v.push.apply(v,s);var g=Function.bind.apply(a,v),x=new g;return f&&(0,As.Z)(x,f.prototype),x},as.apply(null,arguments)}function cu(e){var i=typeof Map=="function"?new Map:void 0;return cu=function(n){if(n===null||!Gc(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return as(n,arguments,(0,mt.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,As.Z)(a,n)},cu(e)}function wh(e){var i=Hc();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Hc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wc=function(e){(0,Pr.Z)(r,e);var i=wh(r);function r(n,a,s){var f;return(0,ht.Z)(this,r),f=i.call(this,n),(0,A.Z)((0,ue.Z)(f),"status",void 0),(0,A.Z)((0,ue.Z)(f),"url",void 0),f.status=a,f.url=s,f.name=f.constructor.name,f.message=n,f}return(0,Pt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(cu(Error));function mf(e){var i=new Uu;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var fu=function(i,r){var n=mf(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new Wc("".concat(n.statusText),n.status,i.url)):r(new Wc(n.statusText,n.status,i.url))},n.send(),n},js=function(i,r){var n=mf(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Wc(n.statusText,n.status,i.url))},n.send(),n};function ki(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Eu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Vs=function(i,r){return js(i,function(n,a){if(n)r(n);else if(a){var s=new fa.Image;s.crossOrigin="anonymous";var f=fa.URL||fa.webkitURL;s.onload=function(){r(null,s),f.revokeObjectURL(s.src),s.onload=null},s.onerror=function(){return r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var v=new fa.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?f.createObjectURL(v):Eu}})},So=2*Math.PI*6378137/2;function gl(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;al(i,n)}),i}function al(e,i){return Array.isArray(i[0])?i.forEach(function(r){al(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function Qs(e,i){return hs(e,i)}function hs(e,i){return Array.isArray(e[0])?e.map(function(r){return hs(r,i)}):i(e)}function Gs(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=ps(e,i);var n=e[0],a=e[1],s=n*So/180,f=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return f=f*So/180,r.enable&&(s=Number(s.toFixed(r.decimal)),f=Number(f.toFixed(r.decimal))),e.length===3?[s,f,e[2]]:[s,f]}function Fn(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/So*180,s=n/So*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function Tn(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Xc(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function ps(e,i){if(i===!1)return e;var r=Tn(e[0]),n=Xc(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Ro(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,f=r*a;f=Math.log(Math.tan(Math.PI/4+f/2));var v=.5/Math.PI,g=.5,x=-.5/Math.PI;return a=.5,s=n*(v*s+g),f=n*(x*f+a),[Math.floor(s),Math.floor(f)]}function os(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,f=_slicedToArray(e,2),v=f[0],g=f[1];v=(v/s-r)/i,g=(g/s-a)/n,g=(Math.atan(Math.pow(Math.E,g))-Math.PI/4)*2,a=Math.PI/180;var x=g/a,C=v/a;return[C,x]}function Gu(e,i){var r=85.0511287798,n=Math.PI/180,a=6378137;return i=Math.max(Math.min(r,i),-r),e*=n,i*=n,i=Math.log(Math.tan(Math.PI/4+i/2)),[e*a,i*a]}function gf(e,i,r){var n=nr(i[1]-e[1]),a=nr(i[0]-e[0]),s=nr(e[1]),f=nr(i[1]),v=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(f);return me(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),r="meters")}function yf(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),f=n*e[0]*i,v=n*Math.log((1+s)/(1-s))/2;return[f,v]}function ra(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function Oa(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Gf(e){return[[e[0],e[1]],[e[2],e[3]]]}function yl(e){var i=hu(e,[0,0]);return[e[0]/i,e[1]/i]}function hu(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Su(e,i){return e[0]*i[0]+e[1]*i[1]}function Lo(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function _l(e,i){return Math.acos(Su(e,i)/(Lo(e)*Lo(i)))*180/Math.PI}function Cu(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function _f(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var f=e[s],v=e[s+1],g=hu(f,v);n+=g;var x=[f[0]-v[0],f[1]-v[1]],C=Cu(r,x);if(s>0){var T=a[s-1].rotation;T-C>360-T+C&&(C=C+360)}a.push({start:f,end:v,dis:g,rotation:C,duration:0})}return a.map(function(O){O.duration=i*(O.dis/n)}),a}}var Zl=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,ht.Z)(this,e),(0,A.Z)(this,"limit",void 0),(0,A.Z)(this,"cache",void 0),(0,A.Z)(this,"destroy",void 0),(0,A.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Pt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function Au(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var Hf=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,ht.Z)(this,e),(0,A.Z)(this,"duration",16),(0,A.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,Pt.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),xl=z(2650);function bl(e){return typeof e=="string"?!!xl.ZP(e):!1}function Ea(e){var i=xl.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function Js(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function pu(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function jl(e){var i=fa.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],f=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var g=(e.positions[v]-s)/(f-s);n.addColorStop(g,e.colors[v])}if(r.fillStyle=n,r.fillRect(0,0,256,1),Ji)return a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),C=0;C<x.data.length;C+=4)x.data[C+0]=a[C+0],x.data[C+1]=a[C+1],x.data[C+2]=a[C+2],x.data[C+3]=a[C+3];return x}var wu;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(wu||(wu={}));var ws={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Yc(e,i,r){var n=e.classList;for(var a in ws)ws.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function Na(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var ol={BACK:1029,FRONT:1028};function Hu(e){switch(e){case"GAODE1.x":return ol.BACK;case"GAODE2.x":return ol.BACK;case"MAPBOX":return ol.FRONT;case"SIMPLE":return ol.FRONT;case"GLOBEL":return ol.BACK;case"L7MAP":return ol.FRONT;default:return ol.FRONT}}function l(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function h(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=i.x,n=i.y,a=i.z;if(Array.isArray(e)){var s=Math.abs(r+n)%e.length;e=e[s]}return e.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,a.toString()).replace(/\{-y\}/g,(Math.pow(2,a)-n-1).toString())}var c;(function(e){e.Overlap="overlap",e.Replace="replace"})(c||(c={}));var d;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(d||(d={}));var E=z(92137),w=z(87757),M=z.n(w);function L(e,i){i===void 0&&(i={});var r=Number(e[0]),n=Number(e[1]),a=Number(e[2]),s=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var f=[r,n],v=[r,s],g=[a,s],x=[a,n];return Oi([[f,x,g,v,f]],i.properties,{bbox:e,id:i.id})}var U=0,Y=1,le=2;function pe(e){e.forEach(function(i){i.properties.state=U}),e.forEach(function(i){i.isCurrent&&!Re(i)&&Ie(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&le)})}function ve(e){e.forEach(function(r){r.properties.state=U}),e.forEach(function(r){r.isCurrent&&Re(r)});var i=e.slice().sort(function(r,n){return r.z-n.z});i.forEach(function(r){r.isVisible=Boolean(r.properties.state&le),r.children.length&&(r.isVisible||r.properties.state&Y)?r.children.forEach(function(n){n.properties.state=Y}):r.isCurrent&&Ie(r)})}function Re(e){for(;e;){if(e.isLoaded)return e.properties.state|=le,!0;e=e.parent}return!1}function Ie(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=le:Ie(i)})}var je,we=256,Ge=[-Infinity,-Infinity,Infinity,Infinity],tt=5,xt=(je={},(0,A.Z)(je,c.Overlap,pe),(0,A.Z)(je,c.Replace,ve),je),Ht=function(){};function Zt(e,i,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),a=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,a]}function Jt(e,i,r){var n=e/Math.pow(2,r)*360-180,a=Math.PI-2*Math.PI*i/Math.pow(2,r),s=180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)));return[n,s]}var mr=function(i,r,n){var a=Jt(i,r,n),s=(0,nn.Z)(a,2),f=s[0],v=s[1],g=Jt(i+1,r+1,n),x=(0,nn.Z)(g,2),C=x[0],T=x[1];return[f,T,C,v]};function Br(e){var i=e.zoom,r=e.latLonBounds,n=e.maxZoom,a=n===void 0?Infinity:n,s=e.minZoom,f=s===void 0?0:s,v=e.zoomOffset,g=v===void 0?0:v,x=e.extent,C=x===void 0?Ge:x,T=Math.ceil(i)+g;T<f?T=f:T>a&&(T=a);for(var O=(0,nn.Z)(r,4),k=O[0],j=O[1],X=O[2],te=O[3],Ee=[Math.max(k,C[0]),Math.max(j,C[1]),Math.min(X,C[2]),Math.min(te,C[3])],Ne=[],$e=Zt(Ee[0],Ee[1],T),ot=(0,nn.Z)($e,2),Et=ot[0],_t=ot[1],qt=Zt(Ee[2],Ee[3],T),or=(0,nn.Z)(qt,2),Mr=or[0],Xr=or[1],yr=Et;yr<=Mr;yr++)for(var sn=Xr;sn<=_t;sn++)Ne.push({x:yr,y:sn,z:T});return Ne}var kr=function(i,r,n){var a=Math.pow(2,n),s=a-1,f=a,v=i,g=r;return v<0?v=v+f:v>s&&(v=v%f),{warpX:v,warpY:g}},un=function(){function e(i){(0,ht.Z)(this,e),(0,A.Z)(this,"x",void 0),(0,A.Z)(this,"y",void 0),(0,A.Z)(this,"z",void 0),(0,A.Z)(this,"tileSize",256),(0,A.Z)(this,"isVisible",!1),(0,A.Z)(this,"isCurrent",!1),(0,A.Z)(this,"layer",null),(0,A.Z)(this,"layers",[]),(0,A.Z)(this,"parent",null),(0,A.Z)(this,"children",[]),(0,A.Z)(this,"data",null),(0,A.Z)(this,"properties",{}),(0,A.Z)(this,"loadStatus",void 0),(0,A.Z)(this,"abortController",void 0),(0,A.Z)(this,"loadDataId",0);var r=i.x,n=i.y,a=i.z,s=i.tileSize;this.x=r,this.y=n,this.z=a,this.tileSize=s}return(0,Pt.Z)(e,[{key:"isLoading",get:function(){return this.loadStatus===d.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===d.Loaded}},{key:"isCancelled",get:function(){return this.loadStatus===d.Cancelled}},{key:"isDone",get:function(){return[d.Loaded,d.Cancelled,d.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return mr(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var r=(0,nn.Z)(this.bounds,4),n=r[0],a=r[1],s=r[2],f=r[3],v=[(s-n)/2,(f-a)/2],g=L(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:v,meta:`
      `.concat(this.key,`
      `)}});return g}},{key:"key",get:function(){var r="".concat(this.x,",").concat(this.y,",").concat(this.z);return r}},{key:"loadData",value:function(){var i=(0,E.Z)(M().mark(function n(a){var s,f,v,g,x,C,T,O,k,j,X,te,Ee,Ne,$e,ot;return M().wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:return s=a.getData,f=a.onLoad,v=a.onError,this.loadDataId++,g=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=d.Loading,x=null,_t.prev=7,T=this.x,O=this.y,k=this.z,j=this.bounds,X=this.tileSize,te=kr(T,O,k),Ee=te.warpX,Ne=te.warpY,$e=this.abortController.signal,ot={x:Ee,y:Ne,z:k,bounds:j,tileSize:X,signal:$e},_t.next=14,s(ot);case 14:x=_t.sent,_t.next=20;break;case 17:_t.prev=17,_t.t0=_t.catch(7),C=_t.t0;case 20:if(g===this.loadDataId){_t.next=22;break}return _t.abrupt("return");case 22:if(!(this.isCancelled&&!x)){_t.next=24;break}return _t.abrupt("return");case 24:if(!(C||!x)){_t.next=28;break}return this.loadStatus=d.Failure,v(C,this),_t.abrupt("return");case 28:this.loadStatus=d.Loaded,this.data=x,f(this);case 31:case"end":return _t.stop()}},n,this,[[7,17]])}));function r(n){return i.apply(this,arguments)}return r}()},{key:"reloadData",value:function(r){this.isLoading&&this.abortLoad(),this.loadData(r)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=d.Cancelled,this.abortController.abort())}}]),e}(),Mn=z(26729),Nn=z.n(Mn);function Rn(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Fi(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Fi(e,i){if(!!e){if(typeof e=="string")return ln(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ln(e,i)}}function ln(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function oi(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function si(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?oi(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oi(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ni(e){var i=Xn();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Xn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yi=function(e){(0,Pr.Z)(r,e);var i=ni(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this),(0,A.Z)((0,ue.Z)(a),"currentTiles",[]),(0,A.Z)((0,ue.Z)(a),"options",void 0),(0,A.Z)((0,ue.Z)(a),"cacheTiles",new Map),(0,A.Z)((0,ue.Z)(a),"lastViewStates",void 0),(0,A.Z)((0,ue.Z)(a),"onTileLoad",function(s){a.emit("tile-loaded",s),a.updateTileVisible()}),(0,A.Z)((0,ue.Z)(a),"onTileError",function(s,f){a.emit("tile-error",{error:s,tile:f}),a.updateTileVisible()}),(0,A.Z)((0,ue.Z)(a),"onTileUnload",function(s){a.emit("tile-unload",s)}),a.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:Ge,getTileData:Ht,updateStrategy:c.Overlap},a.updateOptions(n),a}return(0,Pt.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(a){return a.isDone})}},{key:"tiles",get:function(){var a=Array.from(this.cacheTiles.values()).sort(function(s,f){return s.z-f.z});return a}},{key:"updateOptions",value:function(a){var s=a.minZoom===void 0?this.options.minZoom:Math.ceil(a.minZoom),f=a.maxZoom===void 0?this.options.maxZoom:Math.floor(a.maxZoom);this.options=si(si(si({},this.options),a),{},{minZoom:s,maxZoom:f})}},{key:"update",value:function(a,s){var f=this;if(!(this.lastViewStates&&this.lastViewStates.zoom===a&&this.lastViewStates.latLonBounds.toString()===s.toString())){this.lastViewStates={zoom:a,latLonBounds:s};var v=!1,g=this.getTileIndices(a,s);this.currentTiles=g.map(function(x){var C=x.x,T=x.y,O=x.z,k=f.getTile(C,T,O);return k||(k=f.createTile(C,T,O),v=!0,k)}),v&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible()}}},{key:"reloadAll",value:function(){var a=Rn(this.cacheTiles),s;try{for(a.s();!(s=a.n()).done;){var f=(0,nn.Z)(s.value,2),v=f[0],g=f[1];this.currentTiles.includes(g)||(this.cacheTiles.delete(v),this.onTileUnload(g)),this.onTileUnload(g),g.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(x){a.e(x)}finally{a.f()}}},{key:"destroy",value:function(){var a=Rn(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f.isLoading&&f.abortLoad()}}catch(v){a.e(v)}finally{a.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var a=this.options.updateStrategy,s=new Map,f=Rn(this.cacheTiles.values()),v;try{for(f.s();!(v=f.n()).done;){var g=v.value;s.set(g.key,g.isVisible),g.isCurrent=!1,g.isVisible=!1}}catch(j){f.e(j)}finally{f.f()}var x=Rn(this.currentTiles),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.isCurrent=!0,T.isVisible=!0}}catch(j){x.e(j)}finally{x.f()}var O=Array.from(this.cacheTiles.values());typeof a=="function"?a(O):xt[a](O);var k=Array.from(this.cacheTiles.values()).some(function(j){return j.isVisible!==s.get(j.key)});k&&this.emit("tile-update")}},{key:"getTileIndices",value:function(a,s){var f=this.options,v=f.tileSize,g=f.extent,x=f.zoomOffset,C=Math.floor(this.options.maxZoom),T=Math.ceil(this.options.minZoom),O=Br({maxZoom:C,minZoom:T,zoomOffset:x,tileSize:v,zoom:a,latLonBounds:s,extent:g});return O}},{key:"getTileId",value:function(a,s,f){var v="".concat(a,",").concat(s,",").concat(f);return v}},{key:"getTile",value:function(a,s,f){var v=this.getTileId(a,s,f),g=this.cacheTiles.get(v);return g}},{key:"createTile",value:function(a,s,f){var v=this.getTileId(a,s,f),g=new un({x:a,y:s,z:f,tileSize:this.options.tileSize});return this.cacheTiles.set(v,g),g.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),g}},{key:"resizeCacheTiles",value:function(){var a=tt*this.currentTiles.length,s=this.cacheTiles.size>a;if(s){var f=Rn(this.cacheTiles),v;try{for(f.s();!(v=f.n()).done;){var g=(0,nn.Z)(v.value,2),x=g[0],C=g[1];if(!C.isVisible&&!this.currentTiles.includes(C)&&(this.cacheTiles.delete(x),this.onTileUnload(C)),this.cacheTiles.size<=a)break}}catch(T){f.e(T)}finally{f.f()}}}},{key:"rebuildTileTree",value:function(){var a=Rn(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f.parent=null,f.children.length=0}}catch(T){a.e(T)}finally{a.f()}var v=Rn(this.cacheTiles.values()),g;try{for(v.s();!(g=v.n()).done;){var x=g.value,C=this.getNearestAncestor(x.x,x.y,x.z);x.parent=C,C!=null&&C.children&&C.children.push(x)}}catch(T){v.e(T)}finally{v.f()}}},{key:"getNearestAncestor",value:function(a,s,f){for(;f>this.options.minZoom;){a=Math.floor(a/2),s=Math.floor(s/2),f=f-1;var v=this.getTile(a,s,f);if(v)return v}return null}}]),r}(Nn());function Kn(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(f){e instanceof HTMLImageElement?f([e]):Yn(e,function(v){f(v)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function Yn(e,i){var r=e,n=[];if(typeof r=="string")Vs({url:r},function(f,v){n.push(v),i(n)});else{var a=r.length,s=0;r.forEach(function(f){Vs({url:f},function(v,g){s++,n.push(g),s===a&&i(n)})})}return Kn}function Co(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,f=i.max,v={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:f,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return v}function Ya(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ao(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ya(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ya(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Go={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},no=function(){var e=(0,E.Z)(M().mark(function i(r,n){var a;return M().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return a=h(r,n),f.abrupt("return",new Promise(function(v,g){Vs({url:a},function(x,C){x?g(x):v(C)})}));case 2:case"end":return f.stop()}},i)}));return function(r,n){return e.apply(this,arguments)}}();function po(e,i){var r=function(s){return no(e,s)},n=Ao(Ao(Ao({},Go),i),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n}}var Ds=z(30236),ds=z.n(Ds),Wu=z(47037),qa=z.n(Wu),du=z(23560),$o=z.n(du),dc=z(50361),vu=z.n(dc),mu=z(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Vl(e,i,r,n){function a(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function v(C){try{x(n.next(C))}catch(T){f(T)}}function g(C){try{x(n.throw(C))}catch(T){f(T)}}function x(C){C.done?s(C.value):a(C.value).then(v,g)}x((n=n.apply(e,i||[])).next())})}function vc(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,f;return f={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function v(x){return function(C){return g([x,C])}}function g(x){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=x[0]&2?a.return:x[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,x[1])).done)return s;switch(a=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,a=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){r.label=x[1];break}if(x[0]===6&&r.label<s[1]){r.label=s[1],s=x;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(x);break}s[2]&&r.ops.pop(),r.trys.pop();continue}x=i.call(e,r)}catch(C){x=[6,C],a=0}finally{n=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function gu(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(v){f={error:v}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(f)throw f.error}}return s}function Gl(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(gu(arguments[i]));return e}function Ra(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function qi(e,i){return i={exports:{}},e(i,i.exports),i.exports}var eu=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});Ra(eu);var Xu=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});Ra(Xu);var Hs=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof mu=="object"&&typeof mu.nextTick=="function";function a(v){setTimeout(v,0)}function s(v){return function(g){for(var x=[],C=arguments.length-1;C-- >0;)x[C]=arguments[C+1];return v(function(){return g.apply(void 0,x)})}}var f;r?f=setImmediate:n?f=mu.nextTick:f=a,i.default=s(f)});Ra(Hs);var ha=Hs.fallback,tu=Hs.wrap,Ts=Hs.hasSetImmediate,El=Hs.hasNextTick,mc=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Xu),n=a(Hs);function a(g){return g&&g.__esModule?g:{default:g}}function s(g){return(0,Fs.isAsync)(g)?function(){for(var x=[],C=arguments.length;C--;)x[C]=arguments[C];var T=x.pop(),O=g.apply(this,x);return f(O,T)}:(0,r.default)(function(x,C){var T;try{T=g.apply(this,x)}catch(O){return C(O)}if(T&&typeof T.then=="function")return f(T,C);C(null,T)})}function f(g,x){return g.then(function(C){v(x,null,C)},function(C){v(x,C&&C.message?C:new Error(C))})}function v(g,x,C){try{g(x,C)}catch(T){(0,n.default)(function(O){throw O},T)}}e.exports=i.default});Ra(mc);var Fs=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(mc);function n(g){return g&&g.__esModule?g:{default:g}}function a(g){return g[Symbol.toStringTag]==="AsyncFunction"}function s(g){return g[Symbol.toStringTag]==="AsyncGenerator"}function f(g){return typeof g[Symbol.asyncIterator]=="function"}function v(g){if(typeof g!="function")throw new Error("expected a function");return a(g)?(0,r.default)(g):g}i.default=v,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=f});Ra(Fs);var Wf=Fs.isAsyncIterable,yu=Fs.isAsyncGenerator,qc=Fs.isAsync,vs=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var f=this,v=[],g=arguments.length;g--;)v[g]=arguments[g];return typeof v[a-1]=="function"?n.apply(this,v):new Promise(function(x,C){v[a-1]=function(T){for(var O=[],k=arguments.length-1;k-- >0;)O[k]=arguments[k+1];if(T)return C(T);x(O.length>1?O:O[0])},n.apply(f,v)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});Ra(vs);var Yu=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(eu),n=s(Fs),a=s(vs);function s(f){return f&&f.__esModule?f:{default:f}}i.default=(0,a.default)(function(f,v,g){var x=(0,r.default)(v)?[]:{};f(v,function(C,T,O){(0,n.default)(C)(function(k){for(var j,X=[],te=arguments.length-1;te-- >0;)X[te]=arguments[te+1];X.length<2&&(j=X,X=j[0]),x[T]=X,O(k)})},function(C){return g(C,x)})},3),e.exports=i.default});Ra(Yu);var Sl=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],f=arguments.length;f--;)s[f]=arguments[f];if(n!==null){var v=n;n=null,v.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});Ra(Sl);var _u=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});Ra(_u);var ko=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=g;var r=a(eu),n=a(_u);function a(x){return x&&x.__esModule?x:{default:x}}function s(x){var C=-1,T=x.length;return function(){return++C<T?{value:x[C],key:C}:null}}function f(x){var C=-1;return function(){var O=x.next();return O.done?null:(C++,{value:O.value,key:C})}}function v(x){var C=x?Object.keys(x):[],T=-1,O=C.length;return function(){var j=C[++T];return T<O?{value:x[j],key:j}:null}}function g(x){if((0,r.default)(x))return s(x);var C=(0,n.default)(x);return C?f(C):v(x)}e.exports=i.default});Ra(ko);var Cl=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var f=n;n=null,f.apply(this,a)}}e.exports=i.default});Ra(Cl);var gc=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});Ra(gc);var Xf=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(gc);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,f,v,g){var x=!1,C=!1,T=!1,O=0,k=0;function j(){O>=f||T||x||(T=!0,s.next().then(function(Ee){var Ne=Ee.value,$e=Ee.done;if(!(C||x)){if(T=!1,$e){x=!0,O<=0&&g(null);return}O++,v(Ne,k,X),k++,j()}}).catch(te))}function X(Ee,Ne){if(O-=1,!C){if(Ee)return te(Ee);if(Ee===!1){x=!0,C=!0;return}if(Ne===r.default||x&&O<=0)return x=!0,g(null);j()}}function te(Ee){C||(T=!1,x=!0,g(Ee))}j()}e.exports=i.default});Ra(Xf);var xf=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=v(Sl),n=v(ko),a=v(Cl),s=v(Xf),f=v(gc);function v(g){return g&&g.__esModule?g:{default:g}}i.default=function(g){return function(x,C,T){if(T=(0,r.default)(T),g<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return T(null);if((0,Fs.isAsyncGenerator)(x))return(0,s.default)(x,g,C,T);if((0,Fs.isAsyncIterable)(x))return(0,s.default)(x[Symbol.asyncIterator](),g,C,T);var O=(0,n.default)(x),k=!1,j=!1,X=0,te=!1;function Ee($e,ot){if(!j)if(X-=1,$e)k=!0,T($e);else if($e===!1)k=!0,j=!0;else{if(ot===f.default||k&&X<=0)return k=!0,T(null);te||Ne()}}function Ne(){for(te=!0;X<g&&!k;){var $e=O();if($e===null){k=!0,X<=0&&T(null);return}X+=1,C($e.value,$e.key,(0,a.default)(Ee))}te=!1}Ne()}},e.exports=i.default});Ra(xf);var Yf=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(xf),n=s(Fs),a=s(vs);function s(v){return v&&v.__esModule?v:{default:v}}function f(v,g,x,C){return(0,r.default)(g)(v,(0,n.default)(x),C)}i.default=(0,a.default)(f,4),e.exports=i.default});Ra(Yf);var Th=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(Yf),n=a(vs);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v,g){return(0,r.default)(f,1,v,g)}i.default=(0,n.default)(s,3),e.exports=i.default});Ra(Th);var yc=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Yu),n=a(Th);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v){return(0,r.default)(n.default,f,v)}e.exports=i.default}),Kc=Ra(yc),Tu=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Kc(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,Gl(n.args)),a(null,i)})},e}(),ip=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=x(eu),n=x(gc),a=x(Yf),s=x(Sl),f=x(Cl),v=x(Fs),g=x(vs);function x(k){return k&&k.__esModule?k:{default:k}}function C(k,j,X){X=(0,s.default)(X);var te=0,Ee=0,Ne=k.length,$e=!1;Ne===0&&X(null);function ot(Et,_t){Et===!1&&($e=!0),$e!==!0&&(Et?X(Et):(++Ee===Ne||_t===n.default)&&X(null))}for(;te<Ne;te++)j(k[te],te,(0,f.default)(ot))}function T(k,j,X){return(0,a.default)(k,Infinity,j,X)}function O(k,j,X){var te=(0,r.default)(k)?C:T;return te(k,(0,v.default)(j),X)}i.default=(0,g.default)(O,3),e.exports=i.default});Ra(ip);var Hl=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(ip),n=a(Yu);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v){return(0,n.default)(r.default,f,v)}e.exports=i.default}),bf=Ra(Hl),Gp=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return bf(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return Vl(n,void 0,void 0,function(){return vc(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),Ad=qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=f(Sl),n=f(Cl),a=f(Fs),s=f(vs);function f(g){return g&&g.__esModule?g:{default:g}}function v(g,x){if(x=(0,r.default)(x),!Array.isArray(g))return x(new Error("First argument to waterfall must be an array of functions"));if(!g.length)return x();var C=0;function T(k){var j=(0,a.default)(g[C++]);j.apply(void 0,k.concat([(0,n.default)(O)]))}function O(k){for(var j=[],X=arguments.length-1;X-- >0;)j[X]=arguments[X+1];if(k!==!1){if(k||C===g.length)return x.apply(void 0,[k].concat(j));T(j)}}T([])}i.default=(0,s.default)(v),e.exports=i.default}),Ef=Ra(Ad),ap=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Ef(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),op=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Kc(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),wd=z(69848),sp=z.n(wd);function Mh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Hp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Mh(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $c(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,f=i.minZoom,v=f===void 0?0:f,g=i.zoom,x=g===void 0?2:g;if(e.pointIndex){var C=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=Td(C),e}var T=new(sp())({radius:n,minZoom:v,maxZoom:s}),O={type:"FeatureCollection",features:[]};return O.features=e.dataArray.map(function(k){return{type:"Feature",geometry:{type:"Point",coordinates:k.coordinates},properties:Hp({},k)}}),T.load(O.features),T}function Td(e){return e.map(function(i,r){return Hp({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Do(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Ph(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function up(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function Ih(e){if(e.length===0)throw new Error("mean requires at least one data point");return up(e)/e.length}var Oh={min:Ph,max:Do,mean:Ih,sum:up};function qf(e,i){return e.map(function(r){return r[i]*1})}function Kf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Wl(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Kf(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _c(e){var i=Sf();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Sf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function $f(e,i){if(Array.isArray(i))return i}var Rh=function(e){(0,Pr.Z)(r,e);var i=_c(r);function r(n,a){var s;return(0,ht.Z)(this,r),s=i.call(this),(0,A.Z)((0,ue.Z)(s),"data",void 0),(0,A.Z)((0,ue.Z)(s),"center",void 0),(0,A.Z)((0,ue.Z)(s),"extent",void 0),(0,A.Z)((0,ue.Z)(s),"hooks",{init:new Tu}),(0,A.Z)((0,ue.Z)(s),"parser",{type:"geojson"}),(0,A.Z)((0,ue.Z)(s),"transforms",[]),(0,A.Z)((0,ue.Z)(s),"cluster",!1),(0,A.Z)((0,ue.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,A.Z)((0,ue.Z)(s),"tileset",void 0),(0,A.Z)((0,ue.Z)(s),"mapService",void 0),(0,A.Z)((0,ue.Z)(s),"invalidExtent",!1),(0,A.Z)((0,ue.Z)(s),"dataArrayChanged",!1),(0,A.Z)((0,ue.Z)(s),"originData",void 0),(0,A.Z)((0,ue.Z)(s),"rawData",void 0),(0,A.Z)((0,ue.Z)(s),"cfg",{}),(0,A.Z)((0,ue.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,Pt.Z)(r,[{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,f=this.clusterOptions,v=f.method,g=v===void 0?"sum":v,x=f.field,C=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,C.forEach(function(T){T.id||(T.properties.point_count=1)}),(x||$o()(g))&&(C=C.map(function(T){var O=T.id;if(O){var k=s.clusterIndex.getLeaves(O,Infinity),j=k.map(function(Ee){return Ee.properties}),X;if(qa()(g)&&x){var te=qf(j,x);X=Oh[g](te)}$o()(g)&&(X=g(j)),T.properties.stat=X}else T.properties.point_count=1;return T})),this.data=fe("geojson")({type:"FeatureCollection",features:C}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,f=s===void 0?"geojson":s;if(f==="geojson"&&!this.cluster){var v=a<this.originData.features.length?this.originData.features[a]:"null",g=vu()(v);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(C){return C._id===a});g.properties=x}return g}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(f){return f._id===a?Wl(Wl({},f),s):f}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var f=this.data.dataArray.find(function(v){return v[a]===s});return f==null?void 0:f._id}},{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"destroy",value:function(){var a;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(a=this.tileset)===null||a===void 0||a.destroy()}},{key:"initCfg",value:function(a){this.cfg=ds()(this.cfg,a,$f);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=Wl(Wl({},this.clusterOptions),s.clusterOptions)))}},{key:"init",value:function(){this.hooks.init.call(this)}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson",f=fe(s);this.data=f(this.originData,a),this.extent=gl(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3],this.tileset=this.initTileset()}},{key:"setCenter",value:function(a){this.center=[(a[0]+a[2])/2,(a[1]+a[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var a=this.data.tilesetOptions;if(!!a){if(this.tileset)return this.tileset.updateOptions(a),this.tileset;var s=new yi(Wl({},a));return s}}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(f){var v=f.type,g=J(v)(a.data,f);Object.assign(a.data,g)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=$c(this.data,a)}}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=ra(Gf(this.extent),a)),s[0].concat(s[1])}}]),r}(Mn.EventEmitter);function xc(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Qf(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Jf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Jf(e,i){if(!!e){if(typeof e=="string")return eh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eh(e,i)}}function eh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var bc=6378e3;function Cf(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*bc)*(256<<20)/2,f=ru(r,a),v=f.gridHash,g=f.gridOffset,x=ih(v,g,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function ru(e,i){var r=Infinity,n=-Infinity,a,s=Qf(e),f;try{for(s.s();!(f=s.n()).done;){var v=f.value;a=v.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch($e){s.e($e)}finally{s.f()}var g=(r+n)/2,x=th(i,g);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var C={},T=Qf(e),O;try{for(T.s();!(O=T.n()).done;){var k=O.value,j=k.coordinates[1],X=k.coordinates[0];if(Number.isFinite(j)&&Number.isFinite(X)){var te=Math.floor((j+90)/x.yOffset),Ee=Math.floor((X+180)/x.xOffset),Ne="".concat(te,"-").concat(Ee);C[Ne]=C[Ne]||{count:0,points:[]},C[Ne].count+=1,C[Ne].points.push(k)}}}catch($e){T.e($e)}finally{T.f()}return{gridHash:C,gridOffset:x}}function th(e,i){var r=rh(e),n=nh(i,e);return{yOffset:r,xOffset:n}}function rh(e){return e/bc*(180/Math.PI)}function nh(e,i){return i/bc*(180/Math.PI)/Math.cos(e*Math.PI/180)}function ih(e,i,r){return Object.keys(e).reduce(function(n,a,s){var f=a.split("-"),v=parseInt(f[0],10),g=parseInt(f[1],10),x={};if(r.field&&r.method){var C=ju(e[a].points,r.field);x[r.method]=pc[r.method](C)}return Object.assign(x,{_id:s,coordinates:Ro([-180+i.xOffset*(g+.5),-90+i.yOffset*(v+.5)]),rawData:e[a].points,count:e[a].count}),n.push(x),n},[])}var Xl=Math.PI/3,Al=[0,Xl,2*Xl,3*Xl,4*Xl,5*Xl];function Qc(e){return e[0]}function Wp(e){return e[1]}function Lh(){var e=0,i=0,r=1,n=1,a=Qc,s=Wp,f,v,g;function x(T){var O={},k=[],j,X=T.length;for(j=0;j<X;++j)if(!(isNaN(Ee=+a.call(null,te=T[j],j,T))||isNaN(Ne=+s.call(null,te,j,T)))){var te,Ee,Ne,$e=Math.round(Ne=Ne/g),ot=Math.round(Ee=Ee/v-($e&1)/2),Et=Ne-$e;if(Math.abs(Et)*3>1){var _t=Ee-ot,qt=ot+(Ee<ot?-1:1)/2,or=$e+(Ne<$e?-1:1),Mr=Ee-qt,Xr=Ne-or;_t*_t+Et*Et>Mr*Mr+Xr*Xr&&(ot=qt+($e&1?1:-1)/2,$e=or)}var yr=ot+"-"+$e,sn=O[yr];sn?sn.push(te):(k.push(sn=O[yr]=[te]),sn.x=(ot+($e&1)/2)*v,sn.y=$e*g)}return k}function C(T){var O=0,k=0;return Al.map(function(j){var X=Math.sin(j)*T,te=-Math.cos(j)*T,Ee=X-O,Ne=te-k;return O=X,k=te,[Ee,Ne]})}return x.hexagon=function(T){return"m"+C(T==null?f:+T).join("l")+"z"},x.centers=function(){for(var T=[],O=Math.round(i/g),k=Math.round(e/v),j=O*g;j<n+f;j+=g,++O)for(var X=k*v+(O&1)*v/2;X<r+v/2;X+=v)T.push([X,j]);return T},x.mesh=function(){var T=C(f).slice(0,4).join("l");return x.centers().map(function(O){return"M"+O+"m"+T}).join("")},x.x=function(T){return arguments.length?(a=T,x):a},x.y=function(T){return arguments.length?(s=T,x):s},x.radius=function(T){return arguments.length?(f=+T,v=f*2*Math.sin(Xl),g=f*1.5,x):f},x.size=function(T){return arguments.length?(e=i=0,r=+T[0],n=+T[1],x):[r-e,n-i]},x.extent=function(T){return arguments.length?(e=+T[0][0],i=+T[0][1],r=+T[1][0],n=+T[1][1],x):[[e,i],[r,n]]},x.radius(1)}function lp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?lp(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Md=6378e3;function Mu(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,f=s===void 0?"sum":s,v=a/(2*Math.PI*Md)*(256<<20)/2,g=r.map(function(O){var k=Ro(O.coordinates),j=(0,nn.Z)(k,2),X=j[0],te=j[1];return Xp(Xp({},O),{},{coordinates:[X,te]})}),x=Lh().radius(v).x(function(O){return O.coordinates[0]}).y(function(O){return O.coordinates[1]}),C=x(g),T={dataArray:C.map(function(O,k){var j;if(i.field&&f){var X=ju(O,i.field);O[f]=pc[f](X)}return j={},(0,A.Z)(j,i.method,O[f]),(0,A.Z)(j,"count",O.length),(0,A.Z)(j,"rawData",O),(0,A.Z)(j,"coordinates",[O.x,O.y]),(0,A.Z)(j,"_id",k),j}),radius:v,xOffset:v,yOffset:v,type:"hexagon"};return T}function cp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ah(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?cp(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Af(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(f){s[f[r]]=f}),e.dataArray=e.dataArray.map(function(f){var v=f[n];return ah(ah({},f),s[v])}),e}function sl(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Le("rasterTile",po),Le("geojson",Hr),Le("image",Kn),Le("csv",vn),Le("json",Kt),Le("raster",Co),Xe("cluster",$c),Xe("filter",xc),Xe("join",Af),Xe("map",sl),Xe("grid",Cf),Xe("hexagon",Mu);var Yp=Cr,Pd=Qn,qu=Rh,oh=z(28660),zr=z(86700),Ec=z(84879),Yt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},fp=z(31745),kh=z.n(fp);function Dh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ya(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Dh(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yl(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Fo(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Fo(e,i){if(!!e){if(typeof e=="string")return Ws(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ws(e,i)}}function Ws(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var wf=30;function qp(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,f=e.mapping,v=f===void 0?{}:f,g=e.xOffset,x=g===void 0?0:g,C=e.yOffset,T=C===void 0?0:C,O=0,k=x;Array.from(i).forEach(function(X,te){if(!v[X]){var Ee=r(X,te);k+wf>s&&(k=0,O++),v[X]={x:k,y:T+O*wf,width:wf,height:wf,advance:Ee},k+=wf}});var j=n+a*2;return{mapping:v,xOffset:k,yOffset:T+O*j,canvasHeight:$p(T+(O+1)*j)}}function Id(e,i,r){var n=0,a=0,s=0,f=[],v={},g=Yl(e),x;try{for(g.s();!(x=g.n()).done;){var C=x.value;if(!v[C.id]){var T=C.size;n+T+i>r&&(Kp(v,f,a),n=0,a=s+a+i,s=0,f=[]),f.push({icon:C,xOffset:n}),n=n+T+i,s=Math.max(s,T)}}}catch(k){g.e(k)}finally{g.f()}f.length>0&&Kp(v,f,a);var O=$p(s+a+i);return{mapping:v,canvasHeight:O}}function Kp(e,i,r){var n=Yl(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,f=s.icon,v=s.xOffset;e[f.id]=ya(ya({},f),{},{x:v,y:r,image:f.image,width:f.width,height:f.height})}}catch(g){n.e(g)}finally{n.f()}}function $p(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Fh,Qp;function Jp(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=sh(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function sh(e,i){if(!!e){if(typeof e=="string")return hp(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hp(e,i)}}function hp(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function pp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?pp(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var La=er(),dp="sans-serif",ql="normal",Tf=24,vp=3,Od=.25,B=8,ge=1024,Be=1,kt=1,ur=3,Dt=null;function er(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function hr(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function gr(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var xr=(Fh=(0,zr.b2)(),Fh(Qp=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"fontAtlas",void 0),(0,A.Z)(this,"iconFontMap",void 0),(0,A.Z)(this,"iconFontGlyphs",{}),(0,A.Z)(this,"fontOptions",void 0),(0,A.Z)(this,"key",void 0),(0,A.Z)(this,"cache",new Zl(ur))}return(0,Pt.Z)(e,[{key:"scale",get:function(){return kt}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:dp,fontWeight:ql,characterSet:La,fontSize:Tf,buffer:vp,sdf:!0,cutoff:Od,radius:B,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=Jc(Jc({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,f=s.fontFamily,v=s.fontWeight,g=s.fontSize,x=s.buffer,C=s.sdf,T=s.radius,O=s.cutoff,k=s.iconfont,j=a&&a.data;j||(j=fa.document.createElement("canvas"),j.width=ge);var X=j.getContext("2d");hr(X,f,g,v);var te=qp(Jc({getFontWidth:function(Os){return X.measureText(Os).width},fontHeight:g*kt,buffer:x,characterSet:n,maxCanvasWidth:ge},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),Ee=te.mapping,Ne=te.canvasHeight,$e=te.xOffset,ot=te.yOffset,Et=X.getImageData(0,0,j.width,j.height);if(j.height=Ne,X.putImageData(Et,0,0),hr(X,f,g,v),C){var _t=new(kh())(g,x,T,O,f,v),qt=X.getImageData(0,0,_t.size,_t.size),or=Jp(n),Mr;try{for(or.s();!(Mr=or.n()).done;){var Xr=Mr.value;if(k){var yr=String.fromCharCode(parseInt(Xr.replace("&#x","").replace(";",""),16)),sn=_t.draw(yr);gr(sn,qt)}else gr(_t.draw(Xr),qt);X.putImageData(qt,Ee[Xr].x,Ee[Xr].y)}}catch(Po){or.e(Po)}finally{or.f()}}else{var Ln=Jp(n),jn;try{for(Ln.s();!(jn=Ln.n()).done;){var ja=jn.value;X.fillText(ja,Ee[ja].x,Ee[ja].y+g*Be)}}catch(Po){Ln.e(Po)}finally{Ln.f()}}return{xOffset:$e,yOffset:ot,mapping:Ee,data:j,width:j.width,height:j.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,f,v,g,x}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],f=a.mapping,v=new Set(Object.keys(f)),g=new Set(n);return g.forEach(function(x){v.has(x)||s.push(x)}),s}}]),e}())||Qp),wr,Ir;function Gr(e){var i=_r();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function _r(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tr=3,st=1024,jt=64,br=(wr=(0,zr.b2)(),wr(Ir=function(e){(0,Pr.Z)(r,e);var i=Gr(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"canvasHeight",128),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"canvas",void 0),(0,A.Z)((0,ue.Z)(n),"iconData",void 0),(0,A.Z)((0,ue.Z)(n),"iconMap",void 0),(0,A.Z)((0,ue.Z)(n),"ctx",void 0),(0,A.Z)((0,ue.Z)(n),"loadingImageCount",0),n}return(0,Pt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=fa.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var f=this,v=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:jt}),this.updateIconMap(),this.loadImage(s).then(function(g){v=g;var x=f.iconData.find(function(C){return C.id===a});x&&(x.image=v,x.width=v.width,x.height=v.height),f.update()})}},{key:"addImageMini",value:function(a,s,f){var v=this,g=f.getSceneConfig().canvas,x=g.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:jt}),this.updateIconMap(),this.loadImageMini(s,g).then(function(C){x=C;var T=v.iconData.find(function(O){return O.id===a});T&&(T.image=x,T.width=x.width,T.height=x.height),v.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,f){if(a instanceof HTMLImageElement){s(a);return}var v=new Image;v.crossOrigin="anonymous",v.onload=function(){s(v)},v.onerror=function(){f(new Error("Could not load image at "+a))},v.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=st,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var f=a.iconMap[s],v=f.x,g=f.y,x=f.image,C=f.width,T=C===void 0?64:C,O=f.height,k=O===void 0?64:O,j=Math.max(T,k),X=j/jt,te=k/X,Ee=T/X;x&&a.ctx.drawImage(x,v+(jt-Ee)/2,g+(jt-te)/2,Ee,te)})}},{key:"updateIconMap",value:function(){var a=Id(this.iconData,Tr,st),s=a.mapping,f=a.canvasHeight;this.iconMap=s,this.canvasHeight=f}},{key:"loadImageMini",value:function(a,s){return new Promise(function(f,v){var g=s.createImage();g.crossOrigin="anonymous",g.onload=function(){f(g)},g.onerror=function(){v(new Error("Could not load image at "+a))},g.src=a})}}]),r}(Mn.EventEmitter))||Ir),fr=z(49685);function ar(){var e=new fr.WT(16);return fr.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Lr(e){var i=new fr.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function $r(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function zn(e,i,r,n,a,s,f,v,g,x,C,T,O,k,j,X){var te=new fr.WT(16);return te[0]=e,te[1]=i,te[2]=r,te[3]=n,te[4]=a,te[5]=s,te[6]=f,te[7]=v,te[8]=g,te[9]=x,te[10]=C,te[11]=T,te[12]=O,te[13]=k,te[14]=j,te[15]=X,te}function tr(e,i,r,n,a,s,f,v,g,x,C,T,O,k,j,X,te){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=f,e[6]=v,e[7]=g,e[8]=x,e[9]=C,e[10]=T,e[11]=O,e[12]=k,e[13]=j,e[14]=X,e[15]=te,e}function ir(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Sn(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],f=i[7],v=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=f,e[14]=v}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Vr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=i[4],v=i[5],g=i[6],x=i[7],C=i[8],T=i[9],O=i[10],k=i[11],j=i[12],X=i[13],te=i[14],Ee=i[15],Ne=r*v-n*f,$e=r*g-a*f,ot=r*x-s*f,Et=n*g-a*v,_t=n*x-s*v,qt=a*x-s*g,or=C*X-T*j,Mr=C*te-O*j,Xr=C*Ee-k*j,yr=T*te-O*X,sn=T*Ee-k*X,Ln=O*Ee-k*te,jn=Ne*Ln-$e*sn+ot*yr+Et*Xr-_t*Mr+qt*or;return jn?(jn=1/jn,e[0]=(v*Ln-g*sn+x*yr)*jn,e[1]=(a*sn-n*Ln-s*yr)*jn,e[2]=(X*qt-te*_t+Ee*Et)*jn,e[3]=(O*_t-T*qt-k*Et)*jn,e[4]=(g*Xr-f*Ln-x*Mr)*jn,e[5]=(r*Ln-a*Xr+s*Mr)*jn,e[6]=(te*ot-j*qt-Ee*$e)*jn,e[7]=(C*qt-O*ot+k*$e)*jn,e[8]=(f*sn-v*Xr+x*or)*jn,e[9]=(n*Xr-r*sn-s*or)*jn,e[10]=(j*_t-X*ot+Ee*Ne)*jn,e[11]=(T*ot-C*_t-k*Ne)*jn,e[12]=(v*Mr-f*yr-g*or)*jn,e[13]=(r*yr-n*Mr+a*or)*jn,e[14]=(X*$e-j*Et-te*Ne)*jn,e[15]=(C*Et-T*$e+O*Ne)*jn,e):null}function Sr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=i[4],v=i[5],g=i[6],x=i[7],C=i[8],T=i[9],O=i[10],k=i[11],j=i[12],X=i[13],te=i[14],Ee=i[15];return e[0]=v*(O*Ee-k*te)-T*(g*Ee-x*te)+X*(g*k-x*O),e[1]=-(n*(O*Ee-k*te)-T*(a*Ee-s*te)+X*(a*k-s*O)),e[2]=n*(g*Ee-x*te)-v*(a*Ee-s*te)+X*(a*x-s*g),e[3]=-(n*(g*k-x*O)-v*(a*k-s*O)+T*(a*x-s*g)),e[4]=-(f*(O*Ee-k*te)-C*(g*Ee-x*te)+j*(g*k-x*O)),e[5]=r*(O*Ee-k*te)-C*(a*Ee-s*te)+j*(a*k-s*O),e[6]=-(r*(g*Ee-x*te)-f*(a*Ee-s*te)+j*(a*x-s*g)),e[7]=r*(g*k-x*O)-f*(a*k-s*O)+C*(a*x-s*g),e[8]=f*(T*Ee-k*X)-C*(v*Ee-x*X)+j*(v*k-x*T),e[9]=-(r*(T*Ee-k*X)-C*(n*Ee-s*X)+j*(n*k-s*T)),e[10]=r*(v*Ee-x*X)-f*(n*Ee-s*X)+j*(n*x-s*v),e[11]=-(r*(v*k-x*T)-f*(n*k-s*T)+C*(n*x-s*v)),e[12]=-(f*(T*te-O*X)-C*(v*te-g*X)+j*(v*O-g*T)),e[13]=r*(T*te-O*X)-C*(n*te-a*X)+j*(n*O-a*T),e[14]=-(r*(v*te-g*X)-f*(n*te-a*X)+j*(n*g-a*v)),e[15]=r*(v*O-g*T)-f*(n*O-a*T)+C*(n*g-a*v),e}function qr(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],f=e[5],v=e[6],g=e[7],x=e[8],C=e[9],T=e[10],O=e[11],k=e[12],j=e[13],X=e[14],te=e[15],Ee=i*f-r*s,Ne=i*v-n*s,$e=i*g-a*s,ot=r*v-n*f,Et=r*g-a*f,_t=n*g-a*v,qt=x*j-C*k,or=x*X-T*k,Mr=x*te-O*k,Xr=C*X-T*j,yr=C*te-O*j,sn=T*te-O*X;return Ee*sn-Ne*yr+$e*Xr+ot*Mr-Et*or+_t*qt}function Nr(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3],v=i[4],g=i[5],x=i[6],C=i[7],T=i[8],O=i[9],k=i[10],j=i[11],X=i[12],te=i[13],Ee=i[14],Ne=i[15],$e=r[0],ot=r[1],Et=r[2],_t=r[3];return e[0]=$e*n+ot*v+Et*T+_t*X,e[1]=$e*a+ot*g+Et*O+_t*te,e[2]=$e*s+ot*x+Et*k+_t*Ee,e[3]=$e*f+ot*C+Et*j+_t*Ne,$e=r[4],ot=r[5],Et=r[6],_t=r[7],e[4]=$e*n+ot*v+Et*T+_t*X,e[5]=$e*a+ot*g+Et*O+_t*te,e[6]=$e*s+ot*x+Et*k+_t*Ee,e[7]=$e*f+ot*C+Et*j+_t*Ne,$e=r[8],ot=r[9],Et=r[10],_t=r[11],e[8]=$e*n+ot*v+Et*T+_t*X,e[9]=$e*a+ot*g+Et*O+_t*te,e[10]=$e*s+ot*x+Et*k+_t*Ee,e[11]=$e*f+ot*C+Et*j+_t*Ne,$e=r[12],ot=r[13],Et=r[14],_t=r[15],e[12]=$e*n+ot*v+Et*T+_t*X,e[13]=$e*a+ot*g+Et*O+_t*te,e[14]=$e*s+ot*x+Et*k+_t*Ee,e[15]=$e*f+ot*C+Et*j+_t*Ne,e}function ci(e,i,r){var n=r[0],a=r[1],s=r[2],f,v,g,x,C,T,O,k,j,X,te,Ee;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(f=i[0],v=i[1],g=i[2],x=i[3],C=i[4],T=i[5],O=i[6],k=i[7],j=i[8],X=i[9],te=i[10],Ee=i[11],e[0]=f,e[1]=v,e[2]=g,e[3]=x,e[4]=C,e[5]=T,e[6]=O,e[7]=k,e[8]=j,e[9]=X,e[10]=te,e[11]=Ee,e[12]=f*n+C*a+j*s+i[12],e[13]=v*n+T*a+X*s+i[13],e[14]=g*n+O*a+te*s+i[14],e[15]=x*n+k*a+Ee*s+i[15]),e}function ei(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Wr(e,i,r,n){var a=n[0],s=n[1],f=n[2],v=Math.hypot(a,s,f),g,x,C,T,O,k,j,X,te,Ee,Ne,$e,ot,Et,_t,qt,or,Mr,Xr,yr,sn,Ln,jn,ja;return v<fr.Ib?null:(v=1/v,a*=v,s*=v,f*=v,g=Math.sin(r),x=Math.cos(r),C=1-x,T=i[0],O=i[1],k=i[2],j=i[3],X=i[4],te=i[5],Ee=i[6],Ne=i[7],$e=i[8],ot=i[9],Et=i[10],_t=i[11],qt=a*a*C+x,or=s*a*C+f*g,Mr=f*a*C-s*g,Xr=a*s*C-f*g,yr=s*s*C+x,sn=f*s*C+a*g,Ln=a*f*C+s*g,jn=s*f*C-a*g,ja=f*f*C+x,e[0]=T*qt+X*or+$e*Mr,e[1]=O*qt+te*or+ot*Mr,e[2]=k*qt+Ee*or+Et*Mr,e[3]=j*qt+Ne*or+_t*Mr,e[4]=T*Xr+X*yr+$e*sn,e[5]=O*Xr+te*yr+ot*sn,e[6]=k*Xr+Ee*yr+Et*sn,e[7]=j*Xr+Ne*yr+_t*sn,e[8]=T*Ln+X*jn+$e*ja,e[9]=O*Ln+te*jn+ot*ja,e[10]=k*Ln+Ee*jn+Et*ja,e[11]=j*Ln+Ne*jn+_t*ja,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function Qr(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],f=i[5],v=i[6],g=i[7],x=i[8],C=i[9],T=i[10],O=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+x*n,e[5]=f*a+C*n,e[6]=v*a+T*n,e[7]=g*a+O*n,e[8]=x*a-s*n,e[9]=C*a-f*n,e[10]=T*a-v*n,e[11]=O*a-g*n,e}function $n(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],f=i[1],v=i[2],g=i[3],x=i[8],C=i[9],T=i[10],O=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-x*n,e[1]=f*a-C*n,e[2]=v*a-T*n,e[3]=g*a-O*n,e[8]=s*n+x*a,e[9]=f*n+C*a,e[10]=v*n+T*a,e[11]=g*n+O*a,e}function ui(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],f=i[1],v=i[2],g=i[3],x=i[4],C=i[5],T=i[6],O=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+x*n,e[1]=f*a+C*n,e[2]=v*a+T*n,e[3]=g*a+O*n,e[4]=x*a-s*n,e[5]=C*a-f*n,e[6]=T*a-v*n,e[7]=O*a-g*n,e}function Bi(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function uo(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vo(e,i,r){var n=r[0],a=r[1],s=r[2],f=Math.hypot(n,a,s),v,g,x;return f<fr.Ib?null:(f=1/f,n*=f,a*=f,s*=f,v=Math.sin(i),g=Math.cos(i),x=1-g,e[0]=n*n*x+g,e[1]=a*n*x+s*v,e[2]=s*n*x-a*v,e[3]=0,e[4]=n*a*x-s*v,e[5]=a*a*x+g,e[6]=s*a*x+n*v,e[7]=0,e[8]=n*s*x+a*v,e[9]=a*s*x-n*v,e[10]=s*s*x+g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Ni(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ss(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ka(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ho(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3],v=n+n,g=a+a,x=s+s,C=n*v,T=n*g,O=n*x,k=a*g,j=a*x,X=s*x,te=f*v,Ee=f*g,Ne=f*x;return e[0]=1-(k+X),e[1]=T+Ne,e[2]=O-Ee,e[3]=0,e[4]=T-Ne,e[5]=1-(C+X),e[6]=j+te,e[7]=0,e[8]=O+Ee,e[9]=j-te,e[10]=1-(C+k),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function wo(e,i){var r=new fr.WT(3),n=-i[0],a=-i[1],s=-i[2],f=i[3],v=i[4],g=i[5],x=i[6],C=i[7],T=n*n+a*a+s*s+f*f;return T>0?(r[0]=(v*f+C*n+g*s-x*a)*2/T,r[1]=(g*f+C*a+x*n-v*s)*2/T,r[2]=(x*f+C*s+v*a-g*n)*2/T):(r[0]=(v*f+C*n+g*s-x*a)*2,r[1]=(g*f+C*a+x*n-v*s)*2,r[2]=(x*f+C*s+v*a-g*n)*2),Ho(e,i,r),e}function Qo(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function Bo(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],f=i[5],v=i[6],g=i[8],x=i[9],C=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,f,v),e[2]=Math.hypot(g,x,C),e}function ms(e,i){var r=new fr.WT(3);Bo(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],f=i[0]*n,v=i[1]*a,g=i[2]*s,x=i[4]*n,C=i[5]*a,T=i[6]*s,O=i[8]*n,k=i[9]*a,j=i[10]*s,X=f+C+j,te=0;return X>0?(te=Math.sqrt(X+1)*2,e[3]=.25*te,e[0]=(T-k)/te,e[1]=(O-g)/te,e[2]=(v-x)/te):f>C&&f>j?(te=Math.sqrt(1+f-C-j)*2,e[3]=(T-k)/te,e[0]=.25*te,e[1]=(v+x)/te,e[2]=(O+g)/te):C>j?(te=Math.sqrt(1+C-f-j)*2,e[3]=(O-g)/te,e[0]=(v+x)/te,e[1]=.25*te,e[2]=(T+k)/te):(te=Math.sqrt(1+j-f-C)*2,e[3]=(v-x)/te,e[0]=(O+g)/te,e[1]=(T+k)/te,e[2]=.25*te),e}function mo(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=i[3],g=a+a,x=s+s,C=f+f,T=a*g,O=a*x,k=a*C,j=s*x,X=s*C,te=f*C,Ee=v*g,Ne=v*x,$e=v*C,ot=n[0],Et=n[1],_t=n[2];return e[0]=(1-(j+te))*ot,e[1]=(O+$e)*ot,e[2]=(k-Ne)*ot,e[3]=0,e[4]=(O-$e)*Et,e[5]=(1-(T+te))*Et,e[6]=(X+Ee)*Et,e[7]=0,e[8]=(k+Ne)*_t,e[9]=(X-Ee)*_t,e[10]=(1-(T+j))*_t,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function xi(e,i,r,n,a){var s=i[0],f=i[1],v=i[2],g=i[3],x=s+s,C=f+f,T=v+v,O=s*x,k=s*C,j=s*T,X=f*C,te=f*T,Ee=v*T,Ne=g*x,$e=g*C,ot=g*T,Et=n[0],_t=n[1],qt=n[2],or=a[0],Mr=a[1],Xr=a[2],yr=(1-(X+Ee))*Et,sn=(k+ot)*Et,Ln=(j-$e)*Et,jn=(k-ot)*_t,ja=(1-(O+Ee))*_t,Po=(te+Ne)*_t,Os=(j+$e)*qt,iu=(te-Ne)*qt,Us=(1-(O+X))*qt;return e[0]=yr,e[1]=sn,e[2]=Ln,e[3]=0,e[4]=jn,e[5]=ja,e[6]=Po,e[7]=0,e[8]=Os,e[9]=iu,e[10]=Us,e[11]=0,e[12]=r[0]+or-(yr*or+jn*Mr+Os*Xr),e[13]=r[1]+Mr-(sn*or+ja*Mr+iu*Xr),e[14]=r[2]+Xr-(Ln*or+Po*Mr+Us*Xr),e[15]=1,e}function Wo(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=r+r,v=n+n,g=a+a,x=r*f,C=n*f,T=n*v,O=a*f,k=a*v,j=a*g,X=s*f,te=s*v,Ee=s*g;return e[0]=1-T-j,e[1]=C+Ee,e[2]=O-te,e[3]=0,e[4]=C-Ee,e[5]=1-x-j,e[6]=k+X,e[7]=0,e[8]=O+te,e[9]=k-X,e[10]=1-x-T,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function na(e,i,r,n,a,s,f){var v=1/(r-i),g=1/(a-n),x=1/(s-f);return e[0]=s*2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*g,e[6]=0,e[7]=0,e[8]=(r+i)*v,e[9]=(a+n)*g,e[10]=(f+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=f*s*2*x,e[15]=0,e}function Jo(e,i,r,n,a){var s=1/Math.tan(i/2),f;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(f=1/(n-a),e[10]=(a+n)*f,e[14]=2*a*n*f):(e[10]=-1,e[14]=-2*n),e}var ri=Jo;function zi(e,i,r,n,a){var s=1/Math.tan(i/2),f;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(f=1/(n-a),e[10]=a*f,e[14]=a*n*f):(e[10]=-1,e[14]=-n),e}function _a(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),f=Math.tan(i.leftDegrees*Math.PI/180),v=Math.tan(i.rightDegrees*Math.PI/180),g=2/(f+v),x=2/(a+s);return e[0]=g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((f-v)*g*.5),e[9]=(a-s)*x*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function bo(e,i,r,n,a,s,f){var v=1/(i-r),g=1/(n-a),x=1/(s-f);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=(f+s)*x,e[15]=1,e}var wl=bo;function Te(e,i,r,n,a,s,f){var v=1/(i-r),g=1/(n-a),x=1/(s-f);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=s*x,e[15]=1,e}function Ut(e,i,r,n){var a,s,f,v,g,x,C,T,O,k,j=i[0],X=i[1],te=i[2],Ee=n[0],Ne=n[1],$e=n[2],ot=r[0],Et=r[1],_t=r[2];return Math.abs(j-ot)<fr.Ib&&Math.abs(X-Et)<fr.Ib&&Math.abs(te-_t)<fr.Ib?ir(e):(C=j-ot,T=X-Et,O=te-_t,k=1/Math.hypot(C,T,O),C*=k,T*=k,O*=k,a=Ne*O-$e*T,s=$e*C-Ee*O,f=Ee*T-Ne*C,k=Math.hypot(a,s,f),k?(k=1/k,a*=k,s*=k,f*=k):(a=0,s=0,f=0),v=T*f-O*s,g=O*a-C*f,x=C*s-T*a,k=Math.hypot(v,g,x),k?(k=1/k,v*=k,g*=k,x*=k):(v=0,g=0,x=0),e[0]=a,e[1]=v,e[2]=C,e[3]=0,e[4]=s,e[5]=g,e[6]=T,e[7]=0,e[8]=f,e[9]=x,e[10]=O,e[11]=0,e[12]=-(a*j+s*X+f*te),e[13]=-(v*j+g*X+x*te),e[14]=-(C*j+T*X+O*te),e[15]=1,e)}function At(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=n[0],g=n[1],x=n[2],C=a-r[0],T=s-r[1],O=f-r[2],k=C*C+T*T+O*O;k>0&&(k=1/Math.sqrt(k),C*=k,T*=k,O*=k);var j=g*O-x*T,X=x*C-v*O,te=v*T-g*C;return k=j*j+X*X+te*te,k>0&&(k=1/Math.sqrt(k),j*=k,X*=k,te*=k),e[0]=j,e[1]=X,e[2]=te,e[3]=0,e[4]=T*te-O*X,e[5]=O*j-C*te,e[6]=C*X-T*j,e[7]=0,e[8]=C,e[9]=T,e[10]=O,e[11]=0,e[12]=a,e[13]=s,e[14]=f,e[15]=1,e}function mn(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Vi(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Se(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function oe(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Ve(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function ct(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function Rt(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Ye(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],f=e[4],v=e[5],g=e[6],x=e[7],C=e[8],T=e[9],O=e[10],k=e[11],j=e[12],X=e[13],te=e[14],Ee=e[15],Ne=i[0],$e=i[1],ot=i[2],Et=i[3],_t=i[4],qt=i[5],or=i[6],Mr=i[7],Xr=i[8],yr=i[9],sn=i[10],Ln=i[11],jn=i[12],ja=i[13],Po=i[14],Os=i[15];return Math.abs(r-Ne)<=fr.Ib*Math.max(1,Math.abs(r),Math.abs(Ne))&&Math.abs(n-$e)<=fr.Ib*Math.max(1,Math.abs(n),Math.abs($e))&&Math.abs(a-ot)<=fr.Ib*Math.max(1,Math.abs(a),Math.abs(ot))&&Math.abs(s-Et)<=fr.Ib*Math.max(1,Math.abs(s),Math.abs(Et))&&Math.abs(f-_t)<=fr.Ib*Math.max(1,Math.abs(f),Math.abs(_t))&&Math.abs(v-qt)<=fr.Ib*Math.max(1,Math.abs(v),Math.abs(qt))&&Math.abs(g-or)<=fr.Ib*Math.max(1,Math.abs(g),Math.abs(or))&&Math.abs(x-Mr)<=fr.Ib*Math.max(1,Math.abs(x),Math.abs(Mr))&&Math.abs(C-Xr)<=fr.Ib*Math.max(1,Math.abs(C),Math.abs(Xr))&&Math.abs(T-yr)<=fr.Ib*Math.max(1,Math.abs(T),Math.abs(yr))&&Math.abs(O-sn)<=fr.Ib*Math.max(1,Math.abs(O),Math.abs(sn))&&Math.abs(k-Ln)<=fr.Ib*Math.max(1,Math.abs(k),Math.abs(Ln))&&Math.abs(j-jn)<=fr.Ib*Math.max(1,Math.abs(j),Math.abs(jn))&&Math.abs(X-ja)<=fr.Ib*Math.max(1,Math.abs(X),Math.abs(ja))&&Math.abs(te-Po)<=fr.Ib*Math.max(1,Math.abs(te),Math.abs(Po))&&Math.abs(Ee-Os)<=fr.Ib*Math.max(1,Math.abs(Ee),Math.abs(Os))}var Fe=Nr,nt=oe,_e,ze,Ae=(_e=(0,zr.b2)(),_e(ze=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"overridedViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredProjectionMatrix",void 0),(0,A.Z)(this,"viewMatrixInverse",void 0),(0,A.Z)(this,"cameraPosition",void 0)}return(0,Pt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=ar(),Vr(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,nn.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=Bi(ar(),[r,n,0]);this.jitteredProjectionMatrix=Nr(ar(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Nr(ar(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||ze),lt,St;function pr(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=jr(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function jr(e,i){if(!!e){if(typeof e=="string")return Ur(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ur(e,i)}}function Ur(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var on=(lt=(0,zr.b2)(),lt(St=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"controlCorners",void 0),(0,A.Z)(this,"controlContainer",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"controls",[]),(0,A.Z)(this,"unAddControls",[])}return(0,Pt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Yt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(Yt.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=pr(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=Wa("div",n+"control-container",this.container);function s(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=f.map(function(g){return n+g}).join(" ");r[f.join("")]=Wa("div",v,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&fc(this.controlCorners[r]);this.controlContainer&&fc(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||St),Dr,Cn,fn=(Dr=(0,zr.b2)(),Dr(Cn=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"markers",[]),(0,A.Z)(this,"markerLayers",[]),(0,A.Z)(this,"unAddMarkers",[]),(0,A.Z)(this,"unAddMarkerLayers",[])}return(0,Pt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Yt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||Cn),bn,_n,gn=(bn=(0,zr.b2)(),bn(_n=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"popup",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"unAddPopup",void 0)}return(0,Pt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Yt.IMapService)}}]),e}())||_n),ti=z(82492),Sa=z.n(ti),us={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},za=us,pa,ul;function Ms(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Pu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ms(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ms(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Iu={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},mp={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Ou=(pa=(0,zr.b2)(),pa(ul=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"sceneConfigCache",{}),(0,A.Z)(this,"layerConfigCache",{})}return(0,Pt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return za[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=Pu(Pu({},Iu),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=Pu({},Sa()({},this.sceneConfigCache[r],mp,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||ul);function mi(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function bi(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(f){s[f]=n[f]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(f,v){return v(e,i,f)||f},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function Rd(){var e=new fr.WT(4);return fr.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function ls(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function gp(e,i,r,n){var a=new fr.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function Mf(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Ld(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function kd(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function wv(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function yp(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function Pf(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function y0(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function _0(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function ym(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function Ps(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function uh(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function Tv(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function t(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function o(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function u(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function p(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function y(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function b(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function S(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function I(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=r*r+n*n+a*a+s*s;return f>0&&(f=1/Math.sqrt(f)),e[0]=r*f,e[1]=n*f,e[2]=a*f,e[3]=s*f,e}function D(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function N(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],f=r[0]*n[3]-r[3]*n[0],v=r[1]*n[2]-r[2]*n[1],g=r[1]*n[3]-r[3]*n[1],x=r[2]*n[3]-r[3]*n[2],C=i[0],T=i[1],O=i[2],k=i[3];return e[0]=T*x-O*g+k*v,e[1]=-(C*x)+O*f-k*s,e[2]=C*g-T*f+k*a,e[3]=-(C*v)+T*s-O*a,e}function V(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=f+n*(r[2]-f),e[3]=v+n*(r[3]-v),e}function W(e,i){i=i||1;var r,n,a,s,f,v;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,f=r*r+n*n;while(f>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,v=a*a+s*s;while(v>=1);var g=Math.sqrt((1-f)/v);return e[0]=i*r,e[1]=i*n,e[2]=i*a*g,e[3]=i*s*g,e}function ee(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*f,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*f,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*f,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*f,e}function se(e,i,r){var n=i[0],a=i[1],s=i[2],f=r[0],v=r[1],g=r[2],x=r[3],C=x*n+v*s-g*a,T=x*a+g*n-f*s,O=x*s+f*a-v*n,k=-f*n-v*a-g*s;return e[0]=C*x+k*-f+T*-g-O*-v,e[1]=T*x+k*-v+O*-f-C*-g,e[2]=O*x+k*-g+C*-v-T*-f,e[3]=i[3],e}function Me(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Oe(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function qe(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function Ue(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],f=i[0],v=i[1],g=i[2],x=i[3];return Math.abs(r-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))}var ut=null,Mt=null,Gt=null,Wt=null,lr=null,Or=null,Kr=null,Un=function(){var e=Rd();return function(i,r,n,a,s,f){var v,g;for(r||(r=4),n||(n=0),a?g=Math.min(a*r+n,i.length):g=i.length,v=n;v<g;v+=r)e[0]=i[v],e[1]=i[v+1],e[2]=i[v+2],e[3]=i[v+3],s(e,e,f),i[v]=e[0],i[v+1]=e[1],i[v+2]=e[2],i[v+3]=e[3];return i}}(),hn=Math.PI/180,Vn=512,dn=4003e4;function Ii(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,f=e.highPrecision,v=f===void 0?!1:f,g=e.flipY,x=g===void 0?!1:g;s=s!==void 0?s:Math.pow(2,a);var C={},T=Vn*s,O=Math.cos(r*hn),k=T/360,j=k/O,X=T/dn/O;if(C.pixelsPerMeter=[X,-X,X],C.metersPerPixel=[1/X,-1/X,1/X],C.pixelsPerDegree=[k,-j,X],C.degreesPerPixel=[1/k,-1/j,1/X],v){var te=hn*Math.tan(r*hn)/O,Ee=k*te/2,Ne=T/dn*te,$e=Ne/j*X;C.pixelsPerDegree2=[0,-Ee,Ne],C.pixelsPerMeter2=[$e,0,$e],x&&(C.pixelsPerDegree2[1]=-C.pixelsPerDegree2[1],C.pixelsPerMeter2[1]=-C.pixelsPerMeter2[1])}return x&&(C.pixelsPerMeter[1]=-C.pixelsPerMeter[1],C.metersPerPixel[1]=-C.metersPerPixel[1],C.pixelsPerDegree[1]=-C.pixelsPerDegree[1],C.degreesPerPixel[1]=-C.degreesPerPixel[1]),C}var Hn;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Hn||(Hn={}));var An={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Ui,Si,ea,Zn,da,lo=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],To=(Ui=(0,zr.b2)(),Si=(0,zr.f3)(Yt.ICameraService),Ui(ea=(Zn=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"needRefresh",!0),mi(this,"cameraService",da,this),(0,A.Z)(this,"coordinateSystem",void 0),(0,A.Z)(this,"viewportCenter",void 0),(0,A.Z)(this,"viewportCenterProjection",void 0),(0,A.Z)(this,"pixelsPerDegree",void 0),(0,A.Z)(this,"pixelsPerDegree2",void 0),(0,A.Z)(this,"pixelsPerMeter",void 0)}return(0,Pt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=Ii({latitude:a[1],zoom:r}),f=s.pixelsPerMeter,v=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=f,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Hn.LNGLAT||this.coordinateSystem===Hn.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Hn.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===Hn.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var f=Ii({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),v=f.pixelsPerMeter,g=f.pixelsPerDegree,x=f.pixelsPerDegree2,C=this.cameraService.getViewMatrix(),T=this.cameraService.getProjectionMatrix(),O=Nr([],T,C),k=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=ee([],[k[0],k[1],0,1],O),C=this.cameraService.getViewMatrixUncentered()||C,O=Nr([],T,C),O=Nr([],O,lo),this.cameraService.setViewProjectionMatrix(O),this.pixelsPerMeter=v,this.pixelsPerDegree=g,this.pixelsPerDegree2=x}}]),e}(),da=bi(Zn.prototype,"cameraService",[Si],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zn))||ea),Eo=z(20396),Ua=z.n(Eo),ia;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(ia||(ia={}));var es,ts,Bs,rs,Ns;function No(e){var i=gs();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function gs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ki={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Za=(es=(0,zr.b2)(),ts=(0,zr.f3)(Yt.IMapService),es(Bs=(rs=function(e){(0,Pr.Z)(r,e);var i=No(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"indragging",!1),mi((0,ue.Z)(n),"mapService",Ns,(0,ue.Z)(n)),(0,A.Z)((0,ue.Z)(n),"hammertime",void 0),(0,A.Z)((0,ue.Z)(n),"lastClickTime",0),(0,A.Z)((0,ue.Z)(n),"lastClickXY",[-1,-1]),(0,A.Z)((0,ue.Z)(n),"clickTimer",void 0),(0,A.Z)((0,ue.Z)(n),"$containter",void 0),(0,A.Z)((0,ue.Z)(n),"onDrag",function(v){var g=n.interactionEvent(v);g.type=Ki[g.type],g.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(ia.Drag,g)}),(0,A.Z)((0,ue.Z)(n),"onHammer",function(v){v.srcEvent.stopPropagation();var g=n.interactionEvent(v);n.emit(ia.Hover,g)}),(0,A.Z)((0,ue.Z)(n),"onTouch",function(v){var g=v.touches[0];n.onHover({x:g.pageX,y:g.pageY,type:"touch"})}),(0,A.Z)((0,ue.Z)(n),"onHover",function(v){var g=v.clientX,x=v.clientY,C=g,T=x,O=v.type,k=n.mapService.getMapContainer();if(k)if(Ji)C=C-k.left-0,T=T-k.top-0;else{var j=k.getBoundingClientRect(),X=j.top,te=j.left;C=C-te-k.clientLeft,T=T-X-k.clientTop}var Ee=n.mapService.containerToLngLat([C,T]);if(O==="click"){if(!Ji&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(C,T,Ee);return}if(O==="touch"){n.isDoubleTap(C,T,Ee);return}O!=="click"&&O!=="dblclick"&&n.emit(ia.Hover,{x:C,y:T,lngLat:Ee,type:O,target:v})}),n}return(0,Pt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ia.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,f=a.y;this.emit(ia.Hover,{x:s,y:f})}},{key:"triggerSelect",value:function(a){this.emit(ia.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(ia.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(Ji)fa.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(Ua()).Manager(a);s.add(new(Ua()).Tap({event:"dblclick",taps:2})),s.add(new(Ua()).Tap({event:"click"})),s.add(new(Ua()).Pan({threshold:0,pointers:0})),s.add(new(Ua()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(Ji)fa.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,f=a.pointerType,v,g;f==="touch"?(g=Math.floor(a.pointers[0].clientY),v=Math.floor(a.pointers[0].clientX)):(g=Math.floor(a.srcEvent.y),v=Math.floor(a.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var C=x.getBoundingClientRect(),T=C.top,O=C.left;v-=O,g-=T}var k=this.mapService.containerToLngLat([v,g]);return{x:v,y:g,lngLat:k,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,f){var v=this,g=new Date().getTime(),x="click";g-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(ia.Hover,{x:a,y:s,lngLat:f,type:x})):(this.lastClickTime=g,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){x="click",v.emit(ia.Hover,{x:a,y:s,lngLat:f,type:x})},400))}}]),r}(Nn()),Ns=bi(rs.prototype,"mapService",[ts],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rs))||Bs),Ta=0;function ua(e){if(Ji)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(Ta++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function nu(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(f){(f==="l7-marker"||f==="l7-popup")&&(n=!1)})}}),n}var G;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(G||(G={}));var $a,zo,Is,va,Kl,Ru,$l,Qa,Ql,ll,lh,If,ch;function Sc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ef(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Sc(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ed=($a=(0,zr.b2)(),zo=(0,zr.f3)(Yt.IMapService),Is=(0,zr.f3)(Yt.IRendererService),va=(0,zr.f3)(Yt.IGlobalConfigService),Kl=(0,zr.f3)(Yt.IInteractionService),Ru=(0,zr.f3)(Yt.ILayerService),$a($l=(Qa=function(){function e(){var i=this;(0,ht.Z)(this,e),mi(this,"mapService",Ql,this),mi(this,"rendererService",ll,this),mi(this,"configService",lh,this),mi(this,"interactionService",If,this),mi(this,"layerService",ch,this),(0,A.Z)(this,"pickingFBO",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0),(0,A.Z)(this,"alreadyInPicking",!1),(0,A.Z)(this,"pickBufferScale",1),(0,A.Z)(this,"lastPickTime",new Date().getTime()),(0,A.Z)(this,"pickedLayers",[]),(0,A.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,f=n.y,v=n.lngLat,g=n.type,x=n.target,C=!1,T=i.rendererService,O=T.getViewportSize,k=T.readPixels,j=T.getContainer,X=i.getContainerSize(j()),te=X.width,Ee=X.height;te*=Fa,Ee*=Fa;var Ne=r.getLayerConfig(),$e=Ne.enableHighlight,ot=Ne.enableSelect,Et=s*Fa,_t=f*Fa;if(Et>te-1*Fa||Et<0||_t>Ee-1*Fa||_t<0)return!1;var qt;if(qt=k({x:Math.floor(Et/i.pickBufferScale),y:Math.floor((Ee-(f+1)*Fa)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),qt[0]!==0||qt[1]!==0||qt[2]!==0){var or=Js(qt),Mr=r.getSource().getFeatureById(or);or!==r.getCurrentPickId()&&g==="mousemove"&&(g="mouseenter");var Xr={x:s,y:f,type:g,lngLat:v,featureId:or,feature:Mr,target:x};Mr&&(C=!0,r.setCurrentPickId(or),i.pickedLayers=[r],i.triggerHoverOnLayer(r,Xr))}else{var yr={x:s,y:f,lngLat:v,type:r.getCurrentPickId()!==null&&g==="mousemove"?"mouseout":"un"+g,featureId:null,target:x,feature:null};i.triggerHoverOnLayer(r,ef(ef({},yr),{},{type:"unpick"})),i.triggerHoverOnLayer(r,yr),r.setCurrentPickId(null),i.pickedLayers=[]}if($e&&i.highlightPickedFeature(r,qt),ot&&g==="click"&&((a=qt)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var sn=Js(qt);r.getCurrentSelectedId()===null||sn!==r.getCurrentSelectedId()?(i.selectFeature(r,qt),r.setCurrentSelectedId(sn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return C})}return(0,Pt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,f=n.getViewportSize,v=n.getContainer,g=this.getContainerSize(v()),x=g.width,C=g.height;x*=Fa,C*=Fa,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(x/this.pickBufferScale),height:Math.round(C/this.pickBufferScale),wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.interactionService.on(ia.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,E.Z)(M().mark(function n(a,s,f){var v=this,g,x,C,T;return M().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:g=this.rendererService,x=g.useFramebuffer,C=g.clear,T=g.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){C({framebuffer:v.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var j=v.pickBox(a,s);f(j)});case 3:case"end":return k.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(yr){var sn=yr<0?0:yr;return Math.floor(sn*Fa/a.pickBufferScale)}),f=(0,nn.Z)(s,4),v=f[0],g=f[1],x=f[2],C=f[3],T=this.rendererService,O=T.getViewportSize,k=T.readPixels,j=T.getContainer,X=this.getContainerSize(j()),te=X.width,Ee=X.height;if(te*=Fa,Ee*=Fa,v>(te-1)*Fa/this.pickBufferScale||x<0||g>(Ee-1)*Fa/this.pickBufferScale||C<0)return[];var Ne,$e=Math.min(te/this.pickBufferScale,x)-v,ot=Math.min(Ee/this.pickBufferScale,C)-g;Ne=k({x:v,y:Math.floor(Ee/this.pickBufferScale-(C+1)),width:$e,height:ot,data:new Uint8Array($e*ot*4),framebuffer:this.pickingFBO});for(var Et=[],_t={},qt=0;qt<Ne.length/4;qt=qt+1){var or=Ne.slice(qt*4,qt*4+4),Mr=Js(or);if(Mr!==-1&&!_t[Mr]){var Xr=r.getSource().getFeatureById(Mr);Et.push(ef(ef({},Xr),{},{pickedFeatureIdx:Mr})),_t[Mr]=!0}}return Et}},{key:"handleCursor",value:function(r,n){var a=r.getLayerConfig(),s=a.cursor,f=s===void 0?"":s,v=a.cursorEnabled;if(v){var g=this.mapService.version,x=g==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),C=x==null?void 0:x.style.getPropertyValue("cursor");n==="unmousemove"&&C!==""?x==null||x.style.setProperty("cursor",""):n==="mousemove"&&(x==null||x.style.setProperty("cursor",f))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/Fa,height:r.height/Fa}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,E.Z)(M().mark(function n(a){var s;return M().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){v.next=2;break}return v.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||["contextmenu","click","mouseup"].includes(a.type))){v.next=7;break}return v.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return v.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=Fa,s*=Fa,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,E.Z)(M().mark(function n(a){var s=this,f,v,g,x,C;return M().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:f=this.rendererService,v=f.getViewportSize,g=f.useFramebuffer,x=f.clear,C=f.getContainer,this.resizePickingFBO(),g(this.pickingFBO,function(){var k=s.layerService.getRenderList();k.filter(function(j){return j.needPick(a.type)}).reverse().some(function(j){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),j.hooks.beforePickingEncode.call(),j.masks.length>0&&j.masks.map(function(te){te.hooks.beforeRenderData.call(),te.hooks.beforeRender.call(),te.render(),te.hooks.afterRender.call()}),j.renderModels(!0),j.hooks.afterPickingEncode.call(),s.pickedLayers.map(function(te){s.selectFeature(te,new Uint8Array([0,0,0,0]))});var X=s.pickFromPickingFBO(j,a);return s.layerService.pickedLayerId=X?+j.id:-1,X&&!j.getLayerConfig().enablePropagation})});case 3:case"end":return O.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){nu(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,nn.Z)(n,3),s=a[0],f=a[1],v=a[2];r.hooks.beforeHighlight.call([s,f,v])}},{key:"selectFeature",value:function(r,n){var a=(0,nn.Z)(n,3),s=a[0],f=a[1],v=a[2];r.hooks.beforeSelect.call([s,f,v])}}]),e}(),Ql=bi(Qa.prototype,"mapService",[zo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ll=bi(Qa.prototype,"rendererService",[Is],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lh=bi(Qa.prototype,"configService",[va],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),If=bi(Qa.prototype,"interactionService",[Kl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ch=bi(Qa.prototype,"layerService",[Ru],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qa))||$l),Bh=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ht.Z)(this,e),(0,A.Z)(this,"autoStart",void 0),(0,A.Z)(this,"startTime",0),(0,A.Z)(this,"oldTime",0),(0,A.Z)(this,"running",!1),(0,A.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,Pt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Nh,_p,xp,Cc,zh,Ac,tf,fh,bp;function td(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ep(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Ep(e,i){if(!!e){if(typeof e=="string")return Uh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Uh(e,i)}}function Uh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var rd=(Nh=(0,zr.b2)(),_p=(0,zr.f3)(Yt.IRendererService),xp=(0,zr.f3)(Yt.IMapService),Cc=(0,zr.f3)(Yt.IGlobalConfigService),Nh(zh=(Ac=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"pickedLayerId",-1),(0,A.Z)(this,"clock",new Bh),(0,A.Z)(this,"alreadyInRendering",!1),(0,A.Z)(this,"layers",[]),(0,A.Z)(this,"layerList",[]),(0,A.Z)(this,"layerRenderID",void 0),(0,A.Z)(this,"sceneInited",!1),(0,A.Z)(this,"animateInstanceCount",0),(0,A.Z)(this,"shaderPicking",!0),(0,A.Z)(this,"enableRender",!0),mi(this,"renderService",tf,this),mi(this,"mapService",fh,this),mi(this,"configService",bp,this)}return(0,Pt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"addMask",value:function(r){this.sceneInited&&r.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,E.Z)(M().mark(function n(){var a,s,f;return M().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){g.next=2;break}return g.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=td(this.layerList),g.prev=5,a.s();case 7:if((s=a.n()).done){g.next=21;break}if(f=s.value,f.hooks.beforeRenderData.call(),f.hooks.beforeRender.call(),!f.isLayerGroup&&f.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),f.masks.map(function(x){x.hooks.beforeRenderData.call(),x.hooks.beforeRender.call(),x.render(),x.hooks.afterRender.call()})),!f.getLayerConfig().enableMultiPassRenderer){g.next=17;break}return g.next=15,f.renderMultiPass();case 15:g.next=18;break;case 17:f.render();case 18:f.hooks.afterRender.call();case 19:g.next=7;break;case 21:g.next=26;break;case 23:g.prev=23,g.t0=g.catch(5),a.e(g.t0);case 26:return g.prev=26,a.f(),g.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return g.stop()}},n,this,[[5,23,26,29]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,a){return n.zIndex-a.zIndex}).forEach(function(n){n.isLayerGroup?n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){r.layerList.push(a)}):r.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=Ea(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=fa.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){fa.cancelAnimationFrame(this.layerRenderID)}}]),e}(),tf=bi(Ac.prototype,"renderService",[_p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fh=bi(Ac.prototype,"mapService",[xp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bp=bi(Ac.prototype,"configService",[Cc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ac))||zh),wc=z(81253),Sp=z(14293),cl=z.n(Sp),nd=function(){function e(i){var r=this;(0,ht.Z)(this,e),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"scale",void 0),(0,A.Z)(this,"descriptor",void 0),(0,A.Z)(this,"featureBufferLayout",[]),(0,A.Z)(this,"needRescale",!1),(0,A.Z)(this,"needRemapping",!1),(0,A.Z)(this,"needRegenerateVertices",!1),(0,A.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,A.Z)(this,"vertexAttribute",void 0),(0,A.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,f){var v,g=(v=r.scale)===null||v===void 0?void 0:v.scalers[f].func,x=g(s);return x})}),this.setProps(i)}return(0,Pt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,Ce.Z)(r));if(!cl()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Zh=["buffer","update","name"],id=["buffer","update","name"],Tc,jh,Of,Vh,Rf,ad;function Dd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Gh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Dd(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function x0(e){return new Promise(function(i){return setTimeout(i,e)})}var Fd=(Tc={},(0,A.Z)(Tc,G.FLOAT,4),(0,A.Z)(Tc,G.UNSIGNED_BYTE,1),(0,A.Z)(Tc,G.UNSIGNED_SHORT,2),Tc),b0=(jh=(0,zr.b2)(),Of=(0,zr.f3)(Yt.IRendererService),jh(Vh=(Rf=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"attributesAndIndices",void 0),mi(this,"rendererService",ad,this),(0,A.Z)(this,"attributes",[]),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Pt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new nd(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(Gh(Gh({},n),{},{name:r})));var f=n.scale;f&&s&&(s.scale=f,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,f=this.attributes.find(function(ot){return ot.name===r});if(f&&f.descriptor){var v=f.descriptor,g=v.update,x=v.buffer,C=v.size,T=C===void 0?0:C,O=Fd[x.type||G.FLOAT];if(g){var k=this.featureLayout,j=k.elements,X=k.sizePerElement,te=j.slice(a,s);if(!te.length)return;var Ee=te[0].offset,Ne=Ee*T*O,$e=te.map(function(ot,Et){for(var _t=ot.featureIdx,qt=ot.vertices,or=ot.normals,Mr=qt.length/X,Xr=[],yr=0;yr<Mr;yr++){var sn=or?or.slice(yr*3,yr*3+3):[];Xr.push.apply(Xr,(0,Ce.Z)(g(n[_t],_t,qt.slice(yr*X,yr*X+X),Et,sn)))}return Xr}).reduce(function(ot,Et){return ot.push.apply(ot,(0,Ce.Z)(Et)),ot},[]);f.vertexAttribute.updateBuffer({data:$e,offset:Ne})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var f=this.attributes.map(function(Ne){return Ne.resetDescriptor(),Ne.descriptor}),v=0,g=[],x=[],C=[],T=3;r.forEach(function(Ne,$e){var ot=s.triangulation(Ne,a),Et=ot.indices,_t=ot.vertices,qt=ot.normals,or=ot.size,Mr=ot.indexes;Et.forEach(function(Ln){x.push(Ln+v)}),T=or;var Xr=_t.length/or;s.featureLayout.sizePerElement=T,s.featureLayout.elements.push({featureIdx:$e,vertices:_t,normals:qt,offset:v}),v+=Xr;for(var yr=function(jn){var ja=(qt==null?void 0:qt.slice(jn*3,jn*3+3))||[],Po=_t.slice(jn*or,jn*or+or),Os=0;Mr&&Mr[jn]!==void 0&&(Os=Mr[jn]),f.forEach(function(iu,Us){if(iu&&iu.update){var kc;(kc=iu.buffer.data).push.apply(kc,(0,Ce.Z)(iu.update(Ne,$e,Po,jn,ja,Os)))}})},sn=0;sn<Xr;sn++)yr(sn)});var O=this.rendererService,k=O.createAttribute,j=O.createBuffer,X=O.createElements,te={};f.forEach(function(Ne,$e){if(Ne){var ot=Ne.buffer,Et=Ne.update,_t=Ne.name,qt=(0,wc.Z)(Ne,Zh),or=k(Gh({buffer:j(ot)},qt));te[Ne.name||""]=or,s.attributes[$e].vertexAttribute=or}});var Ee=X({data:x,type:G.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:te,elements:Ee},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(k){return k.resetDescriptor(),k.descriptor}),f=0,v=[],g=3;r.forEach(function(k,j){var X=a.triangulation(k),te=X.indices,Ee=X.vertices,Ne=X.normals,$e=X.size,ot=X.indexes;te.forEach(function(or){v.push(or+f)}),g=$e;var Et=Ee.length/$e;a.featureLayout.sizePerElement=g,a.featureLayout.elements.push({featureIdx:j,vertices:Ee,normals:Ne,offset:f}),f+=Et;for(var _t=function(Mr){var Xr=(Ne==null?void 0:Ne.slice(Mr*3,Mr*3+3))||[],yr=Ee.slice(Mr*$e,Mr*$e+$e),sn=0;ot&&ot[Mr]!==void 0&&(sn=ot[Mr]),s.forEach(function(Ln,jn){if(Ln&&Ln.update){var ja;(ja=Ln.buffer.data).push.apply(ja,(0,Ce.Z)(Ln.update(k,j,yr,Mr,Xr,sn)))}})},qt=0;qt<Et;qt++)_t(qt)});var x=this.rendererService,C=x.createAttribute,T=x.createBuffer,O={};return s.forEach(function(k,j){if(k){var X=k.buffer,te=k.update,Ee=k.name,Ne=(0,wc.Z)(k,id),$e=C(Gh({buffer:T(X)},Ne));O[k.name||""]=$e,a.attributes[j].vertexAttribute=$e}}),{attributes:O}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),ad=bi(Rf.prototype,"rendererService",[Of],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rf))||Vh),Hh=z(67709),Uo=z.n(Hh),Tl,Mv,rf,od,Bd,Cp,Jl,Ap,Wh,wp,Tp,sd,Nd,Xh,zd,Ud,Zd,Xs,jd,Lu,Mp,Vd,ec,Pv,Gd,Lf,hh,ph,dh,vh,Hd,Wd,Xd;function Iv(e){var i=Yd();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Yd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qd=(Tl=(0,zr.b2)(),Mv=(0,zr.f3)(Yt.SceneID),rf=(0,zr.f3)(Yt.IIconService),od=(0,zr.f3)(Yt.IFontService),Bd=(0,zr.f3)(Yt.IControlService),Cp=(0,zr.f3)(Yt.IGlobalConfigService),Jl=(0,zr.f3)(Yt.IMapService),Ap=(0,zr.f3)(Yt.ICoordinateSystemService),Wh=(0,zr.f3)(Yt.IRendererService),wp=(0,zr.f3)(Yt.ILayerService),Tp=(0,zr.f3)(Yt.ICameraService),sd=(0,zr.f3)(Yt.IInteractionService),Nd=(0,zr.f3)(Yt.IPickingService),Xh=(0,zr.f3)(Yt.IShaderModuleService),zd=(0,zr.f3)(Yt.IMarkerService),Ud=(0,zr.f3)(Yt.IPopupService),Tl(Zd=(Xs=function(e){(0,Pr.Z)(r,e);var i=Iv(r);function r(){var n;return(0,ht.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"destroyed",!1),(0,A.Z)((0,ue.Z)(n),"loaded",!1),(0,A.Z)((0,ue.Z)(n),"loadFont",!1),(0,A.Z)((0,ue.Z)(n),"fontFamily",""),mi((0,ue.Z)(n),"id",jd,(0,ue.Z)(n)),mi((0,ue.Z)(n),"iconService",Lu,(0,ue.Z)(n)),mi((0,ue.Z)(n),"fontService",Mp,(0,ue.Z)(n)),mi((0,ue.Z)(n),"controlService",Vd,(0,ue.Z)(n)),mi((0,ue.Z)(n),"configService",ec,(0,ue.Z)(n)),mi((0,ue.Z)(n),"map",Pv,(0,ue.Z)(n)),mi((0,ue.Z)(n),"coordinateSystemService",Gd,(0,ue.Z)(n)),mi((0,ue.Z)(n),"rendererService",Lf,(0,ue.Z)(n)),mi((0,ue.Z)(n),"layerService",hh,(0,ue.Z)(n)),mi((0,ue.Z)(n),"cameraService",ph,(0,ue.Z)(n)),mi((0,ue.Z)(n),"interactionService",dh,(0,ue.Z)(n)),mi((0,ue.Z)(n),"pickingService",vh,(0,ue.Z)(n)),mi((0,ue.Z)(n),"shaderModuleService",Hd,(0,ue.Z)(n)),mi((0,ue.Z)(n),"markerService",Wd,(0,ue.Z)(n)),mi((0,ue.Z)(n),"popupService",Xd,(0,ue.Z)(n)),(0,A.Z)((0,ue.Z)(n),"inited",!1),(0,A.Z)((0,ue.Z)(n),"initPromise",void 0),(0,A.Z)((0,ue.Z)(n),"rendering",!1),(0,A.Z)((0,ue.Z)(n),"$container",void 0),(0,A.Z)((0,ue.Z)(n),"canvas",void 0),(0,A.Z)((0,ue.Z)(n),"markerContainer",void 0),(0,A.Z)((0,ue.Z)(n),"hooks",void 0),(0,A.Z)((0,ue.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),yn(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,A.Z)((0,ue.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new Gp},n}return(0,Pt.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,E.Z)(M().mark(function f(){return M().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){g.next=6;break}return g.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(ia.Drag,s.addSceneEvent.bind(s));case 13:case"end":return g.stop()}},f)}))),this.hooks.init.tapPromise("initRenderer",(0,E.Z)(M().mark(function f(){var v,g;return M().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v=ua(s.configService.getSceneConfig(s.id).id||""),s.$container=v,!v){C.next=11;break}return s.canvas=Wa("canvas","",v),s.setCanvas(),C.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:Uo()(s.$container,s.handleWindowResized),fa.matchMedia&&((g=fa.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||g===void 0||g.addListener(s.handleWindowResized)),C.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return C.stop()}},f)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,E.Z)(M().mark(function f(){return M().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(ia.Drag,s.addSceneEvent.bind(s));case 5:case"end":return g.stop()}},f)}))),this.hooks.init.tapPromise("initRenderer",(0,E.Z)(M().mark(function f(){var v;return M().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=a.canvas,s.$container=v||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},f)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"addMask",value:function(a){this.layerService.sceneService=this,this.layerService.addMask(a),this.render()}},{key:"render",value:function(){var n=(0,E.Z)(M().mark(function s(){return M().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.rendering||this.destroyed)){v.next=2;break}return v.abrupt("return");case 2:if(this.rendering=!0,this.inited){v.next=23;break}return v.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){v.next=18;break}return v.prev=8,v.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:v.next=18;break;case 13:v.prev=13,v.t0=v.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(v.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return v.stop()}},s,this,[[8,13]])}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var f=document.createElement("style");f.type="text/css",f.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(f),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,f=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var v=a==="jpg"?f==null?void 0:f.toDataURL("image/jpeg"):f==null?void 0:f.toDataURL("image/png");return v}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=Wa("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,f;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var g;(g=a.$container)===null||g===void 0||g.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(f=s.parentNode)===null||f===void 0||f.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Hh.unbind)(this.$container,this.handleWindowResized),fa.matchMedia){var v;(v=fa.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,f=Fa,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=v*f,x.height=g*f),this.rendererService.viewport({x:0,y:0,width:f*v,height:f*g})}},{key:"setCanvas",value:function(){var a,s,f=Fa,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=v*f,x.height=g*f,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(Mn.EventEmitter),jd=bi(Xs.prototype,"id",[Mv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lu=bi(Xs.prototype,"iconService",[rf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mp=bi(Xs.prototype,"fontService",[od],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vd=bi(Xs.prototype,"controlService",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ec=bi(Xs.prototype,"configService",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pv=bi(Xs.prototype,"map",[Jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gd=bi(Xs.prototype,"coordinateSystemService",[Ap],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lf=bi(Xs.prototype,"rendererService",[Wh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hh=bi(Xs.prototype,"layerService",[wp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ph=bi(Xs.prototype,"cameraService",[Tp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dh=bi(Xs.prototype,"interactionService",[sd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vh=bi(Xs.prototype,"pickingService",[Nd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hd=bi(Xs.prototype,"shaderModuleService",[Xh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wd=bi(Xs.prototype,"markerService",[zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xd=bi(Xs.prototype,"popupService",[Ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xs))||Zd),nf=z(44908),Kd=z.n(nf);function $d(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var Qd=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Jd(e){var i={};return e=e.replace(Qd,function(r,n,a){var s=a.split(":"),f=s[0].trim(),v="";switch(s.length>1&&(v=s[1].trim()),n){case"bool":v=v==="true";break;case"float":case"int":v=Number(v);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":v?v=v.replace("[","").replace("]","").split(",").reduce(function(g,x){return g.push(Number(x.trim())),g},[]):v=new Array($d(n)).fill(0);break;default:}return i[f]=v,"uniform ".concat(n," ").concat(f,`;
`)}),{content:e,uniforms:i}}var ud,ev;function tv(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function mh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?tv(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tv(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var rv="#define PI 3.14159265359",Pp=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Ov=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,ld=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,E0=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,Rv=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,S0=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,C0=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,A0=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,w0=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,T0=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,M0=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,P0=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,I0=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,Mc=/precision\s+(high|low|medium)p\s+float/,cd=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Lv=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Ip=(ud=(0,zr.b2)(),ud(ev=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"moduleCache",{}),(0,A.Z)(this,"rawContentCache",{})}return(0,Pt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:rv,fs:rv}),this.registerModule("decode",{vs:Pp,fs:""}),this.registerModule("projection",{vs:C0,fs:""}),this.registerModule("project",{vs:S0,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:A0}),this.registerModule("lighting",{vs:ld,fs:""}),this.registerModule("light",{vs:Ov,fs:""}),this.registerModule("picking",{vs:Rv,fs:E0}),this.registerModule("styleMapping",{vs:w0,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:I0,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:T0,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:M0,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:P0,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,f=n.uniforms,v=Jd(a),g=v.content,x=v.uniforms,C=Jd(s),T=C.content,O=C.uniforms;this.rawContentCache[r]={fs:T,uniforms:mh(mh(mh({},x),O),f),vs:g}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,f=this.processModule(a,[],"vs"),v=f.content,g=f.includeList,x=this.processModule(s,[],"fs"),C=x.content,T=x.includeList,O=C,k=Kd()(g.concat(T).concat(r)).reduce(function(j,X){return mh(mh({},j),n.rawContentCache[X].uniforms)},{});return Mc.test(C)||(O=cd+C),this.moduleCache[r]={fs:O.trim(),uniforms:k,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,f=r.replace(Lv,function(v,g){var x=g.split(" "),C=x[0].replace(/"/g,"");if(n.indexOf(C)>-1)return"";var T=s.rawContentCache[C][a];n.push(C);var O=s.processModule(T,n,a),k=O.content;return k});return{content:f,includeList:n}}}]),e}())||ev),Op=z(66213),Yh;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Yh||(Yh={}));var _m,xm,kv=(_m=(0,zr.b2)(),_m(xm=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"config",void 0)}return(0,Pt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Yh.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Yt.IRendererService),this.cameraService=r.getContainer().get(Yt.ICameraService),this.mapService=r.getContainer().get(Yt.IMapService),this.interactionService=r.getContainer().get(Yt.IInteractionService),this.layerService=r.getContainer().get(Yt.ILayerService),this.shaderModuleService=r.getContainer().get(Yt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||xm),bm,Em;function hb(e){var i=pb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function pb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var db=(bm=(0,zr.b2)(),bm(Em=function(e){(0,Pr.Z)(r,e);var i=hb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){(0,Op.Z)((0,mt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(kv))||Em),Sm,Cm,Am,O0,wm;function vb(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=mb(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function mb(e,i){if(!!e){if(typeof e=="string")return Tm(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Tm(e,i)}}function Tm(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var gb=(Sm=(0,zr.b2)(),Cm=(0,zr.f3)(Yt.IPostProcessor),Sm(Am=(O0=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"passes",[]),mi(this,"postProcessor",wm,this),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"renderFlag",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0)}return(0,Pt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,E.Z)(M().mark(function n(){var a,s,f;return M().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a=vb(this.passes),g.prev=1,a.s();case 3:if((s=a.n()).done){g.next=9;break}return f=s.value,g.next=7,f.render(this.layer);case 7:g.next=3;break;case 9:g.next=14;break;case 11:g.prev=11,g.t0=g.catch(1),a.e(g.t0);case 14:return g.prev=14,a.f(),g.finish(14);case 17:return g.next=19,this.postProcessor.render(this.layer);case 19:case"end":return g.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Yh.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),wm=bi(O0.prototype,"postProcessor",[Cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O0))||Am),Mm,Pm;function Im(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Om(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Im(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Im(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yb(e){var i=_b();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function _b(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xb=(Mm=(0,zr.b2)(),Mm(Pm=function(e){(0,Pr.Z)(r,e);var i=yb(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"pickingFBO",void 0),(0,A.Z)((0,ue.Z)(n),"layer",void 0),(0,A.Z)((0,ue.Z)(n),"width",0),(0,A.Z)((0,ue.Z)(n),"height",0),(0,A.Z)((0,ue.Z)(n),"alreadyInRendering",!1),(0,A.Z)((0,ue.Z)(n),"pickFromPickingFBO",function(v){var g=v.x,x=v.y,C=v.lngLat,T=v.type;if(!(!n.layer.isVisible()||!n.layer.needPick(T))){var O=n.rendererService,k=O.getViewportSize,j=O.readPixels,X=O.useFramebuffer,te=k(),Ee=te.width,Ne=te.height,$e=n.layer.getLayerConfig(),ot=$e.enableHighlight,Et=$e.enableSelect,_t=g*Fa,qt=x*Fa;if(!(_t>Ee||_t<0||qt>Ne||qt<0)){var or;X(n.pickingFBO,function(){var Mr;if(or=j({x:Math.round(_t),y:Math.round(Ne-(x+1)*Fa),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),or[0]!==0||or[1]!==0||or[2]!==0){var Xr=Js(or),yr=n.layer.getSource().getFeatureById(Xr),sn={x:g,y:x,type:T,lngLat:C,featureId:Xr,feature:yr};yr&&(n.layer.setCurrentPickId(Xr),n.triggerHoverOnLayer(sn))}else{var Ln={x:g,y:x,lngLat:C,type:n.layer.getCurrentPickId()===null?"un"+T:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Om(Om({},Ln),{},{type:"unpick"})),n.triggerHoverOnLayer(Ln),n.layer.setCurrentPickId(null)}ot&&n.highlightPickedFeature(or),Et&&T==="click"&&((Mr=or)===null||Mr===void 0?void 0:Mr.toString())!==[0,0,0,0].toString()&&n.selectFeature(or)})}}}),n}return(0,Pt.Z)(r,[{key:"getType",value:function(){return Yh.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){(0,Op.Z)((0,mt.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var f=this.rendererService,v=f.createTexture2D,g=f.createFramebuffer,x=f.getViewportSize,C=x(),T=C.width,O=C.height;this.pickingFBO=g({color:v({width:T,height:O,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.interactionService.on(ia.Hover,this.pickFromPickingFBO),this.interactionService.on(ia.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ia.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var f=this.rendererService,v=f.getViewportSize,g=f.useFramebuffer,x=f.clear,C=v(),T=C.width,O=C.height;this.alreadyInRendering=!0,(this.width!==T||this.height!==O)&&(this.pickingFBO.resize({width:T,height:O}),this.width=T,this.height=O),g(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var k=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(k),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,nn.Z)(a,3),f=s[0],v=s[1],g=s[2];this.layer.hooks.beforeHighlight.call([f,v,g]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,nn.Z)(a,3),f=s[0],v=s[1],g=s[2];this.layer.hooks.beforeSelect.call([f,v,g]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,f=pu(s);this.selectFeature(new Uint8Array(f))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,f=pu(s);this.highlightPickedFeature(new Uint8Array(f))}}]),r}(kv))||Pm),bb=z(11700),Eb=z.n(bb),Sb=z(68929),Cb=z.n(Sb),Rm,Lm,km,R0,Dm;function Fm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Ab=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gh=(Rm=(0,zr.b2)(),Lm=(0,zr.f3)(Yt.IShaderModuleService),Rm(km=(R0=function(){function e(){(0,ht.Z)(this,e),mi(this,"shaderModuleService",Dm,this),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"config",void 0),(0,A.Z)(this,"quad",Ab),(0,A.Z)(this,"enabled",!0),(0,A.Z)(this,"renderToScreen",!1),(0,A.Z)(this,"model",void 0),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"optionsToUpdate",{})}return(0,Pt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Yh.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Yt.IRendererService),this.shaderModuleService=r.getContainer().get(Yt.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,f=a.createBuffer,v=a.createModel,g=this.setupShaders(),x=g.vs,C=g.fs,T=g.uniforms;this.model=v({vs:x,fs:C,attributes:{a_Position:s({buffer:f({data:[-4,-4,4,-4,0,4],type:G.FLOAT}),size:2})},uniforms:nv(nv({u_Texture:null},T),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),f=this.rendererService,v=f.useFramebuffer,g=f.getViewportSize,x=f.clear,C=g(),T=C.width,O=C.height;v(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var k=nv({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[T,O]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(k.u_BloomFinal=1,k.u_Texture2=n),a.model.draw({uniforms:k})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=nv(nv({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){cl()(r[a])||(n["u_".concat(Eb()(Cb()(a)))]=r[a])}),n}}]),e}(),Dm=bi(R0.prototype,"shaderModuleService",[Lm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R0))||km),Bm,Nm;function zm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Um(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?zm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wb(e){var i=Tb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Tb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mb=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Pb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ib=(Bm=(0,zr.b2)(),Bm(Nm=function(e){(0,Pr.Z)(r,e);var i=wb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Pb,fs:Mb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:Um(Um({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return cl()(a.bloomRadius)||(s.u_radius=a.bloomRadius),cl()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),cl()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(gh))||Nm),Zm,jm;function Vm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Gm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Vm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ob(e){var i=Rb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Rb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,kb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Db=(Zm=(0,zr.b2)(),Zm(jm=function(e){(0,Pr.Z)(r,e);var i=Ob(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:kb,fs:Lb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:Gm(Gm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return cl()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(gh))||jm),Hm,Wm;function Xm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ym(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Xm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Fb(e){var i=Bb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Bb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Nb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,zb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ub=(Hm=(0,zr.b2)(),Hm(Wm=function(e){(0,Pr.Z)(r,e);var i=Fb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:zb,fs:Nb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:Ym(Ym({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return cl()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(gh))||Wm),qm,Km;function $m(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Qm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$m(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$m(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Zb(e){var i=jb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function jb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Gb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Hb=(qm=(0,zr.b2)(),qm(Km=function(e){(0,Pr.Z)(r,e);var i=Zb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Gb,fs:Vb});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:Qm(Qm({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(gh))||Km),Jm,eg;function Wb(e){var i=Xb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Xb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,qb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Kb=(Jm=(0,zr.b2)(),Jm(eg=function(e){(0,Pr.Z)(r,e);var i=Wb(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:qb,fs:Yb}),this.shaderModuleService.getModule("copy-pass")}}]),r}(gh))||eg),tg,rg;function ng(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ig(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ng(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ng(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $b(e){var i=Qb();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Qb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Jb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,e2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,t2=(tg=(0,zr.b2)(),tg(rg=function(e){(0,Pr.Z)(r,e);var i=$b(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:e2,fs:Jb});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:ig(ig({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(gh))||rg),ag,og;function sg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ug(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?sg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function r2(e){var i=n2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function n2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,a2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,o2=(ag=(0,zr.b2)(),ag(og=function(e){(0,Pr.Z)(r,e);var i=r2(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:a2,fs:i2});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,f=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:f,uniforms:ug(ug({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(gh))||og),lg,cg;function s2(e){var i=u2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function u2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,c2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,f2=(lg=(0,zr.b2)(),lg(cg=function(e){(0,Pr.Z)(r,e);var i=s2(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:c2,fs:l2}),this.shaderModuleService.getModule("noise-pass")}}]),r}(gh))||cg),fg,hg;function h2(e){var i=p2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function p2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,v2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,m2=(fg=(0,zr.b2)(),fg(hg=function(e){(0,Pr.Z)(r,e);var i=h2(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:d2,fs:v2}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(gh))||hg),pg,dg,vg,mg,fd,gg,g2=(pg=(0,zr.b2)(),dg=(0,zr.f3)(Yt.IRendererService),vg=(0,zr.zY)(),pg(mg=(fd=function(){function e(){(0,ht.Z)(this,e),mi(this,"rendererService",gg,this),(0,A.Z)(this,"passes",[]),(0,A.Z)(this,"readFBO",void 0),(0,A.Z)(this,"writeFBO",void 0)}return(0,Pt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),f=s.width,v=s.height;return a({x:0,y:0,width:f,height:v,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,E.Z)(M().mark(function f(){return M().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return g.stop()}},f)})))})}},{key:"renderBloomPass",value:function(){var i=(0,E.Z)(M().mark(function n(a,s){var f,v;return M().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:f=x.sent,v=0;case 4:if(!(v<4)){x.next=11;break}return x.next=7,s.render(a,f);case 7:this.swap(),v++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,E.Z)(M().mark(function n(a){var s,f;return M().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:s=0;case 1:if(!(s<this.passes.length)){g.next=15;break}if(f=this.passes[s],f.setRenderToScreen(this.isLastEnabledPass(s)),f.getName()!=="bloom"){g.next=9;break}return g.next=7,this.renderBloomPass(a,f);case 7:g.next=12;break;case 9:return g.next=11,f.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,g.next=1;break;case 15:case"end":return g.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),gg=bi(fd.prototype,"rendererService",[dg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bi(fd.prototype,"init",[vg],Object.getOwnPropertyDescriptor(fd.prototype,"init"),fd.prototype),fd))||mg),yg,_g;function y2(e){var i=_2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function _2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x2=(yg=(0,zr.b2)(),yg(_g=function(e){(0,Pr.Z)(r,e);var i=y2(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getType",value:function(){return Yh.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){(0,Op.Z)((0,mt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,f=s.useFramebuffer,v=s.clear,g=a.multiPassRenderer.getPostProcessor().getReadFBO();f(g,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:g}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(x){x.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(kv))||_g),xg,bg,Eg,L0,Sg;function Cg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ag(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Cg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function b2(e){var i=E2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function E2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var S2=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,wg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,C2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Tg(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var A2=1,w2=(xg=(0,zr.b2)(),bg=(0,zr.f3)(Yt.IShaderModuleService),xg(Eg=(L0=function(e){(0,Pr.Z)(r,e);var i=b2(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),mi((0,ue.Z)(n),"shaderModuleService",Sg,(0,ue.Z)(n)),(0,A.Z)((0,ue.Z)(n),"haltonSequence",[]),(0,A.Z)((0,ue.Z)(n),"accumulatingId",0),(0,A.Z)((0,ue.Z)(n),"frame",0),(0,A.Z)((0,ue.Z)(n),"timer",void 0),(0,A.Z)((0,ue.Z)(n),"sampleRenderTarget",void 0),(0,A.Z)((0,ue.Z)(n),"prevRenderTarget",void 0),(0,A.Z)((0,ue.Z)(n),"outputRenderTarget",void 0),(0,A.Z)((0,ue.Z)(n),"copyRenderTarget",void 0),(0,A.Z)((0,ue.Z)(n),"blendModel",void 0),(0,A.Z)((0,ue.Z)(n),"outputModel",void 0),(0,A.Z)((0,ue.Z)(n),"copyModel",void 0),n}return(0,Pt.Z)(r,[{key:"getType",value:function(){return Yh.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){(0,Op.Z)((0,mt.Z)(r.prototype),"init",this).call(this,a,s);var f=this.rendererService,v=f.createFramebuffer,g=f.createTexture2D;this.sampleRenderTarget=v({color:g({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.prevRenderTarget=v({color:g({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.outputRenderTarget=v({color:g({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})}),this.copyRenderTarget=v({color:g({width:1,height:1,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([Tg(x,2),Tg(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",S2),this.outputModel=this.createTriangleModel("copy-pass",wg,{blend:{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE_MINUS_SRC_ALPHA,srcAlpha:G.ONE,dstAlpha:G.ONE_MINUS_SRC_ALPHA},equation:{rgb:G.FUNC_ADD,alpha:G.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",wg)}},{key:"render",value:function(a){var s=this,f=this.rendererService,v=f.clear,g=f.getViewportSize,x=f.useFramebuffer,C=g(),T=C.width,O=C.height;this.sampleRenderTarget.resize({width:T,height:O}),this.prevRenderTarget.resize({width:T,height:O}),this.outputRenderTarget.resize({width:T,height:O}),this.copyRenderTarget.resize({width:T,height:O}),this.resetFrame(),this.stopAccumulating();var k=a.multiPassRenderer.getPostProcessor().getReadFBO();x(k,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:k}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var j=function X(te){!s.accumulatingId||te!==s.accumulatingId||s.isFinished()||(s.doRender(a),fa.requestAnimationFrame(function(){X(te)}))};this.accumulatingId=A2++,this.timer=fa.setTimeout(function(){j(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,f=this.rendererService,v=f.clear,g=f.getViewportSize,x=f.useFramebuffer,C=g(),T=C.width,O=C.height,k=a.getLayerConfig(),j=k.jitterScale,X=j===void 0?1:j,te=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((te[0]*2-1)/T*X,(te[1]*2-1)/O*X),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var Ee=a.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:Ee.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var Ne=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Ne,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,fa.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,f){this.shaderModuleService.registerModule(a,{vs:C2,fs:s});var v=this.shaderModuleService.getModule(a),g=v.vs,x=v.fs,C=v.uniforms,T=this.rendererService,O=T.createAttribute,k=T.createBuffer,j=T.createModel;return j(Ag({vs:g,fs:x,attributes:{a_Position:O({buffer:k({data:[-4,-4,4,-4,0,4],type:G.FLOAT}),size:2})},uniforms:Ag({},C),depth:{enable:!1},count:3},f))}}]),r}(kv),Sg=bi(L0.prototype,"shaderModuleService",[bg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L0))||Eg),iv=new zr.W2;iv.bind(Yt.IGlobalConfigService).to(Ou).inSingletonScope(),(0,zr.GW)((0,zr.b2)(),Mn.EventEmitter),iv.bind(Yt.IEventEmitter).to(Mn.EventEmitter);var Mg=(0,Ec.Z)(iv,!1),k0=function(i){var r=Mg.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},AP=function(i){var r=Mg.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},tc=iv,T2=0;function M2(){var e=new zr.W2;return e.parent=iv,e.bind(Yt.SceneID).toConstantValue("".concat(T2++)),e.bind(Yt.IShaderModuleService).to(Ip).inSingletonScope(),e.bind(Yt.ILayerService).to(rd).inSingletonScope(),e.bind(Yt.ISceneService).to(qd).inSingletonScope(),e.bind(Yt.ICameraService).to(Ae).inSingletonScope(),e.bind(Yt.ICoordinateSystemService).to(To).inSingletonScope(),e.bind(Yt.IInteractionService).to(Za).inSingletonScope(),e.bind(Yt.IPickingService).to(ed).inSingletonScope(),e.bind(Yt.IControlService).to(on).inSingletonScope(),e.bind(Yt.IMarkerService).to(fn).inSingletonScope(),e.bind(Yt.IIconService).to(br).inSingletonScope(),e.bind(Yt.IFontService).to(xr).inSingletonScope(),e.bind(Yt.IPopupService).to(gn).inSingletonScope(),e.bind(Yt.INormalPass).to(db).whenTargetNamed("clear"),e.bind(Yt.INormalPass).to(xb).whenTargetNamed("pixelPicking"),e.bind(Yt.INormalPass).to(x2).whenTargetNamed("render"),e.bind(Yt.INormalPass).to(w2).whenTargetNamed("taa"),e.bind(Yt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Yt.INormalPass,r)}}),e.bind(Yt.IPostProcessingPass).to(Kb).whenTargetNamed("copy"),e.bind(Yt.IPostProcessingPass).to(Ib).whenTargetNamed("bloom"),e.bind(Yt.IPostProcessingPass).to(Db).whenTargetNamed("blurH"),e.bind(Yt.IPostProcessingPass).to(Ub).whenTargetNamed("blurV"),e.bind(Yt.IPostProcessingPass).to(f2).whenTargetNamed("noise"),e.bind(Yt.IPostProcessingPass).to(m2).whenTargetNamed("sepia"),e.bind(Yt.IPostProcessingPass).to(Hb).whenTargetNamed("colorHalftone"),e.bind(Yt.IPostProcessingPass).to(t2).whenTargetNamed("hexagonalPixelate"),e.bind(Yt.IPostProcessingPass).to(o2).whenTargetNamed("ink"),e.bind(Yt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Yt.IPostProcessingPass,r);return n.setName(r),n}}),e}function av(e){var i=new zr.W2;return i.parent=e,i.bind(Yt.IStyleAttributeService).to(b0).inSingletonScope(),i.bind(Yt.IMultiPassRenderer).to(gb).inSingletonScope(),i.bind(Yt.IPostProcessor).to(g2).inSingletonScope(),i}var wP=z(74691),P2=null;function TP(e){return P2.indexOf(e)}var I2=2,MP=4,O2=64,PP=128,R2=256,L2=512,IP=8192,OP=16384,RP=32768,k2=null,Pg=131072,LP=262144,D2=524288,kP=1048576,F2=2097152,DP=4194304,B2=8388608,N2=16777216,z2=null;function Dv(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function FP(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,f=e.opacity,v=e.stroke,g=e.strokeWidth,x=e.strokeOpacity,C=[],T=[],O=[],k=[Dv(i[0],i[1]),Dv(i[2],i[3])],j=[Dv(v[0],v[1]),Dv(v[2],v[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(X){var te=_slicedToArray(X,2),Ee=te[0],Ne=te[1];C.push([].concat(k,[(Ee+1)*B2+(Ne+1)*F2+getShapeIndex(s)*Pg+r,(n+512)*D2+(a+512)*O2])),T.push([].concat(j,[g,x])),O.push([f,0,0,0])}),{packedBuffer:C,packedBuffer2:T,packedBuffer3:O}}function BP(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*z2+r*N2+n*Pg+r*k2+n*L2+r*R2+n*I2+r}var Pc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Pc||(Pc={}));var Mo;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(Mo||(Mo={}));var qh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(qh||(qh={}));var On;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(On||(On={}));var U2=["mapload","mapchange","mapAfterFrameChange"],Rp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},D0=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Kh;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Kh||(Kh={}));function Ig(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Og(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ig(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ig(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Z2(e){var i=j2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function j2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V2=0,Fv=function(e){(0,Pr.Z)(r,e);var i=Z2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this),(0,A.Z)((0,ue.Z)(a),"controlOption",void 0),(0,A.Z)((0,ue.Z)(a),"container",void 0),(0,A.Z)((0,ue.Z)(a),"sceneContainer",void 0),(0,A.Z)((0,ue.Z)(a),"mapsService",void 0),(0,A.Z)((0,ue.Z)(a),"renderService",void 0),(0,A.Z)((0,ue.Z)(a),"layerService",void 0),(0,A.Z)((0,ue.Z)(a),"controlService",void 0),(0,A.Z)((0,ue.Z)(a),"isShow",void 0),a.controlOption=Og(Og({},a.getDefault()),n||{}),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{position:Kh.TOPRIGHT,name:"".concat(V2++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Kh.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(Yt.IMapService),this.renderService=a.get(Yt.IRendererService),this.layerService=a.get(Yt.ILayerService),this.controlService=a.get(Yt.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,f=this.controlOption.position,v=this.controlService.controlCorners[f];return zl(s,"l7-control"),f.indexOf("bottom")!==-1?v.insertBefore(s,v.firstChild):v.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;zl(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;nl(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;fc(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(Mn.EventEmitter);function G2(e){var i=H2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function H2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NP=function(e){(0,Pr.Z)(r,e);var i=G2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"layerControlInputs",void 0),(0,A.Z)((0,ue.Z)(a),"layers",void 0),(0,A.Z)((0,ue.Z)(a),"lastZIndex",void 0),(0,A.Z)((0,ue.Z)(a),"handlingClick",void 0),(0,A.Z)((0,ue.Z)(a),"layersLink",void 0),(0,A.Z)((0,ue.Z)(a),"baseLayersList",void 0),(0,A.Z)((0,ue.Z)(a),"separator",void 0),(0,A.Z)((0,ue.Z)(a),"overlaysList",void 0),(0,A.Z)((0,ue.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),Au(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,ue.Z)(a)),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:Kh.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;zl(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var f=s-(this.container.offsetTop+50);return f<this.form.clientHeight?(zl(this.form,"l7-control-layers-scrollbar"),this.form.style.height=f+"px"):nl(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return nl(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=Wa("div",a),f=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var v=this.form=Wa("form",a+"-list");f&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=Wa("a",a+"-toggle",s);var g=this.layersLink;g.title="Layers",f||this.expand(),this.baseLayersList=Wa("div",a+"-base",v),this.separator=Wa("div",a+"-separator",v),this.overlaysList=Wa("div",a+"-overlays",v),s.appendChild(v)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,f=s.baseLayers,v=f===void 0?{}:f,g=s.overlayers,x=g===void 0?{}:g;Object.keys(v).forEach(function(C,T){a.addLayer(v[C],C,!1)}),Object.keys(x).forEach(function(C,T){a.addLayer(x[C],C,!0)})}},{key:"update",value:function(){if(!this.container)return this;Ul(this.baseLayersList),Ul(this.overlaysList),this.layerControlInputs=[];var a,s,f,v,g=0;for(f=0;f<this.layers.length;f++)v=this.layers[f],this.addItem(v),s=s||v.overlay,a=a||!v.overlay,g+=v.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&g>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,f,v=this.mapsService.getZoom(),g=a.length-1;g>=0;g--)if(s=a[g],f=this.layerService.getLayer(s.layerId),f&&f.inited){var x=f.getMinZoom(),C=f.getMaxZoom();s.disabled=v<x||v>C}}},{key:"addLayer",value:function(a,s,f){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:f});var v=this.controlOption,g=v.sortLayers,x=v.sortFunction,C=v.autoZIndex;g&&this.layers.sort(function(T,O){return x(T.layer,O.layer,T.name,O.name)}),C&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),f=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;f&&this.emit(f,s)}},{key:"createRadioElement",value:function(a,s){var f='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",v=document.createElement("div");return v.innerHTML=f,v.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),f=this.layerService.getLayer(a.layer.id),v=f&&f.inited&&a.layer.isVisible(),g;a.overlay?(g=document.createElement("input"),g.type="checkbox",g.className="l7-control-layers-selector",g.defaultChecked=v):g=this.createRadioElement("l7-base-layers",v),this.layerControlInputs.push(g),g.layerId=a.layer.id,g.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+a.name;var C=document.createElement("div");s.appendChild(C),C.appendChild(g),C.appendChild(x);var T=a.overlay?this.overlaysList:this.baseLayersList;return T.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,f,v=[],g=[];this.handlingClick=!0;for(var x=a.length-1;x>=0;x--)s=a[x],f=this.layerService.getLayer(s.layerId),s.checked?v.push(f):s.checked||g.push(f);g.forEach(function(C){C.hide()}),v.forEach(function(C){C.show()}),this.handlingClick=!1}}]),r}(Fv);function W2(e){var i=X2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function X2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y2=function(e){(0,Pr.Z)(r,e);var i=W2(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{position:Kh.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=Wa("div",a),f=Wa("a","l7-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://antv.alipay.com/l7",f.setAttribute("aria-label","AntV logo"),f.setAttribute("rel","noopener nofollow"),s.appendChild(f),s}},{key:"onRemove",value:function(){return null}}]),r}(Fv);function q2(e){var i=K2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function K2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zP=function(e){(0,Pr.Z)(r,e);var i=q2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"mScale",void 0),(0,A.Z)((0,ue.Z)(a),"iScale",void 0),Au(["update"],(0,ue.Z)(a)),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{position:Kh.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=Wa("div",a);this.addScales(a+"-line",s);var f=this.controlOption.updateWhenIdle;return this.mapsService.on(f?"moveend":"mapmove",this.update),this.mapsService.on(f?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,f=a.getSize()[1]/2,v=a.containerToLngLat([0,f]),g=a.containerToLngLat([s,f]),x=gf([v.lng,v.lat],[g.lng,g.lat]);this.updateScales(x)}},{key:"updateScales",value:function(a){var s=this.controlOption,f=s.metric,v=s.imperial;f&&a&&this.updateMetric(a),v&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),f=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,f,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,f,v,g;s>5280?(f=s/5280,v=this.getRoundNum(f),this.updateScale(this.iScale,v+" mi",v/f)):(g=this.getRoundNum(s),this.updateScale(this.iScale,g+" ft",g/s))}},{key:"updateScale",value:function(a,s,f){var v=this.controlOption.maxWidth;a.style.width=Math.round(v*f)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),f=a/s;return f=f>=10?10:f>=5?5:f>=3?3:f>=2?2:1,s*f}},{key:"addScales",value:function(a,s){var f=this.controlOption,v=f.metric,g=f.imperial;v&&(this.mScale=Wa("div",a,s)),g&&(this.iScale=Wa("div",a,s))}}]),r}(Fv);function $2(e){var i=Q2();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UP=function(e){(0,Pr.Z)(r,e);var i=$2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ue.Z)(a),"disabled",void 0),(0,A.Z)((0,ue.Z)(a),"zoomInButton",void 0),(0,A.Z)((0,ue.Z)(a),"zoomOutButton",void 0),Au(["updateDisabled","zoomIn","zoomOut"],(0,ue.Z)(a)),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{position:Kh.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=Wa("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,f,v,g){var x=Wa("a",f,v);return x.innerHTML=a,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",g),x}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";nl(this.zoomInButton,s),nl(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&zl(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&zl(this.zoomInButton,s)}}]),r}(Fv);function Rg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Lg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Rg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function J2(e){var i=eE();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function eE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kg=function(e){(0,Pr.Z)(r,e);var i=J2(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this),(0,A.Z)((0,ue.Z)(a),"markerOption",void 0),(0,A.Z)((0,ue.Z)(a),"defaultMarker",void 0),(0,A.Z)((0,ue.Z)(a),"popup",void 0),(0,A.Z)((0,ue.Z)(a),"mapsService",void 0),(0,A.Z)((0,ue.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,ue.Z)(a),"lngLat",void 0),(0,A.Z)((0,ue.Z)(a),"scene",void 0),(0,A.Z)((0,ue.Z)(a),"added",!1),(0,A.Z)((0,ue.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=Lg(Lg({},a.getDefault()),n),Au(["update","onMove","onUp","addDragHandler","onMapClick"],(0,ue.Z)(a)),a.init(),a}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:wu.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(Yt.IMapService),this.sceneSerive=a.get(Yt.ISceneService);var s=this.markerOption,f=s.element,v=s.draggable;return this.mapsService.getMarkerContainer().appendChild(f),this.registerMarkerEvent(f),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&fc(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var f=this.markerOption.element;return f&&fc(f),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,f=a.anchor;this.updatePosition(),xo(s,"".concat(ws[f]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,f=a.offsets,v=this.lngLat,g=v.lng,x=v.lat,C=this.mapsService.getBounds(),T=this.mapsService.lngLatToContainer([g,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var O=this.mapsService.getContainer(),k=0,j=0;if(O&&(k=O.scrollWidth,j=O.scrollHeight),Math.abs(C[0][0])>180||Math.abs(C[1][0])>180){if(T.x>k){var X=this.mapsService.lngLatToContainer([g-360,x]);T.x=X.x}if(T.x<0){var te=this.mapsService.lngLatToContainer([g+360,x]);T.x=te.x}}(T.x>k||T.x<0||T.y>j||T.y<0)&&(s.style.display="none"),s.style.left=T.x+f[0]+"px",s.style.top=T.y-f[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,f=this.markerOption,v=f.color,g=f.anchor;if(!s){this.defaultMarker=!0,s=Wa("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),C.setAttributeNS(null,"fill",v),x.appendChild(C),s.appendChild(x)}zl(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(T){var O,k,j=((O=a.markerOption)===null||O===void 0?void 0:O.style)&&((k=a.markerOption)===null||k===void 0?void 0:k.style[T]);s&&(s.style[T]=j)}),s.addEventListener("click",function(T){a.onMapClick(T)}),s.addEventListener("click",this.eventHandle),Yc(s,g,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(Mn.EventEmitter);function Dg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Fg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Dg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function tE(e){var i=rE();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function rE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZP=function(e){(0,Pr.Z)(r,e);var i=tE(r);function r(n){var a,s;return(0,ht.Z)(this,r),s=i.call(this),(0,A.Z)((0,ue.Z)(s),"markers",[]),(0,A.Z)((0,ue.Z)(s),"markerLayerOption",void 0),(0,A.Z)((0,ue.Z)(s),"clusterIndex",void 0),(0,A.Z)((0,ue.Z)(s),"points",[]),(0,A.Z)((0,ue.Z)(s),"clusterMarkers",[]),(0,A.Z)((0,ue.Z)(s),"mapsService",void 0),(0,A.Z)((0,ue.Z)(s),"scene",void 0),(0,A.Z)((0,ue.Z)(s),"zoom",void 0),(0,A.Z)((0,ue.Z)(s),"bbox",void 0),s.markerLayerOption=Sa()(s.getDefault(),n),Au(["update"],(0,ue.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,Pt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(Yt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;if(s&&(this.addPoint(a,this.markers.length),this.mapsService)){var f=this.mapsService.getZoom(),v=this.mapsService.getBounds();this.bbox=ra(v,.5),this.zoom=Math.floor(f),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var f=a.getLnglat(),v=f.lng,g=f.lat,x={geometry:{type:"Point",coordinates:[v,g]},properties:Fg(Fg({},a.getExtData()),{},{marker_id:s})};this.points.push(x),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,f=a.minZoom,v=f===void 0?0:f,g=a.maxZoom;this.clusterIndex=new(sp())({radius:s,minZoom:v,maxZoom:g}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var f=this,v=a[0].concat(a[1]),g=this.clusterIndex.getClusters(v,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],g.forEach(function(x){var C,T=f.markerLayerOption.clusterOption,O=T.field,k=T.method;if(x.properties&&(C=x.properties)!==null&&C!==void 0&&C.cluster_id){var j,X=f.getLeaves((j=x.properties)===null||j===void 0?void 0:j.cluster_id);if(x.properties.clusterData=X,O&&k){var te=X==null?void 0:X.map(function(Et){var _t=(0,A.Z)({},O,Et.properties[O]);return _t}),Ee=ju(te,O),Ne=Ba(k,Ee),$e="point_"+k;x.properties[$e]=Ne.toFixed(2)}}var ot=f.clusterMarker(x);f.clusterMarkers.push(ot),ot.addTo(f.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,f):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,f=s,v=f.element,g=v===void 0?this.generateElement.bind(this):v,x=new kg({element:g(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){if(!!this.mapsService){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!Oa(this.bbox,s))&&(this.bbox=ra(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(a){var s=Wa("div","l7-marker-cluster"),f=Wa("div","",s),v=Wa("span","",f),g=this.markerLayerOption.clusterOption,x=g.field,C=g.method;a.properties.point_count=a.properties.point_count||1;var T=x&&C?a.properties["point_"+C]||a.properties[x]:a.properties.point_count;return v.textContent=T,s}}]),r}(Mn.EventEmitter);function Bg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ng(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Bg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nE(e){var i=iE();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function iE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zg=function(e){(0,Pr.Z)(r,e);var i=nE(r);function r(n){var a;return(0,ht.Z)(this,r),a=i.call(this),(0,A.Z)((0,ue.Z)(a),"popupOption",void 0),(0,A.Z)((0,ue.Z)(a),"mapsService",void 0),(0,A.Z)((0,ue.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,ue.Z)(a),"lngLat",void 0),(0,A.Z)((0,ue.Z)(a),"content",void 0),(0,A.Z)((0,ue.Z)(a),"closeButton",void 0),(0,A.Z)((0,ue.Z)(a),"timeoutInstance",void 0),(0,A.Z)((0,ue.Z)(a),"container",void 0),(0,A.Z)((0,ue.Z)(a),"tip",void 0),(0,A.Z)((0,ue.Z)(a),"scene",void 0),a.popupOption=Ng(Ng({},a.getdefault()),n),Au(["update","onClickClose","remove"],(0,ue.Z)(a)),a}return(0,Pt.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(Yt.IMapService),this.sceneSerive=a.get(Yt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),f=window.document.createElement("body"),v;for(f.innerHTML=a;v=f.firstChild,!!v;)s.appendChild(v);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&fc(this.content),this.content=Wa("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Wa("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,f){var v=window.document.createElement(a);return s!==void 0&&(v.className=s),f&&f.appendChild(v),v}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:wu.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,f=this.popupOption,v=f.className,g=f.maxWidth,x=f.anchor;if(!(!this.mapsService||!s||!this.content)){var C=this.mapsService.getMarkerContainer();if(!this.container&&C){this.container=this.creatDom("div","l7-popup",C),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),v&&v.split(" ").forEach(function(O){return a.container.classList.add(O)});var T=this.popupOption.stopPropagation;T&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(O){a.container.addEventListener(O,function(k){k.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}g&&this.container.style.maxWidth!==g&&(this.container.style.maxWidth=g),this.updatePosition(),xo(this.container,"".concat(ws[x])),Yc(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,f=a.lat,v=this.popupOption.offsets,g=this.mapsService.lngLatToContainer([s,f]);this.container.style.left=g.x+v[0]+"px",this.container.style.top=g.y-v[1]+"px"}}}]),r}(Mn.EventEmitter);function aE(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}aE(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var oE=z(52353),sE=z.n(oE),uE=z(13218),Ku=z.n(uE),$h,Ug=($h={},(0,A.Z)($h,Pc.additive,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE,srcAlpha:1,dstAlpha:1}}),(0,A.Z)($h,Pc.none,{enable:!1}),(0,A.Z)($h,Pc.normal,{enable:!0,func:{srcRGB:G.SRC_ALPHA,dstRGB:G.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,A.Z)($h,Pc.subtractive,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE,srcAlpha:G.ZERO,dstAlpha:G.ONE_MINUS_SRC_COLOR},equation:{rgb:G.FUNC_SUBTRACT,alpha:G.FUNC_SUBTRACT}}),(0,A.Z)($h,Pc.max,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE},equation:{rgb:G.MAX_EXT}}),(0,A.Z)($h,Pc.min,{enable:!0,func:{srcRGB:G.ONE,dstRGB:G.ONE},equation:{rgb:G.MIN_EXT}}),$h),lE=z(81763),ma=z.n(lE),jP=1024;function fl(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function cE(e,i){e.opacity&&Bv("opacity",i,e.opacity),e.strokeWidth&&Bv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Bv("strokeOpacity",i,e.strokeOpacity),e.stroke&&fE("stroke",i,e.stroke),e.offsets&&Zg("offsets",i,e.offsets),e.textOffset&&Zg("textOffset",i,e.textOffset),e.thetaOffset&&Bv("thetaOffset",i,e.thetaOffset)}function Bv(e,i,r){qa()(r)?fl(e,i,r,function(n){return n}):ma()(r)?fl(e,i,[r],void 0):Array.isArray(r)&&r.length===2?qa()(r[0])&&$o()(r[1])||qa()(r[0])&&Array.isArray(r[1])&&ma()(r[1][0])&&ma()(r[1][1])?fl(e,i,r[0],r[1]):fl(e,i,[1],void 0):fl(e,i,[1],void 0)}function Zg(e,i,r){qa()(r)?fl(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&qa()(r[0])&&$o()(r[1])?fl(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&ma()(r[0])&&ma()(r[1])?fl(e,i,r,void 0):fl(e,i,[0,0],void 0)}function fE(e,i,r){qa()(r)?fl(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(qa()(r[0])&&$o()(r[1])||qa()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?fl(e,i,r[0],r[1]):fl(e,i,"#fff",void 0)}var zs;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(zs||(zs={}));function hE(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=yl(r),a=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return a}function pE(e,i){var r=this;e.length>0&&i.version===zs["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=zs["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=zs["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoords(n.coordinates)}))}function dE(e,i){e.length>0&&i.version===zs.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=vE(r.coordinates,i),r.simpleCoordinate=!0)})}function vE(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(a){var s=[];a.map(function(f){s.push(i.simpleMapCoord.unproject(f))}),r.push(s)}),r}else{var n=[];return e.map(function(a){n.push(i.simpleMapCoord.unproject(a))}),n}}function mE(e,i,r){var n;if(!e.scale)return[];var a=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],s=[];a.forEach(function(v){var g,x=v.field;(i.hasOwnProperty(x)||((g=e.scale)===null||g===void 0?void 0:g.type)==="variable")&&s.push(i[x])});var f=e.mapping?e.mapping(s):[];return e.name==="color"&&!bl(f[0])?[r]:f}function gE(e,i,r,n,a,s){var f=s==null?void 0:s.getLayerConfig(),v=f.arrow,g=v===void 0?{enable:!1}:v,x=i.map(function(C){var T={id:C._id,coordinates:C.coordinates};if(e.filter(function(j){return j.scale!==void 0}).forEach(function(j){var X=mE(j,C,a);j.needRemapping=!1,j.name==="color"&&(X=X.map(function(te){return Ea(te)})),T[j.name]=Array.isArray(X)&&X.length===1?X[0]:X,j.name==="shape"&&(T.shape=r.getIconFontKey(T[j.name]))}),T.shape==="line"&&g.enable){var O=T.coordinates,k=hE(O[0],O[1]);T.coordinates.splice(1,0,k,k)}return T});return pE(x,n),dE(x,n),x}function yE(e,i,r,n,a,s){var f=new qu(a,s),v=e.getBottomColor(),g=n.getLayerStyleAttributes()||[],x=f.data.dataArray,C=x,T=gE(g,C,i,r,v,e);return f.destroy(),T}function jg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function Vg(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),f=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),jg(i).forEach(function(g){var x=(0,nn.Z)(g,2),C=x[0],T=x[1];a.add(r(C),T)}),a.add(r("copy")),a}var _E=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function xE(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}_E.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var bE=["passes"],EE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Gg,F0,Hg;function SE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=CE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function CE(e,i){if(!!e){if(typeof e=="string")return Wg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wg(e,i)}}function Wg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Xg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $u(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Xg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function AE(e){var i=wE();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function wE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yg=0,Qh=(Gg=k0(Yt.IGlobalConfigService),F0=function(e){(0,Pr.Z)(r,e);var i=AE(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ht.Z)(this,r),n=i.call(this),(0,A.Z)((0,ue.Z)(n),"id","".concat(Yg++)),(0,A.Z)((0,ue.Z)(n),"name","".concat(Yg)),(0,A.Z)((0,ue.Z)(n),"type",void 0),(0,A.Z)((0,ue.Z)(n),"visible",!0),(0,A.Z)((0,ue.Z)(n),"zIndex",0),(0,A.Z)((0,ue.Z)(n),"minZoom",void 0),(0,A.Z)((0,ue.Z)(n),"maxZoom",void 0),(0,A.Z)((0,ue.Z)(n),"inited",!1),(0,A.Z)((0,ue.Z)(n),"layerModelNeedUpdate",!1),(0,A.Z)((0,ue.Z)(n),"pickedFeatureID",null),(0,A.Z)((0,ue.Z)(n),"selectedFeatureID",null),(0,A.Z)((0,ue.Z)(n),"styleNeedUpdate",!1),(0,A.Z)((0,ue.Z)(n),"rendering",void 0),(0,A.Z)((0,ue.Z)(n),"clusterZoom",0),(0,A.Z)((0,ue.Z)(n),"layerType",void 0),(0,A.Z)((0,ue.Z)(n),"isLayerGroup",!1),(0,A.Z)((0,ue.Z)(n),"triangulation",void 0),(0,A.Z)((0,ue.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,A.Z)((0,ue.Z)(n),"hooks",{init:new op,afterInit:new op,beforeRender:new op,beforeRenderData:new ap,afterRender:new Tu,beforePickingEncode:new Tu,afterPickingEncode:new Tu,beforeHighlight:new Tu(["pickedColor"]),afterHighlight:new Tu,beforeSelect:new Tu(["pickedColor"]),afterSelect:new Tu,beforeDestroy:new Tu,afterDestroy:new Tu}),(0,A.Z)((0,ue.Z)(n),"models",[]),(0,A.Z)((0,ue.Z)(n),"multiPassRenderer",void 0),(0,A.Z)((0,ue.Z)(n),"plugins",void 0),(0,A.Z)((0,ue.Z)(n),"sourceOption",void 0),(0,A.Z)((0,ue.Z)(n),"layerModel",void 0),(0,A.Z)((0,ue.Z)(n),"shapeOption",void 0),(0,A.Z)((0,ue.Z)(n),"sceneContainer",void 0),(0,A.Z)((0,ue.Z)(n),"layerChildren",[]),(0,A.Z)((0,ue.Z)(n),"masks",[]),mi((0,ue.Z)(n),"configService",Hg,(0,ue.Z)(n)),(0,A.Z)((0,ue.Z)(n),"shaderModuleService",void 0),(0,A.Z)((0,ue.Z)(n),"cameraService",void 0),(0,A.Z)((0,ue.Z)(n),"coordinateService",void 0),(0,A.Z)((0,ue.Z)(n),"iconService",void 0),(0,A.Z)((0,ue.Z)(n),"fontService",void 0),(0,A.Z)((0,ue.Z)(n),"pickingService",void 0),(0,A.Z)((0,ue.Z)(n),"rendererService",void 0),(0,A.Z)((0,ue.Z)(n),"layerService",void 0),(0,A.Z)((0,ue.Z)(n),"interactionService",void 0),(0,A.Z)((0,ue.Z)(n),"mapService",void 0),(0,A.Z)((0,ue.Z)(n),"styleAttributeService",void 0),(0,A.Z)((0,ue.Z)(n),"layerSource",void 0),(0,A.Z)((0,ue.Z)(n),"postProcessingPassFactory",void 0),(0,A.Z)((0,ue.Z)(n),"normalPassFactory",void 0),(0,A.Z)((0,ue.Z)(n),"animateOptions",{enable:!1}),(0,A.Z)((0,ue.Z)(n),"container",void 0),(0,A.Z)((0,ue.Z)(n),"encodedData",void 0),(0,A.Z)((0,ue.Z)(n),"configSchema",void 0),(0,A.Z)((0,ue.Z)(n),"currentPickId",null),(0,A.Z)((0,ue.Z)(n),"rawConfig",void 0),(0,A.Z)((0,ue.Z)(n),"needUpdateConfig",void 0),(0,A.Z)((0,ue.Z)(n),"pendingStyleAttributes",[]),(0,A.Z)((0,ue.Z)(n),"scaleOptions",{}),(0,A.Z)((0,ue.Z)(n),"animateStartTime",void 0),(0,A.Z)((0,ue.Z)(n),"aniamateStatus",!1),(0,A.Z)((0,ue.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,A.Z)((0,ue.Z)(n),"isDestroied",!1),(0,A.Z)((0,ue.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),f=s.autoFit,v=s.fitBoundsOptions;f&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,Pt.Z)(r,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=$u($u({},this.needUpdateConfig),a);else{var s=this.container.get(Yt.SceneID);cE(a,this),this.configService.setLayerConfig(s,this.id,$u($u($u({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(Yt.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Yt.IIconService),this.fontService=this.container.get(Yt.IFontService),this.rendererService=this.container.get(Yt.IRendererService),this.layerService=this.container.get(Yt.ILayerService),this.interactionService=this.container.get(Yt.IInteractionService),this.pickingService=this.container.get(Yt.IPickingService),this.mapService=this.container.get(Yt.IMapService);var f=this.getLayerConfig(),v=f.enableMultiPassRenderer,g=f.passes;v&&g!==null&&g!==void 0&&g.length&&g.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(Yt.ICameraService),this.coordinateService=this.container.get(Yt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Yt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Yt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Yt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Yt.IStyleAttributeService),this.multiPassRenderer=this.container.get(Yt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(O){var k=O.attributeName,j=O.attributeField,X=O.attributeValues,te=O.updateOptions;a.styleAttributeService.updateStyleAttribute(k,{scale:$u({field:j},a.splitValuesAndCallbackInAttribute(X,a.getLayerConfig()[k]))},te)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Yt.ILayerPlugin);var x=SE(this.plugins),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(O){x.e(O)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models.map(function(s){s.updateAttributesAndElements(a.attributes,a.elements)}):console.warn("data error")}},{key:"createModelData",value:function(a,s){if(this.layerModel.createModelData)return this.layerModel.createModelData(s);var f=this.calculateEncodeData(a,s),v=this.triangulation;return f&&v?this.styleAttributeService.createAttributesAndIndices(f,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(a,s){return this.inited?yE(this,this.fontService,this.mapService,this.styleAttributeService,a,s):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig($u($u({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,f){return this.updateStyleAttribute("color",a,s,f),this}},{key:"texture",value:function(a,s,f){return this.updateStyleAttribute("texture",a,s,f),this}},{key:"rotate",value:function(a,s,f){return this.updateStyleAttribute("rotate",a,s,f),this}},{key:"size",value:function(a,s,f){return this.updateStyleAttribute("size",a,s,f),this}},{key:"filter",value:function(a,s,f){return this.updateStyleAttribute("filter",a,s,f),this}},{key:"shape",value:function(a,s,f){var v,g,x,C=(v=this.styleAttributeService)===null||v===void 0||(g=v.getLayerStyleAttribute("shape"))===null||g===void 0||(x=g.scale)===null||x===void 0?void 0:x.field,T=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,f),xE(this,C,T),this}},{key:"label",value:function(a,s,f){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:f}),this}},{key:"animate",value:function(a){var s={};return Ku()(a)?(s.enable=!0,s=$u($u({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var f=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var v=f.getSource();v?f.layerSource.setData(a,s):(f.source(new qu(a,s)),f.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,f=this.getLayerConfig(),v=a.passes,g=(0,wc.Z)(a,bE);return v&&jg(v).forEach(function(x){var C=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);C&&C.updateOptions(x[1])}),this.rawConfig=$u($u({},this.rawConfig),g),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),f&&f.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return Ku()(a)?this.scaleOptions=$u($u({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,E.Z)(M().mark(function s(){return M().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=Ku()(a)?!0:a,Ku()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var f=this;if(Ku()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({highlightColor:Ku()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Ku()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:Ku()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Ku()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(pu(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=Ku()(a)?!0:a,Ku()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var f=this;if(Ku()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({selectColor:Ku()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Ku()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:Ku()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Ku()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(pu(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),f=s.visible,v=s.minZoom,g=v===void 0?-Infinity:v,x=s.maxZoom,C=x===void 0?Infinity:x;return!!f&&a>=g&&a<=C}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var f=this.getLayerConfig(),v=f.passes,g=v===void 0?[]:v;this.multiPassRenderer=Vg(this,g,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),C=x.width,T=x.height;this.multiPassRenderer.resize(C,T)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),f=s.extent,v=f.some(function(g){return Math.abs(g)===Infinity});return v?this:(this.mapService.fitBounds([[f[0],f[1]],[f[2],f[3]]],a),this)}},{key:"destroy",value:function(){var a;this.isDestroied||(this.layerChildren.map(function(s){return s.destroy()}),this.layerChildren=[],this.masks.map(function(s){return s.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var f=s.range().map(function(x){return(0,A.Z)({value:s.invertExtent(x)},a,x)});return f}else if(s.ticks){var v=s.ticks().map(function(x){return(0,A.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var g=s.domain().filter(function(x){return!sE()(x)}).map(function(x){return(0,A.Z)({value:x},a,s(x))});return g}return[]}},{key:"pick",value:function(a){var s=a.x,f=a.y;this.interactionService.triggerHover({x:s,y:f})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,f=a.vertexShader,v=a.fragmentShader,g=a.triangulation,x=a.segmentNumber,C=(0,wc.Z)(a,EE);this.shaderModuleService.registerModule(s,{vs:f,fs:v});var T=this.shaderModuleService.getModule(s),O=T.vs,k=T.fs,j=T.uniforms,X=this.rendererService.createModel,te=this.styleAttributeService.createAttributesAndIndices(this.encodedData,g,x),Ee=te.attributes,Ne=te.elements;return X($u({attributes:Ee,uniforms:j,fs:k,vs:O,elements:Ne,blend:Ug[Pc.normal]},C))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,f=this.styleAttributeService.createAttributes(this.encodedData,s),v=f.attributes;return v}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),f=s.enableHighlight,v=f===void 0?!0:f,g=s.enableSelect,x=g===void 0?!0:g,C=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(C=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(C=!0),this.isVisible()&&C}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,E.Z)(M().mark(function s(f){return M().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,f.render();case 2:case"end":return g.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(f){f.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,f,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:$u({field:s},this.splitValuesAndCallbackInAttribute(f,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:f,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:$o()(a)?void 0:a||s,callback:$o()(a)?a:void 0}}}]),r}(Mn.EventEmitter),Hg=bi(F0.prototype,"configService",[Gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F0),TE=z(18446),hd=z.n(TE),qg,B0,Kg;function ME(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=PE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function PE(e,i){if(!!e){if(typeof e=="string")return $g(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $g(e,i)}}function $g(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var go=(qg=k0(Yt.IGlobalConfigService),B0=function(){function e(i){(0,ht.Z)(this,e),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"createTexture2D",void 0),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"dataTexture",void 0),(0,A.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,A.Z)(this,"rowCount",void 0),(0,A.Z)(this,"cacheStyleProperties",void 0),(0,A.Z)(this,"cellLength",void 0),(0,A.Z)(this,"cellProperties",void 0),(0,A.Z)(this,"cellTypeLayout",void 0),(0,A.Z)(this,"stylePropertyesExist",void 0),(0,A.Z)(this,"dataTextureTest",void 0),mi(this,"configService",Kg,this),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"styleAttributeService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(Yt.IRendererService),this.shaderModuleService=i.getContainer().get(Yt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(Yt.IStyleAttributeService),this.mapService=i.getContainer().get(Yt.IMapService),this.iconService=i.getContainer().get(Yt.IIconService),this.fontService=i.getContainer().get(Yt.IFontService),this.cameraService=i.getContainer().get(Yt.ICameraService),this.layerService=i.getContainer().get(Yt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:G.NEAREST,min:G.NEAREST,width:1,height:1}))}return(0,Pt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return hd()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),hd()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),hd()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),hd()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),hd()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),hd()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!ma()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!ma()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!ma()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!ma()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return qa()(r)?!!(0,xl.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=Ea(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&ma()(r[0])&&ma()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=ME(a),f;try{for(s.s();!(f=s.n()).done;){var v=f.value,g=v.attr,x=v.count,C=n[g];C!==void 0?g==="stroke"?r.push.apply(r,(0,Ce.Z)(Ea(C))):g==="offsets"?this.isOffsetStatic(C)?r.push(-C[0],C[1]):r.push(0,0):r.push(ma()(C)?C:1):this.patchMod(r,x)}}catch(T){s.e(T)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,f=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=f*this.DATA_TEXTURE_WIDTH,g=[],x=0;x<s;x++){var C=n[x];this.patchData(g,C,a)}for(var T=g.length;T<v;T++)g.push(-1);return{data:g,width:this.DATA_TEXTURE_WIDTH,height:f}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return Ug[Pc[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),Kg=bi(B0.prototype,"configService",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B0),IE=z(9187),kf=z.n(IE),Qg=100,VP=36,GP=40;function Jg(e){return e/180*Math.acos(-1)}function ey(e){var i=Jg(e[0])+Math.PI/2,r=Jg(e[1]),n=Qg+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),f=n*Math.sin(r);return[s,f,a]}function HP(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var f=typeof i.segments!="undefined"?i.segments:32,v=2+f,g=2*v,x=[],C=[],T=[],O=[],k=[],j=[],X=0;X<=v;X++){for(var te=X/v,Ee=te*Math.PI,Ne=0;Ne<=g;Ne++){var $e=Ne/g,ot=$e*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Ee),mat4.identity(r),mat4.rotateY(r,r,ot),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),T.push(s.slice()),O.push.apply(O,_toConsumableArray(s.slice())),vec3.normalize(s,s),k.push.apply(k,_toConsumableArray(s.slice())),j.push([$e,1-te]),O.push($e,1-te)}if(X>0)for(var Et=T.length,_t=Et-2*(g+1);_t+g+2<Et;_t++)x.push([_t,_t+1,_t+g+1]),C.push(_t,_t+1,_t+g+1),x.push([_t+g+1,_t+1,_t+g+2]),C.push(_t+g+1,_t+1,_t+g+2)}return{cells:x,positions:T,uvs:j,positionsArr:O,indicesArr:C,normalArr:k}}var Ei=z(31437),Nv=Ei.Ue(),WP=Ei.Ue(),Ys=Ei.Ue(),Jh=Ei.Ue(),pd=Ei.Ue();function N0(e,i,r,n,a){Ei.IH(e,r,n),Ei.Fv(e,e),i=Ei.al(-e[1],e[0]);var s=Ei.al(-r[1],r[0]);return[a/Ei.AK(i,s),i]}function ep(e,i){return Ei.t8(e,-i[1],i[0])}function dd(e,i,r){return Ei.lu(e,i,r),Ei.Fv(e,e),e}function z0(e,i){return e[0]===i[0]&&e[1]===i[1]}function XP(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var ty=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ht.Z)(this,e),(0,A.Z)(this,"complex",void 0),(0,A.Z)(this,"join",void 0),(0,A.Z)(this,"cap",void 0),(0,A.Z)(this,"miterLimit",void 0),(0,A.Z)(this,"thickness",void 0),(0,A.Z)(this,"normal",void 0),(0,A.Z)(this,"lastFlip",-1),(0,A.Z)(this,"miter",Ei.al(0,0)),(0,A.Z)(this,"started",!1),(0,A.Z)(this,"dash",!1),(0,A.Z)(this,"totalDistance",0),(0,A.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Pt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,f=a.startIndex,v=1;v<s;v++){var g,x,C,T=r[v-1];T.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var O=n[v-1],k=r[v];k.push((x=n[v][2])!==null&&x!==void 0?x:0);var j=n[v],X=v<r.length-1?[].concat((0,Ce.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,te=v<n.length-1?n[v+1]:null,Ee=this.segment_gaode2(a,f,T,k,X,O,j,te);f+=Ee}if(this.dash)for(var Ne=0;Ne<a.positions.length/6;Ne++)a.positions[Ne*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,f=a.startIndex,v=1;v<s;v++){var g,x,C,T=r[v-1];T.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var O=n[v-1],k=r[v];k.push((x=n[v][2])!==null&&x!==void 0?x:0);var j=n[v],X=v<r.length-1?[].concat((0,Ce.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,te=v<n.length-1?n[v+1]:null,Ee=this.simpleSegment(a,f,T,k,X,O,j,te);f+=Ee}if(this.dash)for(var Ne=0;Ne<a.positions.length/6;Ne++)a.positions[Ne*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,f=1;f<a;f++){var v=r[f-1],g=r[f],x=f<r.length-1?r[f+1]:null,C=this.segment(n,s,v,g,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,f=1;f<a;f++){var v=r[f-1],g=r[f],x=f<r.length-1?r[f+1]:null,C=this.simpleSegment(n,s,v,g,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,f,v,g,x){var C=0,T=r.indices,O=r.positions,k=r.normals,j=this.cap==="square",X=this.join==="bevel",te=Ro([g[0],g[1]]),Ee=Ro([v[0],v[1]]);dd(Ys,s,a);var Ne=0;if(this.dash&&(Ne=this.lineSegmentDistance(te,Ee),this.totalDistance+=Ne),this.normal||(this.normal=Ei.Ue(),ep(this.normal,Ys)),!this.started)if(this.started=!0,j){var $e=Ei.Ue(),ot=Ei.Ue();Ei.IH($e,this.normal,Ys),Ei.IH(ot,this.normal,Ys),k.push(ot[0],ot[1],0),k.push($e[0],$e[1],0),O.push(a[0],a[1],a[2]|0,this.totalDistance-Ne,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),O.push(a[0],a[1],a[2]|0,this.totalDistance-Ne,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,k,a,this.normal,this.thickness,this.totalDistance-Ne);if(T.push(n+0,n+1,n+2),f){z0(s,f)&&Ei.IH(f,s,Ei.Fv(f,Ei.$X(f,s,a))),dd(Jh,f,s);var qt=N0(pd,Ei.Ue(),Ys,Jh,this.thickness),or=(0,nn.Z)(qt,2),Mr=or[0],Xr=or[1],yr=Ei.AK(pd,this.normal)<0?-1:1,sn=X;if(!sn&&this.join==="miter"){var Ln=Mr;Ln>this.miterLimit&&(sn=!0)}sn?(k.push(this.normal[0],this.normal[1],0),k.push(Xr[0],Xr[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*yr,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*yr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,T.push.apply(T,(0,Ce.Z)(this.lastFlip!==-yr?[n,n+2,n+3]:[n+2,n+1,n+3])),T.push(n+2,n+3,n+4),ep(Nv,Jh),Ei.JG(this.normal,Nv),k.push(this.normal[0],this.normal[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*yr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,C+=3):(this.extrusions(O,k,s,Xr,Mr,this.totalDistance),T.push.apply(T,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),yr=-1,Ei.JG(this.normal,Xr),C+=2),this.lastFlip=yr}else{if(ep(this.normal,Ys),j){var Et=Ei.Ue(),_t=Ei.Ue();Ei.lu(_t,Ys,this.normal),Ei.IH(Et,Ys,this.normal),k.push(_t[0],_t[1],0),k.push(Et[0],Et[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,k,s,this.normal,this.thickness,this.totalDistance);T.push.apply(T,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),C+=2}return C}},{key:"simpleSegment",value:function(r,n,a,s,f){var v=0,g=r.indices,x=r.positions,C=r.normals,T=Ro([s[0],s[1]]),O=Ro([a[0],a[1]]);dd(Ys,T,O);var k=0;if(this.dash&&(k=this.lineSegmentDistance(T,O),this.totalDistance+=k),this.normal||(this.normal=Ei.Ue(),ep(this.normal,Ys)),this.started||(this.started=!0,this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-k)),g.push(n+0,n+1,n+2),!f)ep(this.normal,Ys),this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance),g.push.apply(g,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2;else{var j=Ro([f[0],f[1]]);z0(T,j)&&Ei.IH(j,T,Ei.Fv(j,Ei.$X(j,T,O))),dd(Jh,j,T);var X=N0(pd,Ei.Ue(),Ys,Jh,this.thickness),te=(0,nn.Z)(X,2),Ee=te[0],Ne=te[1],$e=Ei.AK(pd,this.normal)<0?-1:1;this.extrusions(x,C,s,Ne,Ee,this.totalDistance),g.push.apply(g,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),$e=-1,Ei.JG(this.normal,Ne),v+=2,this.lastFlip=$e}return v}},{key:"segment",value:function(r,n,a,s,f){var v=0,g=r.indices,x=r.positions,C=r.normals,T=this.cap==="square",O=this.join==="bevel",k=Ro([s[0],s[1]]),j=Ro([a[0],a[1]]);dd(Ys,k,j);var X=0;if(this.dash&&(X=this.lineSegmentDistance(k,j),this.totalDistance+=X),this.normal||(this.normal=Ei.Ue(),ep(this.normal,Ys)),!this.started)if(this.started=!0,T){var te=Ei.Ue(),Ee=Ei.Ue();Ei.IH(te,this.normal,Ys),Ei.IH(Ee,this.normal,Ys),C.push(Ee[0],Ee[1],0),C.push(te[0],te[1],0),x.push(a[0],a[1],a[2]|0,this.totalDistance-X,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),x.push(a[0],a[1],a[2]|0,this.totalDistance-X,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-X);if(g.push(n+0,n+1,n+2),f){var ot=Ro([f[0],f[1]]);z0(k,ot)&&Ei.IH(ot,k,Ei.Fv(ot,Ei.$X(ot,k,j))),dd(Jh,ot,k);var Et=N0(pd,Ei.Ue(),Ys,Jh,this.thickness),_t=(0,nn.Z)(Et,2),qt=_t[0],or=_t[1],Mr=Ei.AK(pd,this.normal)<0?-1:1,Xr=O;if(!Xr&&this.join==="miter"){var yr=qt;yr>this.miterLimit&&(Xr=!0)}Xr?(C.push(this.normal[0],this.normal[1],0),C.push(or[0],or[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Mr,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Mr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,g.push.apply(g,(0,Ce.Z)(this.lastFlip!==-Mr?[n,n+2,n+3]:[n+2,n+1,n+3])),g.push(n+2,n+3,n+4),ep(Nv,Jh),Ei.JG(this.normal,Nv),C.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Mr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v+=3):(this.extrusions(x,C,s,or,qt,this.totalDistance),g.push.apply(g,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Mr=-1,Ei.JG(this.normal,or),v+=2),this.lastFlip=Mr}else{if(ep(this.normal,Ys),T){var Ne=Ei.Ue(),$e=Ei.Ue();Ei.lu($e,Ys,this.normal),Ei.IH(Ne,Ys,this.normal),C.push($e[0],$e[1],0),C.push(Ne[0],Ne[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance);g.push.apply(g,(0,Ce.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2}return v}},{key:"extrusions",value:function(r,n,a,s,f,v){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,v,-f,a[2]|0),this.complex.indexes.push(this.currentIndex),r.push(a[0],a[1],a[2]|0,v,f,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Lp(e){if(ma()(e[0]))return e;if(ma()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(ma()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(f){r+=f[0],n+=f[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function OE(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,f=0,v=0,g=0;g<e.length;g+=2){var x=e[g],C=e[g+1];x&&C&&(i=Math.max(x,i),r=Math.max(C,r),n=Math.min(x,n),a=Math.min(C,a),s+=x,f+=C,v++)}return{center:[s/v,f/v],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var Ja=z(77160);function RE(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=kf().flatten(e),s=a.vertices,f=a.dimensions,v=[],g=[],x=0;x<s.length/f;x++)f===2?v.push(s[x*2],s[x*2+1],1):v.push(s[x*3],s[x*3+1],1);var C=kf()(a.vertices,a.holes,a.dimensions);g.push.apply(g,(0,Ce.Z)(C));for(var T=function(j){var X=a.vertices.slice(j*f,(j+1)*f),te=a.vertices.slice((j+1)*f,(j+2)*f);te.length===0&&(te=a.vertices.slice(0,f));var Ee=v.length/3;v.push(X[0],X[1],1,te[0],te[1],1,X[0],X[1],0,te[0],te[1],0),g.push.apply(g,(0,Ce.Z)([0,2,1,2,3,1].map(function(Ne){return Ne+Ee})))},O=0;O<n;O++)T(O);return{positions:v,index:g}}function LE(e){var i=kf().flatten(e),r=kf()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function ry(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=kf().flatten(e),f=s.vertices,v=s.dimensions,g=[],x=[],C=[],T=0;T<f.length/v;T++)v===2?g.push(f[T*2],f[T*2+1],1,-1,-1):g.push(f[T*3],f[T*3+1],1,-1,-1),C.push(0,0,1);var O=kf()(s.vertices,s.holes,s.dimensions);x.push.apply(x,(0,Ce.Z)(O));for(var k=function(te){var Ee=s.vertices.slice(te*v,(te+1)*v),Ne=s.vertices.slice((te+1)*v,(te+2)*v);Ne.length===0&&(Ne=s.vertices.slice(0,v));var $e=g.length/5;g.push(Ee[0],Ee[1],1,0,0,Ne[0],Ne[1],1,.1,0,Ee[0],Ee[1],0,0,.8,Ne[0],Ne[1],0,.1,.8);var ot=kE([Ne[0],Ne[1],1],[Ee[0],Ee[1],0],[Ee[0],Ee[1],1],i);C.push.apply(C,(0,Ce.Z)(ot).concat((0,Ce.Z)(ot),(0,Ce.Z)(ot),(0,Ce.Z)(ot))),x.push.apply(x,(0,Ce.Z)([1,2,0,3,2,1].map(function(Et){return Et+$e})))},j=0;j<a;j++)k(j);return{positions:g,index:x,normals:C}}function kE(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=Ja.create(),s=Ja.create(),f=Ja.create();n&&(e=Gs(e),i=Gs(i),r=Gs(r));var v=Ja.fromValues.apply(Ja,(0,Ce.Z)(e)),g=Ja.fromValues.apply(Ja,(0,Ce.Z)(i)),x=Ja.fromValues.apply(Ja,(0,Ce.Z)(r));Ja.sub(a,x,g),Ja.sub(s,v,g),Ja.cross(f,a,s);var C=Ja.create();return Ja.normalize(C,f),C}var Ic,kp;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(kp||(kp={}));var Dp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Dp||(Dp={}));function ov(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(f){var v=Math.sin(f+Math.PI/4),g=Math.cos(f+Math.PI/4);return[v,g,0]});return s}function ny(){return ov(30)}function iy(){return ov(4)}function ay(){return ov(3)}function oy(){return ov(6,1)}function sy(){return ov(5)}var vd=(Ic={},(0,A.Z)(Ic,Dp.CIRCLE,ny),(0,A.Z)(Ic,Dp.HEXAGON,oy),(0,A.Z)(Ic,Dp.TRIANGLE,ay),(0,A.Z)(Ic,Dp.SQUARE,iy),(0,A.Z)(Ic,Dp.PENTAGON,sy),(0,A.Z)(Ic,kp.CYLINDER,ny),(0,A.Z)(Ic,kp.HEXAGONCOLUMN,oy),(0,A.Z)(Ic,kp.TRIANGLECOLUMN,ay),(0,A.Z)(Ic,kp.SQUARECOLUMN,iy),(0,A.Z)(Ic,kp.PENTAGONCOLUMN,sy),Ic),zv={};function Fp(e){var i=Lp(e.coordinates);return{vertices:[].concat((0,Ce.Z)(i),(0,Ce.Z)(i),(0,Ce.Z)(i),(0,Ce.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function uy(e){var i=Lp(e.coordinates),r=ey(i);return{vertices:[].concat((0,Ce.Z)(r),(0,Ce.Z)(r),(0,Ce.Z)(r),(0,Ce.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function ly(e){var i=e.shape,r=NE(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function cy(e){var i=Lp(e.coordinates);return{vertices:(0,Ce.Z)(i),indices:[0],size:i.length}}function sv(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ty({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=f[v];a.extrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(O){a.extrude(O)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,indexes:T.indexes,size:6}}function DE(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ty({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=f[v];a.simpleExtrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(O){a.simpleExtrude(O)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,size:6}}function Uv(e){var i=e.coordinates,r=kf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:kf()(n,s,a),vertices:n,size:a}}function FE(e){var i=e.coordinates,r=kf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:kf()(n,s,a),vertices:BE(n),size:a+4}}function BE(e){for(var i=[],r=OE(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var f=e[s],v=e[s+1];i.push.apply(i,[f,v,0].concat((0,Ce.Z)(n),[a]))}return i}function fy(e){var i=e.coordinates,r=ry(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function hy(e){var i=e.shape,r=UE(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function py(e){var i=e.coordinates,r=[].concat((0,Ce.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,Ce.Z)(i[1]),[0,1,0],(0,Ce.Z)(i[0]),[0,0,1],(0,Ce.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function Zv(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],f=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,(0,Ce.Z)([0,1,2,1,3,2].map(function(C){return x*2+C})))},v=0;v<r;v++)f(v);return{vertices:a,indices:s,size:7}}function dy(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=jv(-1,1),a=jv(1,1),s=jv(-1,-1),f=jv(1,-1),v=[].concat((0,Ce.Z)(i),(0,Ce.Z)(n),(0,Ce.Z)(i),(0,Ce.Z)(s),(0,Ce.Z)(i),(0,Ce.Z)(f),(0,Ce.Z)(i),(0,Ce.Z)(a)),g=[0,1,2,3,0,2];return{vertices:v,indices:g,size:5}}function NE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(zv&&zv[e])return zv[e];var r=vd[e]?vd[e]():vd.cylinder(),n=ry([r],i);return zv[e]=n,n}function YP(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,f,v,g=vec3.create(),x=vec3.create(),C=vec3.create(),T=0,O=i.length;T<O;T+=3){s=i[T+0]*3,f=i[T+1]*3,v=i[T+2]*3;var k=[e[s],e[s+1]],j=[e[f],e[f+1]],X=[e[v],e[v+1]];n&&(k=lngLatToMeters(k),j=lngLatToMeters(j),X=lngLatToMeters(X));var te=k,Ee=_slicedToArray(te,2),Ne=Ee[0],$e=Ee[1],ot=vec3.fromValues(Ne,$e,e[s+2]),Et=j,_t=_slicedToArray(Et,2),qt=_t[0],or=_t[1],Mr=vec3.fromValues(qt,or,e[f+2]),Xr=X,yr=_slicedToArray(Xr,2),sn=yr[0],Ln=yr[1],jn=vec3.fromValues(sn,Ln,e[v+2]);vec3.sub(g,jn,Mr),vec3.sub(x,ot,Mr),vec3.cross(C,g,x),a[s]+=g[0],a[s+1]+=g[1],a[s+2]+=g[2],a[f]+=g[0],a[f+1]+=g[1],a[f+2]+=g[2],a[v]+=g[0],a[v+1]+=g[1],a[v+2]+=g[2]}return zE(a),a}function zE(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function qP(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function UE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=vd[e]?vd[e]():vd.circle(),n=i.indexOf(e)===-1?LE([r]):RE([r]);return n}function jv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function KP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function $P(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function ZE(e){var i=jE();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function jE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,GE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,HE=function(e){(0,Pr.Z)(r,e);var i=ZE(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"cityCenter",void 0),(0,A.Z)((0,ue.Z)(n),"cityMinSize",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.baseColor,g=v===void 0?"rgb(16,16,16)":v,x=a.brightColor,C=x===void 0?"rgb(255,176,38)":x,T=a.windowColor,O=T===void 0?"rgb(30,60,89)":T,k=a.time,j=k===void 0?0:k,X=a.sweep,te=X===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:X;return{u_cityCenter:te.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*te.sweepRadius,u_circleSweep:te.enable?1:0,u_circleSweepColor:Ea(te.sweepColor).slice(0,3),u_circleSweepSpeed:te.sweepSpeed,u_opacity:f,u_baseColor:Ea(g),u_brightColor:Ea(C),u_windowColor:Ea(O),u_time:this.layer.getLayerAnimateTime()||j}}},{key:"calCityGeo",value:function(){var a=(0,nn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],g=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(v+s)/2,(g+f)/2]);var x=this.mapService.lngLatToCoord([v,g]),C=this.mapService.lngLatToCoord([s,f]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-C[0],2)+Math.pow(x[1]-C[1],2))/4}else{var T=v-s,O=g-f;this.cityCenter=[(v+s)/2,(g+f)/2],this.cityMinSize=Math.sqrt(Math.pow(T,2)+Math.pow(O,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:GE,fragmentShader:VE,triangulation:fy,cull:{enable:!0,face:G.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,f,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?10:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){var x=s.size;return[v[3],v[4]]}}})}}]),r}(go);function WE(e){var i=XE();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function XE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YE=function(e){(0,Pr.Z)(r,e);var i=WE(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","PolygonLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new HE(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Qh);function qE(e){var i=KE();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function KE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $E=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,QE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,JE=function(e){(0,Pr.Z)(r,e);var i=qE(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:$E,fragmentShader:QE,triangulation:hy,depth:{enable:!1},primitive:G.TRIANGLES,blend:this.getBlend(),stencil:Na(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(go);function eS(e){var i=tS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function tS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,nS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,iS=function(e){(0,Pr.Z)(r,e);var i=eS(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||1,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:rS,fragmentShader:nS,triangulation:ly,depth:{enable:!0},blend:this.getBlend(),stencil:Na(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,f,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(go);function aS(e,i){for(var r=[],n=[],a=[],s=e+1,f=i+1,v=e/2,g=i/2,x=0;x<f;x++)for(var C=x-g,T=0;T<s;T++){var O=T-v;n.push(O/v,-C/g,0),a.push(T/e),a.push(1-x/i)}for(var k=0;k<i;k++)for(var j=0;j<e;j++){var X=j+s*k,te=j+s*(k+1),Ee=j+1+s*(k+1),Ne=j+1+s*k;r.push(X,te,Ne),r.push(te,Ee,Ne)}return{vertices:n,indices:r,uvs:a}}var vy,gy;function yy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _y(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?yy(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oS(e){var i=sS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function sS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uS=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,lS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,cS=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

float getBlurIndusty() {
    float h = 2.0/512.0;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,fS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,hS=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,pS=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,xy=(vy=(0,zr.b2)(),vy(gy=function(e){(0,Pr.Z)(r,e);var i=oS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"colorTexture",void 0),(0,A.Z)((0,ue.Z)(n),"heatmapFramerBuffer",void 0),(0,A.Z)((0,ue.Z)(n),"intensityModel",void 0),(0,A.Z)((0,ue.Z)(n),"colorModel",void 0),(0,A.Z)((0,ue.Z)(n),"shapeType",void 0),n}return(0,Pt.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,f=s.clear,v=s.useFramebuffer;v(this.heatmapFramerBuffer,function(){f({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,f=s.createFramebuffer,v=s.clear,g=s.getViewportSize,x=s.createTexture2D,C=s.useFramebuffer,T=this.styleAttributeService.getLayerStyleAttribute("shape"),O=(T==null||(a=T.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=O,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=O==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var k=g(),j=k.width,X=k.height;return this.heatmapFramerBuffer=f({color:x({width:Math.floor(j/4),height:Math.floor(X/4),wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,min:G.LINEAR,mag:G.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:On.Attribute,descriptor:{name:"a_Dir",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){return[v[3],v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return[C]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.triangulation=dy,this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:pS,fragmentShader:hS,triangulation:dy,depth:{enable:!1},cull:{enable:!0,face:Hu(this.mapService.version)},blend:{enable:!0,func:{srcRGB:G.ONE,srcAlpha:1,dstRGB:G.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.shaderModuleService.registerModule("heatmapColor",{vs:fS,fs:cS});var x=this.shaderModuleService.getModule("heatmapColor"),C=x.vs,T=x.fs,O=x.uniforms,k=this.rendererService,j=k.createAttribute,X=k.createElements,te=k.createBuffer,Ee=k.createModel;return Ee({vs:C,fs:T,attributes:{a_Position:j({buffer:te({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:G.FLOAT}),size:3}),a_Uv:j({buffer:te({data:[0,1,1,1,0,0,1,0],type:G.FLOAT}),size:2})},uniforms:_y({},O),depth:{enable:!1},blend:this.getBlend(),count:6,elements:X({data:[0,2,1,2,3,1],type:G.UNSIGNED_INT,count:6}),stencil:Na(f,g)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.intensity,v=f===void 0?10:f,g=a.radius,x=g===void 0?5:g;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:v}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=ar();Vr(f,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Ce.Z)(f)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.rendererService.getViewportSize,C=x(),T=C.width,O=C.height,k=aS(T/4,O/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:lS,fs:uS});var j=this.shaderModuleService.getModule("heatmap3dColor"),X=j.vs,te=j.fs,Ee=j.uniforms,Ne=this.rendererService,$e=Ne.createAttribute,ot=Ne.createElements,Et=Ne.createBuffer,_t=Ne.createModel;return _t({vs:X,fs:te,attributes:{a_Position:$e({buffer:Et({data:k.vertices,type:G.FLOAT}),size:3}),a_Uv:$e({buffer:Et({data:k.uvs,type:G.FLOAT}),size:2})},primitive:G.TRIANGLES,uniforms:_y({},Ee),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:G.SRC_ALPHA,srcAlpha:1,dstRGB:G.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:ot({data:k.indices,type:G.UNSIGNED_INT,count:k.indices.length}),stencil:Na(f,g)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),f=s.rampColors,v=jl(f);this.colorTexture=a({data:new Uint8Array(v.data),width:v.width,height:v.height,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,min:G.NEAREST,mag:G.NEAREST,flipY:!1})}}]),r}(go))||gy);function dS(e){var i=vS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function vS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,gS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,yS=function(e){(0,Pr.Z)(r,e);var i=dS(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:gS,fragmentShader:mS,triangulation:hy,depth:{enable:!1},primitive:G.TRIANGLES,blend:this.getBlend(),stencil:Na(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(go),_S={heatmap:xy,heatmap3d:xy,grid:JE,grid3d:iS,hexagon:yS},xS=_S;function bS(e){var i=ES();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function ES(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SS=function(e){(0,Pr.Z)(r,e);var i=bS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","HeatMapLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new xS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(f){return f.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models[0].updateAttributesAndElements(a.attributes,a.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=this.getLayerConfig(),v=f.shape3d,g=this.getSource(),x=g.data.type,C=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return C==="heatmap"||C==="heatmap3d"?"heatmap":x==="hexagon"?(v==null?void 0:v.indexOf(C))===-1?"hexagon":"grid3d":x==="grid"?(v==null?void 0:v.indexOf(C))===-1?"grid":"grid3d":"heatmap"}}]),r}(Qh);function CS(e){var i=AS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function AS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,TS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,MS=function(e){(0,Pr.Z)(r,e);var i=CS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.mask,v=f===void 0?!1:f,g=s.maskInside,x=g===void 0?!0:g,C=this.layer.getSource(),T=this.rendererService.createTexture2D;if(this.texture=T({height:0,width:0}),Ji){var O=this.layerService.sceneService.getSceneConfig().canvas,k=O.createImage();k.crossOrigin="anonymous",k.src=C.data.originData,k.onload=function(){a.texture=T({data:k,width:k.width,height:k.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else C.data.images.then(function(j){a.texture=T({data:j[0],width:j[0].width,height:j[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:TS,fragmentShader:wS,triangulation:py,primitive:G.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Na(v,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){return[v[3],v[4]]}}})}}]),r}(go),PS={image:MS},IS=PS;function OS(e){var i=RS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function RS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var by=function(e){(0,Pr.Z)(r,e);var i=OS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","ImageLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new IS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(Qh);function LS(e){var i=kS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function kS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DS=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,FS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,BS=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,NS=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,zS=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,US=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,ZS={solid:0,dash:1},jS=function(e){(0,Pr.Z)(r,e);var i=LS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.lineType,O=T===void 0?"solid":T,k=a.dashArray,j=k===void 0?[10,5]:k,X=a.forward,te=X===void 0?!0:X,Ee=a.lineTexture,Ne=Ee===void 0?!1:Ee,$e=a.iconStep,ot=$e===void 0?100:$e,Et=a.segmentNumber,_t=Et===void 0?30:Et,qt=a.thetaOffset,or=qt===void 0?.314:qt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,thetaOffset:or})){this.judgeStyleAttributes({opacity:f,thetaOffset:or});var Mr=this.layer.getEncodedData(),Xr=this.calDataFrame(this.cellLength,Mr,this.cellProperties),yr=Xr.data,sn=Xr.width,Ln=Xr.height;this.rowCount=Ln,this.dataTexture=this.cellLength>0&&yr.length>0?this.createTexture2D({flipY:!0,data:yr,format:G.LUMINANCE,type:G.FLOAT,width:sn,height:Ln}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}j.length===2&&j.push(0,0);var jn=0,ja=[0,0,0,0],Po=[0,0,0,0];return v&&g&&(ja=Ea(v),Po=Ea(g),jn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:ma()(or)?or:0,u_opacity:ma()(f)?f:1,u_textureBlend:C==="normal"?0:1,segmentNumber:_t,u_line_type:ZS[O||"solid"],u_dash_array:j,u_blur:.9,u_lineDir:te?1:-1,u_texture:this.texture,u_line_texture:Ne?1:0,u_icon_step:ot,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:jn,u_sourceColor:ja,u_targetColor:Po}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return v==="dash"?{frag:DS,vert:FS,type:"dash"}:s&&f?{frag:zS,vert:US,type:"linear"}:{frag:BS,vert:NS,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,T=this.getShaders(),O=T.frag,k=T.vert,j=T.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+j,vertexShader:k,fragmentShader:O,triangulation:Zv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:f,stencil:Na(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(f,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},k=O.x,j=O.y;return[k,j]}}})}}]),r}(go);function VS(e){var i=GS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function GS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,WS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,XS=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,YS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,qS={solid:0,dash:1},KS=function(e){(0,Pr.Z)(r,e);var i=VS(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.lineType,O=T===void 0?"solid":T,k=a.dashArray,j=k===void 0?[10,5]:k,X=a.lineTexture,te=X===void 0?!1:X,Ee=a.iconStep,Ne=Ee===void 0?100:Ee,$e=a.segmentNumber,ot=$e===void 0?30:$e,Et=a.globalArcHeight,_t=Et===void 0?10:Et;j.length===2&&j.push(0,0);var qt=0,or=[0,0,0,0],Mr=[0,0,0,0];if(v&&g&&(or=Ea(v),Mr=Ea(g),qt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var Xr=this.layer.getEncodedData(),yr=this.calDataFrame(this.cellLength,Xr,this.cellProperties),sn=yr.data,Ln=yr.width,jn=yr.height;this.rowCount=jn,this.dataTexture=this.cellLength>0&&sn.length>0?this.createTexture2D({flipY:!0,data:sn,format:G.LUMINANCE,type:G.FLOAT,width:Ln,height:jn}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Qg,u_global_height:_t,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ma()(f)?f:1,u_textureBlend:C==="normal"?0:1,segmentNumber:ot,u_line_type:qS[O]||0,u_dash_array:j,u_texture:this.texture,u_line_texture:te?1:0,u_icon_step:Ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:qt,u_sourceColor:or,u_targetColor:Mr}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor;return s&&f?{frag:XS,vert:YS,type:"linear"}:{frag:HS,vert:WS,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,T=this.getShaders(),O=T.frag,k=T.vert,j=T.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+j,vertexShader:k,fragmentShader:O,triangulation:Zv,blend:this.getBlend(),segmentNumber:f,stencil:Na(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(f,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},k=O.x,j=O.y;return[k,j]}}})}}]),r}(go);function $S(e){var i=QS();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function QS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JS=`#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,eC=`#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,tC=function(e){(0,Pr.Z)(r,e);var i=$S(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.forward,C=x===void 0?!0:x,T=a.segmentNumber,O=T===void 0?30:T,k=a.thetaOffset,j=k===void 0?.314:k,X=0,te=[0,0,0,0],Ee=[0,0,0,0];return v&&g&&(te=Ea(v),Ee=Ea(g),X=1),{u_thetaOffset:j,u_opacity:ma()(f)?f:1,segmentNumber:O,u_blur:.9,u_lineDir:C?1:-1,u_linearColor:X,u_sourceColor:te,u_targetColor:Ee}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:eC,fragmentShader:JS,triangulation:Zv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:f})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(s,f,v,g){return[v[3],v[4],v[5],v[6]]}}})}}]),r}(go);function rC(e){var i=nC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function nC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,aC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,oC={solid:0,dash:1},sC=function(e){(0,Pr.Z)(r,e);var i=rC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.lineType,O=T===void 0?"solid":T,k=a.dashArray,j=k===void 0?[10,5]:k,X=a.lineTexture,te=X===void 0?!1:X,Ee=a.iconStep,Ne=Ee===void 0?100:Ee,$e=a.segmentNumber,ot=$e===void 0?30:$e;j.length===2&&j.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Et=0,_t=[0,0,0,0],qt=[0,0,0,0];if(v&&g&&(_t=Ea(v),qt=Ea(g),Et=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var or=this.layer.getEncodedData(),Mr=this.calDataFrame(this.cellLength,or,this.cellProperties),Xr=Mr.data,yr=Mr.width,sn=Mr.height;this.rowCount=sn,this.dataTexture=this.cellLength>0&&Xr.length>0?this.createTexture2D({flipY:!0,data:Xr,format:G.LUMINANCE,type:G.FLOAT,width:yr,height:sn}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ma()(f)?f:1,u_textureBlend:C==="normal"?0:1,segmentNumber:ot,u_line_type:oC[O]||0,u_dash_array:j,u_texture:this.texture,u_line_texture:te?1:0,u_icon_step:Ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Et,u_sourceColor:_t,u_targetColor:qt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:aC,fragmentShader:iC,triangulation:Zv,depth:{enable:!1},blend:this.getBlend(),stencil:Na(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(f,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},k=O.x,j=O.y;return[k,j]}}})}}]),r}(go);function uC(e){var i=lC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function lC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cC=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,fC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,hC=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Ey=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,pC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,dC={solid:0,dash:1},Sy=function(e){(0,Pr.Z)(r,e);var i=uC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.lineType,O=T===void 0?"solid":T,k=a.dashArray,j=k===void 0?[10,5,0,0]:k,X=a.lineTexture,te=X===void 0?!1:X,Ee=a.iconStep,Ne=Ee===void 0?100:Ee,$e=a.vertexHeightScale,ot=$e===void 0?20:$e,Et=a.borderWidth,_t=Et===void 0?0:Et,qt=a.borderColor,or=qt===void 0?"#ccc":qt,Mr=a.raisingHeight,Xr=Mr===void 0?0:Mr,yr=a.heightfixed,sn=yr===void 0?!1:yr,Ln=a.arrow,jn=Ln===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Ln;j.length===2&&j.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var ja=0,Po=[0,0,0,0],Os=[0,0,0,0];if(v&&g&&(Po=Ea(v),Os=Ea(g),ja=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var iu=this.layer.getEncodedData(),Us=this.calDataFrame(this.cellLength,iu,this.cellProperties),kc=Us.data,gm=Us.width,g0=Us.height;this.rowCount=g0,this.dataTexture=this.cellLength>0&&kc.length>0?this.createTexture2D({flipY:!0,data:kc,format:G.LUMINANCE,type:G.FLOAT,width:gm,height:g0}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ma()(f)?f:1,u_textureBlend:C==="normal"?0:1,u_line_type:dC[O],u_dash_array:j,u_texture:this.texture,u_line_texture:te?1:0,u_icon_step:Ne,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:_t,u_borderColor:Ea(or),u_linearColor:ja,u_sourceColor:Po,u_targetColor:Os,u_heightfixed:Number(sn),u_vertexScale:ot,u_raisingHeight:Number(Xr),u_arrow:Number(jn.enable),u_arrowHeight:jn.arrowHeight||3,u_arrowWidth:jn.arrowWidth||2,u_tailWidth:jn.tailWidth===void 0?1:jn.tailWidth}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,T=this.getShaders(),O=T.frag,k=T.vert,j=T.type;return this.layer.triangulation=sv,[this.layer.buildLayerModel({moduleName:"line_"+j,vertexShader:k,fragmentShader:O,triangulation:sv,primitive:G.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Na(f,g)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return v==="dash"?{frag:cC,vert:fC,type:"dash"}:s&&f?{frag:pC,vert:Ey,type:"linear"}:{frag:hC,vert:Ey,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:On.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x,C,T){return T===void 0?[g[3],10]:[g[3],T]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},k=O.x,j=O.y;return[k,j]}}})}}]),r}(go);function vC(e){var i=mC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function mC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gC=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = texture2D(u_texture, vec2(d_distance_ratio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,yC=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,_C=function(e){(0,Pr.Z)(r,e);var i=vC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"colorTexture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var g=n.layer.getLayerConfig(),x=g.rampColors,C=jl(x);n.colorTexture=v({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,min:G.NEAREST,mag:G.NEAREST,flipY:!1})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.vertexHeightScale,g=v===void 0?20:v,x=a.raisingHeight,C=x===void 0?0:x,T=a.heightfixed,O=T===void 0?!1:T;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var k=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,k,this.cellProperties),X=j.data,te=j.width,Ee=j.height;this.rowCount=Ee,this.dataTexture=this.cellLength>0&&X.length>0?this.createTexture2D({flipY:!0,data:X,format:G.LUMINANCE,type:G.FLOAT,width:te,height:Ee}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ma()(f)?f:1,u_texture:this.colorTexture,u_heightfixed:Number(O),u_vertexScale:g,u_raisingHeight:Number(C)}}},{key:"initModels",value:function(){return this.updateTexture(),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.colorTexture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,T=this.getShaders(),O=T.frag,k=T.vert,j=T.type;return this.layer.triangulation=sv,[this.layer.buildLayerModel({moduleName:"line_"+j,vertexShader:k,fragmentShader:O,triangulation:sv,primitive:G.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Na(f,g)})]}},{key:"getShaders",value:function(){return{frag:gC,vert:yC,type:"linear_rampColors"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:On.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g,x,C){return C===void 0?[v[3],10]:[v[3],C]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,f,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){return[v[4]]}}})}}]),r}(go);function xC(e){var i=bC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function bC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EC=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,SC=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,Cy=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,CC=function(e){(0,Pr.Z)(r,e);var i=xC(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.vertexHeightScale,C=x===void 0?20:x,T=0,O=[0,0,0,0],k=[0,0,0,0];if(v&&g&&(O=Ea(v),k=Ea(g),T=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var j=this.layer.getEncodedData(),X=this.calDataFrame(this.cellLength,j,this.cellProperties),te=X.data,Ee=X.width,Ne=X.height;this.rowCount=Ne,this.dataTexture=this.cellLength>0&&te.length>0?this.createTexture2D({flipY:!0,data:te,format:G.LUMINANCE,type:G.FLOAT,width:Ee,height:Ne}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ma()(f)?f:1,u_linearColor:T,u_sourceColor:O,u_targetColor:k,u_vertexScale:C}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor;return s&&f?{frag:EC,vert:Cy,type:"simple_linear"}:{frag:SC,vert:Cy,type:"simple_normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:DE,primitive:G.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:Na(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:On.Attribute,descriptor:{name:"a_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(s,f,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){return[v[4]]}}})}}]),r}(go);function AC(e){var i=wC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function wC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TC=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,MC=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,PC=function(e){(0,Pr.Z)(r,e);var i=AC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:G.NEAREST,min:G.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,g=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.heightfixed,O=T===void 0?!1:T,k=a.lineTexture,j=k===void 0?!1:k,X=a.iconStep,te=X===void 0?100:X,Ee=a.iconStepCount,Ne=Ee===void 0?1:Ee;this.rendererService.getDirty()&&this.texture.bind();var $e=0,ot=[0,0,0,0],Et=[0,0,0,0];if(v&&g&&(ot=Ea(v),Et=Ea(g),$e=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var _t=this.layer.getEncodedData(),qt=this.calDataFrame(this.cellLength,_t,this.cellProperties),or=qt.data,Mr=qt.width,Xr=qt.height;this.rowCount=Xr,this.dataTexture=this.cellLength>0&&or.length>0?this.createTexture2D({flipY:!0,data:or,format:G.LUMINANCE,type:G.FLOAT,width:Mr,height:Xr}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_heightfixed:Number(O),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ma()(f)?f:1,u_textureBlend:C==="normal"?0:1,u_texture:this.texture,u_line_texture:j?1:0,u_iconStepCount:Ne,u_icon_step:te,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:$e,u_sourceColor:ot,u_targetColor:Et}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:MC,fragmentShader:TC,triangulation:sv,primitive:G.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:On.Attribute,descriptor:{name:"a_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){return[g[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},k=O.x,j=O.y;return[k,j]}}})}}]),r}(go),IC={arc:jS,arcmini:tC,arc3d:KS,greatcircle:sC,wall:PC,line:Sy,simple:CC,linearline:_C},OC=IC;function RC(e){var i=LC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function LC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ay=function(e){(0,Pr.Z)(r,e);var i=RC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","LineLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new OC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return f||"line"}}]),r}(Qh);function kC(e){var i=DC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function DC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FC=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,BC=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,wy=function(e){(0,Pr.Z)(r,e);var i=kC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"raiseCount",0),(0,A.Z)((0,ue.Z)(n),"raiserepeat",0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,v=a.opacity,g=v===void 0?1:v,x=a.sourceColor,C=a.targetColor,T=a.pickLight,O=T===void 0?!1:T,k=a.heightfixed,j=k===void 0?!1:k,X=a.opacityLinear,te=X===void 0?{enable:!1,dir:"up"}:X,Ee=a.lightEnable,Ne=Ee===void 0?!0:Ee;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var $e=this.layer.getEncodedData(),ot=this.calDataFrame(this.cellLength,$e,this.cellProperties),Et=ot.data,_t=ot.width,qt=ot.height;this.rowCount=qt,this.dataTexture=this.cellLength>0&&Et.length>0?this.createTexture2D({flipY:!0,data:Et,format:G.LUMINANCE,type:G.FLOAT,width:_t,height:qt}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}var or=0,Mr=[0,0,0,0],Xr=[0,0,0,0];if(x&&C&&(Mr=Ea(x),Xr=Ea(C),or=1),this.raiseCount<1&&this.raiserepeat>0&&f.enable){var yr=f.speed,sn=yr===void 0?.01:yr,Ln=f.repeat,jn=Ln===void 0?!1:Ln;this.raiseCount+=sn,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(O),u_heightfixed:Number(j),u_r:f.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ma()(g)?g:1,u_linearColor:or,u_sourceColor:Mr,u_targetColor:Xr,u_opacitylinear:Number(te.enable),u_opacitylinear_dir:te.dir==="up"?1:0,u_lightEnable:Number(Ne)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,f=s===void 0?!0:s,v=a.animateOption.repeat,g=v===void 0?1:v;return this.raiserepeat=g,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:BC,fragmentShader:FC,triangulation:ly,blend:this.getBlend(),cull:{enable:!0,face:Hu(this.mapService.version)},depth:{enable:f}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,v,g,x){var C=f.size;if(C){var T=[];return Array.isArray(C)&&(T=C.length===2?[C[0],C[0],C[1]]:C),Array.isArray(C)||(T=[C,C,C]),T}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,v){var g=Lp(f.coordinates);return a?ey([g[0],g[1]]):[g[0],g[1],0]}}})}}]),r}(go);function NC(e){var i=zC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function zC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ty=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,UC=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,U0=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,My=function(e){(0,Pr.Z)(r,e);var i=NC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"meter2coord",1),(0,A.Z)((0,ue.Z)(n),"isMeter",!1),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,O=T===void 0?"rgba(0,0,0,0)":T,k=a.offsets,j=k===void 0?[0,0]:k,X=a.blend,te=a.blur,Ee=te===void 0?0:te,Ne=a.raisingHeight,$e=Ne===void 0?0:Ne;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:j})){this.judgeStyleAttributes({opacity:f,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:j});var ot=this.layer.getEncodedData(),Et=this.calDataFrame(this.cellLength,ot,this.cellProperties),_t=Et.data,qt=Et.width,or=Et.height;this.rowCount=or,this.dataTexture=this.cellLength>0&&_t.length>0?this.createTexture2D({flipY:!0,data:_t,format:G.LUMINANCE,type:G.FLOAT,width:qt,height:or}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_raisingHeight:Number($e),u_isMeter:Number(this.isMeter),u_blur:Ee,u_additive:X==="additive"?1:0,u_globel:this.mapService.version===zs.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ma()(f)?f:1,u_stroke_opacity:ma()(g)?g:1,u_stroke_width:ma()(C)?C:1,u_stroke_color:this.getStrokeColor(O),u_offsets:this.isOffsetStatic(j)?j:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(f),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Fp)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==zs.L7MAP&&v!==zs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,nn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],g=a[3],x=[(s+v)/2,(f+g)/2],C=this.mapService.version;if(C===zs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,k=O*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-k,T.y,T.z),X=j.toLngLat();this.meter2coord=x[0]-X.lng;return}var te=this.mapService.meterToCoord(x,[s,f]),Ee=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===f?f+.1:g]);this.meter2coord=(te+Ee)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.animateOption,C=x===void 0?{enable:!1}:x,T=this.getShaders(C),O=T.frag,k=T.vert,j=T.type,X=this.mapService.version==="GLOBEL";return this.layer.triangulation=X?uy:Fp,[this.layer.buildLayerModel({moduleName:"pointfill_"+j,vertexShader:k,fragmentShader:O,triangulation:X?uy:Fp,depth:{enable:X},blend:this.getBlend(),stencil:Na(f,g),cull:{enable:!0,face:Hu(this.mapService.version)}})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:Ty,vert:U0,type:"wave"};default:return{frag:Ty,vert:U0,type:"wave"}}else return{frag:UC,vert:U0,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(v,g,x,C){var T;if(s){var O=(0,nn.Z)(x,3),k=O[0],j=O[1],X=O[2],te=Ja.fromValues(0,0,1),Ee=Ja.fromValues(k,0,X),Ne=k>=0?Ja.angle(te,Ee):Math.PI*2-Ja.angle(te,Ee),$e=Math.PI*2-Math.asin(j/100),ot=ar();$n(ot,ot,Ne),Qr(ot,ot,$e);var Et=Ja.fromValues(1,1,0);Ja.transformMat4(Et,Et,ot),Ja.normalize(Et,Et);var _t=Ja.fromValues(-1,1,0);Ja.transformMat4(_t,_t,ot),Ja.normalize(_t,_t);var qt=Ja.fromValues(-1,-1,0);Ja.transformMat4(qt,qt,ot),Ja.normalize(qt,qt);var or=Ja.fromValues(1,-1,0);Ja.transformMat4(or,or,ot),Ja.normalize(or,or),T=[].concat((0,Ce.Z)(Et),(0,Ce.Z)(_t),(0,Ce.Z)(qt),(0,Ce.Z)(or))}else T=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Mr=C%4*3;return[T[Mr],T[Mr+1],T[Mr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(v,g,x,C){var T=v.size,O=T===void 0?5:T;return Array.isArray(O)?[O[0]*a.meter2coord]:[O*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:On.Attribute,descriptor:{name:"a_Shape",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(v,g,x,C){var T=v.shape,O=T===void 0?2:T,k=a.layer.getLayerConfig().shape2d,j=k.indexOf(O);return[j]}}})}}]),r}(go);function ZC(e){var i=jC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function jC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VC=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,GC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,HC=function(e){(0,Pr.Z)(r,e);var i=ZC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"meter2coord",1),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"isMeter",!1),(0,A.Z)((0,ue.Z)(n),"radian",0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:G.LINEAR,min:G.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v,x=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var C=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(C=-1),this.radian=x!==void 0?C*Math.PI*x/180:C*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),k=O.data,j=O.width,X=O.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&k.length>0?this.createTexture2D({flipY:!0,data:k,format:G.LUMINANCE,type:G.FLOAT,width:j,height:X}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:ma()(f)?f:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Fp)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==zs.L7MAP&&v!==zs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,nn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],g=a[3],x=[(s+v)/2,(f+g)/2],C=this.mapService.version;if(C===zs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,k=O*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-k,T.y,T.z),X=j.toLngLat();this.meter2coord=x[0]-X.lng;return}var te=this.mapService.meterToCoord(x,[s,f]),Ee=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===f?f+.1:g]);this.meter2coord=(te+Ee)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:Fp,depth:{enable:!1},blend:this.getBlend(),stencil:Na(f,g),cull:{enable:!0,face:Hu(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:VC,vert:GC,type:"point_fillImage"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:On.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.rotate,T=C===void 0?0:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),T=f.shape,O=C[T]||{x:0,y:0},k=O.x,j=O.y;return[k,j]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,v,g,x){var C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],T=x%4*3;return[C[T],C[T+1],C[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}})}}]),r}(go);function WC(e){var i=XC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function XC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,qC=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,KC=function(e){(0,Pr.Z)(r,e);var i=WC(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:qC,fragmentShader:YC,triangulation:cy,primitive:G.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.size;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.fontService.mapping,T=f.shape,O=a.fontService.getGlyph(T),k=C[O],j=k.x,X=k.y;return[j,X]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:G.LINEAR,min:G.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.fontWeight,v=f===void 0?"normal":f,g=s.fontFamily,x=g===void 0?"sans-serif":g,C=this.layer.getEncodedData(),T=[];C.forEach(function(O){var k=O.shape,j=k===void 0?"":k;j=j.toString();var X=a.fontService.getGlyph(j);T.indexOf(X)===-1&&T.push(X)}),this.fontService.setFontOptions({characterSet:T,fontWeight:v,fontFamily:x,fontSize:48})}}]),r}(go);function $C(e){var i=QC();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function QC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,eA=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,Py=function(e){(0,Pr.Z)(r,e);var i=$C(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:G.LINEAR,min:G.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,O=C.width,k=C.height;this.rowCount=k,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:G.LUMINANCE,type:G.FLOAT,width:O,height:k}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:ma()(f)?f:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:eA,fragmentShader:JC,triangulation:cy,primitive:G.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:Na(f,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(f,v,g,x){var C=a.iconService.getIconMap(),T=f.shape,O=C[T]||{x:0,y:0},k=O.x,j=O.y;return[k,j]}}})}}]),r}(go);function tA(e){var i=rA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function rA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,iA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Iy(e){var i=e.coordinates;return{vertices:(0,Ce.Z)(i),indices:[0],size:i.length}}var Oy=function(e){(0,Pr.Z)(r,e);var i=tA(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,O=C.width,k=C.height;this.rowCount=k,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:G.LUMINANCE,type:G.FLOAT,width:O,height:k}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ma()(f)?f:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=Iy,[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:iA,fragmentShader:nA,triangulation:Iy,depth:{enable:!1},primitive:G.POINTS,blend:this.getBlend(),stencil:Na(f,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Pc.additive}}}]),r}(go);function aA(e){var i=oA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function oA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sA=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,uA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,lA=function(e){(0,Pr.Z)(r,e);var i=aA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"meter2coord",1),(0,A.Z)((0,ue.Z)(n),"isMeter",!1),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v,x=a.blend,C=a.speed,T=C===void 0?1:C;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var O=this.layer.getEncodedData(),k=this.calDataFrame(this.cellLength,O,this.cellProperties),j=k.data,X=k.width,te=k.height;this.rowCount=te,this.dataTexture=this.cellLength>0&&j.length>0?this.createTexture2D({flipY:!0,data:j,format:G.LUMINANCE,type:G.FLOAT,width:X,height:te}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:T,u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ma()(f)?f:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(f),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Fp)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==zs.L7MAP&&v!==zs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,nn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],g=a[3],x=[(s+v)/2,(f+g)/2],C=this.mapService.version;if(C===zs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,k=O*T.meterInMercatorCoordinateUnits(),j=new window.mapboxgl.MercatorCoordinate(T.x-k,T.y,T.z),X=j.toLngLat();this.meter2coord=x[0]-X.lng;return}var te=this.mapService.meterToCoord(x,[s,f]),Ee=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===f?f+.1:g]);this.meter2coord=(te+Ee)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:Fp,depth:{enable:!1},blend:this.getBlend(),stencil:Na(f,g),cull:{enable:!0,face:Hu(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:sA,vert:uA,type:"point_radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(f,v,g,x){var C;C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var T=x%4*3;return[C[T],C[T+1],C[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:On.Attribute,descriptor:{name:"a_Shape",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(f,v,g,x){var C=f.shape,T=C===void 0?2:C,O=a.layer.getLayerConfig().shape2d,k=O.indexOf(T);return[k]}}})}}]),r}(go);function cA(e){var i=fA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function fA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,pA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Ry(e){var i=e.coordinates;return{vertices:(0,Ce.Z)(i),indices:[0],size:i.length}}var dA=function(e){(0,Pr.Z)(r,e);var i=cA(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v,x=a.blend,C=a.strokeOpacity,T=C===void 0?1:C,O=a.strokeWidth,k=O===void 0?0:O,j=a.stroke,X=j===void 0?"#fff":j;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:g})){this.judgeStyleAttributes({opacity:f,offsets:g});var te=this.layer.getEncodedData(),Ee=this.calDataFrame(this.cellLength,te,this.cellProperties),Ne=Ee.data,$e=Ee.width,ot=Ee.height;this.rowCount=ot,this.dataTexture=this.cellLength>0&&Ne.length>0?this.createTexture2D({flipY:!0,data:Ne,format:G.LUMINANCE,type:G.FLOAT,width:$e,height:ot}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ma()(f)?f:1,u_offsets:this.isOffsetStatic(g)?g:[0,0],u_stroke_opacity:ma()(T)?T:1,u_stroke_width:ma()(k)?k:1,u_stroke_color:this.getStrokeColor(X)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=Ry,[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:pA,fragmentShader:hA,triangulation:Ry,depth:{enable:!1},primitive:G.POINTS,blend:this.getBlend(),stencil:Na(f,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Pc.additive}}}]),r}(go);function vA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=mA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function mA(e,i){if(!!e){if(typeof e=="string")return Ly(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ly(e,i)}}function Ly(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var gA=function(){function e(i,r,n){(0,ht.Z)(this,e),(0,A.Z)(this,"boxCells",[]),(0,A.Z)(this,"xCellCount",void 0),(0,A.Z)(this,"yCellCount",void 0),(0,A.Z)(this,"boxKeys",void 0),(0,A.Z)(this,"bboxes",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"xScale",void 0),(0,A.Z)(this,"yScale",void 0),(0,A.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Pt.Z)(e,[{key:"insert",value:function(r,n,a,s,f){this.forEachCell(n,a,s,f,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(f)}},{key:"query",value:function(r,n,a,s,f){return this.queryHitTest(r,n,a,s,!1,f)}},{key:"hitTest",value:function(r,n,a,s,f){return this.queryHitTest(r,n,a,s,!0,f)}},{key:"insertBoxCell",value:function(r,n,a,s,f,v){this.boxCells[f].push(v)}},{key:"queryHitTest",value:function(r,n,a,s,f,v){if(a<0||r>this.width||s<0||n>this.height)return f?!1:[];var g=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(f)return!0;for(var x=0;x<this.boxKeys.length;x++)g.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return v?g.filter(v):g}var C={hitTest:f,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,g,C,v),f?g.length>0:g}},{key:"queryCell",value:function(r,n,a,s,f,v,g,x){var C=g.seenUids,T=this.boxCells[f];if(T!==null){var O=this.bboxes,k=vA(T),j;try{for(k.s();!(j=k.n()).done;){var X=j.value;if(!C.box[X]){C.box[X]=!0;var te=X*4;if(r<=O[te+2]&&n<=O[te+3]&&a>=O[te+0]&&s>=O[te+1]&&(!x||x(this.boxKeys[X]))){if(g.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[X],x1:O[te],y1:O[te+1],x2:O[te+2],y2:O[te+3]})}}}}catch(Ee){k.e(Ee)}finally{k.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,f,v,g,x){for(var C=this.convertToXCellCoord(r),T=this.convertToYCellCoord(n),O=this.convertToXCellCoord(a),k=this.convertToYCellCoord(s),j=C;j<=O;j++)for(var X=T;X<=k;X++){var te=this.xCellCount*X+j;if(f.call(this,r,n,a,s,te,v,g,x))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),yA=gA,_A=function(){function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"grid",void 0),(0,A.Z)(this,"viewportPadding",100),(0,A.Z)(this,"screenRightBoundary",void 0),(0,A.Z)(this,"screenBottomBoundary",void 0),(0,A.Z)(this,"gridRightBoundary",void 0),(0,A.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new yA(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Pt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,f=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,f)||this.grid.hitTest(n,a,s,f)?{box:[]}:{box:[n,a,s,f]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=gp(n,a,0,1),f=Rd(),v=zn.apply(ie,(0,Ce.Z)(r));return ee(f,s,v),{x:(f[0]/f[3]+1)/2*this.width+this.viewportPadding,y:(-f[1]/f[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function ky(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=xA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function xA(e,i){if(!!e){if(typeof e=="string")return Dy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dy(e,i)}}function Dy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Fy(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function By(e,i,r,n,a){if(!!a){var s=e[n],f=s.glyph;if(f)for(var v=i[f].advance*s.scale,g=(e[n].x+v)*a,x=r;x<=n;x++)e[x].x-=g}}function Ny(e,i,r,n,a,s,f){var v=(i-r)*a,g=(-n*f+.5)*s,x=ky(e),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.x+=v,T.y+=g}}catch(O){x.e(O)}finally{x.f()}}function bA(e,i,r,n,a,s,f){var v=-8,g=0,x=v,C=0,T=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,k=T.length;r.forEach(function(Ne){if(Ne.split("").forEach(function(ot){var Et=i[ot],_t=0;Et&&(T.push({glyph:ot,x:g,y:x+_t,vertical:!1,scale:1,metrics:Et}),g+=Et.advance+f)}),T.length!==k){var $e=g-f;C=Math.max($e,C),By(T,i,k,T.length-1,O)}g=0,x-=n+5});var j=Fy(a),X=j.horizontalAlign,te=j.verticalAlign;Ny(T,O,X,te,C,n,r.length);var Ee=x-v;e.top+=-te*Ee,e.bottom=e.top-Ee,e.left+=-X*C,e.right=e.left+C}function EA(e,i,r,n,a,s,f){var v=-8,g=0,x=v,C=0,T=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,k=T.length;r.forEach(function(Ne){var $e=i[Ne],ot=0;if($e&&(T.push({glyph:Ne,x:$e.advance/2,y:x+ot,vertical:!1,scale:1,metrics:$e}),g+=$e.advance+f),T.length!==k){var Et=g-f;C=Math.max(Et,C),By(T,i,k,T.length-1,O)}g=0,x-=n+5});var j=Fy(a),X=j.horizontalAlign,te=j.verticalAlign;Ny(T,O,X,te,C,n,r.length);var Ee=x-v;e.top+=-te*Ee,e.bottom=e.top-Ee,e.left+=-X*C,e.right=e.left+C}function SA(e,i,r,n,a,s){var f=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],v=arguments.length>7?arguments[7]:void 0,g=e.split(`
`),x=[],C={positionedGlyphs:x,top:f[1],bottom:f[1],left:f[0],right:f[0],lineCount:g.length,text:e};return v?EA(C,i,g,r,n,a,s):bA(C,i,g,r,n,a,s),x.length?C:!1}function CA(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],f=ky(a),v;try{for(f.s();!(v=f.n()).done;){var g=v.value,x=g.metrics,C=4,T=x.advance*g.scale/2,O=r?[g.x+T,g.y]:[0,0],k=r?[0,0]:[g.x+T+i[0],g.y+i[1]],j=(0-C)*g.scale-T+k[0],X=(0-C)*g.scale+k[1],te=j+x.width*g.scale,Ee=X+x.height*g.scale,Ne={x:j,y:X},$e={x:te,y:X},ot={x:j,y:Ee},Et={x:te,y:Ee};s.push({tl:Ne,tr:$e,bl:ot,br:Et,tex:x,glyphOffset:O})}}catch(_t){f.e(_t)}finally{f.f()}return s}function AA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=wA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function wA(e,i){if(!!e){if(typeof e=="string")return zy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zy(e,i)}}function zy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function TA(e){var i=MA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function MA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Zy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function jy(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,f=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(v,g){n.push.apply(n,(0,Ce.Z)(f).concat([v.tex.x,v.tex.y+v.tex.height,v.tl.x,v.tl.y],(0,Ce.Z)(f),[v.tex.x+v.tex.width,v.tex.y+v.tex.height,v.tr.x,v.tr.y],(0,Ce.Z)(f),[v.tex.x+v.tex.width,v.tex.y,v.br.x,v.br.y],(0,Ce.Z)(f),[v.tex.x,v.tex.y,v.bl.x,v.bl.y])),a.push(0+g*4,1+g*4,2+g*4,2+g*4,3+g*4,0+g*4)}),{vertices:n,indices:a,size:7}}var Vy=function(e){(0,Pr.Z)(r,e);var i=TA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"glyphInfo",void 0),(0,A.Z)((0,ue.Z)(n),"glyphInfoMap",{}),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"currentZoom",-1),(0,A.Z)((0,ue.Z)(n),"extent",void 0),(0,A.Z)((0,ue.Z)(n),"textureHeight",0),(0,A.Z)((0,ue.Z)(n),"textCount",0),(0,A.Z)((0,ue.Z)(n),"preTextStyle",{}),(0,A.Z)((0,ue.Z)(n),"buildModels",function(){var v=n.layer.getLayerConfig(),g=v.mask,x=g===void 0?!1:g,C=v.maskInside,T=C===void 0?!0:C;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:Zy,fragmentShader:Uy,triangulation:jy.bind((0,ue.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:Na(x,T)})]}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.stroke,g=v===void 0?"#fff":v,x=a.strokeWidth,C=x===void 0?0:x,T=a.textAnchor,O=T===void 0?"center":T,k=a.textAllowOverlap,j=k===void 0?!1:k,X=a.halo,te=X===void 0?.5:X,Ee=a.gamma,Ne=Ee===void 0?2:Ee,$e=a.raisingHeight,ot=$e===void 0?0:$e,Et=this.fontService,_t=Et.canvas,qt=Et.mapping;if(Object.keys(qt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(qt).length),this.preTextStyle={textAnchor:O,textAllowOverlap:j},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeWidth:C,stroke:g})){this.judgeStyleAttributes({opacity:f,strokeWidth:C,stroke:g});var or=this.layer.getEncodedData(),Mr=this.calDataFrame(this.cellLength,or,this.cellProperties),Xr=Mr.data,yr=Mr.width,sn=Mr.height;this.rowCount=sn,this.dataTexture=this.cellLength>0&&Xr.length>0?this.createTexture2D({flipY:!0,data:Xr,format:G.LUMINANCE,type:G.FLOAT,width:yr,height:sn}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(ot),u_opacity:ma()(f)?f:1,u_stroke_width:ma()(C)?C:1,u_stroke_color:this.getStrokeColor(g),u_sdf_map:this.texture,u_halo_blur:te,u_gamma_scale:Ne,u_sdf_map_size:[_t.width,_t.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,f=s===void 0?"center":s,v=a.textAllowOverlap,g=v===void 0?!0:v;return this.preTextStyle={textAnchor:f,textAllowOverlap:g},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,f=s===void 0?!1:s,v=this.mapService.getZoom(),g=this.mapService.getBounds(),x=Oa(this.extent,g);return!f&&(Math.abs(this.currentZoom-v)>1||!x)||f!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:On.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.rotate,C=x===void 0?0:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:On.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){return[v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(s,f,v,g){var x=s.size,C=x===void 0?12:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:On.Attribute,descriptor:{name:"a_tex",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return ra(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,f=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var O=T.shape,k=O===void 0?"":O;k=k.toString();var j=AA(k),X;try{for(j.s();!(X=j.n()).done;){var te=X.value;C.indexOf(te)===-1&&C.push(te)}}catch(Ee){j.e(Ee)}finally{j.f()}}),this.fontService.setFontOptions({characterSet:C,fontWeight:f,fontFamily:g,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,f=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var O=T.shape,k=O===void 0?"":O;k="".concat(k),C.indexOf(k)===-1&&C.push(k)}),this.fontService.setFontOptions({characterSet:C,fontWeight:f,fontFamily:g,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,f=this.fontService.mapping,v=this.layer.getLayerConfig(),g=v.spacing,x=g===void 0?2:g,C=v.textAnchor,T=C===void 0?"center":C,O=this.layer.getEncodedData();this.glyphInfo=O.map(function(k){var j=k.shape,X=j===void 0?"":j,te=k.id,Ee=k.size,Ne=Ee===void 0?1:Ee,$e=k.textOffset,ot=$e===void 0?[0,0]:$e,Et=SA(X.toString(),f,Ne,T,"left",x,ot,a),_t=CA(Et,ot,!1);return k.shaping=Et,k.glyphQuads=_t,k.centroid=Lp(k.coordinates),k.originCentroid=k.version==="GAODE2.x"?Lp(k.originCoordinates):k.originCentroid=k.centroid,s.glyphInfoMap[te]={shaping:Et,glyphQuads:_t,centroid:Lp(k.coordinates)},k})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.padding,v=f===void 0?[4,4]:f,g=s.textAllowOverlap,x=g===void 0?!1:g;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var C=this.rendererService.getViewportSize(),T=C.width,O=C.height,k=new _A(T,O),j=this.glyphInfo.filter(function(X){var te=X.shaping,Ee=X.id,Ne=Ee===void 0?0:Ee,$e=X.version==="GAODE2.x"?X.originCentroid:X.centroid,ot=X.size,Et=ot/24,_t=a.mapService.lngLatToContainer($e),qt=k.placeCollisionBox({x1:te.left*Et-v[0],x2:te.right*Et+v[0],y1:te.top*Et-v[1],y2:te.bottom*Et+v[1],anchorPointX:_t.x,anchorPointY:_t.y}),or=qt.box;return or&&or.length?(k.insertCollisionBox(or,Ne),!0):!1});j.forEach(function(X){a.glyphInfoMap[X.id]=X})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,f=s===void 0?!1:s;f?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(f)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:G.LINEAR,min:G.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Zy,fragmentShader:Uy,triangulation:jy.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Na(f,g)})]}}]),r}(go),PA={fillImage:HC,fill:My,radar:lA,image:Py,normal:Oy,simplePoint:dA,extrude:wy,text:Vy,icon:KC},IA=PA;function OA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=RA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function RA(e,i){if(!!e){if(typeof e=="string")return Gy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gy(e,i)}}function Gy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function LA(e){var i=kA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function kA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hy=function(e){(0,Pr.Z)(r,e);var i=LA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","PointLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new IA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,f=a.values,v=this.getLayerConfig(),g=v.shape2d,x=v.shape3d,C=this.iconService.getIconMap();if(s&&(g==null?void 0:g.indexOf(s))!==-1)return"fill";if(f&&f instanceof Array){var T=OA(f),O;try{for(T.s();!(O=T.n()).done;){var k=O.value;if(typeof k=="string"&&C.hasOwnProperty(k))return"image"}}catch(j){T.e(j)}finally{T.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),f=this.getLayerConfig(),v=f.shape2d,g=f.shape3d,x=this.iconService.getIconMap(),C=s.find(function(O){return O.hasOwnProperty("shape")});if(C){var T=C.shape;return T==="dot"?"normal":T==="simple"?"simplePoint":T==="radar"?"radar":T==="fillImage"?"fillImage":(v==null?void 0:v.indexOf(T))!==-1?"fill":(g==null?void 0:g.indexOf(T))!==-1?"extrude":x.hasOwnProperty(T)?"image":this.fontService.getGlyph(T)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(Qh);function DA(e){var i=FA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function FA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BA=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,NA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,zA=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,UA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,ZA=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,jA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,VA=function(e){(0,Pr.Z)(r,e);var i=DA(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.heightfixed,g=v===void 0?!1:v,x=a.raisingHeight,C=x===void 0?0:x,T=a.topsurface,O=T===void 0?!0:T,k=a.sidesurface,j=k===void 0?!0:k,X=a.sourceColor,te=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var Ee=this.layer.getEncodedData(),Ne=this.calDataFrame(this.cellLength,Ee,this.cellProperties),$e=Ne.data,ot=Ne.width,Et=Ne.height;this.rowCount=Et,this.dataTexture=this.cellLength>0&&$e.length>0?this.createTexture2D({flipY:!0,data:$e,format:G.LUMINANCE,type:G.FLOAT,width:ot,height:Et}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}var _t=0,qt=[1,1,1,1],or=[1,1,1,1];return X&&te&&(qt=Ea(X),or=Ea(te),_t=1),{u_topsurface:Number(O),u_sidesurface:Number(j),u_heightfixed:Number(g),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(C),u_opacity:ma()(f)?f:1,u_linearColor:_t,u_sourceColor:qt,u_targetColor:or,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:fy,stencil:Na(f,g),cull:{enable:!0,face:G.BACK}})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,f=a.mapTexture;return f?{frag:zA,vert:UA,type:"polygonExtrudeTexture"}:s?{frag:ZA,vert:jA,type:"polygonExtrudePickLight"}:{frag:BA,vert:NA,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,nn.Z)(a,4),f=s[0],v=s[1],g=s[2],x=s[3],C=g-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:On.Attribute,descriptor:{name:"a_uvs",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(k,j,X,te,Ee){var Ne=X[0],$e=X[1];return[(Ne-f)/C,($e-v)/T,X[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(k,j,X,te,Ee){return Ee}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(k,j,X,te){var Ee=k.size,Ne=Ee===void 0?10:Ee;return Array.isArray(Ne)?[Ne[0]]:[Ne]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.mapTexture,v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),f){var g=new Image;g.crossOrigin="",g.src=f,g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:G.CLAMP_TO_EDGE,wrapT:G.CLAMP_TO_EDGE,min:G.LINEAR,mag:G.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),r}(go);function GA(e){var i=HA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function HA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,XA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,YA=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,qA=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,KA=function(e){(0,Pr.Z)(r,e);var i=GA(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.raisingHeight,f=s===void 0?0:s,v=a.opacity,g=v===void 0?1:v,x=a.opacityLinear,C=x===void 0?{enable:!1,dir:"in"}:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),k=O.data,j=O.width,X=O.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&k.length>0?this.createTexture2D({flipY:!0,data:k,format:G.LUMINANCE,type:G.FLOAT,width:j,height:X}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(f),u_opacity:ma()(g)?g:1,u_opacitylinear:Number(C.enable),u_dir:C.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.getModelParams(),s=a.frag,f=a.vert,v=a.triangulation,g=a.type,x=this.layer.getLayerConfig(),C=x.mask,T=C===void 0?!1:C,O=x.maskInside,k=O===void 0?!0:O;return this.layer.triangulation=v,[this.layer.buildLayerModel({moduleName:g,vertexShader:f,fragmentShader:s,triangulation:v,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:G.BACK},stencil:Na(T,k)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,f=s===void 0?{enable:!1,dir:"in"}:s;f.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:On.Attribute,descriptor:{name:"a_linear",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:3,update:function(g,x,C,T,O){return[C[3],C[4],C[5]]}}})}},{key:"getModelParams",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,f=s===void 0?{enable:!1}:s;return f.enable?{frag:XA,vert:YA,type:"polygon_linear",triangulation:FE}:{frag:WA,vert:qA,type:"polygon_fill",triangulation:Uv}}}]),r}(go);function $A(e){var i=QA();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function QA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JA=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);  
}
`,ew=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,tw=function(e){(0,Pr.Z)(r,e);var i=$A(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture1",void 0),(0,A.Z)((0,ue.Z)(n),"texture2",void 0),(0,A.Z)((0,ue.Z)(n),"texture3",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.watercolor,g=v===void 0?"#6D99A8":v,x=a.watercolor2,C=x===void 0?"#0F121C":x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),k=O.data,j=O.width,X=O.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&k.length>0?this.createTexture2D({flipY:!0,data:k,format:G.LUMINANCE,type:G.FLOAT,width:j,height:X}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Ea(g),u_watercolor2:Ea(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ma()(f)?f:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:ew,fragmentShader:JA,triangulation:Uv,depth:{enable:!1},stencil:Na(f,g)})]}},{key:"clearModels",value:function(){var a,s,f,v;(a=this.texture1)===null||a===void 0||a.destroy(),(s=this.texture2)===null||s===void 0||s.destroy(),(f=this.texture3)===null||f===void 0||f.destroy(),(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,nn.Z)(a,4),f=s[0],v=s[1],g=s[2],x=s[3],C=g-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:On.Attribute,descriptor:{name:"a_uv",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(k,j,X,te,Ee){var Ne=(0,nn.Z)(X,2),$e=Ne[0],ot=Ne[1];return[($e-f)/C,(ot-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,f={height:0,width:0};this.texture1=s(f),this.texture2=s(f),this.texture3=s(f),v(function(x){a.texture1=g(x[0]),a.texture2=g(x[1]),a.texture3=g(x[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function v(x){var C=0,T=[],O=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];O.map(function(k){var j=new Image;j.crossOrigin="",j.src=k,T.push(j),j.onload=function(){C++,C===3&&x(T)}})}function g(x){return s({data:x,width:x.width,height:x.height,wrapS:G.MIRRORED_REPEAT,wrapT:G.MIRRORED_REPEAT,min:G.LINEAR,mag:G.LINEAR})}}}]),r}(go);function rw(e){var i=nw();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function nw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iw=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E


float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,aw=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,ow=function(e){(0,Pr.Z)(r,e);var i=rw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.speed,g=v===void 0?.5:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,O=C.width,k=C.height;this.rowCount=k,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:G.LUMINANCE,type:G.FLOAT,width:O,height:k}):this.createTexture2D({flipY:!0,data:[1],format:G.LUMINANCE,type:G.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:g,u_opacity:ma()(f)?f:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:aw,fragmentShader:iw,triangulation:Uv,depth:{enable:!1},stencil:Na(f,g)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,nn.Z)(a,4),f=s[0],v=s[1],g=s[2],x=s[3],C=g-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:On.Attribute,descriptor:{name:"a_uv",buffer:{usage:G.STATIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(k,j,X,te,Ee){var Ne=(0,nn.Z)(X,2),$e=Ne[0],ot=Ne[1];return[($e-f)/C,(ot-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.waterTexture,v=this.rendererService.createTexture2D;this.texture=v({height:0,width:0});var g=new Image;g.crossOrigin="",f?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),g.src=f):g.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:G.MIRRORED_REPEAT,wrapT:G.MIRRORED_REPEAT,min:G.LINEAR,mag:G.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),r}(go),sw={fill:KA,line:Sy,extrude:VA,text:Vy,point_fill:My,point_image:Py,point_normal:Oy,point_extrude:wy,water:ow,ocean:tw},uw=sw;function lw(e){var i=cw();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function cw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wy=function(e){(0,Pr.Z)(r,e);var i=lw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","PolygonLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new uw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return f==="fill"?"fill":f==="extrude"?"extrude":f==="water"?"water":f==="ocean"?"ocean":f==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),f=s.shape2d,v=s.shape3d,g=this.iconService.getIconMap(),x=a.find(function(T){return T.hasOwnProperty("shape")});if(x){var C=x.shape;return C==="dot"?"point_normal":(f==null?void 0:f.indexOf(C))!==-1?"point_fill":(v==null?void 0:v.indexOf(C))!==-1?"point_extrude":g.hasOwnProperty(C)?"point_image":"text"}else return"fill"}}]),r}(Qh);function fw(e){var i=hw();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pw=function(e){(0,Pr.Z)(r,e);var i=fw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"isLayerGroup",!0),n}return(0,Pt.Z)(r,[{key:"addChild",value:function(a){this.layerChildren.push(a)}},{key:"removeChild",value:function(a){var s=this.layerChildren.indexOf(a);s>-1&&this.layerChildren.splice(s,1),a.destroy()}},{key:"clearChild",value:function(){this.layerChildren.forEach(function(a){a.destroy()}),this.layerChildren=[]}},{key:"hasChild",value:function(a){return this.layerChildren.includes(a)}}]),r}(Qh);function dw(e){var i=vw();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function vw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mw=function(e){(0,Pr.Z)(r,e);var i=dw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"initedTileset",!1),(0,A.Z)((0,ue.Z)(n),"tilesetManager",void 0),(0,A.Z)((0,ue.Z)(n),"showGrid",!1),(0,A.Z)((0,ue.Z)(n),"subGridLayer",void 0),(0,A.Z)((0,ue.Z)(n),"subTextLayer",void 0),(0,A.Z)((0,ue.Z)(n),"lastViewStates",void 0),(0,A.Z)((0,ue.Z)(n),"timer",void 0),(0,A.Z)((0,ue.Z)(n),"renderSubLayers",function(){if(!!n.tilesetManager){var v=n.layer;n.tilesetManager.tiles.filter(function(g){return g.isLoaded}).map(function(g){return g.layer?g.layer.updateLayerConfig({visible:g.isVisible}):(g.layer=n.creatSubLayer(g),v.addChild(g.layer)),g.layer}),n.showGrid&&(v.hasChild(n.subGridLayer)||v.addChild(n.subGridLayer),v.hasChild(n.subTextLayer)||v.addChild(n.subTextLayer)),n.layerService.renderLayers(),n.tilesetManager.isLoaded&&v.emit("tiles-loaded",n.tilesetManager.currentTiles)}}),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){return{}}},{key:"initModels",value:function(){var a,s=this.layer.getSource();this.tilesetManager=s.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var f=this.getCurrentView(),v=f.latLonBounds,g=f.zoom;return(a=this.tilesetManager)===null||a===void 0||a.update(g,v),this.showGrid&&this.renderSubGridLayer(),this.buildModels()}},{key:"buildModels",value:function(){return[]}},{key:"clearModels",value:function(){}},{key:"renderSubGridLayer",value:function(){if(!!this.tilesetManager){var a=this.tilesetManager.currentTiles.map(function(f){return f.bboxPolygon}),s={type:"FeatureCollection",features:a};if(this.subGridLayer){this.subGridLayer.setData(s),this.subTextLayer.setData(s);return}this.subGridLayer=new Ay({autoFit:!1}).source(s).size(1).color("red").shape("simple").style({lineType:"dash",dashArray:[1,2]}),this.subTextLayer=new Hy({autoFit:!1}).source(s).size(14).color("red").shape("meta","text").style({opacity:1,strokeWidth:1,stroke:"#fff"}),this.subGridLayer.setContainer(av(this.layer.sceneContainer),this.layer.sceneContainer),this.subTextLayer.setContainer(av(this.layer.sceneContainer),this.layer.sceneContainer),this.subGridLayer.init(),this.subTextLayer.init()}}},{key:"registerBuiltinAttributes",value:function(){}},{key:"bindTilesetEvent",value:function(){var a=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(s){}),this.tilesetManager.on("tile-unload",function(s){a.destroySubLayer(s)}),this.tilesetManager.on("tile-error",function(s,f){}),this.tilesetManager.on("tile-update",this.renderSubLayers),this.mapService.on("mapchange",function(s){var f=a.getCurrentView(),v=f.latLonBounds,g=f.zoom;if(a.mapService.version==="GAODE1.x"){var x=a.layer.getLayerConfig(),C=x.visible;g<3&&C?(a.layer.updateLayerConfig({visible:!1}),a.layerService.updateLayerRenderList()):g>=3&&!C&&(a.layer.updateLayerConfig({visible:!0}),a.layerService.updateLayerRenderList())}a.lastViewStates&&a.lastViewStates.zoom===g&&a.lastViewStates.latLonBounds.toString()===v.toString()||(a.lastViewStates={zoom:g,latLonBounds:v},a.timer&&(clearTimeout(a.timer),a.timer=null),a.timer=setTimeout(function(){var T;(T=a.tilesetManager)===null||T===void 0||T.update(g,v),a.showGrid&&a.renderSubGridLayer()},250))}))}},{key:"creatSubLayer",value:function(a){var s=this.layer.getLayerConfig(),f=s.opacity,v=f===void 0?1:f,g=s.zIndex,x=g===void 0?0:g,C=new by({visible:a.isVisible,zIndex:x}).source(a.data,{parser:{type:"image",extent:a.bounds}}).style({opacity:v}),T=av(this.layer.sceneContainer);return C.setContainer(T,this.layer.sceneContainer),C.init(),C}},{key:"destroySubLayer",value:function(a){if(a.layer){var s=this.layer;s.removeChild(a.layer)}}},{key:"getCurrentView",value:function(){var a=this.mapService.getBounds(),s=[a[0][0],a[0][1],a[1][0],a[1][1]],f=this.mapService.getZoom();return{latLonBounds:s,zoom:f}}}]),r}(go);function gw(e){var i=yw();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function yw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _w=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,xw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Xy=function(e){(0,Pr.Z)(r,e);var i=gw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"texture",void 0),(0,A.Z)((0,ue.Z)(n),"colorTexture",void 0),n}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.clampLow,g=v===void 0?!0:v,x=a.clampHigh,C=x===void 0?!0:x,T=a.noDataValue,O=T===void 0?-9999999:T,k=a.domain,j=k===void 0?[0,1]:k;return this.updateColorTexure(),{u_opacity:f||1,u_texture:this.texture,u_domain:j,u_clampLow:g,u_clampHigh:typeof C!="undefined"?C:g,u_noDataValue:O,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){this.layer.isLayerGroup=!1;var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.layer.getSource(),C=this.rendererService.createTexture2D,T=x.data.dataArray[0];this.texture=C({data:T.data,width:T.width,height:T.height,format:G.LUMINANCE,type:G.FLOAT});var O=this.layer.getLayerConfig(),k=O.rampColors,j=jl(k);return this.colorTexture=C({data:j.data,width:j.width,height:j.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:xw,fragmentShader:_w,triangulation:py,primitive:G.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Na(f,g)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:2,update:function(s,f,v,g){return[v[3],v[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),f=s.rampColors,v=jl(f);this.colorTexture=a({data:v.data,width:v.width,height:v.height,flipY:!1})}}]),r}(go),bw={raster:Xy,raster3d:Xy,rasterTile:mw},Ew=bw;function Sw(e){var i=Cw();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Cw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Aw=function(e){(0,Pr.Z)(r,e);var i=Sw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","RasterLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Ew[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{},rasterTile:{}};return s[a]}},{key:"getModelType",value:function(){switch(this.layerSource.parser.type){case"raster":return"raster";case"rasterTile":return"rasterTile";default:return"raster"}}}]),r}(pw);function ww(e){var i=Tw();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Tw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mw=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,Pw=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,Iw=function(e){(0,Pr.Z)(r,e);var i=ww(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?0:s;return{u_opacity:ma()(f)?f:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:Pw,fragmentShader:Mw,triangulation:Uv,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:G.ALWAYS,ref:1,mask:255},opFront:{fail:G.REPLACE,zfail:G.REPLACE,zpass:G.REPLACE}}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(go),Ow={fill:Iw},Rw=Ow;function Lw(e){var i=kw();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function kw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dw=function(e){(0,Pr.Z)(r,e);var i=Lw(r);function r(){var n;(0,ht.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ue.Z)(n),"type","MaskLayer"),n}return(0,Pt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Rw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),r}(Qh),Yy,qy,Ky,$y,Qy,uv,Jy,e_,t_;function r_(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Fw(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?r_(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):r_(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Bw=(Yy=(0,zr.b2)(),qy=(0,zr.f3)(Yt.IGlobalConfigService),Ky=(0,zr.f3)(Yt.IMapService),$y=(0,zr.f3)(Yt.IFontService),Yy(Qy=(uv=function(){function e(){(0,ht.Z)(this,e),mi(this,"configService",Jy,this),mi(this,"mapService",e_,this),mi(this,"fontService",t_,this)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var f=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=v.filter(function(O){return O.needRemapping}),T=x;g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(T=x.filter(function(O){return a.applyAttributeMapping(g,O,f)[0]})),C.length&&(g!=null&&g.needRemapping?(r.setEncodedData(a.mapping(r,v,T,void 0,f)),g.needRemapping=!1):r.setEncodedData(a.mapping(r,C,T,r.getEncodedData(),f)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,f=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=x;g!=null&&g.scale&&(C=x.filter(function(T){return a.applyAttributeMapping(g,T,f)[0]})),r.setEncodedData(this.mapping(r,v,C,void 0,f)),r.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(r,n){var a=[n[0]-r[0],n[1]-r[1]],s=yl(a),f=[r[0]+s[0]*1e-4,r[1]+s[1]*1e-4];return f}},{key:"mapping",value:function(r,n,a,s,f){var v=this,g=r.getLayerConfig(),x=g.arrow,C=x===void 0?{enable:!1}:x,T=a.map(function(O,k){var j=s?s[k]:{},X=Fw({id:O._id,coordinates:O.coordinates},j);if(n.filter(function(Ne){return Ne.scale!==void 0}).forEach(function(Ne){var $e=v.applyAttributeMapping(Ne,O,f);Ne.needRemapping=!1,Ne.name==="color"&&($e=$e.map(function(ot){return Ea(ot)})),X[Ne.name]=Array.isArray($e)&&$e.length===1?$e[0]:$e,Ne.name==="shape"&&(X.shape=v.fontService.getIconFontKey(X[Ne.name]))}),X.shape==="line"&&C.enable){var te=X.coordinates,Ee=v.getArrowPoints(te[0],te[1]);X.coordinates.splice(1,0,Ee,Ee)}return X});return this.adjustData2Amap2Coordinates(T,r),this.adjustData2SimpleCoordinates(T),T}},{key:"adjustData2Amap2Coordinates",value:function(r,n){var a=this;if(r.length>0&&this.mapService.version===zs["GAODE2.x"]){var s=this.getLayerCenter(n);typeof r[0].coordinates[0]=="number"?r.filter(function(f){return!f.originCoordinates}).map(function(f){f.version=zs["GAODE2.x"],f.originCoordinates=vu()(f.coordinates),f.coordinates=a.mapService.lngLatToCoordByLayer(f.coordinates,s)}):r.filter(function(f){return!f.originCoordinates}).map(function(f){f.version=zs["GAODE2.x"],f.originCoordinates=vu()(f.coordinates),f.coordinates=a.mapService.lngLatToCoordsByLayer(f.coordinates,s)})}}},{key:"getLayerCenter",value:function(r){var n=r.getSource();return n.center}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===zs.SIMPLE&&r.map(function(a){a.simpleCoordinate||(a.coordinates=n.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var a=[];return r.map(function(f){var v=[];f.map(function(g){v.push(n.mapService.simpleMapCoord.unproject(g))}),a.push(v)}),a}else{var s=[];return r.map(function(f){s.push(n.mapService.simpleMapCoord.unproject(f))}),s}}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var f=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],v=[];f.forEach(function(x){var C,T=x.field;(n.hasOwnProperty(T)||((C=r.scale)===null||C===void 0?void 0:C.type)==="variable")&&v.push(n[T])});var g=r.mapping?r.mapping(v):[];return r.name==="color"&&!bl(g[0])?[a]:g}}]),e}(),Jy=bi(uv.prototype,"configService",[qy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e_=bi(uv.prototype,"mapService",[Ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t_=bi(uv.prototype,"fontService",[$y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uv))||Qy),n_,i_,Nw=(n_=(0,zr.b2)(),n_(i_=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"mapService",void 0)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Yt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:Yp,options:Pd},f=s.data,v=s.options;r.setSource(new qu(f,v))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,f=s.zoom,v=f===void 0?0:f,g=s.maxZoom,x=g===void 0?16:g,C=this.mapService.getZoom()-1,T=r.dataState.dataSourceNeedUpdate;return a&&(T||Math.abs(r.clusterZoom-C)>=1)?(v!==Math.floor(C)&&n.updateClusterData(Math.floor(C)),r.clusterZoom=C,!0):!1}}]),e}())||i_);function Z0(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function a_(e){return e.length===1&&(e=zw(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function zw(e){return function(i,r){return Z0(e(i),r)}}var o_=a_(Z0),Uw=o_.right,QP=o_.left,Vv=Uw;function s_(e,i){var r=e.length,n=-1,a,s,f;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=f=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),f<a&&(f=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=f=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),f<a&&(f=a));return[s,f]}var u_=Array.prototype,JP=u_.slice,eI=u_.map,j0=Math.sqrt(50),V0=Math.sqrt(10),G0=Math.sqrt(2);function l_(e,i,r){var n,a=-1,s,f,v;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(v=Gv(e,i,r))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),i=Math.floor(i/v),f=new Array(s=Math.ceil(i-e+1));++a<s;)f[a]=(e+a)*v;else for(e=Math.floor(e*v),i=Math.ceil(i*v),f=new Array(s=Math.ceil(e-i+1));++a<s;)f[a]=(e-a)/v;return n&&f.reverse(),f}function Gv(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=j0?10:s>=V0?5:s>=G0?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=j0?10:s>=V0?5:s>=G0?2:1)}function H0(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=j0?a*=10:s>=V0?a*=5:s>=G0&&(a*=2),i<e?-a:a}function tI(){var e=identity,i=extent,r=sturges;function n(a){var s,f=a.length,v,g=new Array(f);for(s=0;s<f;++s)g[s]=e(a[s],s,a);var x=i(g),C=x[0],T=x[1],O=r(g,C,T);Array.isArray(O)||(O=tickStep(C,T,O),O=range(Math.ceil(C/O)*O,T,O));for(var k=O.length;O[0]<=C;)O.shift(),--k;for(;O[k-1]>T;)O.pop(),--k;var j=new Array(k+1),X;for(s=0;s<=k;++s)X=j[s]=[],X.x0=s>0?O[s-1]:C,X.x1=s<k?O[s]:T;for(s=0;s<f;++s)v=g[s],C<=v&&v<=T&&j[bisect(O,v,0,k)].push(a[s]);return j}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function rI(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function Zw(e){return e===null?NaN:+e}function jw(e,i,r){if(r==null&&(r=Zw),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),f=+r(e[s],s,e),v=+r(e[s+1],s+1,e);return f+(v-f)*(a-s)}}var Vw=z(87765),Oc="$";function Hv(){}Hv.prototype=c_.prototype={constructor:Hv,has:function(e){return Oc+e in this},get:function(e){return this[Oc+e]},set:function(e,i){return this[Oc+e]=i,this},remove:function(e){var i=Oc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Oc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Oc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Oc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Oc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Oc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Oc)return!1;return!0},each:function(e){for(var i in this)i[0]===Oc&&e(this[i],i.slice(1),this)}};function c_(e,i){var r=new Hv;if(e instanceof Hv)e.each(function(v,g){r.set(g,v)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var f in e)r.set(f,e[f]);return r}var W0=c_;function nI(){var e=[],i=[],r,n,a;function s(v,g,x,C){if(g>=e.length)return r!=null&&v.sort(r),n!=null?n(v):v;for(var T=-1,O=v.length,k=e[g++],j,X,te=map(),Ee,Ne=x();++T<O;)(Ee=te.get(j=k(X=v[T])+""))?Ee.push(X):te.set(j,[X]);return te.each(function($e,ot){C(Ne,ot,s($e,g,x,C))}),Ne}function f(v,g){if(++g>e.length)return v;var x,C=i[g-1];return n!=null&&g>=e.length?x=v.entries():(x=[],v.each(function(T,O){x.push({key:O,values:f(T,g)})})),C!=null?x.sort(function(T,O){return C(T.key,O.key)}):x}return a={object:function(v){return s(v,0,Gw,Hw)},map:function(v){return s(v,0,f_,h_)},entries:function(v){return f(s(v,0,f_,h_),0)},key:function(v){return e.push(v),a},sortKeys:function(v){return i[e.length-1]=v,a},sortValues:function(v){return r=v,a},rollup:function(v){return n=v,a}}}function Gw(){return{}}function Hw(e,i,r){e[i]=r}function f_(){return map()}function h_(e,i,r){e.set(i,r)}function Wv(){}var Bp=W0.prototype;Wv.prototype=Ww.prototype={constructor:Wv,has:Bp.has,add:function(e){return e+="",this[Oc+e]=e,this},remove:Bp.remove,clear:Bp.clear,values:Bp.keys,size:Bp.size,empty:Bp.empty,each:Bp.each};function Ww(e,i){var r=new Wv;if(e instanceof Wv)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var iI=null,p_=Array.prototype,Xv=p_.map,Np=p_.slice;function tp(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function d_(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var v_={name:"implicit"};function Yv(){var e=W0(),i=[],r=[],n=v_;function a(s){var f=s+"",v=e.get(f);if(!v){if(n!==v_)return n;e.set(f,v=i.push(s))}return r[(v-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=W0();for(var f=-1,v=s.length,g,x;++f<v;)e.has(x=(g=s[f])+"")||e.set(x,i.push(g));return a},a.range=function(s){return arguments.length?(r=Np.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return Yv(i,r).unknown(n)},tp.apply(a,arguments),a}function m_(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,f=!1,v=0,g=0,x=.5;delete e.unknown;function C(){var T=i().length,O=n[1]<n[0],k=n[O-0],j=n[1-O];a=(j-k)/Math.max(1,T-v+g*2),f&&(a=Math.floor(a)),k+=(j-k-a*(T-v))*x,s=a*(1-v),f&&(k=Math.round(k),s=Math.round(s));var X=sequence(T).map(function(te){return k+a*te});return r(O?X.reverse():X)}return e.domain=function(T){return arguments.length?(i(T),C()):i()},e.range=function(T){return arguments.length?(n=[+T[0],+T[1]],C()):n.slice()},e.rangeRound=function(T){return n=[+T[0],+T[1]],f=!0,C()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(T){return arguments.length?(f=!!T,C()):f},e.padding=function(T){return arguments.length?(v=Math.min(1,g=+T),C()):v},e.paddingInner=function(T){return arguments.length?(v=Math.min(1,T),C()):v},e.paddingOuter=function(T){return arguments.length?(g=+T,C()):g},e.align=function(T){return arguments.length?(x=Math.max(0,Math.min(1,T)),C()):x},e.copy=function(){return m_(i(),n).round(f).paddingInner(v).paddingOuter(g).align(x)},initRange.apply(C(),arguments)}function g_(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return g_(i())},e}function aI(){return g_(m_.apply(null,arguments).paddingInner(1))}var Xw=z(21775),Yw=z(73626);function qw(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function Kw(e){return function(){return e}}function X0(e){return+e}var y_=[0,1];function Qu(e){return e}function Y0(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:Kw(isNaN(i)?NaN:.5)}function __(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function $w(e,i,r){var n=e[0],a=e[1],s=i[0],f=i[1];return a<n?(n=Y0(a,n),s=r(f,s)):(n=Y0(n,a),s=r(s,f)),function(v){return s(n(v))}}function Qw(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),f=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++f<n;)a[f]=Y0(e[f],e[f+1]),s[f]=r(i[f],i[f+1]);return function(v){var g=Vv(e,v,1,n)-1;return s[g](a[g](v))}}function qv(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function q0(){var e=y_,i=y_,r=Xw.Z,n,a,s,f=Qu,v,g,x;function C(){return v=Math.min(e.length,i.length)>2?Qw:$w,g=x=null,T}function T(O){return isNaN(O=+O)?s:(g||(g=v(e.map(n),i,r)))(n(f(O)))}return T.invert=function(O){return f(a((x||(x=v(i,e.map(n),Yw.Z)))(O)))},T.domain=function(O){return arguments.length?(e=Xv.call(O,X0),f===Qu||(f=__(e)),C()):e.slice()},T.range=function(O){return arguments.length?(i=Np.call(O),C()):i.slice()},T.rangeRound=function(O){return i=Np.call(O),r=qw,C()},T.clamp=function(O){return arguments.length?(f=O?__(e):Qu,T):f!==Qu},T.interpolate=function(O){return arguments.length?(r=O,C()):r},T.unknown=function(O){return arguments.length?(s=O,T):s},function(O,k){return n=O,a=k,C()}}function x_(e,i){return q0()(e,i)}var Jw=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Kv(e){if(!(i=Jw.exec(e)))throw new Error("invalid format: "+e);var i;return new K0({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}Kv.prototype=K0.prototype;function K0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}K0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function eT(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function $v(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function md(e){return e=$v(Math.abs(e)),e?e[1]:NaN}function tT(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(md(i)/3)))*3-md(Math.abs(e)))}function rT(e,i){return function(r,n){for(var a=r.length,s=[],f=0,v=e[0],g=0;a>0&&v>0&&(g+v+1>n&&(v=Math.max(1,n-g)),s.push(r.substring(a-=v,a+v)),!((g+=v+1)>n));)v=e[f=(f+1)%e.length];return s.reverse().join(i)}}function nT(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function iT(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var b_;function aT(e,i){var r=$v(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(b_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,f=n.length;return s===f?n:s>f?n+new Array(s-f+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+$v(e,Math.max(0,i+s-1))[0]}function E_(e,i){var r=$v(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var S_={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:eT,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return E_(e*100,i)},r:E_,s:aT,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function C_(e){return e}var A_=Array.prototype.map,w_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function oT(e){var i=e.grouping===void 0||e.thousands===void 0?C_:rT(A_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?C_:nT(A_.call(e.numerals,String)),f=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"-":e.minus+"",g=e.nan===void 0?"NaN":e.nan+"";function x(T){T=Kv(T);var O=T.fill,k=T.align,j=T.sign,X=T.symbol,te=T.zero,Ee=T.width,Ne=T.comma,$e=T.precision,ot=T.trim,Et=T.type;Et==="n"?(Ne=!0,Et="g"):S_[Et]||($e===void 0&&($e=12),ot=!0,Et="g"),(te||O==="0"&&k==="=")&&(te=!0,O="0",k="=");var _t=X==="$"?r:X==="#"&&/[boxX]/.test(Et)?"0"+Et.toLowerCase():"",qt=X==="$"?n:/[%p]/.test(Et)?f:"",or=S_[Et],Mr=/[defgprs%]/.test(Et);$e=$e===void 0?6:/[gprs]/.test(Et)?Math.max(1,Math.min(21,$e)):Math.max(0,Math.min(20,$e));function Xr(yr){var sn=_t,Ln=qt,jn,ja,Po;if(Et==="c")Ln=or(yr)+Ln,yr="";else{yr=+yr;var Os=yr<0||1/yr<0;if(yr=isNaN(yr)?g:or(Math.abs(yr),$e),ot&&(yr=iT(yr)),Os&&+yr==0&&j!=="+"&&(Os=!1),sn=(Os?j==="("?j:v:j==="-"||j==="("?"":j)+sn,Ln=(Et==="s"?w_[8+b_/3]:"")+Ln+(Os&&j==="("?")":""),Mr){for(jn=-1,ja=yr.length;++jn<ja;)if(Po=yr.charCodeAt(jn),48>Po||Po>57){Ln=(Po===46?a+yr.slice(jn+1):yr.slice(jn))+Ln,yr=yr.slice(0,jn);break}}}Ne&&!te&&(yr=i(yr,Infinity));var iu=sn.length+yr.length+Ln.length,Us=iu<Ee?new Array(Ee-iu+1).join(O):"";switch(Ne&&te&&(yr=i(Us+yr,Us.length?Ee-Ln.length:Infinity),Us=""),k){case"<":yr=sn+yr+Ln+Us;break;case"=":yr=sn+Us+yr+Ln;break;case"^":yr=Us.slice(0,iu=Us.length>>1)+sn+yr+Ln+Us.slice(iu);break;default:yr=Us+sn+yr+Ln;break}return s(yr)}return Xr.toString=function(){return T+""},Xr}function C(T,O){var k=x((T=Kv(T),T.type="f",T)),j=Math.max(-8,Math.min(8,Math.floor(md(O)/3)))*3,X=Math.pow(10,-j),te=w_[8+j/3];return function(Ee){return k(X*Ee)+te}}return{format:x,formatPrefix:C}}var Qv,$0,T_;sT({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function sT(e){return Qv=oT(e),$0=Qv.format,T_=Qv.formatPrefix,Qv}function uT(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,md(i)-md(e))+1}function lT(e){return Math.max(0,-md(Math.abs(e)))}function cT(e,i,r,n){var a=H0(e,i,r),s;switch(n=Kv(n==null?",f":n),n.type){case"s":{var f=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=tT(a,f))&&(n.precision=s),T_(n,f)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=uT(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=lT(a))&&(n.precision=s-(n.type==="%")*2);break}}return $0(n)}function gd(e){var i=e.domain;return e.ticks=function(r){var n=i();return l_(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return cT(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,f=n[a],v=n[s],g;return v<f&&(g=f,f=v,v=g,g=a,a=s,s=g),g=Gv(f,v,r),g>0?(f=Math.floor(f/g)*g,v=Math.ceil(v/g)*g,g=Gv(f,v,r)):g<0&&(f=Math.ceil(f*g)/g,v=Math.floor(v*g)/g,g=Gv(f,v,r)),g>0?(n[a]=Math.floor(f/g)*g,n[s]=Math.ceil(v/g)*g,i(n)):g<0&&(n[a]=Math.ceil(f*g)/g,n[s]=Math.floor(v*g)/g,i(n)),e},e}function M_(){var e=x_(Qu,Qu);return e.copy=function(){return qv(e,M_())},tp.apply(e,arguments),gd(e)}function P_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Xv.call(n,X0),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return P_(e).unknown(i)},e=arguments.length?Xv.call(e,X0):[0,1],gd(r)}function I_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],f;return s<a&&(f=r,r=n,n=f,f=a,a=s,s=f),e[r]=i.floor(a),e[n]=i.ceil(s),e}function O_(e){return Math.log(e)}function R_(e){return Math.exp(e)}function fT(e){return-Math.log(-e)}function hT(e){return-Math.exp(-e)}function pT(e){return isFinite(e)?+("1e"+e):e<0?0:e}function dT(e){return e===10?pT:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function vT(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function L_(e){return function(i){return-e(-i)}}function mT(e){var i=e(O_,R_),r=i.domain,n=10,a,s;function f(){return a=vT(n),s=dT(n),r()[0]<0?(a=L_(a),s=L_(s),e(fT,hT)):e(O_,R_),i}return i.base=function(v){return arguments.length?(n=+v,f()):n},i.domain=function(v){return arguments.length?(r(v),f()):r()},i.ticks=function(v){var g=r(),x=g[0],C=g[g.length-1],T;(T=C<x)&&(O=x,x=C,C=O);var O=a(x),k=a(C),j,X,te,Ee=v==null?10:+v,Ne=[];if(!(n%1)&&k-O<Ee){if(O=Math.round(O)-1,k=Math.round(k)+1,x>0){for(;O<k;++O)for(X=1,j=s(O);X<n;++X)if(te=j*X,!(te<x)){if(te>C)break;Ne.push(te)}}else for(;O<k;++O)for(X=n-1,j=s(O);X>=1;--X)if(te=j*X,!(te<x)){if(te>C)break;Ne.push(te)}}else Ne=l_(O,k,Math.min(k-O,Ee)).map(s);return T?Ne.reverse():Ne},i.tickFormat=function(v,g){if(g==null&&(g=n===10?".0e":","),typeof g!="function"&&(g=$0(g)),v===Infinity)return g;v==null&&(v=10);var x=Math.max(1,n*v/i.ticks().length);return function(C){var T=C/s(Math.round(a(C)));return T*n<n-.5&&(T*=n),T<=x?g(C):""}},i.nice=function(){return r(I_(r(),{floor:function(v){return s(Math.floor(a(v)))},ceil:function(v){return s(Math.ceil(a(v)))}}))},i}function k_(){var e=mT(q0()).domain([1,10]);return e.copy=function(){return qv(e,k_()).base(e.base())},tp.apply(e,arguments),e}function D_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function F_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function gT(e){var i=1,r=e(D_(i),F_(i));return r.constant=function(n){return arguments.length?e(D_(i=+n),F_(i)):i},linearish(r)}function yT(){var e=gT(transformer());return e.copy=function(){return copy(e,yT()).constant(e.constant())},initRange.apply(e,arguments)}function B_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function _T(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function xT(e){return e<0?-e*e:e*e}function bT(e){var i=e(Qu,Qu),r=1;function n(){return r===1?e(Qu,Qu):r===.5?e(_T,xT):e(B_(r),B_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},gd(i)}function Q0(){var e=bT(q0());return e.copy=function(){return qv(e,Q0()).exponent(e.exponent())},tp.apply(e,arguments),e}function oI(){return Q0.apply(null,arguments).exponent(.5)}function N_(){var e=[],i=[],r=[],n;function a(){var f=0,v=Math.max(1,i.length);for(r=new Array(v-1);++f<v;)r[f-1]=jw(e,f/v);return s}function s(f){return isNaN(f=+f)?n:i[Vv(r,f)]}return s.invertExtent=function(f){var v=i.indexOf(f);return v<0?[NaN,NaN]:[v>0?r[v-1]:e[0],v<r.length?r[v]:e[e.length-1]]},s.domain=function(f){if(!arguments.length)return e.slice();e=[];for(var v=0,g=f.length,x;v<g;++v)x=f[v],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(Z0),a()},s.range=function(f){return arguments.length?(i=Np.call(f),a()):i.slice()},s.unknown=function(f){return arguments.length?(n=f,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return N_().domain(e).range(i).unknown(n)},tp.apply(s,arguments)}function z_(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function f(g){return g<=g?a[Vv(n,g,0,r)]:s}function v(){var g=-1;for(n=new Array(r);++g<r;)n[g]=((g+1)*i-(g-r)*e)/(r+1);return f}return f.domain=function(g){return arguments.length?(e=+g[0],i=+g[1],v()):[e,i]},f.range=function(g){return arguments.length?(r=(a=Np.call(g)).length-1,v()):a.slice()},f.invertExtent=function(g){var x=a.indexOf(g);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],i]:[n[x-1],n[x]]},f.unknown=function(g){return arguments.length&&(s=g),f},f.thresholds=function(){return n.slice()},f.copy=function(){return z_().domain([e,i]).range(a).unknown(s)},tp.apply(gd(f),arguments)}function U_(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[Vv(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=Np.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=Np.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var f=i.indexOf(s);return[e[f-1],e[f]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return U_().domain(e).range(i).unknown(r)},tp.apply(a,arguments)}var J0=new Date,em=new Date;function hl(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var f=a(s),v=a.ceil(s);return s-f<v-s?f:v},a.offset=function(s,f){return i(s=new Date(+s),f==null?1:Math.floor(f)),s},a.range=function(s,f,v){var g=[],x;if(s=a.ceil(s),v=v==null?1:Math.floor(v),!(s<f)||!(v>0))return g;do g.push(x=new Date(+s)),i(s,v),e(s);while(x<s&&s<f);return g},a.filter=function(s){return hl(function(f){if(f>=f)for(;e(f),!s(f);)f.setTime(f-1)},function(f,v){if(f>=f)if(v<0)for(;++v<=0;)for(;i(f,-1),!s(f););else for(;--v>=0;)for(;i(f,1),!s(f););})},r&&(a.count=function(s,f){return J0.setTime(+s),em.setTime(+f),e(J0),e(em),Math.floor(r(J0,em))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(f){return n(f)%s==0}:function(f){return a.count(0,f)%s==0}):a}),a}var tm=hl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});tm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:hl(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var yd=tm,sI=tm.range,Z_=hl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),ET=Z_,uI=Z_.range,Jv=1e3,lv=6e4,j_=36e5,V_=864e5,G_=6048e5;function zp(e){return hl(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*lv)/G_})}var rm=zp(0),e0=zp(1),ST=zp(2),CT=zp(3),_d=zp(4),AT=zp(5),wT=zp(6),lI=rm.range,cI=e0.range,fI=ST.range,hI=CT.range,pI=_d.range,dI=AT.range,vI=wT.range,H_=hl(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*lv)/V_},function(e){return e.getDate()-1}),nm=H_,mI=H_.range,W_=hl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Jv-e.getMinutes()*lv)},function(e,i){e.setTime(+e+i*j_)},function(e,i){return(i-e)/j_},function(e){return e.getHours()}),TT=W_,gI=W_.range,X_=hl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Jv)},function(e,i){e.setTime(+e+i*lv)},function(e,i){return(i-e)/lv},function(e){return e.getMinutes()}),MT=X_,yI=X_.range,Y_=hl(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*Jv)},function(e,i){return(i-e)/Jv},function(e){return e.getUTCSeconds()}),PT=Y_,_I=Y_.range,t0=hl(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});t0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?hl(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):t0};var IT=t0,xI=t0.range;function Up(e){return hl(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/G_})}var q_=Up(0),r0=Up(1),OT=Up(2),RT=Up(3),xd=Up(4),LT=Up(5),kT=Up(6),bI=q_.range,EI=r0.range,SI=OT.range,CI=RT.range,AI=xd.range,wI=LT.range,TI=kT.range,K_=hl(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/V_},function(e){return e.getUTCDate()-1}),$_=K_,MI=K_.range,im=hl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});im.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:hl(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var cv=im,PI=im.range;function am(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function om(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function fv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function DT(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,f=e.shortDays,v=e.months,g=e.shortMonths,x=hv(a),C=pv(a),T=hv(s),O=pv(s),k=hv(f),j=pv(f),X=hv(v),te=pv(v),Ee=hv(g),Ne=pv(g),$e={a:Os,A:iu,b:Us,B:kc,c:null,d:n1,e:n1,f:iM,g:dM,G:mM,H:tM,I:rM,j:nM,L:i1,m:aM,M:oM,p:gm,q:g0,Q:c1,s:f1,S:sM,u:uM,U:lM,V:cM,w:fM,W:hM,x:null,X:null,y:pM,Y:vM,Z:gM,"%":l1},ot={a:_P,A:xP,b:bP,B:EP,c:null,d:o1,e:o1,f:bM,g:OM,G:LM,H:yM,I:_M,j:xM,L:s1,m:EM,M:SM,p:SP,q:CP,Q:c1,s:f1,S:CM,u:AM,U:wM,V:TM,w:MM,W:PM,x:null,X:null,y:IM,Y:RM,Z:kM,"%":l1},Et={a:Xr,A:yr,b:sn,B:Ln,c:jn,d:t1,e:t1,f:$T,g:e1,G:J_,H:r1,I:r1,j:XT,L:KT,m:WT,M:YT,p:Mr,q:HT,Q:JT,s:eM,S:qT,u:UT,U:ZT,V:jT,w:zT,W:VT,x:ja,X:Po,y:e1,Y:J_,Z:GT,"%":QT};$e.x=_t(r,$e),$e.X=_t(n,$e),$e.c=_t(i,$e),ot.x=_t(r,ot),ot.X=_t(n,ot),ot.c=_t(i,ot);function _t(li,ka){return function(ao){var xn=[],Ml=-1,Xo=0,nc=li.length,ic,Vp,fb;for(ao instanceof Date||(ao=new Date(+ao));++Ml<nc;)li.charCodeAt(Ml)===37&&(xn.push(li.slice(Xo,Ml)),(Vp=Q_[ic=li.charAt(++Ml)])!=null?ic=li.charAt(++Ml):Vp=ic==="e"?" ":"0",(fb=ka[ic])&&(ic=fb(ao,Vp)),xn.push(ic),Xo=Ml+1);return xn.push(li.slice(Xo,Ml)),xn.join("")}}function qt(li,ka){return function(ao){var xn=fv(1900,void 0,1),Ml=or(xn,li,ao+="",0),Xo,nc;if(Ml!=ao.length)return null;if("Q"in xn)return new Date(xn.Q);if("s"in xn)return new Date(xn.s*1e3+("L"in xn?xn.L:0));if(ka&&!("Z"in xn)&&(xn.Z=0),"p"in xn&&(xn.H=xn.H%12+xn.p*12),xn.m===void 0&&(xn.m="q"in xn?xn.q:0),"V"in xn){if(xn.V<1||xn.V>53)return null;"w"in xn||(xn.w=1),"Z"in xn?(Xo=om(fv(xn.y,0,1)),nc=Xo.getUTCDay(),Xo=nc>4||nc===0?r0.ceil(Xo):r0(Xo),Xo=$_.offset(Xo,(xn.V-1)*7),xn.y=Xo.getUTCFullYear(),xn.m=Xo.getUTCMonth(),xn.d=Xo.getUTCDate()+(xn.w+6)%7):(Xo=am(fv(xn.y,0,1)),nc=Xo.getDay(),Xo=nc>4||nc===0?e0.ceil(Xo):e0(Xo),Xo=nm.offset(Xo,(xn.V-1)*7),xn.y=Xo.getFullYear(),xn.m=Xo.getMonth(),xn.d=Xo.getDate()+(xn.w+6)%7)}else("W"in xn||"U"in xn)&&("w"in xn||(xn.w="u"in xn?xn.u%7:"W"in xn?1:0),nc="Z"in xn?om(fv(xn.y,0,1)).getUTCDay():am(fv(xn.y,0,1)).getDay(),xn.m=0,xn.d="W"in xn?(xn.w+6)%7+xn.W*7-(nc+5)%7:xn.w+xn.U*7-(nc+6)%7);return"Z"in xn?(xn.H+=xn.Z/100|0,xn.M+=xn.Z%100,om(xn)):am(xn)}}function or(li,ka,ao,xn){for(var Ml=0,Xo=ka.length,nc=ao.length,ic,Vp;Ml<Xo;){if(xn>=nc)return-1;if(ic=ka.charCodeAt(Ml++),ic===37){if(ic=ka.charAt(Ml++),Vp=Et[ic in Q_?ka.charAt(Ml++):ic],!Vp||(xn=Vp(li,ao,xn))<0)return-1}else if(ic!=ao.charCodeAt(xn++))return-1}return xn}function Mr(li,ka,ao){var xn=x.exec(ka.slice(ao));return xn?(li.p=C[xn[0].toLowerCase()],ao+xn[0].length):-1}function Xr(li,ka,ao){var xn=k.exec(ka.slice(ao));return xn?(li.w=j[xn[0].toLowerCase()],ao+xn[0].length):-1}function yr(li,ka,ao){var xn=T.exec(ka.slice(ao));return xn?(li.w=O[xn[0].toLowerCase()],ao+xn[0].length):-1}function sn(li,ka,ao){var xn=Ee.exec(ka.slice(ao));return xn?(li.m=Ne[xn[0].toLowerCase()],ao+xn[0].length):-1}function Ln(li,ka,ao){var xn=X.exec(ka.slice(ao));return xn?(li.m=te[xn[0].toLowerCase()],ao+xn[0].length):-1}function jn(li,ka,ao){return or(li,i,ka,ao)}function ja(li,ka,ao){return or(li,r,ka,ao)}function Po(li,ka,ao){return or(li,n,ka,ao)}function Os(li){return f[li.getDay()]}function iu(li){return s[li.getDay()]}function Us(li){return g[li.getMonth()]}function kc(li){return v[li.getMonth()]}function gm(li){return a[+(li.getHours()>=12)]}function g0(li){return 1+~~(li.getMonth()/3)}function _P(li){return f[li.getUTCDay()]}function xP(li){return s[li.getUTCDay()]}function bP(li){return g[li.getUTCMonth()]}function EP(li){return v[li.getUTCMonth()]}function SP(li){return a[+(li.getUTCHours()>=12)]}function CP(li){return 1+~~(li.getUTCMonth()/3)}return{format:function(li){var ka=_t(li+="",$e);return ka.toString=function(){return li},ka},parse:function(li){var ka=qt(li+="",!1);return ka.toString=function(){return li},ka},utcFormat:function(li){var ka=_t(li+="",ot);return ka.toString=function(){return li},ka},utcParse:function(li){var ka=qt(li+="",!0);return ka.toString=function(){return li},ka}}}var Q_={"-":"",_:" ","0":"0"},xu=/^\s*\d+/,FT=/^%/,BT=/[\\^$*+?|[\]().{}]/g;function io(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function NT(e){return e.replace(BT,"\\$&")}function hv(e){return new RegExp("^(?:"+e.map(NT).join("|")+")","i")}function pv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function zT(e,i,r){var n=xu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function UT(e,i,r){var n=xu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function ZT(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function jT(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function VT(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function J_(e,i,r){var n=xu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function e1(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function GT(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function HT(e,i,r){var n=xu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function WT(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function t1(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function XT(e,i,r){var n=xu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function r1(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function YT(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function qT(e,i,r){var n=xu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function KT(e,i,r){var n=xu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function $T(e,i,r){var n=xu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function QT(e,i,r){var n=FT.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function JT(e,i,r){var n=xu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function eM(e,i,r){var n=xu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function n1(e,i){return io(e.getDate(),i,2)}function tM(e,i){return io(e.getHours(),i,2)}function rM(e,i){return io(e.getHours()%12||12,i,2)}function nM(e,i){return io(1+nm.count(yd(e),e),i,3)}function i1(e,i){return io(e.getMilliseconds(),i,3)}function iM(e,i){return i1(e,i)+"000"}function aM(e,i){return io(e.getMonth()+1,i,2)}function oM(e,i){return io(e.getMinutes(),i,2)}function sM(e,i){return io(e.getSeconds(),i,2)}function uM(e){var i=e.getDay();return i===0?7:i}function lM(e,i){return io(rm.count(yd(e)-1,e),i,2)}function a1(e){var i=e.getDay();return i>=4||i===0?_d(e):_d.ceil(e)}function cM(e,i){return e=a1(e),io(_d.count(yd(e),e)+(yd(e).getDay()===4),i,2)}function fM(e){return e.getDay()}function hM(e,i){return io(e0.count(yd(e)-1,e),i,2)}function pM(e,i){return io(e.getFullYear()%100,i,2)}function dM(e,i){return e=a1(e),io(e.getFullYear()%100,i,2)}function vM(e,i){return io(e.getFullYear()%1e4,i,4)}function mM(e,i){var r=e.getDay();return e=r>=4||r===0?_d(e):_d.ceil(e),io(e.getFullYear()%1e4,i,4)}function gM(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+io(i/60|0,"0",2)+io(i%60,"0",2)}function o1(e,i){return io(e.getUTCDate(),i,2)}function yM(e,i){return io(e.getUTCHours(),i,2)}function _M(e,i){return io(e.getUTCHours()%12||12,i,2)}function xM(e,i){return io(1+$_.count(cv(e),e),i,3)}function s1(e,i){return io(e.getUTCMilliseconds(),i,3)}function bM(e,i){return s1(e,i)+"000"}function EM(e,i){return io(e.getUTCMonth()+1,i,2)}function SM(e,i){return io(e.getUTCMinutes(),i,2)}function CM(e,i){return io(e.getUTCSeconds(),i,2)}function AM(e){var i=e.getUTCDay();return i===0?7:i}function wM(e,i){return io(q_.count(cv(e)-1,e),i,2)}function u1(e){var i=e.getUTCDay();return i>=4||i===0?xd(e):xd.ceil(e)}function TM(e,i){return e=u1(e),io(xd.count(cv(e),e)+(cv(e).getUTCDay()===4),i,2)}function MM(e){return e.getUTCDay()}function PM(e,i){return io(r0.count(cv(e)-1,e),i,2)}function IM(e,i){return io(e.getUTCFullYear()%100,i,2)}function OM(e,i){return e=u1(e),io(e.getUTCFullYear()%100,i,2)}function RM(e,i){return io(e.getUTCFullYear()%1e4,i,4)}function LM(e,i){var r=e.getUTCDay();return e=r>=4||r===0?xd(e):xd.ceil(e),io(e.getUTCFullYear()%1e4,i,4)}function kM(){return"+0000"}function l1(){return"%"}function c1(e){return+e}function f1(e){return Math.floor(+e/1e3)}var bd,h1,DM,FM,BM;NM({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function NM(e){return bd=DT(e),h1=bd.format,DM=bd.parse,FM=bd.utcFormat,BM=bd.utcParse,bd}var dv=1e3,vv=dv*60,mv=vv*60,gv=mv*24,zM=gv*7,p1=gv*30,sm=gv*365;function UM(e){return new Date(e)}function ZM(e){return e instanceof Date?+e:+new Date(+e)}function d1(e,i,r,n,a,s,f,v,g){var x=x_(Qu,Qu),C=x.invert,T=x.domain,O=g(".%L"),k=g(":%S"),j=g("%I:%M"),X=g("%I %p"),te=g("%a %d"),Ee=g("%b %d"),Ne=g("%B"),$e=g("%Y"),ot=[[f,1,dv],[f,5,5*dv],[f,15,15*dv],[f,30,30*dv],[s,1,vv],[s,5,5*vv],[s,15,15*vv],[s,30,30*vv],[a,1,mv],[a,3,3*mv],[a,6,6*mv],[a,12,12*mv],[n,1,gv],[n,2,2*gv],[r,1,zM],[i,1,p1],[i,3,3*p1],[e,1,sm]];function Et(qt){return(f(qt)<qt?O:s(qt)<qt?k:a(qt)<qt?j:n(qt)<qt?X:i(qt)<qt?r(qt)<qt?te:Ee:e(qt)<qt?Ne:$e)(qt)}function _t(qt,or,Mr,Xr){if(qt==null&&(qt=10),typeof qt=="number"){var yr=Math.abs(Mr-or)/qt,sn=a_(function(Ln){return Ln[2]}).right(ot,yr);sn===ot.length?(Xr=H0(or/sm,Mr/sm,qt),qt=e):sn?(sn=ot[yr/ot[sn-1][2]<ot[sn][2]/yr?sn-1:sn],Xr=sn[1],qt=sn[0]):(Xr=Math.max(H0(or,Mr,qt),1),qt=v)}return Xr==null?qt:qt.every(Xr)}return x.invert=function(qt){return new Date(C(qt))},x.domain=function(qt){return arguments.length?T(Xv.call(qt,ZM)):T().map(UM)},x.ticks=function(qt,or){var Mr=T(),Xr=Mr[0],yr=Mr[Mr.length-1],sn=yr<Xr,Ln;return sn&&(Ln=Xr,Xr=yr,yr=Ln),Ln=_t(qt,Xr,yr,or),Ln=Ln?Ln.range(Xr,yr+1):[],sn?Ln.reverse():Ln},x.tickFormat=function(qt,or){return or==null?Et:g(or)},x.nice=function(qt,or){var Mr=T();return(qt=_t(qt,Mr[0],Mr[Mr.length-1],or))?T(I_(Mr,qt)):x},x.copy=function(){return qv(x,d1(e,i,r,n,a,s,f,v,g))},x}function jM(){return tp.apply(d1(yd,ET,rm,nm,TT,MT,PT,IT,h1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function II(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function n0(){var e=0,i=1,r,n,a,s,f=Qu,v=!1,g;function x(C){return isNaN(C=+C)?g:f(a===0?.5:(C=(s(C)-r)*a,v?Math.max(0,Math.min(1,C)):C))}return x.domain=function(C){return arguments.length?(r=s(e=+C[0]),n=s(i=+C[1]),a=r===n?0:1/(n-r),x):[e,i]},x.clamp=function(C){return arguments.length?(v=!!C,x):v},x.interpolator=function(C){return arguments.length?(f=C,x):f},x.unknown=function(C){return arguments.length?(g=C,x):g},function(C){return s=C,r=C(e),n=C(i),a=r===n?0:1/(n-r),x}}function yv(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function v1(){var e=gd(n0()(Qu));return e.copy=function(){return yv(e,v1())},d_.apply(e,arguments)}function VM(){var e=loggish(n0()).domain([1,10]);return e.copy=function(){return yv(e,VM()).base(e.base())},initInterpolator.apply(e,arguments)}function GM(){var e=symlogish(n0());return e.copy=function(){return yv(e,GM()).constant(e.constant())},initInterpolator.apply(e,arguments)}function m1(){var e=powish(n0());return e.copy=function(){return yv(e,m1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function OI(){return m1.apply(null,arguments).exponent(.5)}function HM(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,f;a<s;++a)f=n[a],f!=null&&!isNaN(f=+f)&&e.push(f);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return HM(i).domain(e)},initInterpolator.apply(r,arguments)}function i0(){var e=0,i=.5,r=1,n,a,s,f,v,g=Qu,x,C=!1,T;function O(k){return isNaN(k=+k)?T:(k=.5+((k=+x(k))-a)*(k<a?f:v),g(C?Math.max(0,Math.min(1,k)):k))}return O.domain=function(k){return arguments.length?(n=x(e=+k[0]),a=x(i=+k[1]),s=x(r=+k[2]),f=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O):[e,i,r]},O.clamp=function(k){return arguments.length?(C=!!k,O):C},O.interpolator=function(k){return arguments.length?(g=k,O):g},O.unknown=function(k){return arguments.length?(T=k,O):T},function(k){return x=k,n=k(e),a=k(i),s=k(r),f=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O}}function g1(){var e=gd(i0()(Qu));return e.copy=function(){return yv(e,g1())},d_.apply(e,arguments)}function WM(){var e=loggish(i0()).domain([.1,1,10]);return e.copy=function(){return copy(e,WM()).base(e.base())},initInterpolator.apply(e,arguments)}function XM(){var e=symlogish(i0());return e.copy=function(){return copy(e,XM()).constant(e.constant())},initInterpolator.apply(e,arguments)}function y1(){var e=powish(i0());return e.copy=function(){return copy(e,y1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function RI(){return y1.apply(null,arguments).exponent(.5)}var rc,_1,x1,b1,um,E1;function S1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function C1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?S1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var YM=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,qM=(rc={},(0,A.Z)(rc,Mo.LINEAR,M_),(0,A.Z)(rc,Mo.POWER,Q0),(0,A.Z)(rc,Mo.LOG,k_),(0,A.Z)(rc,Mo.IDENTITY,P_),(0,A.Z)(rc,Mo.SEQUENTIAL,v1),(0,A.Z)(rc,Mo.TIME,jM),(0,A.Z)(rc,Mo.QUANTILE,N_),(0,A.Z)(rc,Mo.QUANTIZE,z_),(0,A.Z)(rc,Mo.THRESHOLD,U_),(0,A.Z)(rc,Mo.CAT,Yv),(0,A.Z)(rc,Mo.DIVERGING,g1),rc),KM=(_1=(0,zr.b2)(),x1=(0,zr.f3)(Yt.IGlobalConfigService),_1(b1=(um=function(){function e(){(0,ht.Z)(this,e),mi(this,"configService",E1,this),(0,A.Z)(this,"scaleCache",{}),(0,A.Z)(this,"scaleOptions",{})}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;v.length!==0&&a.caculateScalesForAttributes(f||[],v)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;return a.caculateScalesForAttributes(f||[],v),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes();if(f){var v=r.getSource().data.dataArray;if(v.length===0)return;var g=f.filter(function(x){return x.needRescale});g.length&&a.caculateScalesForAttributes(g,v)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var f=s.scale,v=s.name;f.names=a.parseFields(s.scale.field||[]);var g=[];f.names.forEach(function(x){var C;g.push(a.createScale(x,s.name,(C=s.scale)===null||C===void 0?void 0:C.values,n))}),g.some(function(x){return x.type===qh.VARIABLE})?(f.type=qh.VARIABLE,g.forEach(function(x){if(!f.callback){var C,T,O,k,j;f.values&&f.values!=="text"&&((C=x.option)===null||C===void 0?void 0:C.type)!==Mo.DIVERGING&&((T=x.option)===null||T===void 0?void 0:T.type)!==Mo.SEQUENTIAL?x.scale.range(f.values):((O=x.option)===null||O===void 0?void 0:O.type)===Mo.CAT?x.scale.range(x.option.domain):(((k=x.option)===null||k===void 0?void 0:k.type)===Mo.DIVERGING||((j=x.option)===null||j===void 0?void 0:j.type)===Mo.SEQUENTIAL)&&x.scale.interpolator(Vw.hD(f.values))}})):(f.type=qh.CONSTANT,f.defaultValues=g.map(function(x,C){return x.scale(f.names[C])})),f.scalers=g.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:qa()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var f,v,g=this.scaleOptions[n]&&((f=this.scaleOptions[n])===null||f===void 0?void 0:f.field)===r?this.scaleOptions[n]:this.scaleOptions[r],x={field:r,scale:void 0,type:qh.VARIABLE,option:g};if(!s||!s.length)return g&&g.type?x.scale=this.createDefaultScale(g):(x.scale=Yv([r]),x.type=qh.CONSTANT),x;var C=(v=s.find(function(k){return!cl()(k[r])}))===null||v===void 0?void 0:v[r];if(this.isNumber(r)||cl()(C)&&!g)x.scale=Yv([r]),x.type=qh.CONSTANT;else{var T=g&&g.type||this.getDefaultType(C);a==="text"&&(T=Mo.CAT);var O=this.createScaleConfig(T,r,g,s);x.scale=this.createDefaultScale(O),x.option=O}return x}},{key:"getDefaultType",value:function(r){var n=Mo.LINEAR;return typeof r=="string"&&(n=YM.test(r)?Mo.TIME:Mo.CAT),n}},{key:"createScaleConfig",value:function(r,n,a,s){var f={type:r},v=(s==null?void 0:s.map(function(C){return C[n]}))||[];if(a!=null&&a.domain)f.domain=a==null?void 0:a.domain;else if(r!==Mo.CAT&&r!==Mo.QUANTILE&&r!==Mo.DIVERGING)f.domain=s_(v);else if(r===Mo.CAT)f.domain=Kd()(v);else if(r===Mo.QUANTILE)f.domain=v;else if(r===Mo.DIVERGING){var g=s_(v),x=(a==null?void 0:a.neutral)!==void 0?a==null?void 0:a.neutral:(g[0]+g[1])/2;f.domain=[g[0],x,g[1]]}return C1(C1({},f),a)}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=r.unknown,f=r.clamp,v=r.nice,g=qM[n]();return a&&g.domain&&g.domain(a),s&&g.unknown(s),f!==void 0&&g.clamp&&g.clamp(f),v!==void 0&&g.nice&&g.nice(v),g}}]),e}(),E1=bi(um.prototype,"configService",[x1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um))||b1),A1,w1,T1,M1,a0,P1,I1;function O1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $M(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?O1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var QM=(A1=(0,zr.b2)(),w1=(0,zr.f3)(Yt.ICameraService),T1=(0,zr.f3)(Yt.IRendererService),A1(M1=(a0=function(){function e(){(0,ht.Z)(this,e),mi(this,"cameraService",P1,this),mi(this,"rendererService",I1,this)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms($M({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),P1=bi(a0.prototype,"cameraService",[w1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I1=bi(a0.prototype,"rendererService",[T1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a0))||M1),R1,L1,JM=(R1=(0,zr.b2)(),R1(L1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||L1),k1,D1,e5=(k1=(0,zr.b2)(),k1(D1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||D1),F1,B1,t5=["type"];function N1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _v(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?N1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var z1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},r5={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},n5={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},i5={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},LI=null;function a5(e){var i={u_DirectionalLights:new Array(3).fill(_v({},n5)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(_v({},i5)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[r5]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,f=(0,wc.Z)(r,t5),v=z1[s].lights,g=z1[s].num,x=i[g];i[v][x]=_v(_v({},i[v][x]),f),i[g]++}),i}var o5=(F1=(0,zr.b2)(),F1(B1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(_v({},a5()))})})}}]),e}())||B1),U1,Z1,j1,lm,V1,s5=(U1=(0,zr.b2)(),Z1=(0,zr.f3)(Yt.IGlobalConfigService),U1(j1=(lm=function(){function e(){(0,ht.Z)(this,e),mi(this,"configService",V1,this),(0,A.Z)(this,"enabled",void 0)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,f=n.postProcessingPassFactory,v=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var g=r.getLayerConfig(),x=g.enableMultiPassRenderer,C=g.passes,T=C===void 0?[]:C;a.enabled=!!x&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=Vg(r,T,f,v),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var g=s.getViewportSize(),x=g.width,C=g.height;r.multiPassRenderer.resize(x,C)}})}}]),e}(),V1=bi(lm.prototype,"configService",[Z1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm))||j1),G1,H1,o0={NONE:0,ENCODE:1,HIGHLIGHT:2},u5=(G1=(0,zr.b2)(),G1(H1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var f=!0;s.registerStyleAttribute({name:"pickingColor",type:On.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:G.FLOAT},size:3,update:function(g,x){var C=g.id;return f?pu(C):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),v=f.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:o0.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),v=f.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:o0.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(f){var v=r.getLayerConfig(),g=v.highlightColor,x=v.activeMix,C=x===void 0?0:x,T=typeof g=="string"?Ea(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Js(new Uint8Array(f))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:o0.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:T.map(function(k){return k*255}),u_activeMix:C})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(f){var v=r.getLayerConfig(),g=v.selectColor,x=v.selectMix,C=x===void 0?0:x,T=typeof g=="string"?Ea(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Js(new Uint8Array(f))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:o0.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:T.map(function(k){return k*255}),u_activeMix:C,u_CurrentSelectedId:f,u_SelectColor:T.map(function(k){return k*255}),u_EnableSelect:1})})})}}]),e}())||H1),W1,X1,l5=(W1=(0,zr.b2)(),W1(X1=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:On.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:G.FLOAT},size:3,update:function(a,s,f){return f.length===2?[f[0],f[1],0]:[f[0],f[1],f[2]]}}}),r.registerStyleAttribute({name:"filter",type:On.Attribute,descriptor:{name:"filter",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(a,s){var f=a.filter;return f?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:On.Attribute,descriptor:{name:"a_Color",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:4,update:function(a,s){var f=a.color;return!f||!f.length?[1,1,1,1]:f}}}),r.registerStyleAttribute({name:"vertexId",type:On.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:G.DYNAMIC_DRAW,data:[],type:G.FLOAT},size:1,update:function(a,s,f,v){return[s]}}})}}]),e}())||X1),Y1,q1,K1,$1,Q1,J1,Ed,ex,tx,rx,nx,c5=(Y1=(0,zr.b2)(),q1=(0,zr.f3)(Yt.ICameraService),K1=(0,zr.f3)(Yt.ICoordinateSystemService),$1=(0,zr.f3)(Yt.IRendererService),Q1=(0,zr.f3)(Yt.IMapService),Y1(J1=(Ed=function(){function e(){(0,ht.Z)(this,e),mi(this,"cameraService",ex,this),mi(this,"coordinateSystemService",tx,this),mi(this,"rendererService",rx,this),mi(this,"mapService",nx,this)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){if(n.coordinateSystemService.refresh(),a==="GAODE2.x"){var v=n.getLayerCenter(r);n.mapService.map.customCoords.setCenter(v),n.mapService.setCustomCoordCenter(v),s=n.mapService.map.customCoords.getMVPMatrix(),f=n.mapService.getCustomCoordCenter()}var g=n.rendererService.getViewportSize(),x=g.width,C=g.height;r.models.forEach(function(T){var O;T.addUniforms((O={},(0,A.Z)(O,Rp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,A.Z)(O,Rp.ViewMatrix,n.cameraService.getViewMatrix()),(0,A.Z)(O,Rp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,A.Z)(O,Rp.Zoom,n.cameraService.getZoom()),(0,A.Z)(O,Rp.ZoomScale,n.cameraService.getZoomScale()),(0,A.Z)(O,Rp.FocalDistance,n.cameraService.getFocalDistance()),(0,A.Z)(O,Rp.CameraPosition,n.cameraService.getCameraPosition()),(0,A.Z)(O,An.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,A.Z)(O,An.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,A.Z)(O,An.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,A.Z)(O,An.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,A.Z)(O,An.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,A.Z)(O,An.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,A.Z)(O,An.Mvp,s),(0,A.Z)(O,"u_SceneCenterMKT",f),(0,A.Z)(O,"u_ViewportSize",[x,C]),(0,A.Z)(O,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,A.Z)(O,"u_DevicePixelRatio",fa.devicePixelRatio),(0,A.Z)(O,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,A.Z)(O,"u_shaderPick",Number(r.getShaderPickStat())),O))})})}},{key:"getLayerCenter",value:function(r){var n=r.getSource();return n.center}}]),e}(),ex=bi(Ed.prototype,"cameraService",[q1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tx=bi(Ed.prototype,"coordinateSystemService",[K1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rx=bi(Ed.prototype,"rendererService",[$1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nx=bi(Ed.prototype,"mapService",[Q1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ed))||J1),ix,ax,f5=(ix=(0,zr.b2)(),ix(ax=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||ax),ox,sx,h5=(ox=(0,zr.b2)(),ox(sx=function(){function e(){(0,ht.Z)(this,e)}return(0,Pt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],f=a.getLayerStyleAttribute("filter"),v=a.getLayerStyleAttribute("shape");if(f&&f.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(g){return g.needRegenerateVertices=!1});return}s.filter(function(g){return g.needRegenerateVertices}).forEach(function(g){a.updateAttributeByFeatureRange(g.name,r.getEncodedData(),g.featureRange.startIndex,g.featureRange.endIndex),g.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(f){return f.needRegenerateVertices}).forEach(function(f){a.updateAttributeByFeatureRange(f.name,r.getEncodedData(),f.featureRange.startIndex,f.featureRange.endIndex),f.needRegenerateVertices=!1})}}]),e}())||sx);tc.bind(Yt.ILayerPlugin).to(Nw).inRequestScope(),tc.bind(Yt.ILayerPlugin).to(l5).inRequestScope(),tc.bind(Yt.ILayerPlugin).to(KM).inRequestScope(),tc.bind(Yt.ILayerPlugin).to(Bw).inRequestScope(),tc.bind(Yt.ILayerPlugin).to(e5).inRequestScope(),tc.bind(Yt.ILayerPlugin).to(h5).inRequestScope(),tc.bind(Yt.ILayerPlugin).to(f5).inRequestScope(),tc.bind(Yt.ILayerPlugin).to(s5).inRequestScope(),tc.bind(Yt.ILayerPlugin).to(c5).inRequestScope(),tc.bind(Yt.ILayerPlugin).to(QM).inRequestScope(),tc.bind(Yt.ILayerPlugin).to(o5).inRequestScope(),tc.bind(Yt.ILayerPlugin).to(u5).inRequestScope(),tc.bind(Yt.ILayerPlugin).to(JM).inRequestScope();var p5=z(88307),d5=z.n(p5),v5=function(){function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"attribute",void 0),(0,A.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,f=r.normalized,v=r.size,g=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:f||!1,divisor:g||0},v&&(this.attribute.size=v)}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),yh,xv,_h,Rc,bv,rp,Ev,s0,Df,Zp,ku,Ff,Bf,u0,m5=(yh={},(0,A.Z)(yh,G.POINTS,"points"),(0,A.Z)(yh,G.LINES,"lines"),(0,A.Z)(yh,G.LINE_LOOP,"line loop"),(0,A.Z)(yh,G.LINE_STRIP,"line strip"),(0,A.Z)(yh,G.TRIANGLES,"triangles"),(0,A.Z)(yh,G.TRIANGLE_FAN,"triangle fan"),(0,A.Z)(yh,G.TRIANGLE_STRIP,"triangle strip"),yh),ux=(xv={},(0,A.Z)(xv,G.STATIC_DRAW,"static"),(0,A.Z)(xv,G.DYNAMIC_DRAW,"dynamic"),(0,A.Z)(xv,G.STREAM_DRAW,"stream"),xv),cm=(_h={},(0,A.Z)(_h,G.BYTE,"int8"),(0,A.Z)(_h,G.UNSIGNED_INT,"int16"),(0,A.Z)(_h,G.INT,"int32"),(0,A.Z)(_h,G.UNSIGNED_BYTE,"uint8"),(0,A.Z)(_h,G.UNSIGNED_SHORT,"uint16"),(0,A.Z)(_h,G.UNSIGNED_INT,"uint32"),(0,A.Z)(_h,G.FLOAT,"float"),_h),g5=(Rc={},(0,A.Z)(Rc,G.ALPHA,"alpha"),(0,A.Z)(Rc,G.LUMINANCE,"luminance"),(0,A.Z)(Rc,G.LUMINANCE_ALPHA,"luminance alpha"),(0,A.Z)(Rc,G.RGB,"rgb"),(0,A.Z)(Rc,G.RGBA,"rgba"),(0,A.Z)(Rc,G.RGBA4,"rgba4"),(0,A.Z)(Rc,G.RGB5_A1,"rgb5 a1"),(0,A.Z)(Rc,G.RGB565,"rgb565"),(0,A.Z)(Rc,G.DEPTH_COMPONENT,"depth"),(0,A.Z)(Rc,G.DEPTH_STENCIL,"depth stencil"),Rc),y5=(bv={},(0,A.Z)(bv,G.DONT_CARE,"dont care"),(0,A.Z)(bv,G.NICEST,"nice"),(0,A.Z)(bv,G.FASTEST,"fast"),bv),lx=(rp={},(0,A.Z)(rp,G.NEAREST,"nearest"),(0,A.Z)(rp,G.LINEAR,"linear"),(0,A.Z)(rp,G.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,A.Z)(rp,G.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,A.Z)(rp,G.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,A.Z)(rp,G.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),rp),cx=(Ev={},(0,A.Z)(Ev,G.REPEAT,"repeat"),(0,A.Z)(Ev,G.CLAMP_TO_EDGE,"clamp"),(0,A.Z)(Ev,G.MIRRORED_REPEAT,"mirror"),Ev),_5=(s0={},(0,A.Z)(s0,G.NONE,"none"),(0,A.Z)(s0,G.BROWSER_DEFAULT_WEBGL,"browser"),s0),x5=(Df={},(0,A.Z)(Df,G.NEVER,"never"),(0,A.Z)(Df,G.ALWAYS,"always"),(0,A.Z)(Df,G.LESS,"less"),(0,A.Z)(Df,G.LEQUAL,"lequal"),(0,A.Z)(Df,G.GREATER,"greater"),(0,A.Z)(Df,G.GEQUAL,"gequal"),(0,A.Z)(Df,G.EQUAL,"equal"),(0,A.Z)(Df,G.NOTEQUAL,"notequal"),Df),fx=(Zp={},(0,A.Z)(Zp,G.FUNC_ADD,"add"),(0,A.Z)(Zp,G.MIN_EXT,"min"),(0,A.Z)(Zp,G.MAX_EXT,"max"),(0,A.Z)(Zp,G.FUNC_SUBTRACT,"subtract"),(0,A.Z)(Zp,G.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Zp),l0=(ku={},(0,A.Z)(ku,G.ZERO,"zero"),(0,A.Z)(ku,G.ONE,"one"),(0,A.Z)(ku,G.SRC_COLOR,"src color"),(0,A.Z)(ku,G.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,A.Z)(ku,G.SRC_ALPHA,"src alpha"),(0,A.Z)(ku,G.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,A.Z)(ku,G.DST_COLOR,"dst color"),(0,A.Z)(ku,G.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,A.Z)(ku,G.DST_ALPHA,"dst alpha"),(0,A.Z)(ku,G.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,A.Z)(ku,G.CONSTANT_COLOR,"constant color"),(0,A.Z)(ku,G.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,A.Z)(ku,G.CONSTANT_ALPHA,"constant alpha"),(0,A.Z)(ku,G.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,A.Z)(ku,G.SRC_ALPHA_SATURATE,"src alpha saturate"),ku),b5=(Ff={},(0,A.Z)(Ff,G.NEVER,"never"),(0,A.Z)(Ff,G.ALWAYS,"always"),(0,A.Z)(Ff,G.LESS,"less"),(0,A.Z)(Ff,G.LEQUAL,"lequal"),(0,A.Z)(Ff,G.GREATER,"greater"),(0,A.Z)(Ff,G.GEQUAL,"gequal"),(0,A.Z)(Ff,G.EQUAL,"equal"),(0,A.Z)(Ff,G.NOTEQUAL,"notequal"),Ff),Sd=(Bf={},(0,A.Z)(Bf,G.ZERO,"zero"),(0,A.Z)(Bf,G.KEEP,"keep"),(0,A.Z)(Bf,G.REPLACE,"replace"),(0,A.Z)(Bf,G.INVERT,"invert"),(0,A.Z)(Bf,G.INCR,"increment"),(0,A.Z)(Bf,G.DECR,"decrement"),(0,A.Z)(Bf,G.INCR_WRAP,"increment wrap"),(0,A.Z)(Bf,G.DECR_WRAP,"decrement wrap"),Bf),E5=(u0={},(0,A.Z)(u0,G.FRONT,"front"),(0,A.Z)(u0,G.BACK,"back"),u0),S5=function(){function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:ux[a||G.STATIC_DRAW],type:cm[s||G.UNSIGNED_BYTE]})}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),C5=function(){function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,f=r.count;this.elements=i.elements({data:n,usage:ux[a||G.STATIC_DRAW],type:cm[s||G.UNSIGNED_BYTE],count:f})}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),A5=function(){function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,f=r.colors,v=r.depth,g=r.stencil,x={width:n,height:a};Array.isArray(f)&&(x.colors=f.map(function(C){return C.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=i.framebuffer(x)}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),w5=z(36719),T5=z.n(w5),M5=z(68630),P5=z.n(M5);function hx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Lc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?hx(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var I5=function(){function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"reGl",void 0),(0,A.Z)(this,"destroyed",!1),(0,A.Z)(this,"drawCommand",void 0),(0,A.Z)(this,"drawPickCommand",void 0),(0,A.Z)(this,"drawParams",void 0),(0,A.Z)(this,"options",void 0),(0,A.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,f=r.uniforms,v=r.primitive,g=r.count,x=r.elements,C=r.depth,T=r.blend,O=r.stencil,k=r.cull,j=r.instances,X={};this.options=r,f&&(this.uniforms=this.extractUniforms(f),Object.keys(f).forEach(function($e){X[$e]=i.prop($e)}));var te={};Object.keys(s).forEach(function($e){te[$e]=s[$e].get()});var Ee={attributes:te,frag:a,uniforms:X,vert:n,blend:{},primitive:m5[v===void 0?G.TRIANGLES:v]};j&&(Ee.instances=j),g&&(Ee.count=g),x&&(Ee.elements=x.get()),this.initDepthDrawParams({depth:C},Ee),this.initBlendDrawParams({blend:T},Ee),this.initStencilDrawParams({stencil:O},Ee),this.initCullDrawParams({cull:k},Ee),this.drawCommand=i(Ee);var Ne=vu()(Ee);Ne.blend=Lc(Lc({},Ne.blend),{},{enable:!1}),this.drawPickCommand=i(Ne),this.drawParams=Ee}return(0,Pt.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var a={};Object.keys(r).forEach(function(f){a[f]=r[f].get()}),this.drawParams.attributes=a,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var s=vu()(this.drawParams);s.blend=Lc(Lc({},s.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(s)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(s){n[s]=r[s].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var a=vu()(this.drawParams);a.blend=Lc(Lc({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}},{key:"addUniforms",value:function(r){this.uniforms=Lc(Lc({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=Lc(Lc({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(f){var v=(0,We.Z)(a[f]);v==="boolean"||v==="number"||Array.isArray(a[f])||a[f].BYTES_PER_ELEMENT?s[f]=a[f]:s[f]=a[f].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:x5[a.func||G.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,f=a.func,v=a.equation,g=a.color,x=g===void 0?[0,0,0,0]:g;n.blend={enable:!!s,func:{srcRGB:l0[f&&f.srcRGB||G.SRC_ALPHA],srcAlpha:l0[f&&f.srcAlpha||G.SRC_ALPHA],dstRGB:l0[f&&f.dstRGB||G.ONE_MINUS_SRC_ALPHA],dstAlpha:l0[f&&f.dstAlpha||G.ONE_MINUS_SRC_ALPHA]},equation:{rgb:fx[v&&v.rgb||G.FUNC_ADD],alpha:fx[v&&v.alpha||G.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,f=a.mask,v=f===void 0?-1:f,g=a.func,x=g===void 0?{cmp:G.ALWAYS,ref:0,mask:-1}:g,C=a.opFront,T=C===void 0?{fail:G.KEEP,zfail:G.KEEP,zpass:G.KEEP}:C,O=a.opBack,k=O===void 0?{fail:G.KEEP,zfail:G.KEEP,zpass:G.KEEP}:O;n.stencil={enable:!!s,mask:v,func:Lc(Lc({},x),{},{cmp:b5[x.cmp]}),opFront:{fail:Sd[T.fail],zfail:Sd[T.zfail],zpass:Sd[T.zpass]},opBack:{fail:Sd[k.fail],zfail:Sd[k.zfail],zpass:Sd[k.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,f=a.face,v=f===void 0?G.BACK:f;n.cull={enable:!!s,face:E5[v]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var f=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||T5()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}P5()(n)&&Object.keys(n).forEach(function(v){f.extractUniformsRecursively(v,n[v],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(v,g){Object.keys(v).forEach(function(x){f.extractUniformsRecursively(x,v[x],a,"".concat(s&&s+".").concat(r,"[").concat(g,"]"))})})}}]),e}(),O5=function(){function e(i,r){(0,ht.Z)(this,e),(0,A.Z)(this,"texture",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?G.UNSIGNED_BYTE:a,f=r.width,v=r.height,g=r.flipY,x=g===void 0?!1:g,C=r.format,T=C===void 0?G.RGBA:C,O=r.mipmap,k=O===void 0?!1:O,j=r.wrapS,X=j===void 0?G.CLAMP_TO_EDGE:j,te=r.wrapT,Ee=te===void 0?G.CLAMP_TO_EDGE:te,Ne=r.aniso,$e=Ne===void 0?0:Ne,ot=r.alignment,Et=ot===void 0?1:ot,_t=r.premultiplyAlpha,qt=_t===void 0?!1:_t,or=r.mag,Mr=or===void 0?G.NEAREST:or,Xr=r.min,yr=Xr===void 0?G.NEAREST:Xr,sn=r.colorSpace,Ln=sn===void 0?G.BROWSER_DEFAULT_WEBGL:sn,jn=r.x,ja=jn===void 0?0:jn,Po=r.y,Os=Po===void 0?0:Po,iu=r.copy,Us=iu===void 0?!1:iu;this.width=f,this.height=v;var kc={width:f,height:v,type:cm[s],format:g5[T],wrapS:cx[X],wrapT:cx[Ee],mag:lx[Mr],min:lx[yr],alignment:Et,flipY:x,colorSpace:_5[Ln],premultiplyAlpha:qt,aniso:$e,x:ja,y:Os,copy:Us};n&&(kc.data=n),typeof k=="number"?kc.mipmap=y5[k]:typeof k=="boolean"&&(kc.mipmap=k),this.texture=i.texture(kc)}return(0,Pt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),px,dx,R5=(px=(0,zr.b2)(),px(dx=function(){function e(){var i=this;(0,ht.Z)(this,e),(0,A.Z)(this,"extensionObject",void 0),(0,A.Z)(this,"gl",void 0),(0,A.Z)(this,"$container",void 0),(0,A.Z)(this,"canvas",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDirty",void 0),(0,A.Z)(this,"createModel",function(r){return new I5(i.gl,r)}),(0,A.Z)(this,"createAttribute",function(r){return new v5(i.gl,r)}),(0,A.Z)(this,"createBuffer",function(r){return new S5(i.gl,r)}),(0,A.Z)(this,"createElements",function(r){return new C5(i.gl,r)}),(0,A.Z)(this,"createTexture2D",function(r){return new O5(i.gl,r)}),(0,A.Z)(this,"createFramebuffer",function(r){return new A5(i.gl,r)}),(0,A.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,A.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,f=r.framebuffer,v=f===void 0?null:f,g={color:n,depth:a,stencil:s};g.framebuffer=v===null?v:v.get(),i.gl.clear(g)}),(0,A.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,f=r.height;i.gl._gl.viewport(n,a,s,f),i.width=s,i.height=f,i.gl._refresh()}),(0,A.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,f=r.width,v=r.height,g={x:a,y:s,width:f,height:v};return n&&(g.framebuffer=n.get()),i.gl.read(g)}),(0,A.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,A.Z)(this,"getContainer",function(){if(Ji)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,A.Z)(this,"getCanvas",function(){return i.canvas}),(0,A.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,A.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,Pt.Z)(e,[{key:"init",value:function(){var i=(0,E.Z)(M().mark(function n(a,s){var f=this;return M().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.canvas=a,g.next=3,new Promise(function(x,C){d5()({canvas:f.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(O,k){(O||!k)&&C(O),x(k)}})});case 3:this.gl=g.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return g.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||dx);function vx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function mx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?vx(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var L5=function(){function e(i){(0,ht.Z)(this,e),(0,A.Z)(this,"sceneService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"controlService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"markerService",void 0),(0,A.Z)(this,"popupService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,f=M2();this.container=f,n.setContainer(f,r,a,s),f.bind(Yt.IRendererService).to(R5).inSingletonScope(),this.sceneService=f.get(Yt.ISceneService),this.mapService=f.get(Yt.IMapService),this.iconService=f.get(Yt.IIconService),this.fontService=f.get(Yt.IFontService),this.controlService=f.get(Yt.IControlService),this.layerService=f.get(Yt.ILayerService),this.markerService=f.get(Yt.IMarkerService),this.interactionService=f.get(Yt.IInteractionService),this.popupService=f.get(Yt.IPopupService),Ji?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,Pt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=av(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r);var a=r.getLayerConfig();if(a){var s=a.mask,f=a.maskfence,v=a.maskColor,g=v===void 0?"#000":v,x=a.maskOpacity,C=x===void 0?0:x;if(s&&f){var T=new Dw().source(f).shape("fill").color(g).style({opacity:C});this.addMask(T,r.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(r,n){var a=this.getLayer(n);if(a){var s=av(this.container);r.setContainer(s,this.container),a.addMaskLayer(r),this.sceneService.addLayer(r)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,nn.Z)(a,2),f=s[0],v=s[1];n.fontService.addIconFont(f,v)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){Ji?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){D0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){D0.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){D0.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,f=a.animate;this.mapService.fitBounds(r,n||mx(mx({},s),{},{animate:f}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Yt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Ia(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new Y2({position:a}))}}]),e}(),kI="2.8.42";function gx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function DI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?gx(Object(r),!0).forEach(function(n){k5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function k5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function FI(e,i){return N5(e)||B5(e,i)||F5(e,i)||D5()}function D5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function F5(e,i){if(!!e){if(typeof e=="string")return yx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yx(e,i)}}function yx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function B5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function N5(e){if(Array.isArray(e))return e}var BI=null,NI=null,_x,fm,xx;function bx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ex(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?bx(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var z5=(_x=k0(Yt.IGlobalConfigService),fm=function(){function e(i){(0,ht.Z)(this,e),mi(this,"configService",xx,this),(0,A.Z)(this,"config",void 0),this.config=i}return(0,Pt.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(Yt.MapConfig).toConstantValue(Ex(Ex({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(Yt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),xx=bi(fm.prototype,"configService",[_x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm),U5=z(6158),Sv=z.n(U5);function Cv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function c0(e,i){var r=ee([],i,e);return Tv(r,r,1/r[3]),r}function zI(e,i){var r=e%i;return r<0?i+r:r}function UI(e,i,r){return r*i+(1-r)*e}function jp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var af=Math.PI,Sx=af/4,xh=af/180,Cx=180/af,hm=512,pm=4003e4,Z5=1.5;function Ax(e){return Math.pow(2,e)}function j5(e){return Math.log2(e)}function f0(e,i){var r=(0,nn.Z)(e,2),n=r[0],a=r[1];jp(Number.isFinite(n)&&Number.isFinite(i)),jp(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=hm;var s=n*xh,f=a*xh,v=i*(s+af)/(2*af),g=i*(af-Math.log(Math.tan(Sx+f*.5)))/(2*af);return[v,g]}function dm(e,i){var r=(0,nn.Z)(e,2),n=r[0],a=r[1];i*=hm;var s=n/i*(2*af)-af,f=2*(Math.atan(Math.exp(af-a/i*(2*af)))-Sx);return[s*Cx,f*Cx]}function ZI(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*xh);return j5(pm*r)-9}function Tx(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,f=s===void 0?!1:s;a=a!==void 0?a:Ax(n),jp(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var v={},g=hm*a,x=Math.cos(i*xh),C=g/360,T=C/x,O=g/pm/x;if(v.pixelsPerMeter=[O,-O,O],v.metersPerPixel=[1/O,-1/O,1/O],v.pixelsPerDegree=[C,-T,O],v.degreesPerPixel=[1/C,-1/T,1/O],f){var k=xh*Math.tan(i*xh)/x,j=C*k/2,X=g/pm*k,te=X/T*O;v.pixelsPerDegree2=[0,-j,X],v.pixelsPerMeter2=[te,0,te]}return v}function jI(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],f=_slicedToArray(i,3),v=f[0],g=f[1],x=f[2],C=1,T=Tx({longitude:n,latitude:a,scale:C,highPrecision:!0}),O=T.pixelsPerMeter,k=T.pixelsPerMeter2,j=f0(e,C);j[0]+=v*(O[0]+k[0]*g),j[1]+=g*(O[1]+k[1]*g);var X=dm(j,C),te=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[X[0],X[1],te]:X}function V5(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,f=s===void 0?null:s,v=e.flipY,g=v===void 0?!1:v,x=Cv();return ci(x,x,[0,0,-a]),ei(x,x,[1,1,1/i]),Qr(x,x,-r*xh),ui(x,x,n*xh),g&&ei(x,x,[1,-1,1]),f&&ci(x,x,Ja.negate([],f)),x}function G5(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?Z5:n,s=e.pitch,f=s===void 0?0:s,v=e.nearZMultiplier,g=v===void 0?1:v,x=e.farZMultiplier,C=x===void 0?1:x,T=f*xh,O=Math.atan(.5/a),k=Math.sin(O)*a/Math.sin(Math.PI/2-T-O),j=Math.cos(Math.PI/2-T)*k+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:g,far:j*C}}function H5(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,f=e.farZMultiplier,v=G5({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:f}),g=v.fov,x=v.aspect,C=v.near,T=v.far,O=ri([],g,x,C,T);return O}function W5(e,i){var r=(0,nn.Z)(e,3),n=r[0],a=r[1],s=r[2],f=s===void 0?0:s;return jp(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(f)),c0(i,[n,a,f,1])}function Mx(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,nn.Z)(e,3),a=n[0],s=n[1],f=n[2];if(jp(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(f)){var v=c0(i,[a,s,f,1]);return v}var g=c0(i,[a,s,0,1]),x=c0(i,[a,s,1,1]),C=g[2],T=x[2],O=C===T?0:((r||0)-C)/(T-C);return Ei.t7([],g,x,O)}var Px=Cv(),X5=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?Px:a,f=i.projectionMatrix,v=f===void 0?Px:f;(0,ht.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=v;var g=Cv();Nr(g,g,this.projectionMatrix),Nr(g,g,this.viewMatrix),this.viewProjectionMatrix=g;var x=Cv();ei(x,x,[this.width/2,-this.height/2,1]),ci(x,x,[1,-1,0]),Nr(x,x,this.viewProjectionMatrix);var C=Vr(Cv(),x);if(!C)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=C,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Pt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Ye(r.projectionMatrix,this.projectionMatrix)&&Ye(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,f=this.projectPosition(r),v=W5(f,this.pixelProjectionMatrix),g=(0,nn.Z)(v,2),x=g[0],C=g[1],T=s?C:this.height-C;return r.length===2?[x,T]:[x,T,v[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,f=n.targetZ,v=(0,nn.Z)(r,3),g=v[0],x=v[1],C=v[2],T=s?x:this.height-x,O=f&&f*this.pixelsPerMeter,k=Mx([g,T,C],this.pixelUnprojectionMatrix,O),j=this.unprojectPosition(k),X=(0,nn.Z)(j,3),te=X[0],Ee=X[1],Ne=X[2];return Number.isFinite(C)?[te,Ee,Ne]:Number.isFinite(f)?[te,Ee,f]:[te,Ee]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,nn.Z)(n,2),s=a[0],f=a[1],v=(r[2]||0)*this.pixelsPerMeter;return[s,f,v]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,nn.Z)(n,2),s=a[0],f=a[1],v=(r[2]||0)/this.pixelsPerMeter;return[s,f,v]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function Y5(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,f=e.maxZoom,v=f===void 0?24:f,g=e.padding,x=g===void 0?0:g,C=e.offset,T=C===void 0?[0,0]:C,O=(0,nn.Z)(n,2),k=(0,nn.Z)(O[0],2),j=k[0],X=k[1],te=(0,nn.Z)(O[1],2),Ee=te[0],Ne=te[1];if(Number.isFinite(x)){var $e=x;x={top:$e,bottom:$e,left:$e,right:$e}}else jp(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var ot=new Ix({width:i,height:r,longitude:0,latitude:0,zoom:0}),Et=ot.project([j,Ne]),_t=ot.project([Ee,X]),qt=[Math.max(Math.abs(_t[0]-Et[0]),s),Math.max(Math.abs(_t[1]-Et[1]),s)],or=[i-x.left-x.right-Math.abs(T[0])*2,r-x.top-x.bottom-Math.abs(T[1])*2];jp(or[0]>0&&or[1]>0);var Mr=or[0]/qt[0],Xr=or[1]/qt[1],yr=(x.right-x.left)/2/Mr,sn=(x.bottom-x.top)/2/Xr,Ln=[(_t[0]+Et[0])/2+yr,(_t[1]+Et[1])/2+sn],jn=ot.unproject(Ln),ja=ot.zoom+Math.log2(Math.abs(Math.min(Mr,Xr)));return{longitude:jn[0],latitude:jn[1],zoom:Math.min(ja,v)}}var Ix=function(e){(0,Pr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,f=n.latitude,v=f===void 0?0:f,g=n.longitude,x=g===void 0?0:g,C=n.zoom,T=C===void 0?0:C,O=n.pitch,k=O===void 0?0:O,j=n.bearing,X=j===void 0?0:j,te=n.altitude,Ee=te===void 0?1.5:te,Ne=n.nearZMultiplier,$e=n.farZMultiplier;(0,ht.Z)(this,i),a=a||1,s=s||1;var ot=Ax(T);Ee=Math.max(.75,Ee);var Et=f0([x,v],ot);Et[2]=0;var _t=H5({width:a,height:s,pitch:k,bearing:X,altitude:Ee,nearZMultiplier:Ne||1/s,farZMultiplier:$e||1.01}),qt=V5({height:s,center:Et,pitch:k,bearing:X,altitude:Ee,flipY:!0});return r=(0,an.Z)(this,(0,mt.Z)(i).call(this,{width:a,height:s,viewMatrix:qt,projectionMatrix:_t})),r.latitude=v,r.longitude=x,r.zoom=T,r.pitch=k,r.bearing=X,r.altitude=Ee,r.scale=ot,r.center=Et,r.pixelsPerMeter=Tx((0,ue.Z)((0,ue.Z)(r))).pixelsPerMeter[2],Object.freeze((0,ue.Z)((0,ue.Z)(r))),r}return(0,Pt.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return f0(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return dm(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,f=Mx(s,this.pixelUnprojectionMatrix),v=f0(a,this.scale),g=Ei.IH([],v,Ei.tk([],f)),x=Ei.IH([],this.center,g);return dm(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,f=this.height,v=Y5(Object.assign({width:s,height:f,bounds:n},a)),g=v.longitude,x=v.latitude,C=v.zoom;return new i({width:s,height:f,longitude:g,latitude:x,zoom:C})}}]),i}(X5),q5=function(){function e(){(0,ht.Z)(this,e),(0,A.Z)(this,"viewport",void 0)}return(0,Pt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,f=r.bearing,v=r.viewportHeight,g=r.viewportWidth;this.viewport=new Ix({width:g,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:f})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),K5=function(){function e(i){(0,ht.Z)(this,e),(0,A.Z)(this,"size",1e4),this.size=i||1e4}return(0,Pt.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),a=this.mercatorYfromLat(r[1]);return[n,a]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),a=this.latFromMercatorY(r[1]);return[n,a]}}]),e}(),Ox={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},$5=["id","attributionControl","style","token","rotation","mapInstance"],Rx,Lx,kx,Dx,Fx,Bx,Cd,Nx,zx,Ux,Zx;function jx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Q5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?jx(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function J5(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}J5(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Sv();var Vx={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},e3=0,t3=12,Gx="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",r3=(Rx=(0,zr.b2)(),Lx=(0,zr.f3)(Yt.MapConfig),kx=(0,zr.f3)(Yt.IGlobalConfigService),Dx=(0,zr.f3)(Yt.ICoordinateSystemService),Fx=(0,zr.f3)(Yt.IEventEmitter),Rx(Bx=(Cd=function(){function e(){var i=this;(0,ht.Z)(this,e),(0,A.Z)(this,"version",zs.MAPBOX),(0,A.Z)(this,"map",void 0),(0,A.Z)(this,"simpleMapCoord",new K5),(0,A.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),mi(this,"config",Nx,this),mi(this,"configService",zx,this),mi(this,"coordinateSystemService",Ux,this),mi(this,"eventEmitter",Zx,this),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"markerContainer",void 0),(0,A.Z)(this,"cameraChangedCallback",void 0),(0,A.Z)(this,"$mapContainer",void 0),(0,A.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,f=s===void 0?t3:s;i.viewport.getZoom()>f?i.coordinateSystemService.setCoordinateSystem(Hn.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(Hn.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,Pt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Wa("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){U2.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(Vx[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(Vx[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,f=a.y;return[s-n.x,f-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,f=s===void 0?0:s,v=a.y,g=v===void 0?0:v,x=a.z,C=x===void 0?0:x;return{x:f,y:g,z:C}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),g=v.meterInMercatorCoordinateUnits(),x=ar();return ci(x,x,Ja.fromValues(v.x-f.x,v.y-f.y,v.z||0-f.z)),ei(x,x,Ja.fromValues(g*s[0],-g*s[1],g*s[2])),Qr(x,x,a[0]),$n(x,x,a[1]),ui(x,x,a[2]),x}},{key:"init",value:function(){var i=(0,E.Z)(M().mark(function n(){var a,s,f,v,g,x,C,T,O,k,j,X,te;return M().wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:a=this.config,s=a.id,f=s===void 0?"map":s,v=a.attributionControl,g=v===void 0?!1:v,x=a.style,C=x===void 0?"light":x,T=a.token,O=T===void 0?Gx:T,k=a.rotation,j=k===void 0?0:k,X=a.mapInstance,te=(0,wc.Z)(a,$5),this.viewport=new q5,!X&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),O===Gx&&C!=="blank"&&!window.mapboxgl.accessToken&&!X&&console.warn(this.configService.getSceneWarninfo("MapToken")),!X&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=O),X?(this.map=X,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(f),this.map=new window.mapboxgl.Map(Q5({container:this.$mapContainer,style:this.getMapStyle(C),attributionControl:g,bearing:j},te))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Ne.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),f=1;f<a;f++)s[f-1]=arguments[f];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),f=1;f<a;f++)s[f-1]=arguments[f];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(Sv()).LngLat(r[0],r[1]),s=new(Sv()).LngLat(n[0],n[1]),f=a.distanceTo(s),v=Sv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),g=Sv().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=v.x,C=v.y,T=g.x,O=g.y,k=Math.sqrt(Math.pow(x-T,2)+Math.pow(C-O,2))*4194304*2;return k/f}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+e3++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:Ox[r]?Ox[r]:r}}]),e}(),Nx=bi(Cd.prototype,"config",[Lx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zx=bi(Cd.prototype,"configService",[kx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ux=bi(Cd.prototype,"coordinateSystemService",[Dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zx=bi(Cd.prototype,"eventEmitter",[Fx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd))||Bx);function n3(e){var i=i3();return function(){var n=(0,mt.Z)(e),a;if(i){var s=(0,mt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function i3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function a3(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}a3(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var o3=function(e){(0,Pr.Z)(r,e);var i=n3(r);function r(){return(0,ht.Z)(this,r),i.apply(this,arguments)}return(0,Pt.Z)(r,[{key:"getServiceConstructor",value:function(){return r3}}]),r}(z5);function Hx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Wx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hx(Object(r),!0).forEach(function(n){s3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function s3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function u3(e,i){return h3(e)||f3(e,i)||c3(e,i)||l3()}function l3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function c3(e,i){if(!!e){if(typeof e=="string")return Xx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xx(e,i)}}function Xx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function f3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function h3(e){if(Array.isArray(e))return e}var p3=re.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,f=(0,re.createRef)(),v=(0,re.useState)(),g=u3(v,2),x=g[0],C=g[1];return(0,re.useEffect)(function(){var T=new L5(Wx(Wx({id:f.current},a),{},{map:new o3(n)}));return T.on("loaded",function(){C(T),s&&s(T)}),function(){T.destroy()}},[]),(0,re.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,re.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),(0,re.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),(0,re.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),(0,re.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),re.createElement(m.Provider,{value:x},(0,re.createElement)("div",{ref:f,style:i,className:r},x&&e.children))}),d3=p3;function Yx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function VI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Yx(Object(r),!0).forEach(function(n){v3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function v3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function GI(e,i){return _3(e)||y3(e,i)||g3(e,i)||m3()}function m3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function g3(e,i){if(!!e){if(typeof e=="string")return qx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qx(e,i)}}function qx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function y3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function _3(e){if(Array.isArray(e))return e}var HI=null,WI=null;function Kx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function XI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Kx(Object(r),!0).forEach(function(n){x3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function x3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function YI(e,i){return C3(e)||S3(e,i)||E3(e,i)||b3()}function b3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function E3(e,i){if(!!e){if(typeof e=="string")return $x(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $x(e,i)}}function $x(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function S3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function C3(e){if(Array.isArray(e))return e}var qI=null,KI=null;function $I(e,i){return M3(e)||T3(e,i)||w3(e,i)||A3()}function A3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function w3(e,i){if(!!e){if(typeof e=="string")return Qx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qx(e,i)}}function Qx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function T3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function M3(e){if(Array.isArray(e))return e}var QI=null,JI=null;function Jx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function eO(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jx(Object(r),!0).forEach(function(n){P3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function P3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function tO(e,i){if(e==null)return{};var r=I3(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function I3(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var rO=null,eb=z(73935);function tb(e,i){return k3(e)||L3(e,i)||R3(e,i)||O3()}function O3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function R3(e,i){if(!!e){if(typeof e=="string")return rb(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rb(e,i)}}function rb(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function L3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function k3(e){if(Array.isArray(e))return e}var nb=re.useEffect,ib=re.useState,D3=/\B([A-Z])/g,F3=function(i){return i.replace(D3,"-$1").toLowerCase()};function nO(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=ib(),f=tb(s,2),v=f[0],g=f[1],x=useSceneValue(),C=ib(function(){return document.createElement("div")}),T=tb(C,1),O=T[0];return nb(function(){var k=new Control({position:a});return k.onAdd=function(){if(i&&(O.className=i),r){var j=Object.keys(r).map(function(X){return"".concat(F3(X),":").concat(r[X])}).join(";");O.style.cssText=j}return O},k.onRemove=function(){},g(k),x.addControl(k),function(){x.removeControl(k)}},[]),nb(function(){v&&v.setPosition(a||"bottomleft")},[a]),createPortal(n,O)}var ab=(0,re.createContext)({});function iO(){return useContext(ab)}var Nf=z(96486),aO=re.useEffect,B3=re.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Nf.isEqual),oO=re.useEffect,N3=re.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Nf.isEqual),sO=re.useEffect,z3=re.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Nf.isEqual),U3=re.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Nf.isEqual),Z3=re.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Nf.isEqual),uO=re.useEffect,j3=re.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Nf.isEqual),V3=re.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Nf.isEqual),G3=re.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Nf.isEqual),H3=["data"];function W3(e,i){if(e==null)return{};var r=X3(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function X3(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var Y3=re.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=W3(n,H3);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Nf.isEqual),lO=re.useEffect,q3=re.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Nf.isEqual);function K3(e,i){return eP(e)||J3(e,i)||Q3(e,i)||$3()}function $3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Q3(e,i){if(!!e){if(typeof e=="string")return ob(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ob(e,i)}}function ob(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function J3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function eP(e){if(Array.isArray(e))return e}var Av=re.useEffect,tP=re.useState;function sb(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,f=i.size,v=i.scale,g=i.active,x=i.select,C=i.filter,T=i.animate,O=i.options,k=i.onLayerLoaded,j=de(),X=tP(function(){var Ne;switch(e){case"polygonLayer":Ne=new Wy(O);break;case"lineLayer":Ne=new Ay(O);break;case"pointLayer":Ne=new Hy(O);break;case"heatmapLayer":Ne=new SS(O);break;case"rasterLayer":Ne=new Aw(O);break;case"imageLayer":Ne=new by(O);break;case"citybuildingLayer":Ne=new YE(O);break;default:Ne=new Wy(O)}return Ne.on("inited",function(){k&&k(Ne,j)}),Ne}),te=K3(X,1),Ee=te[0];return Av(function(){return j.addLayer(Ee),function(){j.removeLayer(Ee)}},[]),Av(function(){Ee.inited&&O&&Ee.updateLayerConfig(O)},[O==null?void 0:O.minZoom,O==null?void 0:O.maxZoom,O==null?void 0:O.visible]),Av(function(){Ee.inited&&(O==null?void 0:O.zIndex)&&Ee.setIndex(O.zIndex)},[O==null?void 0:O.zIndex]),Av(function(){Ee.inited&&(O==null?void 0:O.blend)&&Ee.setBlend(O.blend)},[O==null?void 0:O.blend]),Av(function(){j.render()}),re.createElement(ab.Provider,{value:Ee},re.createElement(Y3,{layer:Ee,source:r}),v&&re.createElement(Z3,{layer:Ee,scale:v}),n&&re.createElement(z3,{layer:Ee,color:n}),f&&re.createElement(G3,{layer:Ee,size:f}),a&&re.createElement(V3,{layer:Ee,shape:a}),s&&re.createElement(q3,{layer:Ee,style:s}),g&&re.createElement(B3,{layer:Ee,active:g}),x&&re.createElement(j3,{layer:Ee,select:x}),C&&re.createElement(U3,{layer:Ee,filter:C}),T&&re.createElement(N3,{layer:Ee,animate:T}),i.children)}var cO=null,fO=null,rP=re.memo(function(i){return sb("pointLayer",i)}),nP=re.memo(function(i){return sb("heatmapLayer",i)}),hO=null,pO=null,dO=null,vO=re.useEffect,mO=null,gO=null;function h0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?h0=function(r){return typeof r}:h0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},h0(e)}function ub(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function p0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ub(Object(r),!0).forEach(function(n){iP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ub(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function aP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function lb(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function oP(e,i,r){return i&&lb(e.prototype,i),r&&lb(e,r),e}function sP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&vm(e,i)}function vm(e,i){return vm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},vm(e,i)}function uP(e){var i=fP();return function(){var n=d0(e),a;if(i){var s=d0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return lP(this,a)}}function lP(e,i){if(i&&(h0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cP(e)}function cP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function d0(e){return d0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},d0(e)}var yO=function(e){sP(r,e);var i=uP(r);function r(n){var a;return aP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return oP(r,[{key:"componentDidMount",value:function(){var a,s=this.props,f=s.lnglat,v=s.children,g=s.option,x=s.lngLat,C=new zg(p0(p0({},g),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));f&&C.setLnglat(f),x&&C.setLnglat(x),v&&C.setDOMContent(this.el),this.popup=C,this.scene.addPopup(C)}},{key:"componentDidUpdate",value:function(a){var s,f,v,g,x,C,T=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(f=a.lnglat)===null||f===void 0?void 0:f.lat],O=Array.isArray(this.props.lnglat)?this.props.lnglat:[(v=this.props)===null||v===void 0||(g=v.lnglat)===null||g===void 0?void 0:g.lng,(x=this.props)===null||x===void 0||(C=x.lnglat)===null||C===void 0?void 0:C.lat],k=T.toString()!==O.toString();if(k){var j;this.popup.remove(),this.popup=new zg(p0(p0({},this.props.option),{},{stopPropagation:(j=this.props.option)===null||j===void 0?void 0:j.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return re.createElement(m.Consumer,{},function(s){return s&&(a.scene=s),(0,eb.createPortal)(a.props.children,a.el)})}}]),r}(re.PureComponent);function v0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?v0=function(r){return typeof r}:v0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},v0(e)}function hP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function cb(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function pP(e,i,r){return i&&cb(e.prototype,i),r&&cb(e,r),e}function dP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&mm(e,i)}function mm(e,i){return mm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},mm(e,i)}function vP(e){var i=yP();return function(){var n=m0(e),a;if(i){var s=m0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return mP(this,a)}}function mP(e,i){if(i&&(v0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gP(e)}function gP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function m0(e){return m0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},m0(e)}var _O=function(e){dP(r,e);var i=vP(r);function r(n){var a;return hP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return pP(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,f=a.children,v=a.option,g=a.onMarkerLoaded,x=new kg(v);s&&x.setLnglat(s),f&&x.setElement(this.el),this.marker=x,g&&g(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(a){var s,f=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());f&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return re.createElement(m.Consumer,{},function(s){return s&&(a.scene=s),(0,eb.createPortal)(a.props.children,a.el)})}}]),r}(re.PureComponent),xO=re.useEffect,bO=null,EO=null,SO=re.useEffect,CO=null},66213:function(It,$,z){"use strict";z.d($,{Z:function(){return m}});var ie=z(77608);function re(de,Z){for(;!Object.prototype.hasOwnProperty.call(de,Z)&&(de=(0,ie.Z)(de),de!==null););return de}function m(){return typeof Reflect!="undefined"&&Reflect.get?m=Reflect.get.bind():m=function(Z,ce,fe){var Le=re(Z,ce);if(!!Le){var J=Object.getOwnPropertyDescriptor(Le,ce);return J.get?J.get.call(arguments.length<3?Z:fe):J.value}},m.apply(this,arguments)}},31795:function(It,$,z){var ie=z(75752);It.exports.geometry=re,It.exports.ring=de;function re(ce){var fe=0,Le;switch(ce.type){case"Polygon":return m(ce.coordinates);case"MultiPolygon":for(Le=0;Le<ce.coordinates.length;Le++)fe+=m(ce.coordinates[Le]);return fe;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Le=0;Le<ce.geometries.length;Le++)fe+=re(ce.geometries[Le]);return fe}}function m(ce){var fe=0;if(ce&&ce.length>0){fe+=Math.abs(de(ce[0]));for(var Le=1;Le<ce.length;Le++)fe-=Math.abs(de(ce[Le]))}return fe}function de(ce){var fe,Le,J,Xe,et,Ze,yt,rr=0,bt=ce.length;if(bt>2){for(yt=0;yt<bt;yt++)yt===bt-2?(Xe=bt-2,et=bt-1,Ze=0):yt===bt-1?(Xe=bt-1,et=0,Ze=1):(Xe=yt,et=yt+1,Ze=yt+2),fe=ce[Xe],Le=ce[et],J=ce[Ze],rr+=(Z(J[0])-Z(fe[0]))*Math.sin(Z(Le[1]));rr=rr*ie.RADIUS*ie.RADIUS/2}return rr}function Z(ce){return ce*Math.PI/180}},38163:function(It,$,z){var ie=z(31795);It.exports=re;function re(Le,J){switch(Le&&Le.type||null){case"FeatureCollection":return Le.features=Le.features.map(m(re,J)),Le;case"GeometryCollection":return Le.geometries=Le.geometries.map(m(re,J)),Le;case"Feature":return Le.geometry=re(Le.geometry,J),Le;case"Polygon":case"MultiPolygon":return de(Le,J);default:return Le}}function m(Le,J){return function(Xe){return Le(Xe,J)}}function de(Le,J){return Le.type==="Polygon"?Le.coordinates=Z(Le.coordinates,J):Le.type==="MultiPolygon"&&(Le.coordinates=Le.coordinates.map(m(Z,J))),Le}function Z(Le,J){J=!!J,Le[0]=ce(Le[0],J);for(var Xe=1;Xe<Le.length;Xe++)Le[Xe]=ce(Le[Xe],!J);return Le}function ce(Le,J){return fe(Le)===J?Le:Le.reverse()}function fe(Le){return ie.ring(Le)>=0}},53645:function(){},9187:function(It){"use strict";It.exports=$,It.exports.default=$;function $(A,Ce,De){De=De||2;var Tt=Ce&&Ce.length,gt=Tt?Ce[0]*De:A.length,Bt=z(A,0,gt,De,!0),Kt=[];if(!Bt||Bt.next===Bt.prev)return Kt;var Cr,Qn,vn,fi,Gn,ii,hi;if(Tt&&(Bt=fe(A,Ce,Bt,De)),A.length>80*De){Cr=vn=A[0],Qn=fi=A[1];for(var Wn=De;Wn<gt;Wn+=De)Gn=A[Wn],ii=A[Wn+1],Gn<Cr&&(Cr=Gn),ii<Qn&&(Qn=ii),Gn>vn&&(vn=Gn),ii>fi&&(fi=ii);hi=Math.max(vn-Cr,fi-Qn),hi=hi!==0?1/hi:0}return re(Bt,Kt,De,Cr,Qn,hi),Kt}function z(A,Ce,De,Tt,gt){var Bt,Kt;if(gt===Jr(A,Ce,De,Tt)>0)for(Bt=Ce;Bt<De;Bt+=Tt)Kt=Qt(Bt,A[Bt],A[Bt+1],Kt);else for(Bt=De-Tt;Bt>=Ce;Bt-=Tt)Kt=Qt(Bt,A[Bt],A[Bt+1],Kt);return Kt&&it(Kt,Kt.next)&&(Er(Kt),Kt=Kt.next),Kt}function ie(A,Ce){if(!A)return A;Ce||(Ce=A);var De=A,Tt;do if(Tt=!1,!De.steiner&&(it(De,De.next)||at(De.prev,De,De.next)===0)){if(Er(De),De=Ce=De.prev,De===De.next)break;Tt=!0}else De=De.next;while(Tt||De!==Ce);return Ce}function re(A,Ce,De,Tt,gt,Bt,Kt){if(!!A){!Kt&&Bt&&Ze(A,Tt,gt,Bt);for(var Cr=A,Qn,vn;A.prev!==A.next;){if(Qn=A.prev,vn=A.next,Bt?de(A,Tt,gt,Bt):m(A)){Ce.push(Qn.i/De),Ce.push(A.i/De),Ce.push(vn.i/De),Er(A),A=vn.next,Cr=vn.next;continue}if(A=vn,A===Cr){Kt?Kt===1?(A=Z(ie(A),Ce,De),re(A,Ce,De,Tt,gt,Bt,2)):Kt===2&&ce(A,Ce,De,Tt,gt,Bt):re(ie(A),Ce,De,Tt,gt,Bt,1);break}}}}function m(A){var Ce=A.prev,De=A,Tt=A.next;if(at(Ce,De,Tt)>=0)return!1;for(var gt=A.next.next;gt!==A.prev;){if(Xt(Ce.x,Ce.y,De.x,De.y,Tt.x,Tt.y,gt.x,gt.y)&&at(gt.prev,gt,gt.next)>=0)return!1;gt=gt.next}return!0}function de(A,Ce,De,Tt){var gt=A.prev,Bt=A,Kt=A.next;if(at(gt,Bt,Kt)>=0)return!1;for(var Cr=gt.x<Bt.x?gt.x<Kt.x?gt.x:Kt.x:Bt.x<Kt.x?Bt.x:Kt.x,Qn=gt.y<Bt.y?gt.y<Kt.y?gt.y:Kt.y:Bt.y<Kt.y?Bt.y:Kt.y,vn=gt.x>Bt.x?gt.x>Kt.x?gt.x:Kt.x:Bt.x>Kt.x?Bt.x:Kt.x,fi=gt.y>Bt.y?gt.y>Kt.y?gt.y:Kt.y:Bt.y>Kt.y?Bt.y:Kt.y,Gn=rr(Cr,Qn,Ce,De,Tt),ii=rr(vn,fi,Ce,De,Tt),hi=A.prevZ,Wn=A.nextZ;hi&&hi.z>=Gn&&Wn&&Wn.z<=ii;){if(hi!==A.prev&&hi!==A.next&&Xt(gt.x,gt.y,Bt.x,Bt.y,Kt.x,Kt.y,hi.x,hi.y)&&at(hi.prev,hi,hi.next)>=0||(hi=hi.prevZ,Wn!==A.prev&&Wn!==A.next&&Xt(gt.x,gt.y,Bt.x,Bt.y,Kt.x,Kt.y,Wn.x,Wn.y)&&at(Wn.prev,Wn,Wn.next)>=0))return!1;Wn=Wn.nextZ}for(;hi&&hi.z>=Gn;){if(hi!==A.prev&&hi!==A.next&&Xt(gt.x,gt.y,Bt.x,Bt.y,Kt.x,Kt.y,hi.x,hi.y)&&at(hi.prev,hi,hi.next)>=0)return!1;hi=hi.prevZ}for(;Wn&&Wn.z<=ii;){if(Wn!==A.prev&&Wn!==A.next&&Xt(gt.x,gt.y,Bt.x,Bt.y,Kt.x,Kt.y,Wn.x,Wn.y)&&at(Wn.prev,Wn,Wn.next)>=0)return!1;Wn=Wn.nextZ}return!0}function Z(A,Ce,De){var Tt=A;do{var gt=Tt.prev,Bt=Tt.next.next;!it(gt,Bt)&&Vt(gt,Tt,Tt.next,Bt)&&Je(gt,Bt)&&Je(Bt,gt)&&(Ce.push(gt.i/De),Ce.push(Tt.i/De),Ce.push(Bt.i/De),Er(Tt),Er(Tt.next),Tt=A=Bt),Tt=Tt.next}while(Tt!==A);return ie(Tt)}function ce(A,Ce,De,Tt,gt,Bt){var Kt=A;do{for(var Cr=Kt.next.next;Cr!==Kt.prev;){if(Kt.i!==Cr.i&&Ct(Kt,Cr)){var Qn=Qe(Kt,Cr);Kt=ie(Kt,Kt.next),Qn=ie(Qn,Qn.next),re(Kt,Ce,De,Tt,gt,Bt),re(Qn,Ce,De,Tt,gt,Bt);return}Cr=Cr.next}Kt=Kt.next}while(Kt!==A)}function fe(A,Ce,De,Tt){var gt=[],Bt,Kt,Cr,Qn,vn;for(Bt=0,Kt=Ce.length;Bt<Kt;Bt++)Cr=Ce[Bt]*Tt,Qn=Bt<Kt-1?Ce[Bt+1]*Tt:A.length,vn=z(A,Cr,Qn,Tt,!1),vn===vn.next&&(vn.steiner=!0),gt.push(bt(vn));for(gt.sort(Le),Bt=0;Bt<gt.length;Bt++)De=J(gt[Bt],De),De=ie(De,De.next);return De}function Le(A,Ce){return A.x-Ce.x}function J(A,Ce){var De=Xe(A,Ce);if(!De)return Ce;var Tt=Qe(De,A),gt=ie(De,De.next);return ie(Tt,Tt.next),Ce===De?gt:Ce}function Xe(A,Ce){var De=Ce,Tt=A.x,gt=A.y,Bt=-Infinity,Kt;do{if(gt<=De.y&&gt>=De.next.y&&De.next.y!==De.y){var Cr=De.x+(gt-De.y)*(De.next.x-De.x)/(De.next.y-De.y);if(Cr<=Tt&&Cr>Bt){if(Bt=Cr,Cr===Tt){if(gt===De.y)return De;if(gt===De.next.y)return De.next}Kt=De.x<De.next.x?De:De.next}}De=De.next}while(De!==Ce);if(!Kt)return null;if(Tt===Bt)return Kt;var Qn=Kt,vn=Kt.x,fi=Kt.y,Gn=Infinity,ii;De=Kt;do Tt>=De.x&&De.x>=vn&&Tt!==De.x&&Xt(gt<fi?Tt:Bt,gt,vn,fi,gt<fi?Bt:Tt,gt,De.x,De.y)&&(ii=Math.abs(gt-De.y)/(Tt-De.x),Je(De,A)&&(ii<Gn||ii===Gn&&(De.x>Kt.x||De.x===Kt.x&&et(Kt,De)))&&(Kt=De,Gn=ii)),De=De.next;while(De!==Qn);return Kt}function et(A,Ce){return at(A.prev,A,Ce.prev)<0&&at(Ce.next,A,A.next)<0}function Ze(A,Ce,De,Tt){var gt=A;do gt.z===null&&(gt.z=rr(gt.x,gt.y,Ce,De,Tt)),gt.prevZ=gt.prev,gt.nextZ=gt.next,gt=gt.next;while(gt!==A);gt.prevZ.nextZ=null,gt.prevZ=null,yt(gt)}function yt(A){var Ce,De,Tt,gt,Bt,Kt,Cr,Qn,vn=1;do{for(De=A,A=null,Bt=null,Kt=0;De;){for(Kt++,Tt=De,Cr=0,Ce=0;Ce<vn&&(Cr++,Tt=Tt.nextZ,!!Tt);Ce++);for(Qn=vn;Cr>0||Qn>0&&Tt;)Cr!==0&&(Qn===0||!Tt||De.z<=Tt.z)?(gt=De,De=De.nextZ,Cr--):(gt=Tt,Tt=Tt.nextZ,Qn--),Bt?Bt.nextZ=gt:A=gt,gt.prevZ=Bt,Bt=gt;De=Tt}Bt.nextZ=null,vn*=2}while(Kt>1);return A}function rr(A,Ce,De,Tt,gt){return A=32767*(A-De)*gt,Ce=32767*(Ce-Tt)*gt,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,Ce=(Ce|Ce<<8)&16711935,Ce=(Ce|Ce<<4)&252645135,Ce=(Ce|Ce<<2)&858993459,Ce=(Ce|Ce<<1)&1431655765,A|Ce<<1}function bt(A){var Ce=A,De=A;do(Ce.x<De.x||Ce.x===De.x&&Ce.y<De.y)&&(De=Ce),Ce=Ce.next;while(Ce!==A);return De}function Xt(A,Ce,De,Tt,gt,Bt,Kt,Cr){return(gt-Kt)*(Ce-Cr)-(A-Kt)*(Bt-Cr)>=0&&(A-Kt)*(Tt-Cr)-(De-Kt)*(Ce-Cr)>=0&&(De-Kt)*(Bt-Cr)-(gt-Kt)*(Tt-Cr)>=0}function Ct(A,Ce){return A.next.i!==Ce.i&&A.prev.i!==Ce.i&&!ft(A,Ce)&&(Je(A,Ce)&&Je(Ce,A)&&wt(A,Ce)&&(at(A.prev,A,Ce.prev)||at(A,Ce.prev,Ce))||it(A,Ce)&&at(A.prev,A,A.next)>0&&at(Ce.prev,Ce,Ce.next)>0)}function at(A,Ce,De){return(Ce.y-A.y)*(De.x-Ce.x)-(Ce.x-A.x)*(De.y-Ce.y)}function it(A,Ce){return A.x===Ce.x&&A.y===Ce.y}function Vt(A,Ce,De,Tt){var gt=$t(at(A,Ce,De)),Bt=$t(at(A,Ce,Tt)),Kt=$t(at(De,Tt,A)),Cr=$t(at(De,Tt,Ce));return!!(gt!==Bt&&Kt!==Cr||gt===0&&q(A,De,Ce)||Bt===0&&q(A,Tt,Ce)||Kt===0&&q(De,A,Tt)||Cr===0&&q(De,Ce,Tt))}function q(A,Ce,De){return Ce.x<=Math.max(A.x,De.x)&&Ce.x>=Math.min(A.x,De.x)&&Ce.y<=Math.max(A.y,De.y)&&Ce.y>=Math.min(A.y,De.y)}function $t(A){return A>0?1:A<0?-1:0}function ft(A,Ce){var De=A;do{if(De.i!==A.i&&De.next.i!==A.i&&De.i!==Ce.i&&De.next.i!==Ce.i&&Vt(De,De.next,A,Ce))return!0;De=De.next}while(De!==A);return!1}function Je(A,Ce){return at(A.prev,A,A.next)<0?at(A,Ce,A.next)>=0&&at(A,A.prev,Ce)>=0:at(A,Ce,A.prev)<0||at(A,A.next,Ce)<0}function wt(A,Ce){var De=A,Tt=!1,gt=(A.x+Ce.x)/2,Bt=(A.y+Ce.y)/2;do De.y>Bt!=De.next.y>Bt&&De.next.y!==De.y&&gt<(De.next.x-De.x)*(Bt-De.y)/(De.next.y-De.y)+De.x&&(Tt=!Tt),De=De.next;while(De!==A);return Tt}function Qe(A,Ce){var De=new Fr(A.i,A.x,A.y),Tt=new Fr(Ce.i,Ce.x,Ce.y),gt=A.next,Bt=Ce.prev;return A.next=Ce,Ce.prev=A,De.next=gt,gt.prev=De,Tt.next=De,De.prev=Tt,Bt.next=Tt,Tt.prev=Bt,Tt}function Qt(A,Ce,De,Tt){var gt=new Fr(A,Ce,De);return Tt?(gt.next=Tt.next,gt.prev=Tt,Tt.next.prev=gt,Tt.next=gt):(gt.prev=gt,gt.next=gt),gt}function Er(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function Fr(A,Ce,De){this.i=A,this.x=Ce,this.y=De,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}$.deviation=function(A,Ce,De,Tt){var gt=Ce&&Ce.length,Bt=gt?Ce[0]*De:A.length,Kt=Math.abs(Jr(A,0,Bt,De));if(gt)for(var Cr=0,Qn=Ce.length;Cr<Qn;Cr++){var vn=Ce[Cr]*De,fi=Cr<Qn-1?Ce[Cr+1]*De:A.length;Kt-=Math.abs(Jr(A,vn,fi,De))}var Gn=0;for(Cr=0;Cr<Tt.length;Cr+=3){var ii=Tt[Cr]*De,hi=Tt[Cr+1]*De,Wn=Tt[Cr+2]*De;Gn+=Math.abs((A[ii]-A[Wn])*(A[hi+1]-A[ii+1])-(A[ii]-A[hi])*(A[Wn+1]-A[ii+1]))}return Kt===0&&Gn===0?0:Math.abs((Gn-Kt)/Kt)};function Jr(A,Ce,De,Tt){for(var gt=0,Bt=Ce,Kt=De-Tt;Bt<De;Bt+=Tt)gt+=(A[Kt]-A[Bt])*(A[Bt+1]+A[Kt+1]),Kt=Bt;return gt}$.flatten=function(A){for(var Ce=A[0][0].length,De={vertices:[],holes:[],dimensions:Ce},Tt=0,gt=0;gt<A.length;gt++){for(var Bt=0;Bt<A[gt].length;Bt++)for(var Kt=0;Kt<Ce;Kt++)De.vertices.push(A[gt][Bt][Kt]);gt>0&&(Tt+=A[gt-1].length,De.holes.push(Tt))}return De}},67709:function(It){function $(ie){var re=ie.target||ie.srcElement;re.__resizeRAF__&&cancelAnimationFrame(re.__resizeRAF__),re.__resizeRAF__=requestAnimationFrame(function(){var m=re.__resizeTrigger__,de=m&&m.__resizeListeners__;de&&de.forEach(function(Z){Z.call(m,ie)})})}var z=function(re,m){var de=this,Z=de.document,ce,fe=Z.attachEvent;typeof navigator!="undefined"&&(ce=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Le(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",$)}if(!re.__resizeListeners__)if(re.__resizeListeners__=[],fe)re.__resizeTrigger__=re,re.attachEvent("onresize",$);else{getComputedStyle(re).position==="static"&&(re.style.position="relative");var J=re.__resizeTrigger__=Z.createElement("object");J.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),J.setAttribute("class","resize-sensor"),J.setAttribute("tabindex","-1"),J.setAttribute("title",""),J.__resizeElement__=re,J.onload=Le,J.type="text/html",ce&&re.appendChild(J),J.data="about:blank",ce||re.appendChild(J)}re.__resizeListeners__.push(m)};It.exports=typeof window=="undefined"?z:z.bind(window),It.exports.unbind=function(ie,re){var m=document.attachEvent,de=ie.__resizeListeners__||[];if(re){var Z=de.indexOf(re);Z!==-1&&de.splice(Z,1)}else de=ie.__resizeListeners__=[];if(!de.length){if(m)ie.detachEvent("onresize",$);else if(ie.__resizeTrigger__){var ce=ie.__resizeTrigger__.contentDocument,fe=ce&&ce.defaultView;fe&&(fe.removeEventListener("resize",$),delete fe.__resizeTrigger__),ie.__resizeTrigger__=!ie.removeChild(ie.__resizeTrigger__)}delete ie.__resizeListeners__}}},26729:function(It){"use strict";var $=Object.prototype.hasOwnProperty,z="~";function ie(){}Object.create&&(ie.prototype=Object.create(null),new ie().__proto__||(z=!1));function re(ce,fe,Le){this.fn=ce,this.context=fe,this.once=Le||!1}function m(ce,fe,Le,J,Xe){if(typeof Le!="function")throw new TypeError("The listener must be a function");var et=new re(Le,J||ce,Xe),Ze=z?z+fe:fe;return ce._events[Ze]?ce._events[Ze].fn?ce._events[Ze]=[ce._events[Ze],et]:ce._events[Ze].push(et):(ce._events[Ze]=et,ce._eventsCount++),ce}function de(ce,fe){--ce._eventsCount==0?ce._events=new ie:delete ce._events[fe]}function Z(){this._events=new ie,this._eventsCount=0}Z.prototype.eventNames=function(){var fe=[],Le,J;if(this._eventsCount===0)return fe;for(J in Le=this._events)$.call(Le,J)&&fe.push(z?J.slice(1):J);return Object.getOwnPropertySymbols?fe.concat(Object.getOwnPropertySymbols(Le)):fe},Z.prototype.listeners=function(fe){var Le=z?z+fe:fe,J=this._events[Le];if(!J)return[];if(J.fn)return[J.fn];for(var Xe=0,et=J.length,Ze=new Array(et);Xe<et;Xe++)Ze[Xe]=J[Xe].fn;return Ze},Z.prototype.listenerCount=function(fe){var Le=z?z+fe:fe,J=this._events[Le];return J?J.fn?1:J.length:0},Z.prototype.emit=function(fe,Le,J,Xe,et,Ze){var yt=z?z+fe:fe;if(!this._events[yt])return!1;var rr=this._events[yt],bt=arguments.length,Xt,Ct;if(rr.fn){switch(rr.once&&this.removeListener(fe,rr.fn,void 0,!0),bt){case 1:return rr.fn.call(rr.context),!0;case 2:return rr.fn.call(rr.context,Le),!0;case 3:return rr.fn.call(rr.context,Le,J),!0;case 4:return rr.fn.call(rr.context,Le,J,Xe),!0;case 5:return rr.fn.call(rr.context,Le,J,Xe,et),!0;case 6:return rr.fn.call(rr.context,Le,J,Xe,et,Ze),!0}for(Ct=1,Xt=new Array(bt-1);Ct<bt;Ct++)Xt[Ct-1]=arguments[Ct];rr.fn.apply(rr.context,Xt)}else{var at=rr.length,it;for(Ct=0;Ct<at;Ct++)switch(rr[Ct].once&&this.removeListener(fe,rr[Ct].fn,void 0,!0),bt){case 1:rr[Ct].fn.call(rr[Ct].context);break;case 2:rr[Ct].fn.call(rr[Ct].context,Le);break;case 3:rr[Ct].fn.call(rr[Ct].context,Le,J);break;case 4:rr[Ct].fn.call(rr[Ct].context,Le,J,Xe);break;default:if(!Xt)for(it=1,Xt=new Array(bt-1);it<bt;it++)Xt[it-1]=arguments[it];rr[Ct].fn.apply(rr[Ct].context,Xt)}}return!0},Z.prototype.on=function(fe,Le,J){return m(this,fe,Le,J,!1)},Z.prototype.once=function(fe,Le,J){return m(this,fe,Le,J,!0)},Z.prototype.removeListener=function(fe,Le,J,Xe){var et=z?z+fe:fe;if(!this._events[et])return this;if(!Le)return de(this,et),this;var Ze=this._events[et];if(Ze.fn)Ze.fn===Le&&(!Xe||Ze.once)&&(!J||Ze.context===J)&&de(this,et);else{for(var yt=0,rr=[],bt=Ze.length;yt<bt;yt++)(Ze[yt].fn!==Le||Xe&&!Ze[yt].once||J&&Ze[yt].context!==J)&&rr.push(Ze[yt]);rr.length?this._events[et]=rr.length===1?rr[0]:rr:de(this,et)}return this},Z.prototype.removeAllListeners=function(fe){var Le;return fe?(Le=z?z+fe:fe,this._events[Le]&&de(this,Le)):(this._events=new ie,this._eventsCount=0),this},Z.prototype.off=Z.prototype.removeListener,Z.prototype.addListener=Z.prototype.on,Z.prefixed=z,Z.EventEmitter=Z,It.exports=Z},7375:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0});var z=Symbol.for("INJECTION");function ie(ce,fe,Le,J){function Xe(){return J&&!Reflect.hasMetadata(z,this,fe)&&Reflect.defineMetadata(z,Le(),this,fe),Reflect.hasMetadata(z,this,fe)?Reflect.getMetadata(z,this,fe):Le()}function et(Ze){Reflect.defineMetadata(z,Ze,this,fe)}Object.defineProperty(ce,fe,{configurable:!0,enumerable:!0,get:Xe,set:et})}function re(ce,fe){return function(Le){return function(J,Xe){var et=function(){return ce.get(Le)};ie(J,Xe,et,fe)}}}$.makePropertyInjectDecorator=re;function m(ce,fe){return function(Le,J){return function(Xe,et){var Ze=function(){return ce.getNamed(Le,J)};ie(Xe,et,Ze,fe)}}}$.makePropertyInjectNamedDecorator=m;function de(ce,fe){return function(Le,J,Xe){return function(et,Ze){var yt=function(){return ce.getTagged(Le,J,Xe)};ie(et,Ze,yt,fe)}}}$.makePropertyInjectTaggedDecorator=de;function Z(ce,fe){return function(Le){return function(J,Xe){var et=function(){return ce.getAll(Le)};ie(J,Xe,et,fe)}}}$.makePropertyMultiInjectDecorator=Z},84879:function(It,$,z){"use strict";var ie;ie={value:!0};var re=z(7375);function m(de,Z){Z===void 0&&(Z=!0);var ce=re.makePropertyInjectDecorator(de,Z),fe=re.makePropertyInjectNamedDecorator(de,Z),Le=re.makePropertyInjectTaggedDecorator(de,Z),J=re.makePropertyMultiInjectDecorator(de,Z);return{lazyInject:ce,lazyInjectNamed:fe,lazyInjectTagged:Le,lazyMultiInject:J}}$.Z=m},99934:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.tagProperty=$.tagParameter=$.decorate=void 0;var ie=z(16674),re=z(6867);function m(J,Xe,et,Ze){var yt=re.TAGGED;Z(yt,J,Xe,Ze,et)}$.tagParameter=m;function de(J,Xe,et){var Ze=re.TAGGED_PROP;Z(Ze,J.constructor,Xe,et)}$.tagProperty=de;function Z(J,Xe,et,Ze,yt){var rr={},bt=typeof yt=="number",Xt=yt!==void 0&&bt?yt.toString():et;if(bt&&et!==void 0)throw new Error(ie.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(J,Xe)&&(rr=Reflect.getMetadata(J,Xe));var Ct=rr[Xt];if(!Array.isArray(Ct))Ct=[];else for(var at=0,it=Ct;at<it.length;at++){var Vt=it[at];if(Vt.key===Ze.key)throw new Error(ie.DUPLICATED_METADATA+" "+Vt.key.toString())}Ct.push(Ze),rr[Xt]=Ct,Reflect.defineMetadata(J,rr,Xe)}function ce(J,Xe){Reflect.decorate(J,Xe)}function fe(J,Xe){return function(et,Ze){Xe(et,Ze,J)}}function Le(J,Xe,et){typeof et=="number"?ce([fe(et,J)],Xe):typeof et=="string"?Reflect.decorate([J],Xe,et):ce([J],Xe)}$.decorate=Le},5744:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.inject=$.LazyServiceIdentifer=void 0;var ie=z(16674),re=z(6867),m=z(47738),de=z(99934),Z=function(){function fe(Le){this._cb=Le}return fe.prototype.unwrap=function(){return this._cb()},fe}();$.LazyServiceIdentifer=Z;function ce(fe){return function(Le,J,Xe){if(fe===void 0)throw new Error(ie.UNDEFINED_INJECT_ANNOTATION(Le.name));var et=new m.Metadata(re.INJECT_TAG,fe);typeof Xe=="number"?de.tagParameter(Le,J,Xe,et):de.tagProperty(Le,J,et)}}$.inject=ce},64315:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.injectable=void 0;var ie=z(16674),re=z(6867);function m(){return function(de){if(Reflect.hasOwnMetadata(re.PARAM_TYPES,de))throw new Error(ie.DUPLICATED_INJECTABLE_DECORATOR);var Z=Reflect.getMetadata(re.DESIGN_PARAM_TYPES,de)||[];return Reflect.defineMetadata(re.PARAM_TYPES,Z,de),de}}$.injectable=m},71693:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.multiInject=void 0;var ie=z(6867),re=z(47738),m=z(99934);function de(Z){return function(ce,fe,Le){var J=new re.Metadata(ie.MULTI_INJECT_TAG,Z);typeof Le=="number"?m.tagParameter(ce,fe,Le,J):m.tagProperty(ce,fe,J)}}$.multiInject=de},38085:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.named=void 0;var ie=z(6867),re=z(47738),m=z(99934);function de(Z){return function(ce,fe,Le){var J=new re.Metadata(ie.NAMED_TAG,Z);typeof Le=="number"?m.tagParameter(ce,fe,Le,J):m.tagProperty(ce,fe,J)}}$.named=de},6515:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.optional=void 0;var ie=z(6867),re=z(47738),m=z(99934);function de(){return function(Z,ce,fe){var Le=new re.Metadata(ie.OPTIONAL_TAG,!0);typeof fe=="number"?m.tagParameter(Z,ce,fe,Le):m.tagProperty(Z,ce,Le)}}$.optional=de},7014:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.postConstruct=void 0;var ie=z(16674),re=z(6867),m=z(47738);function de(){return function(Z,ce,fe){var Le=new m.Metadata(re.POST_CONSTRUCT,ce);if(Reflect.hasOwnMetadata(re.POST_CONSTRUCT,Z.constructor))throw new Error(ie.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(re.POST_CONSTRUCT,Le,Z.constructor)}}$.postConstruct=de},32052:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.tagged=void 0;var ie=z(47738),re=z(99934);function m(de,Z){return function(ce,fe,Le){var J=new ie.Metadata(de,Z);typeof Le=="number"?re.tagParameter(ce,fe,Le,J):re.tagProperty(ce,fe,J)}}$.tagged=m},55638:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.targetName=void 0;var ie=z(6867),re=z(47738),m=z(99934);function de(Z){return function(ce,fe,Le){var J=new re.Metadata(ie.NAME_TAG,Z);m.tagParameter(ce,fe,Le,J)}}$.targetName=de},86757:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.unmanaged=void 0;var ie=z(6867),re=z(47738),m=z(99934);function de(){return function(Z,ce,fe){var Le=new re.Metadata(ie.UNMANAGED_TAG,!0);m.tagParameter(Z,ce,fe,Le)}}$.unmanaged=de},44290:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Binding=void 0;var ie=z(28421),re=z(37791),m=function(){function de(Z,ce){this.id=re.id(),this.activated=!1,this.serviceIdentifier=Z,this.scope=ce,this.type=ie.BindingTypeEnum.Invalid,this.constraint=function(fe){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return de.prototype.clone=function(){var Z=new de(this.serviceIdentifier,this.scope);return Z.activated=Z.scope===ie.BindingScopeEnum.Singleton?this.activated:!1,Z.implementationType=this.implementationType,Z.dynamicValue=this.dynamicValue,Z.scope=this.scope,Z.type=this.type,Z.factory=this.factory,Z.provider=this.provider,Z.constraint=this.constraint,Z.onActivation=this.onActivation,Z.cache=this.cache,Z},de}();$.Binding=m},23184:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingCount=void 0;var z={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};$.BindingCount=z},16674:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.STACK_OVERFLOW=$.CIRCULAR_DEPENDENCY_IN_FACTORY=$.POST_CONSTRUCT_ERROR=$.MULTIPLE_POST_CONSTRUCT_METHODS=$.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=$.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=$.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=$.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=$.ARGUMENTS_LENGTH_MISMATCH=$.INVALID_DECORATOR_OPERATION=$.INVALID_TO_SELF_VALUE=$.INVALID_FUNCTION_BINDING=$.INVALID_MIDDLEWARE_RETURN=$.NO_MORE_SNAPSHOTS_AVAILABLE=$.INVALID_BINDING_TYPE=$.NOT_IMPLEMENTED=$.CIRCULAR_DEPENDENCY=$.UNDEFINED_INJECT_ANNOTATION=$.MISSING_INJECT_ANNOTATION=$.MISSING_INJECTABLE_ANNOTATION=$.NOT_REGISTERED=$.CANNOT_UNBIND=$.AMBIGUOUS_MATCH=$.KEY_NOT_FOUND=$.NULL_ARGUMENT=$.DUPLICATED_METADATA=$.DUPLICATED_INJECTABLE_DECORATOR=void 0,$.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",$.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",$.NULL_ARGUMENT="NULL argument",$.KEY_NOT_FOUND="Key Not Found",$.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",$.CANNOT_UNBIND="Could not unbind serviceIdentifier:",$.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",$.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",$.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var z=function(de){return"@inject called with undefined this could mean that the class "+de+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};$.UNDEFINED_INJECT_ANNOTATION=z,$.CIRCULAR_DEPENDENCY="Circular dependency found:",$.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",$.INVALID_BINDING_TYPE="Invalid binding type:",$.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",$.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",$.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",$.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",$.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var ie=function(){for(var de=[],Z=0;Z<arguments.length;Z++)de[Z]=arguments[Z];return"The number of constructor arguments in the derived class "+(de[0]+" must be >= than the number of constructor arguments of its base class.")};$.ARGUMENTS_LENGTH_MISMATCH=ie,$.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",$.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",$.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",$.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",$.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var re=function(){for(var de=[],Z=0;Z<arguments.length;Z++)de[Z]=arguments[Z];return"@postConstruct error in class "+de[0]+": "+de[1]};$.POST_CONSTRUCT_ERROR=re;var m=function(){for(var de=[],Z=0;Z<arguments.length;Z++)de[Z]=arguments[Z];return"It looks like there is a circular dependency "+("in one of the '"+de[0]+"' bindings. Please investigate bindings with")+("service identifier '"+de[1]+"'.")};$.CIRCULAR_DEPENDENCY_IN_FACTORY=m,$.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.TargetTypeEnum=$.BindingTypeEnum=$.BindingScopeEnum=void 0;var z={Request:"Request",Singleton:"Singleton",Transient:"Transient"};$.BindingScopeEnum=z;var ie={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};$.BindingTypeEnum=ie;var re={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};$.TargetTypeEnum=re},6867:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.NON_CUSTOM_TAG_KEYS=$.POST_CONSTRUCT=$.DESIGN_PARAM_TYPES=$.PARAM_TYPES=$.TAGGED_PROP=$.TAGGED=$.MULTI_INJECT_TAG=$.INJECT_TAG=$.OPTIONAL_TAG=$.UNMANAGED_TAG=$.NAME_TAG=$.NAMED_TAG=void 0,$.NAMED_TAG="named",$.NAME_TAG="name",$.UNMANAGED_TAG="unmanaged",$.OPTIONAL_TAG="optional",$.INJECT_TAG="inject",$.MULTI_INJECT_TAG="multi_inject",$.TAGGED="inversify:tagged",$.TAGGED_PROP="inversify:tagged_props",$.PARAM_TYPES="inversify:paramtypes",$.DESIGN_PARAM_TYPES="design:paramtypes",$.POST_CONSTRUCT="post_construct";function z(){return[$.INJECT_TAG,$.MULTI_INJECT_TAG,$.NAME_TAG,$.UNMANAGED_TAG,$.NAMED_TAG,$.OPTIONAL_TAG]}$.NON_CUSTOM_TAG_KEYS=z()},51389:function(It,$,z){"use strict";var ie=this&&this.__awaiter||function(Ct,at,it,Vt){function q($t){return $t instanceof it?$t:new it(function(ft){ft($t)})}return new(it||(it=Promise))(function($t,ft){function Je(Qt){try{Qe(Vt.next(Qt))}catch(Er){ft(Er)}}function wt(Qt){try{Qe(Vt.throw(Qt))}catch(Er){ft(Er)}}function Qe(Qt){Qt.done?$t(Qt.value):q(Qt.value).then(Je,wt)}Qe((Vt=Vt.apply(Ct,at||[])).next())})},re=this&&this.__generator||function(Ct,at){var it={label:0,sent:function(){if($t[0]&1)throw $t[1];return $t[1]},trys:[],ops:[]},Vt,q,$t,ft;return ft={next:Je(0),throw:Je(1),return:Je(2)},typeof Symbol=="function"&&(ft[Symbol.iterator]=function(){return this}),ft;function Je(Qe){return function(Qt){return wt([Qe,Qt])}}function wt(Qe){if(Vt)throw new TypeError("Generator is already executing.");for(;it;)try{if(Vt=1,q&&($t=Qe[0]&2?q.return:Qe[0]?q.throw||(($t=q.return)&&$t.call(q),0):q.next)&&!($t=$t.call(q,Qe[1])).done)return $t;switch(q=0,$t&&(Qe=[Qe[0]&2,$t.value]),Qe[0]){case 0:case 1:$t=Qe;break;case 4:return it.label++,{value:Qe[1],done:!1};case 5:it.label++,q=Qe[1],Qe=[0];continue;case 7:Qe=it.ops.pop(),it.trys.pop();continue;default:if($t=it.trys,!($t=$t.length>0&&$t[$t.length-1])&&(Qe[0]===6||Qe[0]===2)){it=0;continue}if(Qe[0]===3&&(!$t||Qe[1]>$t[0]&&Qe[1]<$t[3])){it.label=Qe[1];break}if(Qe[0]===6&&it.label<$t[1]){it.label=$t[1],$t=Qe;break}if($t&&it.label<$t[2]){it.label=$t[2],it.ops.push(Qe);break}$t[2]&&it.ops.pop(),it.trys.pop();continue}Qe=at.call(Ct,it)}catch(Qt){Qe=[6,Qt],q=0}finally{Vt=$t=0}if(Qe[0]&5)throw Qe[1];return{value:Qe[0]?Qe[1]:void 0,done:!0}}},m=this&&this.__spreadArray||function(Ct,at){for(var it=0,Vt=at.length,q=Ct.length;it<Vt;it++,q++)Ct[q]=at[it];return Ct};Object.defineProperty($,"__esModule",{value:!0}),$.Container=void 0;var de=z(44290),Z=z(16674),ce=z(28421),fe=z(6867),Le=z(51377),J=z(86311),Xe=z(31927),et=z(15451),Ze=z(37791),yt=z(55800),rr=z(85700),bt=z(80175),Xt=function(){function Ct(at){this._appliedMiddleware=[];var it=at||{};if(typeof it!="object")throw new Error(""+Z.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(it.defaultScope===void 0)it.defaultScope=ce.BindingScopeEnum.Transient;else if(it.defaultScope!==ce.BindingScopeEnum.Singleton&&it.defaultScope!==ce.BindingScopeEnum.Transient&&it.defaultScope!==ce.BindingScopeEnum.Request)throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(it.autoBindInjectable===void 0)it.autoBindInjectable=!1;else if(typeof it.autoBindInjectable!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(it.skipBaseClassChecks===void 0)it.skipBaseClassChecks=!1;else if(typeof it.skipBaseClassChecks!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:it.autoBindInjectable,defaultScope:it.defaultScope,skipBaseClassChecks:it.skipBaseClassChecks},this.id=Ze.id(),this._bindingDictionary=new bt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Le.MetadataReader}return Ct.merge=function(at,it){for(var Vt=[],q=2;q<arguments.length;q++)Vt[q-2]=arguments[q];var $t=new Ct,ft=m([at,it],Vt).map(function(Qe){return J.getBindingDictionary(Qe)}),Je=J.getBindingDictionary($t);function wt(Qe,Qt){Qe.traverse(function(Er,Fr){Fr.forEach(function(Jr){Qt.add(Jr.serviceIdentifier,Jr.clone())})})}return ft.forEach(function(Qe){wt(Qe,Je)}),$t},Ct.prototype.load=function(){for(var at=[],it=0;it<arguments.length;it++)at[it]=arguments[it];for(var Vt=this._getContainerModuleHelpersFactory(),q=0,$t=at;q<$t.length;q++){var ft=$t[q],Je=Vt(ft.id);ft.registry(Je.bindFunction,Je.unbindFunction,Je.isboundFunction,Je.rebindFunction)}},Ct.prototype.loadAsync=function(){for(var at=[],it=0;it<arguments.length;it++)at[it]=arguments[it];return ie(this,void 0,void 0,function(){var Vt,q,$t,ft,Je;return re(this,function(wt){switch(wt.label){case 0:Vt=this._getContainerModuleHelpersFactory(),q=0,$t=at,wt.label=1;case 1:return q<$t.length?(ft=$t[q],Je=Vt(ft.id),[4,ft.registry(Je.bindFunction,Je.unbindFunction,Je.isboundFunction,Je.rebindFunction)]):[3,4];case 2:wt.sent(),wt.label=3;case 3:return q++,[3,1];case 4:return[2]}})})},Ct.prototype.unload=function(){for(var at=this,it=[],Vt=0;Vt<arguments.length;Vt++)it[Vt]=arguments[Vt];var q=function($t){return function(ft){return ft.moduleId===$t}};it.forEach(function($t){var ft=q($t.id);at._bindingDictionary.removeByCondition(ft)})},Ct.prototype.bind=function(at){var it=this.options.defaultScope||ce.BindingScopeEnum.Transient,Vt=new de.Binding(at,it);return this._bindingDictionary.add(at,Vt),new et.BindingToSyntax(Vt)},Ct.prototype.rebind=function(at){return this.unbind(at),this.bind(at)},Ct.prototype.unbind=function(at){try{this._bindingDictionary.remove(at)}catch(it){throw new Error(Z.CANNOT_UNBIND+" "+yt.getServiceIdentifierAsString(at))}},Ct.prototype.unbindAll=function(){this._bindingDictionary=new bt.Lookup},Ct.prototype.isBound=function(at){var it=this._bindingDictionary.hasKey(at);return!it&&this.parent&&(it=this.parent.isBound(at)),it},Ct.prototype.isBoundNamed=function(at,it){return this.isBoundTagged(at,fe.NAMED_TAG,it)},Ct.prototype.isBoundTagged=function(at,it,Vt){var q=!1;if(this._bindingDictionary.hasKey(at)){var $t=this._bindingDictionary.get(at),ft=J.createMockRequest(this,at,it,Vt);q=$t.some(function(Je){return Je.constraint(ft)})}return!q&&this.parent&&(q=this.parent.isBoundTagged(at,it,Vt)),q},Ct.prototype.snapshot=function(){this._snapshots.push(rr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ct.prototype.restore=function(){var at=this._snapshots.pop();if(at===void 0)throw new Error(Z.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=at.bindings,this._middleware=at.middleware},Ct.prototype.createChild=function(at){var it=new Ct(at||this.options);return it.parent=this,it},Ct.prototype.applyMiddleware=function(){for(var at=[],it=0;it<arguments.length;it++)at[it]=arguments[it];this._appliedMiddleware=this._appliedMiddleware.concat(at);var Vt=this._middleware?this._middleware:this._planAndResolve();this._middleware=at.reduce(function(q,$t){return $t(q)},Vt)},Ct.prototype.applyCustomMetadataReader=function(at){this._metadataReader=at},Ct.prototype.get=function(at){return this._get(!1,!1,ce.TargetTypeEnum.Variable,at)},Ct.prototype.getTagged=function(at,it,Vt){return this._get(!1,!1,ce.TargetTypeEnum.Variable,at,it,Vt)},Ct.prototype.getNamed=function(at,it){return this.getTagged(at,fe.NAMED_TAG,it)},Ct.prototype.getAll=function(at){return this._get(!0,!0,ce.TargetTypeEnum.Variable,at)},Ct.prototype.getAllTagged=function(at,it,Vt){return this._get(!1,!0,ce.TargetTypeEnum.Variable,at,it,Vt)},Ct.prototype.getAllNamed=function(at,it){return this.getAllTagged(at,fe.NAMED_TAG,it)},Ct.prototype.resolve=function(at){var it=this.createChild();return it.bind(at).toSelf(),this._appliedMiddleware.forEach(function(Vt){it.applyMiddleware(Vt)}),it.get(at)},Ct.prototype._getContainerModuleHelpersFactory=function(){var at=this,it=function(Je,wt){Je._binding.moduleId=wt},Vt=function(Je){return function(wt){var Qe=at.bind.bind(at),Qt=Qe(wt);return it(Qt,Je),Qt}},q=function(Je){return function(wt){var Qe=at.unbind.bind(at);Qe(wt)}},$t=function(Je){return function(wt){var Qe=at.isBound.bind(at);return Qe(wt)}},ft=function(Je){return function(wt){var Qe=at.rebind.bind(at),Qt=Qe(wt);return it(Qt,Je),Qt}};return function(Je){return{bindFunction:Vt(Je),isboundFunction:$t(Je),rebindFunction:ft(Je),unbindFunction:q(Je)}}},Ct.prototype._get=function(at,it,Vt,q,$t,ft){var Je=null,wt={avoidConstraints:at,contextInterceptor:function(Qe){return Qe},isMultiInject:it,key:$t,serviceIdentifier:q,targetType:Vt,value:ft};if(this._middleware){if(Je=this._middleware(wt),Je==null)throw new Error(Z.INVALID_MIDDLEWARE_RETURN)}else Je=this._planAndResolve()(wt);return Je},Ct.prototype._planAndResolve=function(){var at=this;return function(it){var Vt=J.plan(at._metadataReader,at,it.isMultiInject,it.targetType,it.serviceIdentifier,it.key,it.value,it.avoidConstraints);Vt=it.contextInterceptor(Vt);var q=Xe.resolve(Vt);return q}},Ct}();$.Container=Xt},33244:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.AsyncContainerModule=$.ContainerModule=void 0;var ie=z(37791),re=function(){function de(Z){this.id=ie.id(),this.registry=Z}return de}();$.ContainerModule=re;var m=function(){function de(Z){this.id=ie.id(),this.registry=Z}return de}();$.AsyncContainerModule=m},85700:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.ContainerSnapshot=void 0;var z=function(){function ie(){}return ie.of=function(re,m){var de=new ie;return de.bindings=re,de.middleware=m,de},ie}();$.ContainerSnapshot=z},80175:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Lookup=void 0;var ie=z(16674),re=function(){function m(){this._map=new Map}return m.prototype.getMap=function(){return this._map},m.prototype.add=function(de,Z){if(de==null)throw new Error(ie.NULL_ARGUMENT);if(Z==null)throw new Error(ie.NULL_ARGUMENT);var ce=this._map.get(de);ce!==void 0?(ce.push(Z),this._map.set(de,ce)):this._map.set(de,[Z])},m.prototype.get=function(de){if(de==null)throw new Error(ie.NULL_ARGUMENT);var Z=this._map.get(de);if(Z!==void 0)return Z;throw new Error(ie.KEY_NOT_FOUND)},m.prototype.remove=function(de){if(de==null)throw new Error(ie.NULL_ARGUMENT);if(!this._map.delete(de))throw new Error(ie.KEY_NOT_FOUND)},m.prototype.removeByCondition=function(de){var Z=this;this._map.forEach(function(ce,fe){var Le=ce.filter(function(J){return!de(J)});Le.length>0?Z._map.set(fe,Le):Z._map.delete(fe)})},m.prototype.hasKey=function(de){if(de==null)throw new Error(ie.NULL_ARGUMENT);return this._map.has(de)},m.prototype.clone=function(){var de=new m;return this._map.forEach(function(Z,ce){Z.forEach(function(fe){return de.add(ce,fe.clone())})}),de},m.prototype.traverse=function(de){this._map.forEach(function(Z,ce){de(ce,Z)})},m}();$.Lookup=re},86700:function(It,$,z){"use strict";var ie;ie={value:!0},ie=ie=ie=ie=ie=ie=$.GW=ie=ie=$.zY=ie=ie=ie=ie=ie=$.f3=ie=ie=$.b2=ie=ie=ie=ie=ie=$.W2=ie=void 0;var re=z(6867);ie=re;var m=z(51389);Object.defineProperty($,"W2",{enumerable:!0,get:function(){return m.Container}});var de=z(28421);ie={enumerable:!0,get:function(){return de.BindingScopeEnum}},ie={enumerable:!0,get:function(){return de.BindingTypeEnum}},ie={enumerable:!0,get:function(){return de.TargetTypeEnum}};var Z=z(33244);ie={enumerable:!0,get:function(){return Z.AsyncContainerModule}},ie={enumerable:!0,get:function(){return Z.ContainerModule}};var ce=z(64315);Object.defineProperty($,"b2",{enumerable:!0,get:function(){return ce.injectable}});var fe=z(32052);ie={enumerable:!0,get:function(){return fe.tagged}};var Le=z(38085);ie={enumerable:!0,get:function(){return Le.named}};var J=z(5744);Object.defineProperty($,"f3",{enumerable:!0,get:function(){return J.inject}}),ie={enumerable:!0,get:function(){return J.LazyServiceIdentifer}};var Xe=z(6515);ie={enumerable:!0,get:function(){return Xe.optional}};var et=z(86757);ie={enumerable:!0,get:function(){return et.unmanaged}};var Ze=z(71693);ie={enumerable:!0,get:function(){return Ze.multiInject}};var yt=z(55638);ie={enumerable:!0,get:function(){return yt.targetName}};var rr=z(7014);Object.defineProperty($,"zY",{enumerable:!0,get:function(){return rr.postConstruct}});var bt=z(51377);ie={enumerable:!0,get:function(){return bt.MetadataReader}};var Xt=z(37791);ie={enumerable:!0,get:function(){return Xt.id}};var Ct=z(99934);Object.defineProperty($,"GW",{enumerable:!0,get:function(){return Ct.decorate}});var at=z(80758);ie={enumerable:!0,get:function(){return at.traverseAncerstors}},ie={enumerable:!0,get:function(){return at.taggedConstraint}},ie={enumerable:!0,get:function(){return at.namedConstraint}},ie={enumerable:!0,get:function(){return at.typeConstraint}};var it=z(55800);ie={enumerable:!0,get:function(){return it.getServiceIdentifierAsString}};var Vt=z(70600);ie={enumerable:!0,get:function(){return Vt.multiBindToService}}},95228:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Context=void 0;var ie=z(37791),re=function(){function m(de){this.id=ie.id(),this.container=de}return m.prototype.addPlan=function(de){this.plan=de},m.prototype.setCurrentRequest=function(de){this.currentRequest=de},m}();$.Context=re},47738:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Metadata=void 0;var ie=z(6867),re=function(){function m(de,Z){this.key=de,this.value=Z}return m.prototype.toString=function(){return this.key===ie.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},m}();$.Metadata=re},51377:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.MetadataReader=void 0;var ie=z(6867),re=function(){function m(){}return m.prototype.getConstructorMetadata=function(de){var Z=Reflect.getMetadata(ie.PARAM_TYPES,de),ce=Reflect.getMetadata(ie.TAGGED,de);return{compilerGeneratedMetadata:Z,userGeneratedMetadata:ce||{}}},m.prototype.getPropertiesMetadata=function(de){var Z=Reflect.getMetadata(ie.TAGGED_PROP,de)||[];return Z},m}();$.MetadataReader=re},55314:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Plan=void 0;var z=function(){function ie(re,m){this.parentContext=re,this.rootRequest=m}return ie}();$.Plan=z},86311:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.getBindingDictionary=$.createMockRequest=$.plan=void 0;var ie=z(23184),re=z(16674),m=z(28421),de=z(6867),Z=z(85265),ce=z(55800),fe=z(95228),Le=z(47738),J=z(55314),Xe=z(6e3),et=z(6748),Ze=z(18924);function yt(q){return q._bindingDictionary}$.getBindingDictionary=yt;function rr(q,$t,ft,Je,wt,Qe){var Qt=q?de.MULTI_INJECT_TAG:de.INJECT_TAG,Er=new Le.Metadata(Qt,ft),Fr=new Ze.Target($t,Je,ft,Er);if(wt!==void 0){var Jr=new Le.Metadata(wt,Qe);Fr.metadata.push(Jr)}return Fr}function bt(q,$t,ft,Je,wt){var Qe=at(ft.container,wt.serviceIdentifier),Qt=[];return Qe.length===ie.BindingCount.NoBindingsAvailable&&ft.container.options.autoBindInjectable&&typeof wt.serviceIdentifier=="function"&&q.getConstructorMetadata(wt.serviceIdentifier).compilerGeneratedMetadata&&(ft.container.bind(wt.serviceIdentifier).toSelf(),Qe=at(ft.container,wt.serviceIdentifier)),$t?Qt=Qe:Qt=Qe.filter(function(Er){var Fr=new et.Request(Er.serviceIdentifier,ft,Je,Er,wt);return Er.constraint(Fr)}),Xt(wt.serviceIdentifier,Qt,wt,ft.container),Qt}function Xt(q,$t,ft,Je){switch($t.length){case ie.BindingCount.NoBindingsAvailable:if(ft.isOptional())return $t;var wt=ce.getServiceIdentifierAsString(q),Qe=re.NOT_REGISTERED;throw Qe+=ce.listMetadataForTarget(wt,ft),Qe+=ce.listRegisteredBindingsForServiceIdentifier(Je,wt,at),new Error(Qe);case ie.BindingCount.OnlyOneBindingAvailable:if(!ft.isArray())return $t;case ie.BindingCount.MultipleBindingsAvailable:default:if(ft.isArray())return $t;var wt=ce.getServiceIdentifierAsString(q),Qe=re.AMBIGUOUS_MATCH+" "+wt;throw Qe+=ce.listRegisteredBindingsForServiceIdentifier(Je,wt,at),new Error(Qe)}}function Ct(q,$t,ft,Je,wt,Qe){var Qt,Er;if(wt===null){Qt=bt(q,$t,Je,null,Qe),Er=new et.Request(ft,Je,null,Qt,Qe);var Fr=new J.Plan(Je,Er);Je.addPlan(Fr)}else Qt=bt(q,$t,Je,wt,Qe),Er=wt.addChildRequest(Qe.serviceIdentifier,Qt,Qe);Qt.forEach(function(Jr){var A=null;if(Qe.isArray())A=Er.addChildRequest(Jr.serviceIdentifier,Jr,Qe);else{if(Jr.cache)return;A=Er}if(Jr.type===m.BindingTypeEnum.Instance&&Jr.implementationType!==null){var Ce=Xe.getDependencies(q,Jr.implementationType);if(!Je.container.options.skipBaseClassChecks){var De=Xe.getBaseClassDependencyCount(q,Jr.implementationType);if(Ce.length<De){var Tt=re.ARGUMENTS_LENGTH_MISMATCH(Xe.getFunctionName(Jr.implementationType));throw new Error(Tt)}}Ce.forEach(function(gt){Ct(q,!1,gt.serviceIdentifier,Je,A,gt)})}})}function at(q,$t){var ft=[],Je=yt(q);return Je.hasKey($t)?ft=Je.get($t):q.parent!==null&&(ft=at(q.parent,$t)),ft}function it(q,$t,ft,Je,wt,Qe,Qt,Er){Er===void 0&&(Er=!1);var Fr=new fe.Context($t),Jr=rr(ft,Je,wt,"",Qe,Qt);try{return Ct(q,Er,wt,Fr,null,Jr),Fr}catch(A){throw Z.isStackOverflowExeption(A)&&Fr.plan&&ce.circularDependencyToException(Fr.plan.rootRequest),A}}$.plan=it;function Vt(q,$t,ft,Je){var wt=new Ze.Target(m.TargetTypeEnum.Variable,"",$t,new Le.Metadata(ft,Je)),Qe=new fe.Context(q),Qt=new et.Request($t,Qe,null,[],wt);return Qt}$.createMockRequest=Vt},88460:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.QueryableString=void 0;var z=function(){function ie(re){this.str=re}return ie.prototype.startsWith=function(re){return this.str.indexOf(re)===0},ie.prototype.endsWith=function(re){var m="",de=re.split("").reverse().join("");return m=this.str.split("").reverse().join(""),this.startsWith.call({str:m},de)},ie.prototype.contains=function(re){return this.str.indexOf(re)!==-1},ie.prototype.equals=function(re){return this.str===re},ie.prototype.value=function(){return this.str},ie}();$.QueryableString=z},6e3:function(It,$,z){"use strict";var ie=this&&this.__spreadArray||function(bt,Xt){for(var Ct=0,at=Xt.length,it=bt.length;Ct<at;Ct++,it++)bt[it]=Xt[Ct];return bt};Object.defineProperty($,"__esModule",{value:!0}),$.getFunctionName=$.getBaseClassDependencyCount=$.getDependencies=void 0;var re=z(5744),m=z(16674),de=z(28421),Z=z(6867),ce=z(55800);Object.defineProperty($,"getFunctionName",{enumerable:!0,get:function(){return ce.getFunctionName}});var fe=z(18924);function Le(bt,Xt){var Ct=ce.getFunctionName(Xt),at=J(bt,Ct,Xt,!1);return at}$.getDependencies=Le;function J(bt,Xt,Ct,at){var it=bt.getConstructorMetadata(Ct),Vt=it.compilerGeneratedMetadata;if(Vt===void 0){var q=m.MISSING_INJECTABLE_ANNOTATION+" "+Xt+".";throw new Error(q)}var $t=it.userGeneratedMetadata,ft=Object.keys($t),Je=Ct.length===0&&ft.length>0,wt=ft.length>Ct.length,Qe=Je||wt?ft.length:Ct.length,Qt=et(at,Xt,Vt,$t,Qe),Er=Ze(bt,Ct),Fr=ie(ie([],Qt),Er);return Fr}function Xe(bt,Xt,Ct,at,it){var Vt=it[bt.toString()]||[],q=rr(Vt),$t=q.unmanaged!==!0,ft=at[bt],Je=q.inject||q.multiInject;if(ft=Je||ft,ft instanceof re.LazyServiceIdentifer&&(ft=ft.unwrap()),$t){var wt=ft===Object,Qe=ft===Function,Qt=ft===void 0,Er=wt||Qe||Qt;if(!Xt&&Er){var Fr=m.MISSING_INJECT_ANNOTATION+" argument "+bt+" in class "+Ct+".";throw new Error(Fr)}var Jr=new fe.Target(de.TargetTypeEnum.ConstructorArgument,q.targetName,ft);return Jr.metadata=Vt,Jr}return null}function et(bt,Xt,Ct,at,it){for(var Vt=[],q=0;q<it;q++){var $t=q,ft=Xe($t,bt,Xt,Ct,at);ft!==null&&Vt.push(ft)}return Vt}function Ze(bt,Xt){for(var Ct=bt.getPropertiesMetadata(Xt),at=[],it=Object.keys(Ct),Vt=0,q=it;Vt<q.length;Vt++){var $t=q[Vt],ft=Ct[$t],Je=rr(Ct[$t]),wt=Je.targetName||$t,Qe=Je.inject||Je.multiInject,Qt=new fe.Target(de.TargetTypeEnum.ClassProperty,wt,Qe);Qt.metadata=ft,at.push(Qt)}var Er=Object.getPrototypeOf(Xt.prototype).constructor;if(Er!==Object){var Fr=Ze(bt,Er);at=ie(ie([],at),Fr)}return at}function yt(bt,Xt){var Ct=Object.getPrototypeOf(Xt.prototype).constructor;if(Ct!==Object){var at=ce.getFunctionName(Ct),it=J(bt,at,Ct,!0),Vt=it.map(function(ft){return ft.metadata.filter(function(Je){return Je.key===Z.UNMANAGED_TAG})}),q=[].concat.apply([],Vt).length,$t=it.length-q;return $t>0?$t:yt(bt,Ct)}else return 0}$.getBaseClassDependencyCount=yt;function rr(bt){var Xt={};return bt.forEach(function(Ct){Xt[Ct.key.toString()]=Ct.value}),{inject:Xt[Z.INJECT_TAG],multiInject:Xt[Z.MULTI_INJECT_TAG],targetName:Xt[Z.NAME_TAG],unmanaged:Xt[Z.UNMANAGED_TAG]}}},6748:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Request=void 0;var ie=z(37791),re=function(){function m(de,Z,ce,fe,Le){this.id=ie.id(),this.serviceIdentifier=de,this.parentContext=Z,this.parentRequest=ce,this.target=Le,this.childRequests=[],this.bindings=Array.isArray(fe)?fe:[fe],this.requestScope=ce===null?new Map:null}return m.prototype.addChildRequest=function(de,Z,ce){var fe=new m(de,this.parentContext,this,Z,ce);return this.childRequests.push(fe),fe},m}();$.Request=re},18924:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.Target=void 0;var ie=z(6867),re=z(37791),m=z(47738),de=z(88460),Z=function(){function ce(fe,Le,J,Xe){this.id=re.id(),this.type=fe,this.serviceIdentifier=J,this.name=new de.QueryableString(Le||""),this.metadata=new Array;var et=null;typeof Xe=="string"?et=new m.Metadata(ie.NAMED_TAG,Xe):Xe instanceof m.Metadata&&(et=Xe),et!==null&&this.metadata.push(et)}return ce.prototype.hasTag=function(fe){for(var Le=0,J=this.metadata;Le<J.length;Le++){var Xe=J[Le];if(Xe.key===fe)return!0}return!1},ce.prototype.isArray=function(){return this.hasTag(ie.MULTI_INJECT_TAG)},ce.prototype.matchesArray=function(fe){return this.matchesTag(ie.MULTI_INJECT_TAG)(fe)},ce.prototype.isNamed=function(){return this.hasTag(ie.NAMED_TAG)},ce.prototype.isTagged=function(){return this.metadata.some(function(fe){return ie.NON_CUSTOM_TAG_KEYS.every(function(Le){return fe.key!==Le})})},ce.prototype.isOptional=function(){return this.matchesTag(ie.OPTIONAL_TAG)(!0)},ce.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(fe){return fe.key===ie.NAMED_TAG})[0]:null},ce.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(fe){return ie.NON_CUSTOM_TAG_KEYS.every(function(Le){return fe.key!==Le})}):null},ce.prototype.matchesNamedTag=function(fe){return this.matchesTag(ie.NAMED_TAG)(fe)},ce.prototype.matchesTag=function(fe){var Le=this;return function(J){for(var Xe=0,et=Le.metadata;Xe<et.length;Xe++){var Ze=et[Xe];if(Ze.key===fe&&Ze.value===J)return!0}return!1}},ce}();$.Target=Z},52279:function(It,$,z){"use strict";var ie=this&&this.__spreadArray||function(J,Xe){for(var et=0,Ze=Xe.length,yt=J.length;et<Ze;et++,yt++)J[yt]=Xe[et];return J};Object.defineProperty($,"__esModule",{value:!0}),$.resolveInstance=void 0;var re=z(16674),m=z(28421),de=z(6867);function Z(J,Xe,et){var Ze=Xe.filter(function(rr){return rr.target!==null&&rr.target.type===m.TargetTypeEnum.ClassProperty}),yt=Ze.map(et);return Ze.forEach(function(rr,bt){var Xt="";Xt=rr.target.name.value();var Ct=yt[bt];J[Xt]=Ct}),J}function ce(J,Xe){return new(J.bind.apply(J,ie([void 0],Xe)))}function fe(J,Xe){if(Reflect.hasMetadata(de.POST_CONSTRUCT,J)){var et=Reflect.getMetadata(de.POST_CONSTRUCT,J);try{Xe[et.value]()}catch(Ze){throw new Error(re.POST_CONSTRUCT_ERROR(J.name,Ze.message))}}}function Le(J,Xe,et){var Ze=null;if(Xe.length>0){var yt=Xe.filter(function(bt){return bt.target!==null&&bt.target.type===m.TargetTypeEnum.ConstructorArgument}),rr=yt.map(et);Ze=ce(J,rr),Ze=Z(Ze,Xe,et)}else Ze=new J;return fe(J,Ze),Ze}$.resolveInstance=Le},31927:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.resolve=void 0;var ie=z(16674),re=z(28421),m=z(85265),de=z(55800),Z=z(52279),ce=function(J,Xe,et){try{return et()}catch(Ze){throw m.isStackOverflowExeption(Ze)?new Error(ie.CIRCULAR_DEPENDENCY_IN_FACTORY(J,Xe.toString())):Ze}},fe=function(J){return function(Xe){Xe.parentContext.setCurrentRequest(Xe);var et=Xe.bindings,Ze=Xe.childRequests,yt=Xe.target&&Xe.target.isArray(),rr=!Xe.parentRequest||!Xe.parentRequest.target||!Xe.target||!Xe.parentRequest.target.matchesArray(Xe.target.serviceIdentifier);if(yt&&rr)return Ze.map(function(Vt){var q=fe(J);return q(Vt)});var bt=null;if(Xe.target.isOptional()&&et.length===0)return;var Xt=et[0],Ct=Xt.scope===re.BindingScopeEnum.Singleton,at=Xt.scope===re.BindingScopeEnum.Request;if(Ct&&Xt.activated)return Xt.cache;if(at&&J!==null&&J.has(Xt.id))return J.get(Xt.id);if(Xt.type===re.BindingTypeEnum.ConstantValue)bt=Xt.cache,Xt.activated=!0;else if(Xt.type===re.BindingTypeEnum.Function)bt=Xt.cache,Xt.activated=!0;else if(Xt.type===re.BindingTypeEnum.Constructor)bt=Xt.implementationType;else if(Xt.type===re.BindingTypeEnum.DynamicValue&&Xt.dynamicValue!==null)bt=ce("toDynamicValue",Xt.serviceIdentifier,function(){return Xt.dynamicValue(Xe.parentContext)});else if(Xt.type===re.BindingTypeEnum.Factory&&Xt.factory!==null)bt=ce("toFactory",Xt.serviceIdentifier,function(){return Xt.factory(Xe.parentContext)});else if(Xt.type===re.BindingTypeEnum.Provider&&Xt.provider!==null)bt=ce("toProvider",Xt.serviceIdentifier,function(){return Xt.provider(Xe.parentContext)});else if(Xt.type===re.BindingTypeEnum.Instance&&Xt.implementationType!==null)bt=Z.resolveInstance(Xt.implementationType,Ze,fe(J));else{var it=de.getServiceIdentifierAsString(Xe.serviceIdentifier);throw new Error(ie.INVALID_BINDING_TYPE+" "+it)}return typeof Xt.onActivation=="function"&&(bt=Xt.onActivation(Xe.parentContext,bt)),Ct&&(Xt.cache=bt,Xt.activated=!0),at&&J!==null&&!J.has(Xt.id)&&J.set(Xt.id,bt),bt}};function Le(J){var Xe=fe(J.plan.rootRequest.requestScope);return Xe(J.plan.rootRequest)}$.resolve=Le},83366:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingInSyntax=void 0;var ie=z(28421),re=z(71325),m=function(){function de(Z){this._binding=Z}return de.prototype.inRequestScope=function(){return this._binding.scope=ie.BindingScopeEnum.Request,new re.BindingWhenOnSyntax(this._binding)},de.prototype.inSingletonScope=function(){return this._binding.scope=ie.BindingScopeEnum.Singleton,new re.BindingWhenOnSyntax(this._binding)},de.prototype.inTransientScope=function(){return this._binding.scope=ie.BindingScopeEnum.Transient,new re.BindingWhenOnSyntax(this._binding)},de}();$.BindingInSyntax=m},74889:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingInWhenOnSyntax=void 0;var ie=z(83366),re=z(51811),m=z(98370),de=function(){function Z(ce){this._binding=ce,this._bindingWhenSyntax=new m.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new re.BindingOnSyntax(this._binding),this._bindingInSyntax=new ie.BindingInSyntax(ce)}return Z.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},Z.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},Z.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},Z.prototype.when=function(ce){return this._bindingWhenSyntax.when(ce)},Z.prototype.whenTargetNamed=function(ce){return this._bindingWhenSyntax.whenTargetNamed(ce)},Z.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Z.prototype.whenTargetTagged=function(ce,fe){return this._bindingWhenSyntax.whenTargetTagged(ce,fe)},Z.prototype.whenInjectedInto=function(ce){return this._bindingWhenSyntax.whenInjectedInto(ce)},Z.prototype.whenParentNamed=function(ce){return this._bindingWhenSyntax.whenParentNamed(ce)},Z.prototype.whenParentTagged=function(ce,fe){return this._bindingWhenSyntax.whenParentTagged(ce,fe)},Z.prototype.whenAnyAncestorIs=function(ce){return this._bindingWhenSyntax.whenAnyAncestorIs(ce)},Z.prototype.whenNoAncestorIs=function(ce){return this._bindingWhenSyntax.whenNoAncestorIs(ce)},Z.prototype.whenAnyAncestorNamed=function(ce){return this._bindingWhenSyntax.whenAnyAncestorNamed(ce)},Z.prototype.whenAnyAncestorTagged=function(ce,fe){return this._bindingWhenSyntax.whenAnyAncestorTagged(ce,fe)},Z.prototype.whenNoAncestorNamed=function(ce){return this._bindingWhenSyntax.whenNoAncestorNamed(ce)},Z.prototype.whenNoAncestorTagged=function(ce,fe){return this._bindingWhenSyntax.whenNoAncestorTagged(ce,fe)},Z.prototype.whenAnyAncestorMatches=function(ce){return this._bindingWhenSyntax.whenAnyAncestorMatches(ce)},Z.prototype.whenNoAncestorMatches=function(ce){return this._bindingWhenSyntax.whenNoAncestorMatches(ce)},Z.prototype.onActivation=function(ce){return this._bindingOnSyntax.onActivation(ce)},Z}();$.BindingInWhenOnSyntax=de},51811:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingOnSyntax=void 0;var ie=z(98370),re=function(){function m(de){this._binding=de}return m.prototype.onActivation=function(de){return this._binding.onActivation=de,new ie.BindingWhenSyntax(this._binding)},m}();$.BindingOnSyntax=re},15451:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingToSyntax=void 0;var ie=z(16674),re=z(28421),m=z(74889),de=z(71325),Z=function(){function ce(fe){this._binding=fe}return ce.prototype.to=function(fe){return this._binding.type=re.BindingTypeEnum.Instance,this._binding.implementationType=fe,new m.BindingInWhenOnSyntax(this._binding)},ce.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ie.INVALID_TO_SELF_VALUE);var fe=this._binding.serviceIdentifier;return this.to(fe)},ce.prototype.toConstantValue=function(fe){return this._binding.type=re.BindingTypeEnum.ConstantValue,this._binding.cache=fe,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=re.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ce.prototype.toDynamicValue=function(fe){return this._binding.type=re.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=fe,this._binding.implementationType=null,new m.BindingInWhenOnSyntax(this._binding)},ce.prototype.toConstructor=function(fe){return this._binding.type=re.BindingTypeEnum.Constructor,this._binding.implementationType=fe,this._binding.scope=re.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ce.prototype.toFactory=function(fe){return this._binding.type=re.BindingTypeEnum.Factory,this._binding.factory=fe,this._binding.scope=re.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ce.prototype.toFunction=function(fe){if(typeof fe!="function")throw new Error(ie.INVALID_FUNCTION_BINDING);var Le=this.toConstantValue(fe);return this._binding.type=re.BindingTypeEnum.Function,this._binding.scope=re.BindingScopeEnum.Singleton,Le},ce.prototype.toAutoFactory=function(fe){return this._binding.type=re.BindingTypeEnum.Factory,this._binding.factory=function(Le){var J=function(){return Le.container.get(fe)};return J},this._binding.scope=re.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ce.prototype.toProvider=function(fe){return this._binding.type=re.BindingTypeEnum.Provider,this._binding.provider=fe,this._binding.scope=re.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ce.prototype.toService=function(fe){this.toDynamicValue(function(Le){return Le.container.get(fe)})},ce}();$.BindingToSyntax=Z},71325:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingWhenOnSyntax=void 0;var ie=z(51811),re=z(98370),m=function(){function de(Z){this._binding=Z,this._bindingWhenSyntax=new re.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ie.BindingOnSyntax(this._binding)}return de.prototype.when=function(Z){return this._bindingWhenSyntax.when(Z)},de.prototype.whenTargetNamed=function(Z){return this._bindingWhenSyntax.whenTargetNamed(Z)},de.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},de.prototype.whenTargetTagged=function(Z,ce){return this._bindingWhenSyntax.whenTargetTagged(Z,ce)},de.prototype.whenInjectedInto=function(Z){return this._bindingWhenSyntax.whenInjectedInto(Z)},de.prototype.whenParentNamed=function(Z){return this._bindingWhenSyntax.whenParentNamed(Z)},de.prototype.whenParentTagged=function(Z,ce){return this._bindingWhenSyntax.whenParentTagged(Z,ce)},de.prototype.whenAnyAncestorIs=function(Z){return this._bindingWhenSyntax.whenAnyAncestorIs(Z)},de.prototype.whenNoAncestorIs=function(Z){return this._bindingWhenSyntax.whenNoAncestorIs(Z)},de.prototype.whenAnyAncestorNamed=function(Z){return this._bindingWhenSyntax.whenAnyAncestorNamed(Z)},de.prototype.whenAnyAncestorTagged=function(Z,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(Z,ce)},de.prototype.whenNoAncestorNamed=function(Z){return this._bindingWhenSyntax.whenNoAncestorNamed(Z)},de.prototype.whenNoAncestorTagged=function(Z,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(Z,ce)},de.prototype.whenAnyAncestorMatches=function(Z){return this._bindingWhenSyntax.whenAnyAncestorMatches(Z)},de.prototype.whenNoAncestorMatches=function(Z){return this._bindingWhenSyntax.whenNoAncestorMatches(Z)},de.prototype.onActivation=function(Z){return this._bindingOnSyntax.onActivation(Z)},de}();$.BindingWhenOnSyntax=m},98370:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.BindingWhenSyntax=void 0;var ie=z(51811),re=z(80758),m=function(){function de(Z){this._binding=Z}return de.prototype.when=function(Z){return this._binding.constraint=Z,new ie.BindingOnSyntax(this._binding)},de.prototype.whenTargetNamed=function(Z){return this._binding.constraint=re.namedConstraint(Z),new ie.BindingOnSyntax(this._binding)},de.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(Z){var ce=Z.target!==null&&!Z.target.isNamed()&&!Z.target.isTagged();return ce},new ie.BindingOnSyntax(this._binding)},de.prototype.whenTargetTagged=function(Z,ce){return this._binding.constraint=re.taggedConstraint(Z)(ce),new ie.BindingOnSyntax(this._binding)},de.prototype.whenInjectedInto=function(Z){return this._binding.constraint=function(ce){return re.typeConstraint(Z)(ce.parentRequest)},new ie.BindingOnSyntax(this._binding)},de.prototype.whenParentNamed=function(Z){return this._binding.constraint=function(ce){return re.namedConstraint(Z)(ce.parentRequest)},new ie.BindingOnSyntax(this._binding)},de.prototype.whenParentTagged=function(Z,ce){return this._binding.constraint=function(fe){return re.taggedConstraint(Z)(ce)(fe.parentRequest)},new ie.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorIs=function(Z){return this._binding.constraint=function(ce){return re.traverseAncerstors(ce,re.typeConstraint(Z))},new ie.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorIs=function(Z){return this._binding.constraint=function(ce){return!re.traverseAncerstors(ce,re.typeConstraint(Z))},new ie.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorNamed=function(Z){return this._binding.constraint=function(ce){return re.traverseAncerstors(ce,re.namedConstraint(Z))},new ie.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorNamed=function(Z){return this._binding.constraint=function(ce){return!re.traverseAncerstors(ce,re.namedConstraint(Z))},new ie.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorTagged=function(Z,ce){return this._binding.constraint=function(fe){return re.traverseAncerstors(fe,re.taggedConstraint(Z)(ce))},new ie.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorTagged=function(Z,ce){return this._binding.constraint=function(fe){return!re.traverseAncerstors(fe,re.taggedConstraint(Z)(ce))},new ie.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorMatches=function(Z){return this._binding.constraint=function(ce){return re.traverseAncerstors(ce,Z)},new ie.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorMatches=function(Z){return this._binding.constraint=function(ce){return!re.traverseAncerstors(ce,Z)},new ie.BindingOnSyntax(this._binding)},de}();$.BindingWhenSyntax=m},80758:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.typeConstraint=$.namedConstraint=$.taggedConstraint=$.traverseAncerstors=void 0;var ie=z(6867),re=z(47738),m=function(fe,Le){var J=fe.parentRequest;return J!==null?Le(J)?!0:m(J,Le):!1};$.traverseAncerstors=m;var de=function(fe){return function(Le){var J=function(Xe){return Xe!==null&&Xe.target!==null&&Xe.target.matchesTag(fe)(Le)};return J.metaData=new re.Metadata(fe,Le),J}};$.taggedConstraint=de;var Z=de(ie.NAMED_TAG);$.namedConstraint=Z;var ce=function(fe){return function(Le){var J=null;if(Le!==null)if(J=Le.bindings[0],typeof fe=="string"){var Xe=J.serviceIdentifier;return Xe===fe}else{var et=Le.bindings[0].implementationType;return fe===et}return!1}};$.typeConstraint=ce},70600:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.multiBindToService=void 0;var z=function(ie){return function(re){return function(){for(var m=[],de=0;de<arguments.length;de++)m[de]=arguments[de];return m.forEach(function(Z){return ie.bind(Z).toService(re)})}}};$.multiBindToService=z},85265:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.isStackOverflowExeption=void 0;var ie=z(16674);function re(m){return m instanceof RangeError||m.message===ie.STACK_OVERFLOW}$.isStackOverflowExeption=re},37791:function(It,$){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.id=void 0;var z=0;function ie(){return z++}$.id=ie},55800:function(It,$,z){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.circularDependencyToException=$.listMetadataForTarget=$.listRegisteredBindingsForServiceIdentifier=$.getServiceIdentifierAsString=$.getFunctionName=void 0;var ie=z(16674);function re(J){if(typeof J=="function"){var Xe=J;return Xe.name}else{if(typeof J=="symbol")return J.toString();var Xe=J;return Xe}}$.getServiceIdentifierAsString=re;function m(J,Xe,et){var Ze="",yt=et(J,Xe);return yt.length!==0&&(Ze=`
Registered bindings:`,yt.forEach(function(rr){var bt="Object";rr.implementationType!==null&&(bt=Le(rr.implementationType)),Ze=Ze+`
 `+bt,rr.constraint.metaData&&(Ze=Ze+" - "+rr.constraint.metaData)})),Ze}$.listRegisteredBindingsForServiceIdentifier=m;function de(J,Xe){return J.parentRequest===null?!1:J.parentRequest.serviceIdentifier===Xe?!0:de(J.parentRequest,Xe)}function Z(J){function Xe(Ze,yt){yt===void 0&&(yt=[]);var rr=re(Ze.serviceIdentifier);return yt.push(rr),Ze.parentRequest!==null?Xe(Ze.parentRequest,yt):yt}var et=Xe(J);return et.reverse().join(" --> ")}function ce(J){J.childRequests.forEach(function(Xe){if(de(Xe,Xe.serviceIdentifier)){var et=Z(Xe);throw new Error(ie.CIRCULAR_DEPENDENCY+" "+et)}else ce(Xe)})}$.circularDependencyToException=ce;function fe(J,Xe){if(Xe.isTagged()||Xe.isNamed()){var et="",Ze=Xe.getNamedTag(),yt=Xe.getCustomTags();return Ze!==null&&(et+=Ze.toString()+`
`),yt!==null&&yt.forEach(function(rr){et+=rr.toString()+`
`})," "+J+`
 `+J+" - "+et}else return" "+J}$.listMetadataForTarget=fe;function Le(J){if(J.name)return J.name;var Xe=J.toString(),et=Xe.match(/^function\s*([^\s(]+)/);return et?et[1]:"Anonymous function: "+Xe}$.getFunctionName=Le},31745:function(It){"use strict";It.exports=z,It.exports.default=z;var $=1e20;function z(Z,ce,fe,Le,J,Xe){this.fontSize=Z||24,this.buffer=ce===void 0?3:ce,this.cutoff=Le||.25,this.fontFamily=J||"sans-serif",this.fontWeight=Xe||"normal",this.radius=fe||8;var et=this.size=this.fontSize+this.buffer*2,Ze=et+this.buffer*2,yt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;yt?this.canvas=my.createOffscreenCanvas(et,et,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=et),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Ze*Ze),this.gridInner=new Float64Array(Ze*Ze),this.f=new Float64Array(Ze),this.z=new Float64Array(Ze+1),this.v=new Uint16Array(Ze),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,yt?this.middle=Math.round(et/2*1):this.middle=Math.round(et/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ie(Z,ce,fe,Le,J,Xe,et){Xe.fill($,0,ce*fe),et.fill(0,0,ce*fe);for(var Ze=(ce-Le)/2,yt=0;yt<J;yt++)for(var rr=0;rr<Le;rr++){var bt=(yt+Ze)*ce+rr+Ze,Xt=Z.data[4*(yt*Le+rr)+3]/255;if(Xt===1)Xe[bt]=0,et[bt]=$;else if(Xt===0)Xe[bt]=$,et[bt]=0;else{var Ct=Math.max(0,.5-Xt),at=Math.max(0,Xt-.5);Xe[bt]=Ct*Ct,et[bt]=at*at}}}function re(Z,ce,fe,Le,J,Xe,et){for(var Ze=0;Ze<ce*fe;Ze++){var yt=Math.sqrt(Le[Ze])-Math.sqrt(J[Ze]);Z[Ze]=Math.round(255-255*(yt/Xe+et))}}z.prototype._draw=function(Z,ce){var fe=this.ctx.measureText(Z),Le=fe.width,J=2*this.buffer,Xe,et,Ze,yt,rr,bt,Xt,Ct;ce&&this.useMetrics?(rr=Math.floor(fe.actualBoundingBoxAscent),Ct=this.buffer+Math.ceil(fe.actualBoundingBoxAscent),bt=this.buffer,Xt=this.buffer,et=Math.min(this.size,Math.ceil(fe.actualBoundingBoxRight-fe.actualBoundingBoxLeft)),yt=Math.min(this.size-bt,Math.ceil(fe.actualBoundingBoxAscent+fe.actualBoundingBoxDescent)),Xe=et+J,Ze=yt+J,this.ctx.textBaseline="alphabetic"):(Xe=et=this.size,Ze=yt=this.size,rr=19*this.fontSize/24,bt=Xt=0,Ct=this.middle,this.ctx.textBaseline="middle");var at;et&&yt&&(this.ctx.clearRect(Xt,bt,et,yt),this.ctx.fillText(Z,this.buffer,Ct),at=this.ctx.getImageData(Xt,bt,et,yt));var it=new Uint8ClampedArray(Xe*Ze);return ie(at,Xe,Ze,et,yt,this.gridOuter,this.gridInner),m(this.gridOuter,Xe,Ze,this.f,this.v,this.z),m(this.gridInner,Xe,Ze,this.f,this.v,this.z),re(it,Xe,Ze,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:it,metrics:{width:et,height:yt,sdfWidth:Xe,sdfHeight:Ze,top:rr,left:0,advance:Le}}},z.prototype.draw=function(Z){return this._draw(Z,!1).data},z.prototype.drawWithMetrics=function(Z){return this._draw(Z,!0)};function m(Z,ce,fe,Le,J,Xe){for(var et=0;et<ce;et++)de(Z,et,ce,fe,Le,J,Xe);for(var Ze=0;Ze<fe;Ze++)de(Z,Ze*ce,1,ce,Le,J,Xe)}function de(Z,ce,fe,Le,J,Xe,et){var Ze,yt,rr,bt;for(Xe[0]=0,et[0]=-$,et[1]=$,Ze=0;Ze<Le;Ze++)J[Ze]=Z[ce+Ze*fe];for(Ze=1,yt=0,rr=0;Ze<Le;Ze++){do bt=Xe[yt],rr=(J[Ze]-J[bt]+Ze*Ze-bt*bt)/(Ze-bt)/2;while(rr<=et[yt]&&--yt>-1);yt++,Xe[yt]=Ze,et[yt]=rr,et[yt+1]=$}for(Ze=0,yt=0;Ze<Le;Ze++){for(;et[yt+1]<Ze;)yt++;bt=Xe[yt],Z[ce+Ze*fe]=J[bt]+(Ze-bt)*(Ze-bt)}}},18857:function(It,$,z){"use strict";z.r($),z.d($,{Function:function(){return Ks},Interpreter:function(){return Ca},default:function(){return pl},evaluate:function(){return Ju},vm:function(){return ie}});var ie={};z.r(ie),z.d(ie,{Script:function(){return ac},compileFunction:function(){return of},createContext:function(){return fs},runInContext:function(){return Il},runInNewContext:function(){return qs}});var re={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},m="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",de={5:m,"5module":m+" export import",6:m+" const class extends export import super"},Z=/^in(stanceof)?$/,ce="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",fe="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Le=new RegExp("["+ce+"]"),J=new RegExp("["+ce+fe+"]");ce=fe=null;var Xe=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],et=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Ze(_,P){for(var F=65536,R=0;R<P.length;R+=2){if(F+=P[R],F>_)return!1;if(F+=P[R+1],F>=_)return!0}}function yt(_,P){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&Le.test(String.fromCharCode(_)):P===!1?!1:Ze(_,Xe)}function rr(_,P){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&J.test(String.fromCharCode(_)):P===!1?!1:Ze(_,Xe)||Ze(_,et)}var bt=function(P,F){F===void 0&&(F={}),this.label=P,this.keyword=F.keyword,this.beforeExpr=!!F.beforeExpr,this.startsExpr=!!F.startsExpr,this.isLoop=!!F.isLoop,this.isAssign=!!F.isAssign,this.prefix=!!F.prefix,this.postfix=!!F.postfix,this.binop=F.binop||null,this.updateContext=null};function Xt(_,P){return new bt(_,{beforeExpr:!0,binop:P})}var Ct={beforeExpr:!0},at={startsExpr:!0},it={};function Vt(_,P){return P===void 0&&(P={}),P.keyword=_,it[_]=new bt(_,P)}var q={num:new bt("num",at),regexp:new bt("regexp",at),string:new bt("string",at),name:new bt("name",at),eof:new bt("eof"),bracketL:new bt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new bt("]"),braceL:new bt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new bt("}"),parenL:new bt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new bt(")"),comma:new bt(",",Ct),semi:new bt(";",Ct),colon:new bt(":",Ct),dot:new bt("."),question:new bt("?",Ct),questionDot:new bt("?."),arrow:new bt("=>",Ct),template:new bt("template"),invalidTemplate:new bt("invalidTemplate"),ellipsis:new bt("...",Ct),backQuote:new bt("`",at),dollarBraceL:new bt("${",{beforeExpr:!0,startsExpr:!0}),eq:new bt("=",{beforeExpr:!0,isAssign:!0}),assign:new bt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new bt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new bt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Xt("||",1),logicalAND:Xt("&&",2),bitwiseOR:Xt("|",3),bitwiseXOR:Xt("^",4),bitwiseAND:Xt("&",5),equality:Xt("==/!=/===/!==",6),relational:Xt("</>/<=/>=",7),bitShift:Xt("<</>>/>>>",8),plusMin:new bt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Xt("%",10),star:Xt("*",10),slash:Xt("/",10),starstar:new bt("**",{beforeExpr:!0}),coalesce:Xt("??",1),_break:Vt("break"),_case:Vt("case",Ct),_catch:Vt("catch"),_continue:Vt("continue"),_debugger:Vt("debugger"),_default:Vt("default",Ct),_do:Vt("do",{isLoop:!0,beforeExpr:!0}),_else:Vt("else",Ct),_finally:Vt("finally"),_for:Vt("for",{isLoop:!0}),_function:Vt("function",at),_if:Vt("if"),_return:Vt("return",Ct),_switch:Vt("switch"),_throw:Vt("throw",Ct),_try:Vt("try"),_var:Vt("var"),_const:Vt("const"),_while:Vt("while",{isLoop:!0}),_with:Vt("with"),_new:Vt("new",{beforeExpr:!0,startsExpr:!0}),_this:Vt("this",at),_super:Vt("super",at),_class:Vt("class",at),_extends:Vt("extends",Ct),_export:Vt("export"),_import:Vt("import",at),_null:Vt("null",at),_true:Vt("true",at),_false:Vt("false",at),_in:Vt("in",{beforeExpr:!0,binop:7}),_instanceof:Vt("instanceof",{beforeExpr:!0,binop:7}),_typeof:Vt("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Vt("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Vt("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},$t=/\r\n?|\n|\u2028|\u2029/,ft=new RegExp($t.source,"g");function Je(_,P){return _===10||_===13||!P&&(_===8232||_===8233)}var wt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Qe=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Qt=Object.prototype,Er=Qt.hasOwnProperty,Fr=Qt.toString;function Jr(_,P){return Er.call(_,P)}var A=Array.isArray||function(_){return Fr.call(_)==="[object Array]"};function Ce(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var De=function(P,F){this.line=P,this.column=F};De.prototype.offset=function(P){return new De(this.line,this.column+P)};var Tt=function(P,F,R){this.start=F,this.end=R,P.sourceFile!==null&&(this.source=P.sourceFile)};function gt(_,P){for(var F=1,R=0;;){ft.lastIndex=R;var K=ft.exec(_);if(K&&K.index<P)++F,R=K.index+K[0].length;else return new De(F,P-R)}}var Bt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Kt(_){var P={};for(var F in Bt)P[F]=_&&Jr(_,F)?_[F]:Bt[F];if(P.ecmaVersion>=2015&&(P.ecmaVersion-=2009),P.allowReserved==null&&(P.allowReserved=P.ecmaVersion<5),A(P.onToken)){var R=P.onToken;P.onToken=function(K){return R.push(K)}}return A(P.onComment)&&(P.onComment=Cr(P,P.onComment)),P}function Cr(_,P){return function(F,R,K,xe,We,pt){var dt={type:F?"Block":"Line",value:R,start:K,end:xe};_.locations&&(dt.loc=new Tt(this,We,pt)),_.ranges&&(dt.range=[K,xe]),P.push(dt)}}var Qn=1,vn=2,fi=Qn|vn,Gn=4,ii=8,hi=16,Wn=32,pi=64,la=128;function Gi(_,P){return vn|(_?Gn:0)|(P?ii:0)}var Oi=0,$i=1,ca=2,wi=3,xa=4,qn=5,Ci=function(P,F,R){this.options=P=Kt(P),this.sourceFile=P.sourceFile,this.keywords=Ce(de[P.ecmaVersion>=6?6:P.sourceType==="module"?"5module":5]);var K="";if(P.allowReserved!==!0){for(var xe=P.ecmaVersion;!(K=re[xe]);xe--);P.sourceType==="module"&&(K+=" await")}this.reservedWords=Ce(K);var We=(K?K+" ":"")+re.strict;this.reservedWordsStrict=Ce(We),this.reservedWordsStrictBind=Ce(We+" "+re.strictBind),this.input=String(F),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split($t).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=q.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=P.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&P.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Qn),this.regexpState=null},Zi={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Ci.prototype.parse=function(){var P=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(P)},Zi.inFunction.get=function(){return(this.currentVarScope().flags&vn)>0},Zi.inGenerator.get=function(){return(this.currentVarScope().flags&ii)>0},Zi.inAsync.get=function(){return(this.currentVarScope().flags&Gn)>0},Zi.allowSuper.get=function(){return(this.currentThisScope().flags&pi)>0},Zi.allowDirectSuper.get=function(){return(this.currentThisScope().flags&la)>0},Zi.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Ci.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&vn)>0},Ci.extend=function(){for(var P=[],F=arguments.length;F--;)P[F]=arguments[F];for(var R=this,K=0;K<P.length;K++)R=P[K](R);return R},Ci.parse=function(P,F){return new this(F,P).parse()},Ci.parseExpressionAt=function(P,F,R){var K=new this(R,P,F);return K.nextToken(),K.parseExpression()},Ci.tokenizer=function(P,F){return new this(F,P)},Object.defineProperties(Ci.prototype,Zi);var Qi=Ci.prototype,Zo=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Qi.strictDirective=function(_){for(;;){Qe.lastIndex=_,_+=Qe.exec(this.input)[0].length;var P=Zo.exec(this.input.slice(_));if(!P)return!1;if((P[1]||P[2])==="use strict"){Qe.lastIndex=_+P[0].length;var F=Qe.exec(this.input),R=F.index+F[0].length,K=this.input.charAt(R);return K===";"||K==="}"||$t.test(F[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(K)||K==="!"&&this.input.charAt(R+1)==="=")}_+=P[0].length,Qe.lastIndex=_,_+=Qe.exec(this.input)[0].length,this.input[_]===";"&&_++}},Qi.eat=function(_){return this.type===_?(this.next(),!0):!1},Qi.isContextual=function(_){return this.type===q.name&&this.value===_&&!this.containsEsc},Qi.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},Qi.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},Qi.canInsertSemicolon=function(){return this.type===q.eof||this.type===q.braceR||$t.test(this.input.slice(this.lastTokEnd,this.start))},Qi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Qi.semicolon=function(){!this.eat(q.semi)&&!this.insertSemicolon()&&this.unexpected()},Qi.afterTrailingComma=function(_,P){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),P||this.next(),!0},Qi.expect=function(_){this.eat(_)||this.unexpected()},Qi.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function me(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Qi.checkPatternErrors=function(_,P){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var F=P?_.parenthesizedAssign:_.parenthesizedBind;F>-1&&this.raiseRecoverable(F,"Parenthesized pattern")}},Qi.checkExpressionErrors=function(_,P){if(!_)return!1;var F=_.shorthandAssign,R=_.doubleProto;if(!P)return F>=0||R>=0;F>=0&&this.raise(F,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},Qi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Qi.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var Dn=Ci.prototype;Dn.parseTopLevel=function(_){var P={};for(_.body||(_.body=[]);this.type!==q.eof;){var F=this.parseStatement(null,!0,P);_.body.push(F)}if(this.inModule)for(var R=0,K=Object.keys(this.undefinedExports);R<K.length;R+=1){var xe=K[R];this.raiseRecoverable(this.undefinedExports[xe].start,"Export '"+xe+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var Xa={kind:"loop"},cs={kind:"switch"};Dn.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Qe.lastIndex=this.pos;var P=Qe.exec(this.input),F=this.pos+P[0].length,R=this.input.charCodeAt(F);if(R===91)return!0;if(_)return!1;if(R===123)return!0;if(yt(R,!0)){for(var K=F+1;rr(this.input.charCodeAt(K),!0);)++K;var xe=this.input.slice(F,K);if(!Z.test(xe))return!0}return!1},Dn.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Qe.lastIndex=this.pos;var _=Qe.exec(this.input),P=this.pos+_[0].length;return!$t.test(this.input.slice(this.pos,P))&&this.input.slice(P,P+8)==="function"&&(P+8===this.input.length||!rr(this.input.charAt(P+8)))},Dn.parseStatement=function(_,P,F){var R=this.type,K=this.startNode(),xe;switch(this.isLet(_)&&(R=q._var,xe="let"),R){case q._break:case q._continue:return this.parseBreakContinueStatement(K,R.keyword);case q._debugger:return this.parseDebuggerStatement(K);case q._do:return this.parseDoStatement(K);case q._for:return this.parseForStatement(K);case q._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(K,!1,!_);case q._class:return _&&this.unexpected(),this.parseClass(K,!0);case q._if:return this.parseIfStatement(K);case q._return:return this.parseReturnStatement(K);case q._switch:return this.parseSwitchStatement(K);case q._throw:return this.parseThrowStatement(K);case q._try:return this.parseTryStatement(K);case q._const:case q._var:return xe=xe||this.value,_&&xe!=="var"&&this.unexpected(),this.parseVarStatement(K,xe);case q._while:return this.parseWhileStatement(K);case q._with:return this.parseWithStatement(K);case q.braceL:return this.parseBlock(!0,K);case q.semi:return this.parseEmptyStatement(K);case q._export:case q._import:if(this.options.ecmaVersion>10&&R===q._import){Qe.lastIndex=this.pos;var We=Qe.exec(this.input),pt=this.pos+We[0].length,dt=this.input.charCodeAt(pt);if(dt===40||dt===46)return this.parseExpressionStatement(K,this.parseExpression())}return this.options.allowImportExportEverywhere||(P||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===q._import?this.parseImport(K):this.parseExport(K,F);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(K,!0,!_);var sr=this.value,cr=this.parseExpression();return R===q.name&&cr.type==="Identifier"&&this.eat(q.colon)?this.parseLabeledStatement(K,sr,cr,_):this.parseExpressionStatement(K,cr)}},Dn.parseBreakContinueStatement=function(_,P){var F=P==="break";this.next(),this.eat(q.semi)||this.insertSemicolon()?_.label=null:this.type!==q.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var K=this.labels[R];if((_.label==null||K.name===_.label.name)&&(K.kind!=null&&(F||K.kind==="loop")||_.label&&F))break}return R===this.labels.length&&this.raise(_.start,"Unsyntactic "+P),this.finishNode(_,F?"BreakStatement":"ContinueStatement")},Dn.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},Dn.parseDoStatement=function(_){return this.next(),this.labels.push(Xa),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(q._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(q.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},Dn.parseForStatement=function(_){this.next();var P=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Xa),this.enterScope(0),this.expect(q.parenL),this.type===q.semi)return P>-1&&this.unexpected(P),this.parseFor(_,null);var F=this.isLet();if(this.type===q._var||this.type===q._const||F){var R=this.startNode(),K=F?"let":this.value;return this.next(),this.parseVar(R,!0,K),this.finishNode(R,"VariableDeclaration"),(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===q._in?P>-1&&this.unexpected(P):_.await=P>-1),this.parseForIn(_,R)):(P>-1&&this.unexpected(P),this.parseFor(_,R))}var xe=new me,We=this.parseExpression(!0,xe);return this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===q._in?P>-1&&this.unexpected(P):_.await=P>-1),this.toAssignable(We,!1,xe),this.checkLVal(We),this.parseForIn(_,We)):(this.checkExpressionErrors(xe,!0),P>-1&&this.unexpected(P),this.parseFor(_,We))},Dn.parseFunctionStatement=function(_,P,F){return this.next(),this.parseFunction(_,nr|(F?0:Ar),!1,P)},Dn.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(q._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},Dn.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(q.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},Dn.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(q.braceL),this.labels.push(cs),this.enterScope(0);for(var P,F=!1;this.type!==q.braceR;)if(this.type===q._case||this.type===q._default){var R=this.type===q._case;P&&this.finishNode(P,"SwitchCase"),_.cases.push(P=this.startNode()),P.consequent=[],this.next(),R?P.test=this.parseExpression():(F&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),F=!0,P.test=null),this.expect(q.colon)}else P||this.unexpected(),P.consequent.push(this.parseStatement(null));return this.exitScope(),P&&this.finishNode(P,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},Dn.parseThrowStatement=function(_){return this.next(),$t.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var Nt=[];Dn.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===q._catch){var P=this.startNode();if(this.next(),this.eat(q.parenL)){P.param=this.parseBindingAtom();var F=P.param.type==="Identifier";this.enterScope(F?Wn:0),this.checkLVal(P.param,F?xa:ca),this.expect(q.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),P.param=null,this.enterScope(0);P.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(P,"CatchClause")}return _.finalizer=this.eat(q._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},Dn.parseVarStatement=function(_,P){return this.next(),this.parseVar(_,!1,P),this.semicolon(),this.finishNode(_,"VariableDeclaration")},Dn.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(Xa),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},Dn.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},Dn.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},Dn.parseLabeledStatement=function(_,P,F,R){for(var K=0,xe=this.labels;K<xe.length;K+=1){var We=xe[K];We.name===P&&this.raise(F.start,"Label '"+P+"' is already declared")}for(var pt=this.type.isLoop?"loop":this.type===q._switch?"switch":null,dt=this.labels.length-1;dt>=0;dt--){var sr=this.labels[dt];if(sr.statementStart===_.start)sr.statementStart=this.start,sr.kind=pt;else break}return this.labels.push({name:P,kind:pt,statementStart:this.start}),_.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),_.label=F,this.finishNode(_,"LabeledStatement")},Dn.parseExpressionStatement=function(_,P){return _.expression=P,this.semicolon(),this.finishNode(_,"ExpressionStatement")},Dn.parseBlock=function(_,P,F){for(_===void 0&&(_=!0),P===void 0&&(P=this.startNode()),P.body=[],this.expect(q.braceL),_&&this.enterScope(0);this.type!==q.braceR;){var R=this.parseStatement(null);P.body.push(R)}return F&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(P,"BlockStatement")},Dn.parseFor=function(_,P){return _.init=P,this.expect(q.semi),_.test=this.type===q.semi?null:this.parseExpression(),this.expect(q.semi),_.update=this.type===q.parenR?null:this.parseExpression(),this.expect(q.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},Dn.parseForIn=function(_,P){var F=this.type===q._in;return this.next(),P.type==="VariableDeclaration"&&P.declarations[0].init!=null&&(!F||this.options.ecmaVersion<8||this.strict||P.kind!=="var"||P.declarations[0].id.type!=="Identifier")?this.raise(P.start,(F?"for-in":"for-of")+" loop variable declaration may not have an initializer"):P.type==="AssignmentPattern"&&this.raise(P.start,"Invalid left-hand side in for-loop"),_.left=P,_.right=F?this.parseExpression():this.parseMaybeAssign(),this.expect(q.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,F?"ForInStatement":"ForOfStatement")},Dn.parseVar=function(_,P,F){for(_.declarations=[],_.kind=F;;){var R=this.startNode();if(this.parseVarId(R,F),this.eat(q.eq)?R.init=this.parseMaybeAssign(P):F==="const"&&!(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(P&&(this.type===q._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,_.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(q.comma))break}return _},Dn.parseVarId=function(_,P){_.id=this.parseBindingAtom(),this.checkLVal(_.id,P==="var"?$i:ca,!1)};var nr=1,Ar=2,en=4;Dn.parseFunction=function(_,P,F,R){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===q.star&&P&Ar&&this.unexpected(),_.generator=this.eat(q.star)),this.options.ecmaVersion>=8&&(_.async=!!R),P&nr&&(_.id=P&en&&this.type!==q.name?null:this.parseIdent(),_.id&&!(P&Ar)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?$i:ca:wi));var K=this.yieldPos,xe=this.awaitPos,We=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Gi(_.async,_.generator)),P&nr||(_.id=this.type===q.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,F,!1),this.yieldPos=K,this.awaitPos=xe,this.awaitIdentPos=We,this.finishNode(_,P&nr?"FunctionDeclaration":"FunctionExpression")},Dn.parseFunctionParams=function(_){this.expect(q.parenL),_.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Dn.parseClass=function(_,P){this.next();var F=this.strict;this.strict=!0,this.parseClassId(_,P),this.parseClassSuper(_);var R=this.startNode(),K=!1;for(R.body=[],this.expect(q.braceL);this.type!==q.braceR;){var xe=this.parseClassElement(_.superClass!==null);xe&&(R.body.push(xe),xe.type==="MethodDefinition"&&xe.kind==="constructor"&&(K&&this.raise(xe.start,"Duplicate constructor in the same class"),K=!0))}return this.strict=F,this.next(),_.body=this.finishNode(R,"ClassBody"),this.finishNode(_,P?"ClassDeclaration":"ClassExpression")},Dn.parseClassElement=function(_){var P=this;if(this.eat(q.semi))return null;var F=this.startNode(),R=function(dt,sr){sr===void 0&&(sr=!1);var cr=P.start,Pn=P.startLoc;return P.eatContextual(dt)?P.type!==q.parenL&&(!sr||!P.canInsertSemicolon())?!0:(F.key&&P.unexpected(),F.computed=!1,F.key=P.startNodeAt(cr,Pn),F.key.name=dt,P.finishNode(F.key,"Identifier"),!1):!1};F.kind="method",F.static=R("static");var K=this.eat(q.star),xe=!1;K||(this.options.ecmaVersion>=8&&R("async",!0)?(xe=!0,K=this.options.ecmaVersion>=9&&this.eat(q.star)):R("get")?F.kind="get":R("set")&&(F.kind="set")),F.key||this.parsePropertyName(F);var We=F.key,pt=!1;return!F.computed&&!F.static&&(We.type==="Identifier"&&We.name==="constructor"||We.type==="Literal"&&We.value==="constructor")?(F.kind!=="method"&&this.raise(We.start,"Constructor can't have get/set modifier"),K&&this.raise(We.start,"Constructor can't be a generator"),xe&&this.raise(We.start,"Constructor can't be an async method"),F.kind="constructor",pt=_):F.static&&We.type==="Identifier"&&We.name==="prototype"&&this.raise(We.start,"Classes may not have a static property named prototype"),this.parseClassMethod(F,K,xe,pt),F.kind==="get"&&F.value.params.length!==0&&this.raiseRecoverable(F.value.start,"getter should have no params"),F.kind==="set"&&F.value.params.length!==1&&this.raiseRecoverable(F.value.start,"setter should have exactly one param"),F.kind==="set"&&F.value.params[0].type==="RestElement"&&this.raiseRecoverable(F.value.params[0].start,"Setter cannot use rest params"),F},Dn.parseClassMethod=function(_,P,F,R){return _.value=this.parseMethod(P,F,R),this.finishNode(_,"MethodDefinition")},Dn.parseClassId=function(_,P){this.type===q.name?(_.id=this.parseIdent(),P&&this.checkLVal(_.id,ca,!1)):(P===!0&&this.unexpected(),_.id=null)},Dn.parseClassSuper=function(_){_.superClass=this.eat(q._extends)?this.parseExprSubscripts():null},Dn.parseExport=function(_,P){if(this.next(),this.eat(q.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(P,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==q.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(q._default)){this.checkExport(P,"default",this.lastTokStart);var F;if(this.type===q._function||(F=this.isAsyncFunction())){var R=this.startNode();this.next(),F&&this.next(),_.declaration=this.parseFunction(R,nr|en,!1,F)}else if(this.type===q._class){var K=this.startNode();_.declaration=this.parseClass(K,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(P,_.declaration.declarations):this.checkExport(P,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(P),this.eatContextual("from"))this.type!==q.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var xe=0,We=_.specifiers;xe<We.length;xe+=1){var pt=We[xe];this.checkUnreserved(pt.local),this.checkLocalExport(pt.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},Dn.checkExport=function(_,P,F){!_||(Jr(_,P)&&this.raiseRecoverable(F,"Duplicate export '"+P+"'"),_[P]=!0)},Dn.checkPatternExport=function(_,P){var F=P.type;if(F==="Identifier")this.checkExport(_,P.name,P.start);else if(F==="ObjectPattern")for(var R=0,K=P.properties;R<K.length;R+=1){var xe=K[R];this.checkPatternExport(_,xe)}else if(F==="ArrayPattern")for(var We=0,pt=P.elements;We<pt.length;We+=1){var dt=pt[We];dt&&this.checkPatternExport(_,dt)}else F==="Property"?this.checkPatternExport(_,P.value):F==="AssignmentPattern"?this.checkPatternExport(_,P.left):F==="RestElement"?this.checkPatternExport(_,P.argument):F==="ParenthesizedExpression"&&this.checkPatternExport(_,P.expression)},Dn.checkVariableExport=function(_,P){if(!!_)for(var F=0,R=P;F<R.length;F+=1){var K=R[F];this.checkPatternExport(_,K.id)}},Dn.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Dn.parseExportSpecifiers=function(_){var P=[],F=!0;for(this.expect(q.braceL);!this.eat(q.braceR);){if(F)F=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(_,R.exported.name,R.exported.start),P.push(this.finishNode(R,"ExportSpecifier"))}return P},Dn.parseImport=function(_){return this.next(),this.type===q.string?(_.specifiers=Nt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===q.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},Dn.parseImportSpecifiers=function(){var _=[],P=!0;if(this.type===q.name){var F=this.startNode();if(F.local=this.parseIdent(),this.checkLVal(F.local,ca),_.push(this.finishNode(F,"ImportDefaultSpecifier")),!this.eat(q.comma))return _}if(this.type===q.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,ca),_.push(this.finishNode(R,"ImportNamespaceSpecifier")),_}for(this.expect(q.braceL);!this.eat(q.braceR);){if(P)P=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var K=this.startNode();K.imported=this.parseIdent(!0),this.eatContextual("as")?K.local=this.parseIdent():(this.checkUnreserved(K.imported),K.local=K.imported),this.checkLVal(K.local,ca),_.push(this.finishNode(K,"ImportSpecifier"))}return _},Dn.adaptDirectivePrologue=function(_){for(var P=0;P<_.length&&this.isDirectiveCandidate(_[P]);++P)_[P].directive=_[P].expression.raw.slice(1,-1)},Dn.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var wn=Ci.prototype;wn.toAssignable=function(_,P,F){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",F&&this.checkPatternErrors(F,!0);for(var R=0,K=_.properties;R<K.length;R+=1){var xe=K[R];this.toAssignable(xe,P),xe.type==="RestElement"&&(xe.argument.type==="ArrayPattern"||xe.argument.type==="ObjectPattern")&&this.raise(xe.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,P);break;case"ArrayExpression":_.type="ArrayPattern",F&&this.checkPatternErrors(F,!0),this.toAssignableList(_.elements,P);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,P),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,P);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,P,F);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!P)break;default:this.raise(_.start,"Assigning to rvalue")}else F&&this.checkPatternErrors(F,!0);return _},wn.toAssignableList=function(_,P){for(var F=_.length,R=0;R<F;R++){var K=_[R];K&&this.toAssignable(K,P)}if(F){var xe=_[F-1];this.options.ecmaVersion===6&&P&&xe&&xe.type==="RestElement"&&xe.argument.type!=="Identifier"&&this.unexpected(xe.argument.start)}return _},wn.parseSpread=function(_){var P=this.startNode();return this.next(),P.argument=this.parseMaybeAssign(!1,_),this.finishNode(P,"SpreadElement")},wn.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==q.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},wn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case q.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(q.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case q.braceL:return this.parseObj(!0)}return this.parseIdent()},wn.parseBindingList=function(_,P,F){for(var R=[],K=!0;!this.eat(_);)if(K?K=!1:this.expect(q.comma),P&&this.type===q.comma)R.push(null);else{if(F&&this.afterTrailingComma(_))break;if(this.type===q.ellipsis){var xe=this.parseRestBinding();this.parseBindingListItem(xe),R.push(xe),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var We=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(We),R.push(We)}}return R},wn.parseBindingListItem=function(_){return _},wn.parseMaybeDefault=function(_,P,F){if(F=F||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(q.eq))return F;var R=this.startNodeAt(_,P);return R.left=F,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},wn.checkLVal=function(_,P,F){switch(P===void 0&&(P=Oi),_.type){case"Identifier":P===ca&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(P?"Binding ":"Assigning to ")+_.name+" in strict mode"),F&&(Jr(F,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),F[_.name]=!0),P!==Oi&&P!==qn&&this.declareName(_.name,P,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":P&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,K=_.properties;R<K.length;R+=1){var xe=K[R];this.checkLVal(xe,P,F)}break;case"Property":this.checkLVal(_.value,P,F);break;case"ArrayPattern":for(var We=0,pt=_.elements;We<pt.length;We+=1){var dt=pt[We];dt&&this.checkLVal(dt,P,F)}break;case"AssignmentPattern":this.checkLVal(_.left,P,F);break;case"RestElement":this.checkLVal(_.argument,P,F);break;case"ParenthesizedExpression":this.checkLVal(_.expression,P,F);break;default:this.raise(_.start,(P?"Binding":"Assigning to")+" rvalue")}};var Bn=Ci.prototype;Bn.checkPropClash=function(_,P,F){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var R=_.key,K;switch(R.type){case"Identifier":K=R.name;break;case"Literal":K=String(R.value);break;default:return}var xe=_.kind;if(this.options.ecmaVersion>=6){K==="__proto__"&&xe==="init"&&(P.proto&&(F?F.doubleProto<0&&(F.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),P.proto=!0);return}K="$"+K;var We=P[K];if(We){var pt;xe==="init"?pt=this.strict&&We.init||We.get||We.set:pt=We.init||We[xe],pt&&this.raiseRecoverable(R.start,"Redefinition of property")}else We=P[K]={init:!1,get:!1,set:!1};We[xe]=!0}},Bn.parseExpression=function(_,P){var F=this.start,R=this.startLoc,K=this.parseMaybeAssign(_,P);if(this.type===q.comma){var xe=this.startNodeAt(F,R);for(xe.expressions=[K];this.eat(q.comma);)xe.expressions.push(this.parseMaybeAssign(_,P));return this.finishNode(xe,"SequenceExpression")}return K},Bn.parseMaybeAssign=function(_,P,F){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var R=!1,K=-1,xe=-1;P?(K=P.parenthesizedAssign,xe=P.trailingComma,P.parenthesizedAssign=P.trailingComma=-1):(P=new me,R=!0);var We=this.start,pt=this.startLoc;(this.type===q.parenL||this.type===q.name)&&(this.potentialArrowAt=this.start);var dt=this.parseMaybeConditional(_,P);if(F&&(dt=F.call(this,dt,We,pt)),this.type.isAssign){var sr=this.startNodeAt(We,pt);return sr.operator=this.value,sr.left=this.type===q.eq?this.toAssignable(dt,!1,P):dt,R||(P.parenthesizedAssign=P.trailingComma=P.doubleProto=-1),P.shorthandAssign>=sr.left.start&&(P.shorthandAssign=-1),this.checkLVal(dt),this.next(),sr.right=this.parseMaybeAssign(_),this.finishNode(sr,"AssignmentExpression")}else R&&this.checkExpressionErrors(P,!0);return K>-1&&(P.parenthesizedAssign=K),xe>-1&&(P.trailingComma=xe),dt},Bn.parseMaybeConditional=function(_,P){var F=this.start,R=this.startLoc,K=this.parseExprOps(_,P);if(this.checkExpressionErrors(P))return K;if(this.eat(q.question)){var xe=this.startNodeAt(F,R);return xe.test=K,xe.consequent=this.parseMaybeAssign(),this.expect(q.colon),xe.alternate=this.parseMaybeAssign(_),this.finishNode(xe,"ConditionalExpression")}return K},Bn.parseExprOps=function(_,P){var F=this.start,R=this.startLoc,K=this.parseMaybeUnary(P,!1);return this.checkExpressionErrors(P)||K.start===F&&K.type==="ArrowFunctionExpression"?K:this.parseExprOp(K,F,R,-1,_)},Bn.parseExprOp=function(_,P,F,R,K){var xe=this.type.binop;if(xe!=null&&(!K||this.type!==q._in)&&xe>R){var We=this.type===q.logicalOR||this.type===q.logicalAND,pt=this.type===q.coalesce;pt&&(xe=q.logicalAND.binop);var dt=this.value;this.next();var sr=this.start,cr=this.startLoc,Pn=this.parseExprOp(this.parseMaybeUnary(null,!1),sr,cr,xe,K),ai=this.buildBinary(P,F,_,Pn,dt,We||pt);return(We&&this.type===q.coalesce||pt&&(this.type===q.logicalOR||this.type===q.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ai,P,F,R,K)}return _},Bn.buildBinary=function(_,P,F,R,K,xe){var We=this.startNodeAt(_,P);return We.left=F,We.operator=K,We.right=R,this.finishNode(We,xe?"LogicalExpression":"BinaryExpression")},Bn.parseMaybeUnary=function(_,P){var F=this.start,R=this.startLoc,K;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))K=this.parseAwait(),P=!0;else if(this.type.prefix){var xe=this.startNode(),We=this.type===q.incDec;xe.operator=this.value,xe.prefix=!0,this.next(),xe.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),We?this.checkLVal(xe.argument):this.strict&&xe.operator==="delete"&&xe.argument.type==="Identifier"?this.raiseRecoverable(xe.start,"Deleting local variable in strict mode"):P=!0,K=this.finishNode(xe,We?"UpdateExpression":"UnaryExpression")}else{if(K=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return K;for(;this.type.postfix&&!this.canInsertSemicolon();){var pt=this.startNodeAt(F,R);pt.operator=this.value,pt.prefix=!1,pt.argument=K,this.checkLVal(K),this.next(),K=this.finishNode(pt,"UpdateExpression")}}return!P&&this.eat(q.starstar)?this.buildBinary(F,R,K,this.parseMaybeUnary(null,!1),"**",!1):K},Bn.parseExprSubscripts=function(_){var P=this.start,F=this.startLoc,R=this.parseExprAtom(_);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var K=this.parseSubscripts(R,P,F);return _&&K.type==="MemberExpression"&&(_.parenthesizedAssign>=K.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=K.start&&(_.parenthesizedBind=-1)),K},Bn.parseSubscripts=function(_,P,F,R){for(var K=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,xe=!1;;){var We=this.parseSubscript(_,P,F,R,K,xe);if(We.optional&&(xe=!0),We===_||We.type==="ArrowFunctionExpression"){if(xe){var pt=this.startNodeAt(P,F);pt.expression=We,We=this.finishNode(pt,"ChainExpression")}return We}_=We}},Bn.parseSubscript=function(_,P,F,R,K,xe){var We=this.options.ecmaVersion>=11,pt=We&&this.eat(q.questionDot);R&&pt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var dt=this.eat(q.bracketL);if(dt||pt&&this.type!==q.parenL&&this.type!==q.backQuote||this.eat(q.dot)){var sr=this.startNodeAt(P,F);sr.object=_,sr.property=dt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),sr.computed=!!dt,dt&&this.expect(q.bracketR),We&&(sr.optional=pt),_=this.finishNode(sr,"MemberExpression")}else if(!R&&this.eat(q.parenL)){var cr=new me,Pn=this.yieldPos,ai=this.awaitPos,kn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Xi=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1,cr);if(K&&!pt&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(cr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Pn,this.awaitPos=ai,this.awaitIdentPos=kn,this.parseArrowExpression(this.startNodeAt(P,F),Xi,!0);this.checkExpressionErrors(cr,!0),this.yieldPos=Pn||this.yieldPos,this.awaitPos=ai||this.awaitPos,this.awaitIdentPos=kn||this.awaitIdentPos;var ga=this.startNodeAt(P,F);ga.callee=_,ga.arguments=Xi,We&&(ga.optional=pt),_=this.finishNode(ga,"CallExpression")}else if(this.type===q.backQuote){(pt||xe)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var wa=this.startNodeAt(P,F);wa.tag=_,wa.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(wa,"TaggedTemplateExpression")}return _},Bn.parseExprAtom=function(_){this.type===q.slash&&this.readRegexp();var P,F=this.potentialArrowAt===this.start;switch(this.type){case q._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),P=this.startNode(),this.next(),this.type===q.parenL&&!this.allowDirectSuper&&this.raise(P.start,"super() call outside constructor of a subclass"),this.type!==q.dot&&this.type!==q.bracketL&&this.type!==q.parenL&&this.unexpected(),this.finishNode(P,"Super");case q._this:return P=this.startNode(),this.next(),this.finishNode(P,"ThisExpression");case q.name:var R=this.start,K=this.startLoc,xe=this.containsEsc,We=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!xe&&We.name==="async"&&!this.canInsertSemicolon()&&this.eat(q._function))return this.parseFunction(this.startNodeAt(R,K),0,!1,!0);if(F&&!this.canInsertSemicolon()){if(this.eat(q.arrow))return this.parseArrowExpression(this.startNodeAt(R,K),[We],!1);if(this.options.ecmaVersion>=8&&We.name==="async"&&this.type===q.name&&!xe)return We=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(q.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,K),[We],!0)}return We;case q.regexp:var pt=this.value;return P=this.parseLiteral(pt.value),P.regex={pattern:pt.pattern,flags:pt.flags},P;case q.num:case q.string:return this.parseLiteral(this.value);case q._null:case q._true:case q._false:return P=this.startNode(),P.value=this.type===q._null?null:this.type===q._true,P.raw=this.type.keyword,this.next(),this.finishNode(P,"Literal");case q.parenL:var dt=this.start,sr=this.parseParenAndDistinguishExpression(F);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(sr)&&(_.parenthesizedAssign=dt),_.parenthesizedBind<0&&(_.parenthesizedBind=dt)),sr;case q.bracketL:return P=this.startNode(),this.next(),P.elements=this.parseExprList(q.bracketR,!0,!0,_),this.finishNode(P,"ArrayExpression");case q.braceL:return this.parseObj(!1,_);case q._function:return P=this.startNode(),this.next(),this.parseFunction(P,0);case q._class:return this.parseClass(this.startNode(),!1);case q._new:return this.parseNew();case q.backQuote:return this.parseTemplate();case q._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Bn.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var P=this.parseIdent(!0);switch(this.type){case q.parenL:return this.parseDynamicImport(_);case q.dot:return _.meta=P,this.parseImportMeta(_);default:this.unexpected()}},Bn.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(q.parenR)){var P=this.start;this.eat(q.comma)&&this.eat(q.parenR)?this.raiseRecoverable(P,"Trailing comma is not allowed in import()"):this.unexpected(P)}return this.finishNode(_,"ImportExpression")},Bn.parseImportMeta=function(_){this.next();var P=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),P&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Bn.parseLiteral=function(_){var P=this.startNode();return P.value=_,P.raw=this.input.slice(this.start,this.end),P.raw.charCodeAt(P.raw.length-1)===110&&(P.bigint=P.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(P,"Literal")},Bn.parseParenExpression=function(){this.expect(q.parenL);var _=this.parseExpression();return this.expect(q.parenR),_},Bn.parseParenAndDistinguishExpression=function(_){var P=this.start,F=this.startLoc,R,K=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var xe=this.start,We=this.startLoc,pt=[],dt=!0,sr=!1,cr=new me,Pn=this.yieldPos,ai=this.awaitPos,kn;for(this.yieldPos=0,this.awaitPos=0;this.type!==q.parenR;)if(dt?dt=!1:this.expect(q.comma),K&&this.afterTrailingComma(q.parenR,!0)){sr=!0;break}else if(this.type===q.ellipsis){kn=this.start,pt.push(this.parseParenItem(this.parseRestBinding())),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else pt.push(this.parseMaybeAssign(!1,cr,this.parseParenItem));var Xi=this.start,ga=this.startLoc;if(this.expect(q.parenR),_&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(cr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Pn,this.awaitPos=ai,this.parseParenArrowList(P,F,pt);(!pt.length||sr)&&this.unexpected(this.lastTokStart),kn&&this.unexpected(kn),this.checkExpressionErrors(cr,!0),this.yieldPos=Pn||this.yieldPos,this.awaitPos=ai||this.awaitPos,pt.length>1?(R=this.startNodeAt(xe,We),R.expressions=pt,this.finishNodeAt(R,"SequenceExpression",Xi,ga)):R=pt[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var wa=this.startNodeAt(P,F);return wa.expression=R,this.finishNode(wa,"ParenthesizedExpression")}else return R},Bn.parseParenItem=function(_){return _},Bn.parseParenArrowList=function(_,P,F){return this.parseArrowExpression(this.startNodeAt(_,P),F)};var di=[];Bn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),P=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(q.dot)){_.meta=P;var F=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),F&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var R=this.start,K=this.startLoc,xe=this.type===q._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),R,K,!0),xe&&_.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(q.parenL)?_.arguments=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1):_.arguments=di,this.finishNode(_,"NewExpression")},Bn.parseTemplateElement=function(_){var P=_.isTagged,F=this.startNode();return this.type===q.invalidTemplate?(P||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),F.value={raw:this.value,cooked:null}):F.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),F.tail=this.type===q.backQuote,this.finishNode(F,"TemplateElement")},Bn.parseTemplate=function(_){_===void 0&&(_={});var P=_.isTagged;P===void 0&&(P=!1);var F=this.startNode();this.next(),F.expressions=[];var R=this.parseTemplateElement({isTagged:P});for(F.quasis=[R];!R.tail;)this.type===q.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(q.dollarBraceL),F.expressions.push(this.parseExpression()),this.expect(q.braceR),F.quasis.push(R=this.parseTemplateElement({isTagged:P}));return this.next(),this.finishNode(F,"TemplateLiteral")},Bn.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===q.name||this.type===q.num||this.type===q.string||this.type===q.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===q.star)&&!$t.test(this.input.slice(this.lastTokEnd,this.start))},Bn.parseObj=function(_,P){var F=this.startNode(),R=!0,K={};for(F.properties=[],this.next();!this.eat(q.braceR);){if(R)R=!1;else if(this.expect(q.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(q.braceR))break;var xe=this.parseProperty(_,P);_||this.checkPropClash(xe,K,P),F.properties.push(xe)}return this.finishNode(F,_?"ObjectPattern":"ObjectExpression")},Bn.parseProperty=function(_,P){var F=this.startNode(),R,K,xe,We;if(this.options.ecmaVersion>=9&&this.eat(q.ellipsis))return _?(F.argument=this.parseIdent(!1),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(F,"RestElement")):(this.type===q.parenL&&P&&(P.parenthesizedAssign<0&&(P.parenthesizedAssign=this.start),P.parenthesizedBind<0&&(P.parenthesizedBind=this.start)),F.argument=this.parseMaybeAssign(!1,P),this.type===q.comma&&P&&P.trailingComma<0&&(P.trailingComma=this.start),this.finishNode(F,"SpreadElement"));this.options.ecmaVersion>=6&&(F.method=!1,F.shorthand=!1,(_||P)&&(xe=this.start,We=this.startLoc),_||(R=this.eat(q.star)));var pt=this.containsEsc;return this.parsePropertyName(F),!_&&!pt&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(F)?(K=!0,R=this.options.ecmaVersion>=9&&this.eat(q.star),this.parsePropertyName(F,P)):K=!1,this.parsePropertyValue(F,_,R,K,xe,We,P,pt),this.finishNode(F,"Property")},Bn.parsePropertyValue=function(_,P,F,R,K,xe,We,pt){if((F||R)&&this.type===q.colon&&this.unexpected(),this.eat(q.colon))_.value=P?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,We),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===q.parenL)P&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(F,R);else if(!P&&!pt&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==q.comma&&this.type!==q.braceR&&this.type!==q.eq){(F||R)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var dt=_.kind==="get"?0:1;if(_.value.params.length!==dt){var sr=_.value.start;_.kind==="get"?this.raiseRecoverable(sr,"getter should have no params"):this.raiseRecoverable(sr,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((F||R)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=K),_.kind="init",P?_.value=this.parseMaybeDefault(K,xe,_.key):this.type===q.eq&&We?(We.shorthandAssign<0&&(We.shorthandAssign=this.start),_.value=this.parseMaybeDefault(K,xe,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Bn.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(q.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(q.bracketR),_.key;_.computed=!1}return _.key=this.type===q.num||this.type===q.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Bn.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Bn.parseMethod=function(_,P,F){var R=this.startNode(),K=this.yieldPos,xe=this.awaitPos,We=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=_),this.options.ecmaVersion>=8&&(R.async=!!P),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Gi(P,R.generator)|pi|(F?la:0)),this.expect(q.parenL),R.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=K,this.awaitPos=xe,this.awaitIdentPos=We,this.finishNode(R,"FunctionExpression")},Bn.parseArrowExpression=function(_,P,F){var R=this.yieldPos,K=this.awaitPos,xe=this.awaitIdentPos;return this.enterScope(Gi(F,!1)|hi),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!F),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(P,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=R,this.awaitPos=K,this.awaitIdentPos=xe,this.finishNode(_,"ArrowFunctionExpression")},Bn.parseFunctionBody=function(_,P,F){var R=P&&this.type!==q.braceL,K=this.strict,xe=!1;if(R)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var We=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!K||We)&&(xe=this.strictDirective(this.end),xe&&We&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var pt=this.labels;this.labels=[],xe&&(this.strict=!0),this.checkParams(_,!K&&!xe&&!P&&!F&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,qn),_.body=this.parseBlock(!1,void 0,xe&&!K),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=pt}this.exitScope()},Bn.isSimpleParamList=function(_){for(var P=0,F=_;P<F.length;P+=1){var R=F[P];if(R.type!=="Identifier")return!1}return!0},Bn.checkParams=function(_,P){for(var F={},R=0,K=_.params;R<K.length;R+=1){var xe=K[R];this.checkLVal(xe,$i,P?null:F)}},Bn.parseExprList=function(_,P,F,R){for(var K=[],xe=!0;!this.eat(_);){if(xe)xe=!1;else if(this.expect(q.comma),P&&this.afterTrailingComma(_))break;var We=void 0;F&&this.type===q.comma?We=null:this.type===q.ellipsis?(We=this.parseSpread(R),R&&this.type===q.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):We=this.parseMaybeAssign(!1,R),K.push(We)}return K},Bn.checkUnreserved=function(_){var P=_.start,F=_.end,R=_.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(P,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(P,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(P,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(P,F).indexOf("\\")!==-1)){var K=this.strict?this.reservedWordsStrict:this.reservedWords;K.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(P,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(P,"The keyword '"+R+"' is reserved"))}},Bn.parseIdent=function(_,P){var F=this.startNode();return this.type===q.name?F.name=this.value:this.type.keyword?(F.name=this.type.keyword,(F.name==="class"||F.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(F,"Identifier"),_||(this.checkUnreserved(F),F.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=F.start)),F},Bn.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var P=this.startNode();return this.next(),this.type===q.semi||this.canInsertSemicolon()||this.type!==q.star&&!this.type.startsExpr?(P.delegate=!1,P.argument=null):(P.delegate=this.eat(q.star),P.argument=this.parseMaybeAssign(_)),this.finishNode(P,"YieldExpression")},Bn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var Jn=Ci.prototype;Jn.raise=function(_,P){var F=gt(this.input,_);P+=" ("+F.line+":"+F.column+")";var R=new SyntaxError(P);throw R.pos=_,R.loc=F,R.raisedAt=this.pos,R},Jn.raiseRecoverable=Jn.raise,Jn.curPosition=function(){if(this.options.locations)return new De(this.curLine,this.pos-this.lineStart)};var cn=Ci.prototype,Li=function(P){this.flags=P,this.var=[],this.lexical=[],this.functions=[]};cn.enterScope=function(_){this.scopeStack.push(new Li(_))},cn.exitScope=function(){this.scopeStack.pop()},cn.treatFunctionsAsVarInScope=function(_){return _.flags&vn||!this.inModule&&_.flags&Qn},cn.declareName=function(_,P,F){var R=!1;if(P===ca){var K=this.currentScope();R=K.lexical.indexOf(_)>-1||K.functions.indexOf(_)>-1||K.var.indexOf(_)>-1,K.lexical.push(_),this.inModule&&K.flags&Qn&&delete this.undefinedExports[_]}else if(P===xa){var xe=this.currentScope();xe.lexical.push(_)}else if(P===wi){var We=this.currentScope();this.treatFunctionsAsVar?R=We.lexical.indexOf(_)>-1:R=We.lexical.indexOf(_)>-1||We.var.indexOf(_)>-1,We.functions.push(_)}else for(var pt=this.scopeStack.length-1;pt>=0;--pt){var dt=this.scopeStack[pt];if(dt.lexical.indexOf(_)>-1&&!(dt.flags&Wn&&dt.lexical[0]===_)||!this.treatFunctionsAsVarInScope(dt)&&dt.functions.indexOf(_)>-1){R=!0;break}if(dt.var.push(_),this.inModule&&dt.flags&Qn&&delete this.undefinedExports[_],dt.flags&fi)break}R&&this.raiseRecoverable(F,"Identifier '"+_+"' has already been declared")},cn.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},cn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},cn.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var P=this.scopeStack[_];if(P.flags&fi)return P}},cn.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var P=this.scopeStack[_];if(P.flags&fi&&!(P.flags&hi))return P}};var Ri=function(P,F,R){this.type="",this.start=F,this.end=0,P.options.locations&&(this.loc=new Tt(P,R)),P.options.directSourceFile&&(this.sourceFile=P.options.directSourceFile),P.options.ranges&&(this.range=[F,0])},oo=Ci.prototype;oo.startNode=function(){return new Ri(this,this.start,this.startLoc)},oo.startNodeAt=function(_,P){return new Ri(this,_,P)};function ys(_,P,F,R){return _.type=P,_.end=F,this.options.locations&&(_.loc.end=R),this.options.ranges&&(_.range[1]=F),_}oo.finishNode=function(_,P){return ys.call(this,_,P,this.lastTokEnd,this.lastTokEndLoc)},oo.finishNodeAt=function(_,P,F,R){return ys.call(this,_,P,F,R)};var Yo=function(P,F,R,K,xe){this.token=P,this.isExpr=!!F,this.preserveSpace=!!R,this.override=K,this.generator=!!xe},Va={b_stat:new Yo("{",!1),b_expr:new Yo("{",!0),b_tmpl:new Yo("${",!1),p_stat:new Yo("(",!1),p_expr:new Yo("(",!0),q_tmpl:new Yo("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new Yo("function",!1),f_expr:new Yo("function",!0),f_expr_gen:new Yo("function",!0,!1,null,!0),f_gen:new Yo("function",!1,!1,null,!0)},Aa=Ci.prototype;Aa.initialContext=function(){return[Va.b_stat]},Aa.braceIsBlock=function(_){var P=this.curContext();return P===Va.f_expr||P===Va.f_stat?!0:_===q.colon&&(P===Va.b_stat||P===Va.b_expr)?!P.isExpr:_===q._return||_===q.name&&this.exprAllowed?$t.test(this.input.slice(this.lastTokEnd,this.start)):_===q._else||_===q.semi||_===q.eof||_===q.parenR||_===q.arrow?!0:_===q.braceL?P===Va.b_stat:_===q._var||_===q._const||_===q.name?!1:!this.exprAllowed},Aa.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var P=this.context[_];if(P.token==="function")return P.generator}return!1},Aa.updateContext=function(_){var P,F=this.type;F.keyword&&_===q.dot?this.exprAllowed=!1:(P=F.updateContext)?P.call(this,_):this.exprAllowed=F.beforeExpr},q.parenR.updateContext=q.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===Va.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},q.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?Va.b_stat:Va.b_expr),this.exprAllowed=!0},q.dollarBraceL.updateContext=function(){this.context.push(Va.b_tmpl),this.exprAllowed=!0},q.parenL.updateContext=function(_){var P=_===q._if||_===q._for||_===q._with||_===q._while;this.context.push(P?Va.p_stat:Va.p_expr),this.exprAllowed=!0},q.incDec.updateContext=function(){},q._function.updateContext=q._class.updateContext=function(_){_.beforeExpr&&_!==q.semi&&_!==q._else&&!(_===q._return&&$t.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===q.colon||_===q.braceL)&&this.curContext()===Va.b_stat)?this.context.push(Va.f_expr):this.context.push(Va.f_stat),this.exprAllowed=!1},q.backQuote.updateContext=function(){this.curContext()===Va.q_tmpl?this.context.pop():this.context.push(Va.q_tmpl),this.exprAllowed=!1},q.star.updateContext=function(_){if(_===q._function){var P=this.context.length-1;this.context[P]===Va.f_expr?this.context[P]=Va.f_expr_gen:this.context[P]=Va.f_gen}this.exprAllowed=!0},q.name.updateContext=function(_){var P=!1;this.options.ecmaVersion>=6&&_!==q.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(P=!0),this.exprAllowed=P};var H="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",Q=H+" Extended_Pictographic",ae=Q,ye={9:H,10:Q,11:ae},Pe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",He="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",rt=He+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",he=rt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",ke={9:He,10:rt,11:he},vt={};function dr(_){var P=vt[_]={binary:Ce(ye[_]+" "+Pe),nonBinary:{General_Category:Ce(Pe),Script:Ce(ke[_])}};P.nonBinary.Script_Extensions=P.nonBinary.Script,P.nonBinary.gc=P.nonBinary.General_Category,P.nonBinary.sc=P.nonBinary.Script,P.nonBinary.scx=P.nonBinary.Script_Extensions}dr(9),dr(10),dr(11);var Ft=Ci.prototype,zt=function(P){this.parser=P,this.validFlags="gim"+(P.options.ecmaVersion>=6?"uy":"")+(P.options.ecmaVersion>=9?"s":""),this.unicodeProperties=vt[P.options.ecmaVersion>=11?11:P.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};zt.prototype.reset=function(P,F,R){var K=R.indexOf("u")!==-1;this.start=P|0,this.source=F+"",this.flags=R,this.switchU=K&&this.parser.options.ecmaVersion>=6,this.switchN=K&&this.parser.options.ecmaVersion>=9},zt.prototype.raise=function(P){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+P)},zt.prototype.at=function(P,F){F===void 0&&(F=!1);var R=this.source,K=R.length;if(P>=K)return-1;var xe=R.charCodeAt(P);if(!(F||this.switchU)||xe<=55295||xe>=57344||P+1>=K)return xe;var We=R.charCodeAt(P+1);return We>=56320&&We<=57343?(xe<<10)+We-56613888:xe},zt.prototype.nextIndex=function(P,F){F===void 0&&(F=!1);var R=this.source,K=R.length;if(P>=K)return K;var xe=R.charCodeAt(P),We;return!(F||this.switchU)||xe<=55295||xe>=57344||P+1>=K||(We=R.charCodeAt(P+1))<56320||We>57343?P+1:P+2},zt.prototype.current=function(P){return P===void 0&&(P=!1),this.at(this.pos,P)},zt.prototype.lookahead=function(P){return P===void 0&&(P=!1),this.at(this.nextIndex(this.pos,P),P)},zt.prototype.advance=function(P){P===void 0&&(P=!1),this.pos=this.nextIndex(this.pos,P)},zt.prototype.eat=function(P,F){return F===void 0&&(F=!1),this.current(F)===P?(this.advance(F),!0):!1};function vr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Ft.validateRegExpFlags=function(_){for(var P=_.validFlags,F=_.flags,R=0;R<F.length;R++){var K=F.charAt(R);P.indexOf(K)===-1&&this.raise(_.start,"Invalid regular expression flag"),F.indexOf(K,R+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Ft.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Ft.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var P=0,F=_.backReferenceNames;P<F.length;P+=1){var R=F[P];_.groupNames.indexOf(R)===-1&&_.raise("Invalid named capture referenced")}},Ft.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Ft.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Ft.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Ft.regexp_eatAssertion=function(_){var P=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=P}if(_.eat(40)&&_.eat(63)){var F=!1;if(this.options.ecmaVersion>=9&&(F=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!F,!0}return _.pos=P,!1},Ft.regexp_eatQuantifier=function(_,P){return P===void 0&&(P=!1),this.regexp_eatQuantifierPrefix(_,P)?(_.eat(63),!0):!1},Ft.regexp_eatQuantifierPrefix=function(_,P){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,P)},Ft.regexp_eatBracedQuantifier=function(_,P){var F=_.pos;if(_.eat(123)){var R=0,K=-1;if(this.regexp_eatDecimalDigits(_)&&(R=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(K=_.lastIntValue),_.eat(125)))return K!==-1&&K<R&&!P&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!P&&_.raise("Incomplete quantifier"),_.pos=F}return!1},Ft.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Ft.regexp_eatReverseSolidusAtomEscape=function(_){var P=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=P}return!1},Ft.regexp_eatUncapturingGroup=function(_){var P=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=P}return!1},Ft.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Ft.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Ft.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Ft.regexp_eatSyntaxCharacter=function(_){var P=_.current();return En(P)?(_.lastIntValue=P,_.advance(),!0):!1};function En(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Ft.regexp_eatPatternCharacters=function(_){for(var P=_.pos,F=0;(F=_.current())!==-1&&!En(F);)_.advance();return _.pos!==P},Ft.regexp_eatExtendedPatternCharacter=function(_){var P=_.current();return P!==-1&&P!==36&&!(P>=40&&P<=43)&&P!==46&&P!==63&&P!==91&&P!==94&&P!==124?(_.advance(),!0):!1},Ft.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Ft.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Ft.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=vr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=vr(_.lastIntValue);return!0}return!1},Ft.regexp_eatRegExpIdentifierStart=function(_){var P=_.pos,F=this.options.ecmaVersion>=11,R=_.current(F);return _.advance(F),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(R=_.lastIntValue),pn(R)?(_.lastIntValue=R,!0):(_.pos=P,!1)};function pn(_){return yt(_,!0)||_===36||_===95}Ft.regexp_eatRegExpIdentifierPart=function(_){var P=_.pos,F=this.options.ecmaVersion>=11,R=_.current(F);return _.advance(F),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(R=_.lastIntValue),Ot(R)?(_.lastIntValue=R,!0):(_.pos=P,!1)};function Ot(_){return rr(_,!0)||_===36||_===95||_===8204||_===8205}Ft.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Ft.regexp_eatBackReference=function(_){var P=_.pos;if(this.regexp_eatDecimalEscape(_)){var F=_.lastIntValue;if(_.switchU)return F>_.maxBackReference&&(_.maxBackReference=F),!0;if(F<=_.numCapturingParens)return!0;_.pos=P}return!1},Ft.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Ft.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Ft.regexp_eatCControlLetter=function(_){var P=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=P}return!1},Ft.regexp_eatZero=function(_){return _.current()===48&&!nn(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Ft.regexp_eatControlEscape=function(_){var P=_.current();return P===116?(_.lastIntValue=9,_.advance(),!0):P===110?(_.lastIntValue=10,_.advance(),!0):P===118?(_.lastIntValue=11,_.advance(),!0):P===102?(_.lastIntValue=12,_.advance(),!0):P===114?(_.lastIntValue=13,_.advance(),!0):!1},Ft.regexp_eatControlLetter=function(_){var P=_.current();return tn(P)?(_.lastIntValue=P%32,_.advance(),!0):!1};function tn(_){return _>=65&&_<=90||_>=97&&_<=122}Ft.regexp_eatRegExpUnicodeEscapeSequence=function(_,P){P===void 0&&(P=!1);var F=_.pos,R=P||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var K=_.lastIntValue;if(R&&K>=55296&&K<=56319){var xe=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var We=_.lastIntValue;if(We>=56320&&We<=57343)return _.lastIntValue=(K-55296)*1024+(We-56320)+65536,!0}_.pos=xe,_.lastIntValue=K}return!0}if(R&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Zr(_.lastIntValue))return!0;R&&_.raise("Invalid unicode escape"),_.pos=F}return!1};function Zr(_){return _>=0&&_<=1114111}Ft.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var P=_.current();return P!==99&&(!_.switchN||P!==107)?(_.lastIntValue=P,_.advance(),!0):!1},Ft.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var P=_.current();if(P>=49&&P<=57){do _.lastIntValue=10*_.lastIntValue+(P-48),_.advance();while((P=_.current())>=48&&P<=57);return!0}return!1},Ft.regexp_eatCharacterClassEscape=function(_){var P=_.current();if(Hr(P))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(P===80||P===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Hr(_){return _===100||_===68||_===115||_===83||_===119||_===87}Ft.regexp_eatUnicodePropertyValueExpression=function(_){var P=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var F=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var R=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,F,R),!0}}if(_.pos=P,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var K=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,K),!0}return!1},Ft.regexp_validateUnicodePropertyNameAndValue=function(_,P,F){Jr(_.unicodeProperties.nonBinary,P)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[P].test(F)||_.raise("Invalid property value")},Ft.regexp_validateUnicodePropertyNameOrValue=function(_,P){_.unicodeProperties.binary.test(P)||_.raise("Invalid property name")},Ft.regexp_eatUnicodePropertyName=function(_){var P=0;for(_.lastStringValue="";gi(P=_.current());)_.lastStringValue+=vr(P),_.advance();return _.lastStringValue!==""};function gi(_){return tn(_)||_===95}Ft.regexp_eatUnicodePropertyValue=function(_){var P=0;for(_.lastStringValue="";rn(P=_.current());)_.lastStringValue+=vr(P),_.advance();return _.lastStringValue!==""};function rn(_){return gi(_)||nn(_)}Ft.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Ft.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Ft.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var P=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var F=_.lastIntValue;_.switchU&&(P===-1||F===-1)&&_.raise("Invalid character class"),P!==-1&&F!==-1&&P>F&&_.raise("Range out of order in character class")}}},Ft.regexp_eatClassAtom=function(_){var P=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var F=_.current();(F===99||Ti(F))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=P}var R=_.current();return R!==93?(_.lastIntValue=R,_.advance(),!0):!1},Ft.regexp_eatClassEscape=function(_){var P=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=P}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Ft.regexp_eatClassControlLetter=function(_){var P=_.current();return nn(P)||P===95?(_.lastIntValue=P%32,_.advance(),!0):!1},Ft.regexp_eatHexEscapeSequence=function(_){var P=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=P}return!1},Ft.regexp_eatDecimalDigits=function(_){var P=_.pos,F=0;for(_.lastIntValue=0;nn(F=_.current());)_.lastIntValue=10*_.lastIntValue+(F-48),_.advance();return _.pos!==P};function nn(_){return _>=48&&_<=57}Ft.regexp_eatHexDigits=function(_){var P=_.pos,F=0;for(_.lastIntValue=0;Wi(F=_.current());)_.lastIntValue=16*_.lastIntValue+vi(F),_.advance();return _.pos!==P};function Wi(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function vi(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Ft.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var P=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var F=_.lastIntValue;P<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=P*64+F*8+_.lastIntValue:_.lastIntValue=P*8+F}else _.lastIntValue=P;return!0}return!1},Ft.regexp_eatOctalDigit=function(_){var P=_.current();return Ti(P)?(_.lastIntValue=P-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Ti(_){return _>=48&&_<=55}Ft.regexp_eatFixedHexDigits=function(_,P){var F=_.pos;_.lastIntValue=0;for(var R=0;R<P;++R){var K=_.current();if(!Wi(K))return _.pos=F,!1;_.lastIntValue=16*_.lastIntValue+vi(K),_.advance()}return!0};var _i=function(P){this.type=P.type,this.value=P.value,this.start=P.start,this.end=P.end,P.options.locations&&(this.loc=new Tt(P,P.startLoc,P.endLoc)),P.options.ranges&&(this.range=[P.start,P.end])},ht=Ci.prototype;ht.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new _i(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ht.getToken=function(){return this.next(),new _i(this)},typeof Symbol!="undefined"&&(ht[Symbol.iterator]=function(){var _=this;return{next:function(){var P=_.getToken();return{done:P.type===q.eof,value:P}}}}),ht.curContext=function(){return this.context[this.context.length-1]},ht.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(q.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},ht.readToken=function(_){return yt(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},ht.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var P=this.input.charCodeAt(this.pos+1);return(_<<10)+P-56613888},ht.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),P=this.pos,F=this.input.indexOf("*/",this.pos+=2);if(F===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=F+2,this.options.locations){ft.lastIndex=P;for(var R;(R=ft.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(P+2,F),P,this.pos,_,this.curPosition())},ht.skipLineComment=function(_){for(var P=this.pos,F=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!Je(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(P+_,this.pos),P,this.pos,F,this.curPosition())},ht.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&wt.test(String.fromCharCode(_)))++this.pos;else break e}}},ht.finishToken=function(_,P){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var F=this.type;this.type=_,this.value=P,this.updateContext(F)},ht.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var P=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&P===46?(this.pos+=3,this.finishToken(q.ellipsis)):(++this.pos,this.finishToken(q.dot))},ht.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(q.assign,2):this.finishOp(q.slash,1)},ht.readToken_mult_modulo_exp=function(_){var P=this.input.charCodeAt(this.pos+1),F=1,R=_===42?q.star:q.modulo;return this.options.ecmaVersion>=7&&_===42&&P===42&&(++F,R=q.starstar,P=this.input.charCodeAt(this.pos+2)),P===61?this.finishOp(q.assign,F+1):this.finishOp(R,F)},ht.readToken_pipe_amp=function(_){var P=this.input.charCodeAt(this.pos+1);if(P===_){if(this.options.ecmaVersion>=12){var F=this.input.charCodeAt(this.pos+2);if(F===61)return this.finishOp(q.assign,3)}return this.finishOp(_===124?q.logicalOR:q.logicalAND,2)}return P===61?this.finishOp(q.assign,2):this.finishOp(_===124?q.bitwiseOR:q.bitwiseAND,1)},ht.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(q.assign,2):this.finishOp(q.bitwiseXOR,1)},ht.readToken_plus_min=function(_){var P=this.input.charCodeAt(this.pos+1);return P===_?P===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||$t.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(q.incDec,2):P===61?this.finishOp(q.assign,2):this.finishOp(q.plusMin,1)},ht.readToken_lt_gt=function(_){var P=this.input.charCodeAt(this.pos+1),F=1;return P===_?(F=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+F)===61?this.finishOp(q.assign,F+1):this.finishOp(q.bitShift,F)):P===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(P===61&&(F=2),this.finishOp(q.relational,F))},ht.readToken_eq_excl=function(_){var P=this.input.charCodeAt(this.pos+1);return P===61?this.finishOp(q.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&P===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(q.arrow)):this.finishOp(_===61?q.eq:q.prefix,1)},ht.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var P=this.input.charCodeAt(this.pos+1);if(P===46){var F=this.input.charCodeAt(this.pos+2);if(F<48||F>57)return this.finishOp(q.questionDot,2)}if(P===63){if(_>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(q.assign,3)}return this.finishOp(q.coalesce,2)}}return this.finishOp(q.question,1)},ht.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(q.parenL);case 41:return++this.pos,this.finishToken(q.parenR);case 59:return++this.pos,this.finishToken(q.semi);case 44:return++this.pos,this.finishToken(q.comma);case 91:return++this.pos,this.finishToken(q.bracketL);case 93:return++this.pos,this.finishToken(q.bracketR);case 123:return++this.pos,this.finishToken(q.braceL);case 125:return++this.pos,this.finishToken(q.braceR);case 58:return++this.pos,this.finishToken(q.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(q.backQuote);case 48:var P=this.input.charCodeAt(this.pos+1);if(P===120||P===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(P===111||P===79)return this.readRadixNumber(8);if(P===98||P===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(q.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ai(_)+"'")},ht.finishOp=function(_,P){var F=this.input.slice(this.pos,this.pos+P);return this.pos+=P,this.finishToken(_,F)},ht.readRegexp=function(){for(var _,P,F=this.pos;;){this.pos>=this.input.length&&this.raise(F,"Unterminated regular expression");var R=this.input.charAt(this.pos);if($t.test(R)&&this.raise(F,"Unterminated regular expression"),_)_=!1;else{if(R==="[")P=!0;else if(R==="]"&&P)P=!1;else if(R==="/"&&!P)break;_=R==="\\"}++this.pos}var K=this.input.slice(F,this.pos);++this.pos;var xe=this.pos,We=this.readWord1();this.containsEsc&&this.unexpected(xe);var pt=this.regexpState||(this.regexpState=new zt(this));pt.reset(F,K,We),this.validateRegExpFlags(pt),this.validateRegExpPattern(pt);var dt=null;try{dt=new RegExp(K,We)}catch(sr){}return this.finishToken(q.regexp,{pattern:K,flags:We,value:dt})},ht.readInt=function(_,P,F){for(var R=this.options.ecmaVersion>=12&&P===void 0,K=F&&this.input.charCodeAt(this.pos)===48,xe=this.pos,We=0,pt=0,dt=0,sr=P==null?Infinity:P;dt<sr;++dt,++this.pos){var cr=this.input.charCodeAt(this.pos),Pn=void 0;if(R&&cr===95){K&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),pt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),dt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),pt=cr;continue}if(cr>=97?Pn=cr-97+10:cr>=65?Pn=cr-65+10:cr>=48&&cr<=57?Pn=cr-48:Pn=Infinity,Pn>=_)break;pt=cr,We=We*_+Pn}return R&&pt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===xe||P!=null&&this.pos-xe!==P?null:We};function Pt(_,P){return P?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Ma(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}ht.readRadixNumber=function(_){var P=this.pos;this.pos+=2;var F=this.readInt(_);return F==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(F=Ma(this.input.slice(P,this.pos)),++this.pos):yt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,F)},ht.readNumber=function(_){var P=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(P,"Invalid number");var F=this.pos-P>=2&&this.input.charCodeAt(P)===48;F&&this.strict&&this.raise(P,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!F&&!_&&this.options.ecmaVersion>=11&&R===110){var K=Ma(this.input.slice(P,this.pos));return++this.pos,yt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,K)}F&&/[89]/.test(this.input.slice(P,this.pos))&&(F=!1),R===46&&!F&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!F&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(P,"Invalid number")),yt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var xe=Pt(this.input.slice(P,this.pos),F);return this.finishToken(q.num,xe)},ht.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),P;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var F=++this.pos;P=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,P>1114111&&this.invalidStringToken(F,"Code point out of bounds")}else P=this.readHexChar(4);return P};function Ai(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}ht.readString=function(_){for(var P="",F=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===_)break;R===92?(P+=this.input.slice(F,this.pos),P+=this.readEscapedChar(!1),F=this.pos):(Je(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return P+=this.input.slice(F,this.pos++),this.finishToken(q.string,P)};var Mi={};ht.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Mi)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},ht.invalidStringToken=function(_,P){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Mi;this.raise(_,P)},ht.readTmplToken=function(){for(var _="",P=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var F=this.input.charCodeAt(this.pos);if(F===96||F===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===q.template||this.type===q.invalidTemplate)?F===36?(this.pos+=2,this.finishToken(q.dollarBraceL)):(++this.pos,this.finishToken(q.backQuote)):(_+=this.input.slice(P,this.pos),this.finishToken(q.template,_));if(F===92)_+=this.input.slice(P,this.pos),_+=this.readEscapedChar(!0),P=this.pos;else if(Je(F)){switch(_+=this.input.slice(P,this.pos),++this.pos,F){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(F);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),P=this.pos}else++this.pos}},ht.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(q.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ht.readEscapedChar=function(_){var P=this.input.charCodeAt(++this.pos);switch(++this.pos,P){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ai(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var F=this.pos-1;return this.invalidStringToken(F,"Invalid escape sequence in template string"),null}default:if(P>=48&&P<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],K=parseInt(R,8);return K>255&&(R=R.slice(0,-1),K=parseInt(R,8)),this.pos+=R.length-1,P=this.input.charCodeAt(this.pos),(R!=="0"||P===56||P===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-R.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(K)}return Je(P)?"":String.fromCharCode(P)}},ht.readHexChar=function(_){var P=this.pos,F=this.readInt(16,_);return F===null&&this.invalidStringToken(P,"Bad character escape sequence"),F},ht.readWord1=function(){this.containsEsc=!1;for(var _="",P=!0,F=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var K=this.fullCharCodeAtPos();if(rr(K,R))this.pos+=K<=65535?1:2;else if(K===92){this.containsEsc=!0,_+=this.input.slice(F,this.pos);var xe=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var We=this.readCodePoint();(P?yt:rr)(We,R)||this.invalidStringToken(xe,"Invalid Unicode escape"),_+=Ai(We),F=this.pos}else break;P=!1}return _+this.input.slice(F,this.pos)},ht.readWord=function(){var _=this.readWord1(),P=q.name;return this.keywords.test(_)&&(P=it[_]),this.finishToken(P,_)};var ji="7.4.1";Ci.acorn={Parser:Ci,version:ji,defaultOptions:Bt,Position:De,SourceLocation:Tt,getLineInfo:gt,Node:Ri,TokenType:bt,tokTypes:q,keywordTypes:it,TokContext:Yo,tokContexts:Va,isIdentifierChar:rr,isIdentifierStart:yt,Token:_i,isNewLine:Je,lineBreak:$t,lineBreakG:ft,nonASCIIwhitespace:wt};function Pr(_,P){return Ci.parse(_,P)}function an(_,P,F){return Ci.parseExpressionAt(_,P,F)}function mt(_,P){return Ci.tokenizer(_,P)}function aa(_,P){_.prototype=Object.create(P.prototype),_.prototype.constructor=_,_.__proto__=P}function ue(_){var P=typeof Map=="function"?new Map:void 0;return ue=function(R){if(R===null||!bu(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof P!="undefined"){if(P.has(R))return P.get(R);P.set(R,K)}function K(){return ta(R,arguments,Pa(this).constructor)}return K.prototype=Object.create(R.prototype,{constructor:{value:K,enumerable:!1,writable:!0,configurable:!0}}),Ga(K,R)},ue(_)}function ns(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function ta(_,P,F){return ns()?ta=Reflect.construct:ta=function(K,xe,We){var pt=[null];pt.push.apply(pt,xe);var dt=Function.bind.apply(K,pt),sr=new dt;return We&&Ga(sr,We.prototype),sr},ta.apply(null,arguments)}function bu(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function Ga(_,P){return Ga=Object.setPrototypeOf||function(R,K){return R.__proto__=K,R},Ga(_,P)}function Pa(_){return Pa=Object.setPrototypeOf?Object.getPrototypeOf:function(F){return F.__proto__||Object.getPrototypeOf(F)},Pa(_)}var eo=function(_){aa(P,_);function P(){return _.apply(this,arguments)||this}return P}(ue(Error)),oa=function(_){aa(P,_);function P(){return _.apply(this,arguments)||this}return P}(ue(SyntaxError)),Io=function(_){aa(P,_);function P(){return _.apply(this,arguments)||this}return P}(ue(ReferenceError)),qo=function(_){aa(P,_);function P(){return _.apply(this,arguments)||this}return P}(ue(TypeError)),Du=function(_){aa(P,_);function P(){return _.apply(this,arguments)||this}return P}(eo),yo=function(_){aa(P,_);function P(){return _.apply(this,arguments)||this}return P}(oa),jo=function(_){aa(P,_);function P(){return _.apply(this,arguments)||this}return P}(Io),sa={UnknownError:[3001,"%0",Du],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Du],NodeTypeSyntaxError:[1001,"Unknown node type: %0",jo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",jo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",jo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",jo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",jo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",jo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",jo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",jo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",jo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",jo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Io],VariableUndefinedReferenceError:[2002,"%0 is not defined",Io],IsNotConstructor:[2003,"%0 is not a constructor",qo]};function to(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Vo(_,P,F){return to()?Vo=Reflect.construct:Vo=function(K,xe,We){var pt=[null];pt.push.apply(pt,xe);var dt=Function.bind.apply(K,pt),sr=new dt;return We&&ro(sr,We.prototype),sr},Vo.apply(null,arguments)}function ro(_,P){return ro=Object.setPrototypeOf||function(R,K){return R.__proto__=K,R},ro(_,P)}var Rs="0.0.3";function Pl(_,P){Object.defineProperty(_,"name",{value:P,writable:!1,enumerable:!1,configurable:!0})}var _s=Object.prototype.hasOwnProperty,ne=Symbol("Break"),be=Symbol("Continue"),Ke=Symbol("DefaultCase"),Lt=Symbol("EmptyStatementReturn"),Rr=Symbol("WithScopeName"),In=Symbol("SuperScopeName"),Pi=Symbol("RootScopeName"),so=Symbol("GlobalScopeName");function Da(_){return typeof _=="function"}var Ha=function(){function _(F){this.interpreter=F}var P=_.prototype;return P.generator=function(){var R=this.interpreter;function K(){return this.getCurrentScope()}function xe(){return this.getGlobalScope()}function We(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:K.bind(R),getGlobalScope:xe.bind(R),getCurrentContext:We.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},_}();function Ko(_,P,F){if(F===void 0&&(F=!0),!(_ instanceof Ha))throw new Error("Illegal call");if(typeof P!="string")return P;if(!!P){var R=_.generator(),K=R.getOptions(),xe={timeout:K.timeout,_initEnv:function(){F||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},We=F?R.getGlobalScope():R.getCurrentScope(),pt=new Ca(We,xe);return pt.evaluate(P)}}Object.defineProperty(Ko,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function xs(_){if(!(_ instanceof Ha))throw new Error("Illegal call");for(var P=_.generator(),F=arguments.length,R=new Array(F>1?F-1:0),K=1;K<F;K++)R[K-1]=arguments[K];var xe=R.pop(),We=new Ca(P.getGlobalScope(),P.getOptions()),pt=`
		    (function anonymous(`+R.join(",")+`){
		        `+xe+`
		    });
		    `;return We.evaluate(pt)}Object.defineProperty(xs,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var co=function(P){this.value=P},Oo=function(P){this.value=P},bs=function(P){this.value=P},Ls=function(P,F,R){F===void 0&&(F=null),this.name=R,this.parent=F,this.data=P,this.labelStack=[]};function Zs(){}function au(_,P){return _===void 0&&(_=null),new Ls(Object.create(null),_,P)}function Es(_){return Object.create(_)}var ba={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Ko,Function:xs};typeof JSON!="undefined"&&(ba.JSON=JSON),typeof Promise!="undefined"&&(ba.Promise=Promise),typeof Set!="undefined"&&(ba.Set=Set),typeof Map!="undefined"&&(ba.Map=Map),typeof Symbol!="undefined"&&(ba.Symbol=Symbol),typeof Proxy!="undefined"&&(ba.Proxy=Proxy),typeof WeakMap!="undefined"&&(ba.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ba.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ba.Reflect=Reflect);var Ca=function(){function _(F,R){F===void 0&&(F=_.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||_.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?_.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=F||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var P=_.prototype;return P.initEnvironment=function(R){var K;if(R instanceof Ls)K=R;else{var xe=null,We=this.createSuperScope(R);this.options.rootContext&&(xe=new Ls(Es(this.options.rootContext),We,Pi)),K=new Ls(R,xe||We,so)}this.globalScope=K,this.currentScope=this.globalScope,this.globalContext=K.data,this.currentContext=K.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var pt=this.options._initEnv;pt&&pt.call(this)},P.getExecStartTime=function(){return this.execStartTime},P.getExecutionTime=function(){return this.execEndTime-this.execStartTime},P.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},P.getOptions=function(){return this.options},P.getGlobalScope=function(){return this.globalScope},P.getCurrentScope=function(){return this.currentScope},P.getCurrentContext=function(){return this.currentContext},P.isInterruptThrow=function(R){return R instanceof Du||R instanceof jo||R instanceof yo},P.createSuperScope=function(R){var K=Object.assign({},ba),xe=Object.keys(K);return xe.forEach(function(We){We in R&&delete K[We]}),new Ls(K,null,In)},P.setCurrentContext=function(R){this.currentContext=R},P.setCurrentScope=function(R){this.currentScope=R},P.evaluate=function(R){R===void 0&&(R="");var K;if(!!R)return K=Pr(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(K,R)},P.appendCode=function(R){return this.evaluate(R)},P.evaluateNode=function(R,K){var xe=this;K===void 0&&(K=""),this.value=void 0,this.source=K,this.sourceList.push(K),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var We=this.getCurrentScope(),pt=this.getCurrentContext(),dt=We.labelStack.concat([]),sr=this.callStack.concat([]),cr=function(){xe.setCurrentScope(We),xe.setCurrentContext(pt),We.labelStack=dt,xe.callStack=sr};try{var Pn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Pn()}catch(ai){throw ai}finally{cr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},P.createErrorMessage=function(R,K,xe){var We=R[1].replace("%0",String(K));return xe!==null&&(We+=this.getNodePosition(xe||this.lastExecNode)),We},P.createError=function(R,K){return new K(R)},P.createThrowError=function(R,K){return this.createError(R,K)},P.createInternalThrowError=function(R,K,xe){return this.createError(this.createErrorMessage(R,K,xe),R[2])},P.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,K=Date.now();return K-this.execStartTime>R},P.getNodePosition=function(R){if(R){var K="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+K:""}return""},P.createClosure=function(R){var K=this,xe;switch(R.type){case"BinaryExpression":xe=this.binaryExpressionHandler(R);break;case"LogicalExpression":xe=this.logicalExpressionHandler(R);break;case"UnaryExpression":xe=this.unaryExpressionHandler(R);break;case"UpdateExpression":xe=this.updateExpressionHandler(R);break;case"ObjectExpression":xe=this.objectExpressionHandler(R);break;case"ArrayExpression":xe=this.arrayExpressionHandler(R);break;case"CallExpression":xe=this.callExpressionHandler(R);break;case"NewExpression":xe=this.newExpressionHandler(R);break;case"MemberExpression":xe=this.memberExpressionHandler(R);break;case"ThisExpression":xe=this.thisExpressionHandler(R);break;case"SequenceExpression":xe=this.sequenceExpressionHandler(R);break;case"Literal":xe=this.literalHandler(R);break;case"Identifier":xe=this.identifierHandler(R);break;case"AssignmentExpression":xe=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":xe=this.functionDeclarationHandler(R);break;case"VariableDeclaration":xe=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":xe=this.programHandler(R);break;case"ExpressionStatement":xe=this.expressionStatementHandler(R);break;case"EmptyStatement":xe=this.emptyStatementHandler(R);break;case"ReturnStatement":xe=this.returnStatementHandler(R);break;case"FunctionExpression":xe=this.functionExpressionHandler(R);break;case"IfStatement":xe=this.ifStatementHandler(R);break;case"ConditionalExpression":xe=this.conditionalExpressionHandler(R);break;case"ForStatement":xe=this.forStatementHandler(R);break;case"WhileStatement":xe=this.whileStatementHandler(R);break;case"DoWhileStatement":xe=this.doWhileStatementHandler(R);break;case"ForInStatement":xe=this.forInStatementHandler(R);break;case"WithStatement":xe=this.withStatementHandler(R);break;case"ThrowStatement":xe=this.throwStatementHandler(R);break;case"TryStatement":xe=this.tryStatementHandler(R);break;case"ContinueStatement":xe=this.continueStatementHandler(R);break;case"BreakStatement":xe=this.breakStatementHandler(R);break;case"SwitchStatement":xe=this.switchStatementHandler(R);break;case"LabeledStatement":xe=this.labeledStatementHandler(R);break;case"DebuggerStatement":xe=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(sa.NodeTypeSyntaxError,R.type,R)}return function(){var We=K.options.timeout;if(We&&We>0&&K.checkTimeout())throw K.createInternalThrowError(sa.ExecutionTimeOutError,We,null);return K.lastExecNode=R,xe.apply(void 0,arguments)}},P.binaryExpressionHandler=function(R){var K=this,xe=this.createClosure(R.left),We=this.createClosure(R.right);return function(){var pt=xe(),dt=We();switch(R.operator){case"==":return pt==dt;case"!=":return pt!=dt;case"===":return pt===dt;case"!==":return pt!==dt;case"<":return pt<dt;case"<=":return pt<=dt;case">":return pt>dt;case">=":return pt>=dt;case"<<":return pt<<dt;case">>":return pt>>dt;case">>>":return pt>>>dt;case"+":return pt+dt;case"-":return pt-dt;case"*":return pt*dt;case"**":return Math.pow(pt,dt);case"/":return pt/dt;case"%":return pt%dt;case"|":return pt|dt;case"^":return pt^dt;case"&":return pt&dt;case"in":return pt in dt;case"instanceof":return pt instanceof dt;default:throw K.createInternalThrowError(sa.BinaryOperatorSyntaxError,R.operator,R)}}},P.logicalExpressionHandler=function(R){var K=this,xe=this.createClosure(R.left),We=this.createClosure(R.right);return function(){switch(R.operator){case"||":return xe()||We();case"&&":return xe()&&We();default:throw K.createInternalThrowError(sa.LogicalOperatorSyntaxError,R.operator,R)}}},P.unaryExpressionHandler=function(R){var K=this;switch(R.operator){case"delete":var xe=this.createObjectGetter(R.argument),We=this.createNameGetter(R.argument);return function(){var cr=xe(),Pn=We();return delete cr[Pn]};default:var pt;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var dt=this.createObjectGetter(R.argument),sr=this.createNameGetter(R.argument);pt=function(){return dt()[sr()]}}else pt=this.createClosure(R.argument);return function(){var cr=pt();switch(R.operator){case"-":return-cr;case"+":return+cr;case"!":return!cr;case"~":return~cr;case"void":return;case"typeof":return typeof cr;default:throw K.createInternalThrowError(sa.UnaryOperatorSyntaxError,R.operator,R)}}}},P.updateExpressionHandler=function(R){var K=this,xe=this.createObjectGetter(R.argument),We=this.createNameGetter(R.argument);return function(){var pt=xe(),dt=We();switch(K.assertVariable(pt,dt,R),R.operator){case"++":return R.prefix?++pt[dt]:pt[dt]++;case"--":return R.prefix?--pt[dt]:pt[dt]--;default:throw K.createInternalThrowError(sa.UpdateOperatorSyntaxError,R.operator,R)}}},P.objectExpressionHandler=function(R){var K=this,xe=[];function We(dt){return dt.type==="Identifier"?dt.name:dt.type==="Literal"?dt.value:this.throwError(sa.ObjectStructureSyntaxError,dt.type,dt)}var pt=Object.create(null);return R.properties.forEach(function(dt){var sr=dt.kind,cr=We(dt.key);(!pt[cr]||sr==="init")&&(pt[cr]={}),pt[cr][sr]=K.createClosure(dt.value),xe.push({key:cr,property:dt})}),function(){for(var dt={},sr=xe.length,cr=0;cr<sr;cr++){var Pn=xe[cr],ai=Pn.key,kn=pt[ai],Xi=kn.init?kn.init():void 0,ga=kn.get?kn.get():function(){},wa=kn.set?kn.set():function(el){};if("set"in kn||"get"in kn){var Hi={configurable:!0,enumerable:!0,get:ga,set:wa};Object.defineProperty(dt,ai,Hi)}else{var Ss=Pn.property,ou=Ss.kind;Ss.key.type==="Identifier"&&Ss.value.type==="FunctionExpression"&&ou==="init"&&!Ss.value.id&&Pl(Xi,Ss.key.name),dt[ai]=Xi}}return dt}},P.arrayExpressionHandler=function(R){var K=this,xe=R.elements.map(function(We){return We&&K.createClosure(We)});return function(){for(var We=xe.length,pt=Array(We),dt=0;dt<We;dt++){var sr=xe[dt];sr&&(pt[dt]=sr())}return pt}},P.safeObjectGet=function(R,K,xe){return R[K]},P.createCallFunctionGetter=function(R){var K=this;switch(R.type){case"MemberExpression":var xe=this.createClosure(R.object),We=this.createMemberKeyGetter(R),pt=this.source;return function(){var sr=xe(),cr=We(),Pn=K.safeObjectGet(sr,cr,R);if(!Pn||!Da(Pn)){var ai=pt.slice(R.start,R.end);throw K.createInternalThrowError(sa.FunctionUndefinedReferenceError,ai,R)}return Pn.__IS_EVAL_FUNC?function(kn){return Pn(new Ha(K),kn,!0)}:Pn.__IS_FUNCTION_FUNC?function(){for(var kn=arguments.length,Xi=new Array(kn),ga=0;ga<kn;ga++)Xi[ga]=arguments[ga];return Pn.apply(void 0,[new Ha(K)].concat(Xi))}:Pn.bind(sr)};default:var dt=this.createClosure(R);return function(){var sr="";R.type==="Identifier"&&(sr=R.name);var cr=dt();if(!cr||!Da(cr))throw K.createInternalThrowError(sa.FunctionUndefinedReferenceError,sr,R);if(R.type==="Identifier"&&cr.__IS_EVAL_FUNC&&sr==="eval")return function(kn){var Xi=K.getScopeFromName(sr,K.getCurrentScope()),ga=Xi.name===In||Xi.name===so||Xi.name===Pi;return cr(new Ha(K),kn,!ga)};if(cr.__IS_EVAL_FUNC)return function(kn){return cr(new Ha(K),kn,!0)};if(cr.__IS_FUNCTION_FUNC)return function(){for(var kn=arguments.length,Xi=new Array(kn),ga=0;ga<kn;ga++)Xi[ga]=arguments[ga];return cr.apply(void 0,[new Ha(K)].concat(Xi))};var Pn=K.options.globalContextInFunction;if(R.type==="Identifier"){var ai=K.getIdentifierScope(R);ai.name===Rr&&(Pn=ai.data)}return cr.bind(Pn)}}},P.callExpressionHandler=function(R){var K=this,xe=this.createCallFunctionGetter(R.callee),We=R.arguments.map(function(pt){return K.createClosure(pt)});return function(){return xe().apply(void 0,We.map(function(pt){return pt()}))}},P.functionExpressionHandler=function(R){var K=this,xe=this,We=this.source,pt=this.collectDeclVars,dt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var sr=R.id?R.id.name:"",cr=R.params.length,Pn=R.params.map(function(ga){return K.createParamNameGetter(ga)}),ai=this.createClosure(R.body),kn=this.collectDeclVars,Xi=this.collectDeclFuncs;return this.collectDeclVars=pt,this.collectDeclFuncs=dt,function(){var ga=xe.getCurrentScope(),wa=function Hi(){for(var Ss=arguments.length,ou=new Array(Ss),el=0;el<Ss;el++)ou[el]=arguments[el];xe.callStack.push(""+sr);var sf=xe.getCurrentScope(),dl=au(ga,"FunctionScope("+sr+")");xe.setCurrentScope(dl),xe.addDeclarationsToScope(kn,Xi,dl),sr&&(dl.data[sr]=Hi),dl.data.arguments=arguments,Pn.forEach(function(Bu,Nu){dl.data[Bu()]=ou[Nu]});var Dc=xe.getCurrentContext();xe.setCurrentContext(this);var Fu=ai();if(xe.setCurrentContext(Dc),xe.setCurrentScope(sf),xe.callStack.pop(),Fu instanceof co)return Fu.value};return Pl(wa,sr),Object.defineProperty(wa,"length",{value:cr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(wa,"toString",{value:function(){return We.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(wa,"valueOf",{value:function(){return We.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),wa}},P.newExpressionHandler=function(R){var K=this,xe=this.source,We=this.createClosure(R.callee),pt=R.arguments.map(function(dt){return K.createClosure(dt)});return function(){var dt=We();if(!Da(dt)||dt.__IS_EVAL_FUNC){var sr=R.callee,cr=xe.slice(sr.start,sr.end);throw K.createInternalThrowError(sa.IsNotConstructor,cr,R)}return dt.__IS_FUNCTION_FUNC?dt.apply(void 0,[new Ha(K)].concat(pt.map(function(Pn){return Pn()}))):Vo(dt,pt.map(function(Pn){return Pn()}))}},P.memberExpressionHandler=function(R){var K=this.createClosure(R.object),xe=this.createMemberKeyGetter(R);return function(){var We=K(),pt=xe();return We[pt]}},P.thisExpressionHandler=function(R){var K=this;return function(){return K.getCurrentContext()}},P.sequenceExpressionHandler=function(R){var K=this,xe=R.expressions.map(function(We){return K.createClosure(We)});return function(){for(var We,pt=xe.length,dt=0;dt<pt;dt++){var sr=xe[dt];We=sr()}return We}},P.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},P.identifierHandler=function(R){var K=this;return function(){var xe=K.getCurrentScope(),We=K.getScopeDataFromName(R.name,xe);return K.assertVariable(We,R.name,R),We[R.name]}},P.getIdentifierScope=function(R){var K=this.getCurrentScope(),xe=this.getScopeFromName(R.name,K);return xe},P.assignmentExpressionHandler=function(R){var K=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var xe=this.createObjectGetter(R.left),We=this.createNameGetter(R.left),pt=this.createClosure(R.right);return function(){var dt=xe(),sr=We(),cr=pt();switch(R.operator!=="="&&K.assertVariable(dt,sr,R),R.operator){case"=":return dt[sr]=cr;case"+=":return dt[sr]+=cr;case"-=":return dt[sr]-=cr;case"*=":return dt[sr]*=cr;case"**=":return dt[sr]=Math.pow(dt[sr],cr);case"/=":return dt[sr]/=cr;case"%=":return dt[sr]%=cr;case"<<=":return dt[sr]<<=cr;case">>=":return dt[sr]>>=cr;case">>>=":return dt[sr]>>>=cr;case"&=":return dt[sr]&=cr;case"^=":return dt[sr]^=cr;case"|=":return dt[sr]|=cr;default:throw K.createInternalThrowError(sa.AssignmentExpressionSyntaxError,R.type,R)}}},P.functionDeclarationHandler=function(R){if(R.id){var K=this.functionExpressionHandler(R);Object.defineProperty(K,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,K)}return function(){return Lt}},P.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(sa.VariableTypeSyntaxError,R.type,R)},P.variableDeclarationHandler=function(R){for(var K=this,xe,We=[],pt=0;pt<R.declarations.length;pt++){var dt=R.declarations[pt];this.varDeclaration(this.getVariableName(dt.id)),dt.init&&We.push({type:"AssignmentExpression",operator:"=",left:dt.id,right:dt.init})}return We.length&&(xe=this.createClosure({type:"BlockStatement",body:We})),function(){if(xe){var sr=K.isVarDeclMode;K.isVarDeclMode=!0,xe(),K.isVarDeclMode=sr}return Lt}},P.assertVariable=function(R,K,xe){if(R===this.globalScope.data&&!(K in R))throw this.createInternalThrowError(sa.VariableUndefinedReferenceError,K,xe)},P.programHandler=function(R){var K=this,xe=R.body.map(function(We){return K.createClosure(We)});return function(){for(var We=Lt,pt=0;pt<xe.length;pt++){var dt=xe[pt],sr=K.setValue(dt());if(sr!==Lt&&(We=sr,We instanceof co||We instanceof Oo||We instanceof bs||We===ne||We===be))break}return We}},P.expressionStatementHandler=function(R){return this.createClosure(R.expression)},P.emptyStatementHandler=function(R){return function(){return Lt}},P.returnStatementHandler=function(R){var K=R.argument?this.createClosure(R.argument):Zs;return function(){return new co(K())}},P.ifStatementHandler=function(R){var K=this.createClosure(R.test),xe=this.createClosure(R.consequent),We=R.alternate?this.createClosure(R.alternate):function(){return Lt};return function(){return K()?xe():We()}},P.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},P.forStatementHandler=function(R){var K=this,xe=Zs,We=R.test?this.createClosure(R.test):function(){return!0},pt=Zs,dt=this.createClosure(R.body);return R.type==="ForStatement"&&(xe=R.init?this.createClosure(R.init):xe,pt=R.update?this.createClosure(R.update):Zs),function(sr){var cr,Pn=Lt,ai=R.type==="DoWhileStatement";for(sr&&sr.type==="LabeledStatement"&&(cr=sr.label.name),xe();ai||We();pt()){ai=!1;var kn=K.setValue(dt());if(!(kn===Lt||kn===be)){if(kn===ne)break;if(Pn=kn,Pn instanceof bs&&Pn.value===cr){Pn=Lt;continue}if(Pn instanceof co||Pn instanceof Oo||Pn instanceof bs)break}}return Pn}},P.whileStatementHandler=function(R){return this.forStatementHandler(R)},P.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},P.forInStatementHandler=function(R){var K=this,xe=R.left,We=this.createClosure(R.right),pt=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),xe=R.left.declarations[0].id),function(dt){var sr,cr=Lt,Pn;dt&&dt.type==="LabeledStatement"&&(sr=dt.label.name);var ai=We();for(Pn in ai){K.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:xe,right:{type:"Literal",value:Pn}})();var kn=K.setValue(pt());if(!(kn===Lt||kn===be)){if(kn===ne)break;if(cr=kn,cr instanceof bs&&cr.value===sr){cr=Lt;continue}if(cr instanceof co||cr instanceof Oo||cr instanceof bs)break}}return cr}},P.withStatementHandler=function(R){var K=this,xe=this.createClosure(R.object),We=this.createClosure(R.body);return function(){var pt=xe(),dt=K.getCurrentScope(),sr=new Ls(pt,dt,Rr);K.setCurrentScope(sr);var cr=K.setValue(We());return K.setCurrentScope(dt),cr}},P.throwStatementHandler=function(R){var K=this,xe=this.createClosure(R.argument);return function(){throw K.setValue(void 0),xe()}},P.tryStatementHandler=function(R){var K=this,xe=this.createClosure(R.block),We=R.handler?this.catchClauseHandler(R.handler):null,pt=R.finalizer?this.createClosure(R.finalizer):null;return function(){var dt=K.getCurrentScope(),sr=K.getCurrentContext(),cr=dt.labelStack.concat([]),Pn=K.callStack.concat([]),ai=Lt,kn,Xi,ga=function(){K.setCurrentScope(dt),K.setCurrentContext(sr),dt.labelStack=cr,K.callStack=Pn};try{ai=K.setValue(xe()),ai instanceof co&&(kn=ai)}catch(wa){if(ga(),K.isInterruptThrow(wa))throw wa;if(We)try{ai=K.setValue(We(wa)),ai instanceof co&&(kn=ai)}catch(Hi){if(ga(),K.isInterruptThrow(Hi))throw Hi;Xi=Hi}}if(pt)try{ai=pt(),ai instanceof co&&(kn=ai)}catch(wa){if(ga(),K.isInterruptThrow(wa))throw wa;Xi=wa}if(Xi)throw Xi;return kn||ai}},P.catchClauseHandler=function(R){var K=this,xe=this.createParamNameGetter(R.param),We=this.createClosure(R.body);return function(pt){var dt,sr=K.getCurrentScope(),cr=sr.data,Pn=xe(),ai=_s.call(cr,Pn),kn=cr[Pn];return cr[Pn]=pt,dt=We(),ai?cr[Pn]=kn:delete cr[Pn],dt}},P.continueStatementHandler=function(R){return function(){return R.label?new bs(R.label.name):be}},P.breakStatementHandler=function(R){return function(){return R.label?new Oo(R.label.name):ne}},P.switchStatementHandler=function(R){var K=this,xe=this.createClosure(R.discriminant),We=R.cases.map(function(pt){return K.switchCaseHandler(pt)});return function(){for(var pt=xe(),dt=!1,sr,cr,Pn,ai=0;ai<We.length;ai++){var kn=We[ai](),Xi=kn.testClosure();if(Xi===Ke){Pn=kn;continue}if(dt||Xi===pt){if(dt=!0,cr=K.setValue(kn.bodyClosure()),cr===Lt)continue;if(cr===ne||(sr=cr,sr instanceof co||sr instanceof Oo||sr instanceof bs||sr===be))break}}if(!dt&&Pn){cr=K.setValue(Pn.bodyClosure());var ga=cr===Lt||cr===ne||cr===be;ga||(sr=cr)}return sr}},P.switchCaseHandler=function(R){var K=R.test?this.createClosure(R.test):function(){return Ke},xe=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:K,bodyClosure:xe}}},P.labeledStatementHandler=function(R){var K=this,xe=R.label.name,We=this.createClosure(R.body);return function(){var pt,dt=K.getCurrentScope();return dt.labelStack.push(xe),pt=We(R),pt instanceof Oo&&pt.value===xe&&(pt=Lt),dt.labelStack.pop(),pt}},P.debuggerStatementHandler=function(R){return function(){debugger;return Lt}},P.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(sa.ParamTypeSyntaxError,R.type,R)},P.createObjectKeyGetter=function(R){var K;return R.type==="Identifier"?K=function(){return R.name}:K=this.createClosure(R),function(){return K()}},P.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},P.createObjectGetter=function(R){var K=this;switch(R.type){case"Identifier":return function(){return K.getScopeDataFromName(R.name,K.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(sa.AssignmentTypeSyntaxError,R.type,R)}},P.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(sa.AssignmentTypeSyntaxError,R.type,R)}},P.varDeclaration=function(R){var K=this.collectDeclVars;K[R]=void 0},P.funcDeclaration=function(R,K){var xe=this.collectDeclFuncs;xe[R]=K},P.addDeclarationsToScope=function(R,K,xe){var We=xe.data;for(var pt in K){var dt=K[pt];We[pt]=dt&&dt()}for(var sr in R)sr in We||(We[sr]=void 0)},P.getScopeValue=function(R,K){var xe=this.getScopeFromName(R,K);return xe.data[R]},P.getScopeDataFromName=function(R,K){return this.getScopeFromName(R,K).data},P.getScopeFromName=function(R,K){var xe=K;do if(R in xe.data)return xe;while(xe=xe.parent);return this.globalScope},P.setValue=function(R){var K=this.callStack.length;return this.isVarDeclMode||K||R===Lt||R===ne||R===be||R instanceof Oo||R instanceof bs||(this.value=R instanceof co?R.value:R),R},P.getValue=function(){return this.value},_}();Ca.version=Rs,Ca.eval=Ko,Ca.Function=xs,Ca.ecmaVersion=5,Ca.globalContextInFunction=void 0,Ca.global=Object.create(null);function fs(_){return _===void 0&&(_=Object.create(null)),_}function of(_,P,F){P===void 0&&(P=[]),F===void 0&&(F={});var R=F.parsingContext,K=F.timeout===void 0?0:F.timeout,xe=`
    (function anonymous(`+P.join(",")+`){
         `+_+`
    });
    `,We=new Ca(R,{ecmaVersion:F.ecmaVersion,timeout:K,rootContext:F.rootContext,globalContextInFunction:F.globalContextInFunction});return We.evaluate(xe)}function Il(_,P,F){var R=new Ca(P,F);return R.evaluate(_)}var qs=Il,ac=function(){function _(F){this._code=F}var P=_.prototype;return P.runInContext=function(R){return Il(this._code,R)},P.runInNewContext=function(R){return Il(this._code,R)},_}(),Ju=function(_,P,F){return Il(_,P,F)};function Ks(){for(var _=arguments.length,P=new Array(_),F=0;F<_;F++)P[F]=arguments[F];var R=P.pop();return of(R||"",P)}var pl=Ju},20396:function(It,$,z){var ie;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(re,m,de,Z){"use strict";var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,fe=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Le=ce||fe,J=["","webkit","Moz","MS","ms","o"],Xe=Le?"":m.createElement("div"),et="function",Ze=Math.round,yt=Math.abs,rr=Date.now;function bt(ne,be,Ke){return setTimeout(ft(ne,Ke),be)}function Xt(ne,be,Ke){return Array.isArray(ne)?(Ct(ne,Ke[be],Ke),!0):!1}function Ct(ne,be,Ke){var Lt;if(!!ne)if(ne.forEach)ne.forEach(be,Ke);else if(ne.length!==Z)for(Lt=0;Lt<ne.length;)be.call(Ke,ne[Lt],Lt,ne),Lt++;else for(Lt in ne)ne.hasOwnProperty(Lt)&&be.call(Ke,ne[Lt],Lt,ne)}function at(ne,be,Ke){var Lt="DEPRECATED METHOD: "+be+`
`+Ke+` AT 
`;return function(){var Rr=new Error("get-stack-trace"),In=Rr&&Rr.stack?Rr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Pi=re.console&&(re.console.warn||re.console.log);return Pi&&Pi.call(re.console,Lt,In),ne.apply(this,arguments)}}var it;typeof Object.assign!="function"?it=function(be){if(be===Z||be===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ke=Object(be),Lt=1;Lt<arguments.length;Lt++){var Rr=arguments[Lt];if(Rr!==Z&&Rr!==null)for(var In in Rr)Rr.hasOwnProperty(In)&&(Ke[In]=Rr[In])}return Ke}:it=Object.assign;var Vt=at(function(be,Ke,Lt){for(var Rr=Object.keys(Ke),In=0;In<Rr.length;)(!Lt||Lt&&be[Rr[In]]===Z)&&(be[Rr[In]]=Ke[Rr[In]]),In++;return be},"extend","Use `assign`."),q=at(function(be,Ke){return Vt(be,Ke,!0)},"merge","Use `assign`.");function $t(ne,be,Ke){var Lt=be.prototype,Rr;Rr=ne.prototype=Object.create(Lt),Rr.constructor=ne,Rr._super=Lt,Ke&&it(Rr,Ke)}function ft(ne,be){return function(){return ne.apply(be,arguments)}}function Je(ne,be){return typeof ne==et?ne.apply(be&&be[0]||Z,be):ne}function wt(ne,be){return ne===Z?be:ne}function Qe(ne,be,Ke){Ct(Jr(be),function(Lt){ne.addEventListener(Lt,Ke,!1)})}function Qt(ne,be,Ke){Ct(Jr(be),function(Lt){ne.removeEventListener(Lt,Ke,!1)})}function Er(ne,be){for(;ne;){if(ne==be)return!0;ne=ne.parentNode}return!1}function Fr(ne,be){return ne.indexOf(be)>-1}function Jr(ne){return ne.trim().split(/\s+/g)}function A(ne,be,Ke){if(ne.indexOf&&!Ke)return ne.indexOf(be);for(var Lt=0;Lt<ne.length;){if(Ke&&ne[Lt][Ke]==be||!Ke&&ne[Lt]===be)return Lt;Lt++}return-1}function Ce(ne){return Array.prototype.slice.call(ne,0)}function De(ne,be,Ke){for(var Lt=[],Rr=[],In=0;In<ne.length;){var Pi=be?ne[In][be]:ne[In];A(Rr,Pi)<0&&Lt.push(ne[In]),Rr[In]=Pi,In++}return Ke&&(be?Lt=Lt.sort(function(Da,Ha){return Da[be]>Ha[be]}):Lt=Lt.sort()),Lt}function Tt(ne,be){for(var Ke,Lt,Rr=be[0].toUpperCase()+be.slice(1),In=0;In<J.length;){if(Ke=J[In],Lt=Ke?Ke+Rr:be,Lt in ne)return Lt;In++}return Z}var gt=1;function Bt(){return gt++}function Kt(ne){var be=ne.ownerDocument||ne;return be.defaultView||be.parentWindow||re}var Cr=/mobile|tablet|ip(ad|hone|od)|android/i,Qn="ontouchstart"in re,vn=Tt(re,"PointerEvent")!==Z,fi=Qn&&Cr.test(navigator.userAgent),Gn="touch",ii="pen",hi="mouse",Wn="kinect",pi=25,la=1,Gi=2,Oi=4,$i=8,ca=1,wi=2,xa=4,qn=8,Ci=16,Zi=wi|xa,Qi=qn|Ci,Zo=Zi|Qi,me=["x","y"],Dn=["clientX","clientY"];function Xa(ne,be){var Ke=this;this.manager=ne,this.callback=be,this.element=ne.element,this.target=ne.options.inputTarget,this.domHandler=function(Lt){Je(ne.options.enable,[ne])&&Ke.handler(Lt)},this.init()}Xa.prototype={handler:function(){},init:function(){this.evEl&&Qe(this.element,this.evEl,this.domHandler),this.evTarget&&Qe(this.target,this.evTarget,this.domHandler),this.evWin&&Qe(Kt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Qt(this.element,this.evEl,this.domHandler),this.evTarget&&Qt(this.target,this.evTarget,this.domHandler),this.evWin&&Qt(Kt(this.element),this.evWin,this.domHandler)}};function cs(ne){var be,Ke=ne.options.inputClass;return Ke?be=Ke:vn?be=Pe:fi?be=zt:Qn?be=Ot:be=Aa,new be(ne,Nt)}function Nt(ne,be,Ke){var Lt=Ke.pointers.length,Rr=Ke.changedPointers.length,In=be&la&&Lt-Rr==0,Pi=be&(Oi|$i)&&Lt-Rr==0;Ke.isFirst=!!In,Ke.isFinal=!!Pi,In&&(ne.session={}),Ke.eventType=be,nr(ne,Ke),ne.emit("hammer.input",Ke),ne.recognize(Ke),ne.session.prevInput=Ke}function nr(ne,be){var Ke=ne.session,Lt=be.pointers,Rr=Lt.length;Ke.firstInput||(Ke.firstInput=wn(be)),Rr>1&&!Ke.firstMultiple?Ke.firstMultiple=wn(be):Rr===1&&(Ke.firstMultiple=!1);var In=Ke.firstInput,Pi=Ke.firstMultiple,so=Pi?Pi.center:In.center,Da=be.center=Bn(Lt);be.timeStamp=rr(),be.deltaTime=be.timeStamp-In.timeStamp,be.angle=Li(so,Da),be.distance=cn(so,Da),Ar(Ke,be),be.offsetDirection=Jn(be.deltaX,be.deltaY);var Ha=di(be.deltaTime,be.deltaX,be.deltaY);be.overallVelocityX=Ha.x,be.overallVelocityY=Ha.y,be.overallVelocity=yt(Ha.x)>yt(Ha.y)?Ha.x:Ha.y,be.scale=Pi?oo(Pi.pointers,Lt):1,be.rotation=Pi?Ri(Pi.pointers,Lt):0,be.maxPointers=Ke.prevInput?be.pointers.length>Ke.prevInput.maxPointers?be.pointers.length:Ke.prevInput.maxPointers:be.pointers.length,en(Ke,be);var Ko=ne.element;Er(be.srcEvent.target,Ko)&&(Ko=be.srcEvent.target),be.target=Ko}function Ar(ne,be){var Ke=be.center,Lt=ne.offsetDelta||{},Rr=ne.prevDelta||{},In=ne.prevInput||{};(be.eventType===la||In.eventType===Oi)&&(Rr=ne.prevDelta={x:In.deltaX||0,y:In.deltaY||0},Lt=ne.offsetDelta={x:Ke.x,y:Ke.y}),be.deltaX=Rr.x+(Ke.x-Lt.x),be.deltaY=Rr.y+(Ke.y-Lt.y)}function en(ne,be){var Ke=ne.lastInterval||be,Lt=be.timeStamp-Ke.timeStamp,Rr,In,Pi,so;if(be.eventType!=$i&&(Lt>pi||Ke.velocity===Z)){var Da=be.deltaX-Ke.deltaX,Ha=be.deltaY-Ke.deltaY,Ko=di(Lt,Da,Ha);In=Ko.x,Pi=Ko.y,Rr=yt(Ko.x)>yt(Ko.y)?Ko.x:Ko.y,so=Jn(Da,Ha),ne.lastInterval=be}else Rr=Ke.velocity,In=Ke.velocityX,Pi=Ke.velocityY,so=Ke.direction;be.velocity=Rr,be.velocityX=In,be.velocityY=Pi,be.direction=so}function wn(ne){for(var be=[],Ke=0;Ke<ne.pointers.length;)be[Ke]={clientX:Ze(ne.pointers[Ke].clientX),clientY:Ze(ne.pointers[Ke].clientY)},Ke++;return{timeStamp:rr(),pointers:be,center:Bn(be),deltaX:ne.deltaX,deltaY:ne.deltaY}}function Bn(ne){var be=ne.length;if(be===1)return{x:Ze(ne[0].clientX),y:Ze(ne[0].clientY)};for(var Ke=0,Lt=0,Rr=0;Rr<be;)Ke+=ne[Rr].clientX,Lt+=ne[Rr].clientY,Rr++;return{x:Ze(Ke/be),y:Ze(Lt/be)}}function di(ne,be,Ke){return{x:be/ne||0,y:Ke/ne||0}}function Jn(ne,be){return ne===be?ca:yt(ne)>=yt(be)?ne<0?wi:xa:be<0?qn:Ci}function cn(ne,be,Ke){Ke||(Ke=me);var Lt=be[Ke[0]]-ne[Ke[0]],Rr=be[Ke[1]]-ne[Ke[1]];return Math.sqrt(Lt*Lt+Rr*Rr)}function Li(ne,be,Ke){Ke||(Ke=me);var Lt=be[Ke[0]]-ne[Ke[0]],Rr=be[Ke[1]]-ne[Ke[1]];return Math.atan2(Rr,Lt)*180/Math.PI}function Ri(ne,be){return Li(be[1],be[0],Dn)+Li(ne[1],ne[0],Dn)}function oo(ne,be){return cn(be[0],be[1],Dn)/cn(ne[0],ne[1],Dn)}var ys={mousedown:la,mousemove:Gi,mouseup:Oi},Yo="mousedown",Va="mousemove mouseup";function Aa(){this.evEl=Yo,this.evWin=Va,this.pressed=!1,Xa.apply(this,arguments)}$t(Aa,Xa,{handler:function(be){var Ke=ys[be.type];Ke&la&&be.button===0&&(this.pressed=!0),Ke&Gi&&be.which!==1&&(Ke=Oi),!!this.pressed&&(Ke&Oi&&(this.pressed=!1),this.callback(this.manager,Ke,{pointers:[be],changedPointers:[be],pointerType:hi,srcEvent:be}))}});var H={pointerdown:la,pointermove:Gi,pointerup:Oi,pointercancel:$i,pointerout:$i},Q={2:Gn,3:ii,4:hi,5:Wn},ae="pointerdown",ye="pointermove pointerup pointercancel";!Le&&re.MSPointerEvent&&!re.PointerEvent&&(ae="MSPointerDown",ye="MSPointerMove MSPointerUp MSPointerCancel");function Pe(){this.evEl=ae,this.evWin=ye,Xa.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}$t(Pe,Xa,{handler:function(be){var Ke=this.store,Lt=!1,Rr=be.type.toLowerCase().replace("ms",""),In=H[Rr],Pi=Q[be.pointerType]||be.pointerType,so=Pi==Gn,Da=A(Ke,be.pointerId,"pointerId");In&la&&(be.button===0||so)?Da<0&&(Ke.push(be),Da=Ke.length-1):In&(Oi|$i)&&(Lt=!0),!(Da<0)&&(Ke[Da]=be,this.callback(this.manager,In,{pointers:Ke,changedPointers:[be],pointerType:Pi,srcEvent:be}),Lt&&Ke.splice(Da,1))}});var He={touchstart:la,touchmove:Gi,touchend:Oi,touchcancel:$i},rt="touchstart",he="touchstart touchmove touchend touchcancel";function ke(){this.evTarget=rt,this.evWin=he,this.started=!1,Xa.apply(this,arguments)}$t(ke,Xa,{handler:function(be){var Ke=He[be.type];if(Ke===la&&(this.started=!0),!!this.started){var Lt=vt.call(this,be,Ke);Ke&(Oi|$i)&&Lt[0].length-Lt[1].length==0&&(this.started=!1),this.callback(this.manager,Ke,{pointers:Lt[0],changedPointers:Lt[1],pointerType:Gn,srcEvent:be})}}});function vt(ne,be){var Ke=Ce(ne.touches),Lt=Ce(ne.changedTouches);return be&(Oi|$i)&&(Ke=De(Ke.concat(Lt),"identifier",!0)),[Ke,Lt]}var dr={touchstart:la,touchmove:Gi,touchend:Oi,touchcancel:$i},Ft="touchstart touchmove touchend touchcancel";function zt(){this.evTarget=Ft,this.targetIds={},Xa.apply(this,arguments)}$t(zt,Xa,{handler:function(be){var Ke=dr[be.type],Lt=vr.call(this,be,Ke);!Lt||this.callback(this.manager,Ke,{pointers:Lt[0],changedPointers:Lt[1],pointerType:Gn,srcEvent:be})}});function vr(ne,be){var Ke=Ce(ne.touches),Lt=this.targetIds;if(be&(la|Gi)&&Ke.length===1)return Lt[Ke[0].identifier]=!0,[Ke,Ke];var Rr,In,Pi=Ce(ne.changedTouches),so=[],Da=this.target;if(In=Ke.filter(function(Ha){return Er(Ha.target,Da)}),be===la)for(Rr=0;Rr<In.length;)Lt[In[Rr].identifier]=!0,Rr++;for(Rr=0;Rr<Pi.length;)Lt[Pi[Rr].identifier]&&so.push(Pi[Rr]),be&(Oi|$i)&&delete Lt[Pi[Rr].identifier],Rr++;if(!!so.length)return[De(In.concat(so),"identifier",!0),so]}var En=2500,pn=25;function Ot(){Xa.apply(this,arguments);var ne=ft(this.handler,this);this.touch=new zt(this.manager,ne),this.mouse=new Aa(this.manager,ne),this.primaryTouch=null,this.lastTouches=[]}$t(Ot,Xa,{handler:function(be,Ke,Lt){var Rr=Lt.pointerType==Gn,In=Lt.pointerType==hi;if(!(In&&Lt.sourceCapabilities&&Lt.sourceCapabilities.firesTouchEvents)){if(Rr)tn.call(this,Ke,Lt);else if(In&&Hr.call(this,Lt))return;this.callback(be,Ke,Lt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function tn(ne,be){ne&la?(this.primaryTouch=be.changedPointers[0].identifier,Zr.call(this,be)):ne&(Oi|$i)&&Zr.call(this,be)}function Zr(ne){var be=ne.changedPointers[0];if(be.identifier===this.primaryTouch){var Ke={x:be.clientX,y:be.clientY};this.lastTouches.push(Ke);var Lt=this.lastTouches,Rr=function(){var In=Lt.indexOf(Ke);In>-1&&Lt.splice(In,1)};setTimeout(Rr,En)}}function Hr(ne){for(var be=ne.srcEvent.clientX,Ke=ne.srcEvent.clientY,Lt=0;Lt<this.lastTouches.length;Lt++){var Rr=this.lastTouches[Lt],In=Math.abs(be-Rr.x),Pi=Math.abs(Ke-Rr.y);if(In<=pn&&Pi<=pn)return!0}return!1}var gi=Le?Z:Tt(Xe.style,"touchAction"),rn=gi!==Z,nn="compute",Wi="auto",vi="manipulation",Ti="none",_i="pan-x",ht="pan-y",Pt=Mi();function Ma(ne,be){this.manager=ne,this.set(be)}Ma.prototype={set:function(ne){ne==nn&&(ne=this.compute()),rn&&this.manager.element.style&&Pt[ne]&&(this.manager.element.style[gi]=ne),this.actions=ne.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ne=[];return Ct(this.manager.recognizers,function(be){Je(be.options.enable,[be])&&(ne=ne.concat(be.getTouchAction()))}),Ai(ne.join(" "))},preventDefaults:function(ne){var be=ne.srcEvent,Ke=ne.offsetDirection;if(this.manager.session.prevented){be.preventDefault();return}var Lt=this.actions,Rr=Fr(Lt,Ti)&&!Pt[Ti],In=Fr(Lt,ht)&&!Pt[ht],Pi=Fr(Lt,_i)&&!Pt[_i];if(Rr){var so=ne.pointers.length===1,Da=ne.distance<2,Ha=ne.deltaTime<250;if(so&&Da&&Ha)return}if(!(Pi&&In)&&(Rr||In&&Ke&Zi||Pi&&Ke&Qi))return this.preventSrc(be)},preventSrc:function(ne){this.manager.session.prevented=!0,ne.preventDefault()}};function Ai(ne){if(Fr(ne,Ti))return Ti;var be=Fr(ne,_i),Ke=Fr(ne,ht);return be&&Ke?Ti:be||Ke?be?_i:ht:Fr(ne,vi)?vi:Wi}function Mi(){if(!rn)return!1;var ne={};if(Le)return ne;var be=re.CSS&&re.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ke){ne[Ke]=be?re.CSS.supports("touch-action",Ke):!0}),ne}var ji=1,Pr=2,an=4,mt=8,aa=mt,ue=16,ns=32;function ta(ne){this.options=it({},this.defaults,ne||{}),this.id=Bt(),this.manager=null,this.options.enable=wt(this.options.enable,!0),this.state=ji,this.simultaneous={},this.requireFail=[]}ta.prototype={defaults:{},set:function(ne){return it(this.options,ne),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ne){if(Xt(ne,"recognizeWith",this))return this;var be=this.simultaneous;return ne=Pa(ne,this),be[ne.id]||(be[ne.id]=ne,ne.recognizeWith(this)),this},dropRecognizeWith:function(ne){return Xt(ne,"dropRecognizeWith",this)?this:(ne=Pa(ne,this),delete this.simultaneous[ne.id],this)},requireFailure:function(ne){if(Xt(ne,"requireFailure",this))return this;var be=this.requireFail;return ne=Pa(ne,this),A(be,ne)===-1&&(be.push(ne),ne.requireFailure(this)),this},dropRequireFailure:function(ne){if(Xt(ne,"dropRequireFailure",this))return this;ne=Pa(ne,this);var be=A(this.requireFail,ne);return be>-1&&this.requireFail.splice(be,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ne){return!!this.simultaneous[ne.id]},emit:function(ne){var be=this,Ke=this.state;function Lt(Rr){be.manager.emit(Rr,ne)}Ke<mt&&Lt(be.options.event+bu(Ke)),Lt(be.options.event),ne.additionalEvent&&Lt(ne.additionalEvent),Ke>=mt&&Lt(be.options.event+bu(Ke))},tryEmit:function(ne){if(this.canEmit())return this.emit(ne);this.state=ns},canEmit:function(){for(var ne=0;ne<this.requireFail.length;){if(!(this.requireFail[ne].state&(ns|ji)))return!1;ne++}return!0},recognize:function(ne){var be=it({},ne);if(!Je(this.options.enable,[this,be])){this.reset(),this.state=ns;return}this.state&(aa|ue|ns)&&(this.state=ji),this.state=this.process(be),this.state&(Pr|an|mt|ue)&&this.tryEmit(be)},process:function(ne){},getTouchAction:function(){},reset:function(){}};function bu(ne){return ne&ue?"cancel":ne&mt?"end":ne&an?"move":ne&Pr?"start":""}function Ga(ne){return ne==Ci?"down":ne==qn?"up":ne==wi?"left":ne==xa?"right":""}function Pa(ne,be){var Ke=be.manager;return Ke?Ke.get(ne):ne}function eo(){ta.apply(this,arguments)}$t(eo,ta,{defaults:{pointers:1},attrTest:function(ne){var be=this.options.pointers;return be===0||ne.pointers.length===be},process:function(ne){var be=this.state,Ke=ne.eventType,Lt=be&(Pr|an),Rr=this.attrTest(ne);return Lt&&(Ke&$i||!Rr)?be|ue:Lt||Rr?Ke&Oi?be|mt:be&Pr?be|an:Pr:ns}});function oa(){eo.apply(this,arguments),this.pX=null,this.pY=null}$t(oa,eo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Zo},getTouchAction:function(){var ne=this.options.direction,be=[];return ne&Zi&&be.push(ht),ne&Qi&&be.push(_i),be},directionTest:function(ne){var be=this.options,Ke=!0,Lt=ne.distance,Rr=ne.direction,In=ne.deltaX,Pi=ne.deltaY;return Rr&be.direction||(be.direction&Zi?(Rr=In===0?ca:In<0?wi:xa,Ke=In!=this.pX,Lt=Math.abs(ne.deltaX)):(Rr=Pi===0?ca:Pi<0?qn:Ci,Ke=Pi!=this.pY,Lt=Math.abs(ne.deltaY))),ne.direction=Rr,Ke&&Lt>be.threshold&&Rr&be.direction},attrTest:function(ne){return eo.prototype.attrTest.call(this,ne)&&(this.state&Pr||!(this.state&Pr)&&this.directionTest(ne))},emit:function(ne){this.pX=ne.deltaX,this.pY=ne.deltaY;var be=Ga(ne.direction);be&&(ne.additionalEvent=this.options.event+be),this._super.emit.call(this,ne)}});function Io(){eo.apply(this,arguments)}$t(Io,eo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ti]},attrTest:function(ne){return this._super.attrTest.call(this,ne)&&(Math.abs(ne.scale-1)>this.options.threshold||this.state&Pr)},emit:function(ne){if(ne.scale!==1){var be=ne.scale<1?"in":"out";ne.additionalEvent=this.options.event+be}this._super.emit.call(this,ne)}});function qo(){ta.apply(this,arguments),this._timer=null,this._input=null}$t(qo,ta,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Wi]},process:function(ne){var be=this.options,Ke=ne.pointers.length===be.pointers,Lt=ne.distance<be.threshold,Rr=ne.deltaTime>be.time;if(this._input=ne,!Lt||!Ke||ne.eventType&(Oi|$i)&&!Rr)this.reset();else if(ne.eventType&la)this.reset(),this._timer=bt(function(){this.state=aa,this.tryEmit()},be.time,this);else if(ne.eventType&Oi)return aa;return ns},reset:function(){clearTimeout(this._timer)},emit:function(ne){this.state===aa&&(ne&&ne.eventType&Oi?this.manager.emit(this.options.event+"up",ne):(this._input.timeStamp=rr(),this.manager.emit(this.options.event,this._input)))}});function Du(){eo.apply(this,arguments)}$t(Du,eo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ti]},attrTest:function(ne){return this._super.attrTest.call(this,ne)&&(Math.abs(ne.rotation)>this.options.threshold||this.state&Pr)}});function yo(){eo.apply(this,arguments)}$t(yo,eo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Zi|Qi,pointers:1},getTouchAction:function(){return oa.prototype.getTouchAction.call(this)},attrTest:function(ne){var be=this.options.direction,Ke;return be&(Zi|Qi)?Ke=ne.overallVelocity:be&Zi?Ke=ne.overallVelocityX:be&Qi&&(Ke=ne.overallVelocityY),this._super.attrTest.call(this,ne)&&be&ne.offsetDirection&&ne.distance>this.options.threshold&&ne.maxPointers==this.options.pointers&&yt(Ke)>this.options.velocity&&ne.eventType&Oi},emit:function(ne){var be=Ga(ne.offsetDirection);be&&this.manager.emit(this.options.event+be,ne),this.manager.emit(this.options.event,ne)}});function jo(){ta.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}$t(jo,ta,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[vi]},process:function(ne){var be=this.options,Ke=ne.pointers.length===be.pointers,Lt=ne.distance<be.threshold,Rr=ne.deltaTime<be.time;if(this.reset(),ne.eventType&la&&this.count===0)return this.failTimeout();if(Lt&&Rr&&Ke){if(ne.eventType!=Oi)return this.failTimeout();var In=this.pTime?ne.timeStamp-this.pTime<be.interval:!0,Pi=!this.pCenter||cn(this.pCenter,ne.center)<be.posThreshold;this.pTime=ne.timeStamp,this.pCenter=ne.center,!Pi||!In?this.count=1:this.count+=1,this._input=ne;var so=this.count%be.taps;if(so===0)return this.hasRequireFailures()?(this._timer=bt(function(){this.state=aa,this.tryEmit()},be.interval,this),Pr):aa}return ns},failTimeout:function(){return this._timer=bt(function(){this.state=ns},this.options.interval,this),ns},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==aa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function sa(ne,be){return be=be||{},be.recognizers=wt(be.recognizers,sa.defaults.preset),new ro(ne,be)}sa.VERSION="2.0.7",sa.defaults={domEvents:!1,touchAction:nn,enable:!0,inputTarget:null,inputClass:null,preset:[[Du,{enable:!1}],[Io,{enable:!1},["rotate"]],[yo,{direction:Zi}],[oa,{direction:Zi},["swipe"]],[jo],[jo,{event:"doubletap",taps:2},["tap"]],[qo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var to=1,Vo=2;function ro(ne,be){this.options=it({},sa.defaults,be||{}),this.options.inputTarget=this.options.inputTarget||ne,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ne,this.input=cs(this),this.touchAction=new Ma(this,this.options.touchAction),Rs(this,!0),Ct(this.options.recognizers,function(Ke){var Lt=this.add(new Ke[0](Ke[1]));Ke[2]&&Lt.recognizeWith(Ke[2]),Ke[3]&&Lt.requireFailure(Ke[3])},this)}ro.prototype={set:function(ne){return it(this.options,ne),ne.touchAction&&this.touchAction.update(),ne.inputTarget&&(this.input.destroy(),this.input.target=ne.inputTarget,this.input.init()),this},stop:function(ne){this.session.stopped=ne?Vo:to},recognize:function(ne){var be=this.session;if(!be.stopped){this.touchAction.preventDefaults(ne);var Ke,Lt=this.recognizers,Rr=be.curRecognizer;(!Rr||Rr&&Rr.state&aa)&&(Rr=be.curRecognizer=null);for(var In=0;In<Lt.length;)Ke=Lt[In],be.stopped!==Vo&&(!Rr||Ke==Rr||Ke.canRecognizeWith(Rr))?Ke.recognize(ne):Ke.reset(),!Rr&&Ke.state&(Pr|an|mt)&&(Rr=be.curRecognizer=Ke),In++}},get:function(ne){if(ne instanceof ta)return ne;for(var be=this.recognizers,Ke=0;Ke<be.length;Ke++)if(be[Ke].options.event==ne)return be[Ke];return null},add:function(ne){if(Xt(ne,"add",this))return this;var be=this.get(ne.options.event);return be&&this.remove(be),this.recognizers.push(ne),ne.manager=this,this.touchAction.update(),ne},remove:function(ne){if(Xt(ne,"remove",this))return this;if(ne=this.get(ne),ne){var be=this.recognizers,Ke=A(be,ne);Ke!==-1&&(be.splice(Ke,1),this.touchAction.update())}return this},on:function(ne,be){if(ne!==Z&&be!==Z){var Ke=this.handlers;return Ct(Jr(ne),function(Lt){Ke[Lt]=Ke[Lt]||[],Ke[Lt].push(be)}),this}},off:function(ne,be){if(ne!==Z){var Ke=this.handlers;return Ct(Jr(ne),function(Lt){be?Ke[Lt]&&Ke[Lt].splice(A(Ke[Lt],be),1):delete Ke[Lt]}),this}},emit:function(ne,be){this.options.domEvents&&Pl(ne,be);var Ke=this.handlers[ne]&&this.handlers[ne].slice();if(!(!Ke||!Ke.length)){be.type=ne,be.preventDefault=function(){be.srcEvent.preventDefault()};for(var Lt=0;Lt<Ke.length;)Ke[Lt](be),Lt++}},destroy:function(){this.element&&Rs(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Rs(ne,be){var Ke=ne.element;if(!!Ke.style){var Lt;Ct(ne.options.cssProps,function(Rr,In){Lt=Tt(Ke.style,In),be?(ne.oldCssProps[Lt]=Ke.style[Lt],Ke.style[Lt]=Rr):Ke.style[Lt]=ne.oldCssProps[Lt]||""}),be||(ne.oldCssProps={})}}function Pl(ne,be){if(!Le){var Ke=m.createEvent("Event");Ke.initEvent(ne,!0,!0),Ke.gesture=be,be.target.dispatchEvent(Ke)}}if(!Le){it(sa,{INPUT_START:la,INPUT_MOVE:Gi,INPUT_END:Oi,INPUT_CANCEL:$i,STATE_POSSIBLE:ji,STATE_BEGAN:Pr,STATE_CHANGED:an,STATE_ENDED:mt,STATE_RECOGNIZED:aa,STATE_CANCELLED:ue,STATE_FAILED:ns,DIRECTION_NONE:ca,DIRECTION_LEFT:wi,DIRECTION_RIGHT:xa,DIRECTION_UP:qn,DIRECTION_DOWN:Ci,DIRECTION_HORIZONTAL:Zi,DIRECTION_VERTICAL:Qi,DIRECTION_ALL:Zo,Manager:ro,Input:Xa,TouchAction:Ma,TouchInput:zt,MouseInput:Aa,PointerEventInput:Pe,TouchMouseInput:Ot,SingleTouchInput:ke,Recognizer:ta,AttrRecognizer:eo,Tap:jo,Pan:oa,Swipe:yo,Pinch:Io,Rotate:Du,Press:qo,on:Qe,off:Qt,each:Ct,merge:q,extend:Vt,assign:it,inherit:$t,bindFn:ft,prefixed:Tt});var _s=typeof window!="undefined"?window:typeof self!="undefined"?self:{};_s.Hammer=sa,ie=function(){return sa}.call($,z,$,It),ie!==Z&&(It.exports=ie)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(It,$,z){(function(ie,re){It.exports=re(z(18857))})(this,function(ie){"use strict";var re=function(B){return B instanceof Uint8Array||B instanceof Uint16Array||B instanceof Uint32Array||B instanceof Int8Array||B instanceof Int16Array||B instanceof Int32Array||B instanceof Float32Array||B instanceof Float64Array||B instanceof Uint8ClampedArray},m=function(B,ge){for(var Be=Object.keys(ge),kt=0;kt<Be.length;++kt)B[Be[kt]]=ge[Be[kt]];return B},de=`
`;function Z(B){return typeof atob!="undefined"?atob(B):"base64:"+B}function ce(B){var ge=new Error("(regl) "+B);throw console.error(ge),ge}function fe(B,ge){B||ce(ge)}function Le(B){return B?": "+B:""}function J(B,ge,Be){B in ge||ce("unknown parameter ("+B+")"+Le(Be)+". possible values: "+Object.keys(ge).join())}function Xe(B,ge){re(B)||ce("invalid parameter type"+Le(ge)+". must be a typed array")}function et(B,ge){switch(ge){case"number":return typeof B=="number";case"object":return typeof B=="object";case"string":return typeof B=="string";case"boolean":return typeof B=="boolean";case"function":return typeof B=="function";case"undefined":return typeof B=="undefined";case"symbol":return typeof B=="symbol"}}function Ze(B,ge,Be){et(B,ge)||ce("invalid parameter type"+Le(Be)+". expected "+ge+", got "+typeof B)}function yt(B,ge){B>=0&&(B|0)===B||ce("invalid parameter type, ("+B+")"+Le(ge)+". must be a nonnegative integer")}function rr(B,ge,Be){ge.indexOf(B)<0&&ce("invalid value"+Le(Be)+". must be one of: "+ge)}var bt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Xt(B){Object.keys(B).forEach(function(ge){bt.indexOf(ge)<0&&ce('invalid regl constructor argument "'+ge+'". must be one of '+bt)})}function Ct(B,ge){for(B=B+"";B.length<ge;)B=" "+B;return B}function at(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function it(B,ge){this.number=B,this.line=ge,this.errors=[]}function Vt(B,ge,Be){this.file=B,this.line=ge,this.message=Be}function q(){var B=new Error,ge=(B.stack||B).toString(),Be=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ge);if(Be)return Be[1];var kt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ge);return kt?kt[1]:"unknown"}function $t(){var B=new Error,ge=(B.stack||B).toString(),Be=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ge);if(Be)return Be[1];var kt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ge);return kt?kt[1]:"unknown"}function ft(B,ge){var Be=B.split(`
`),kt=1,ur=0,Dt={unknown:new at,0:new at};Dt.unknown.name=Dt[0].name=ge||q(),Dt.unknown.lines.push(new it(0,""));for(var er=0;er<Be.length;++er){var hr=Be[er],gr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(hr);if(gr)switch(gr[1]){case"line":var xr=/(\d+)(\s+\d+)?/.exec(gr[2]);xr&&(kt=xr[1]|0,xr[2]&&(ur=xr[2]|0,ur in Dt||(Dt[ur]=new at)));break;case"define":var wr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(gr[2]);wr&&(Dt[ur].name=wr[1]?Z(wr[2]):wr[2]);break}Dt[ur].lines.push(new it(kt++,hr))}return Object.keys(Dt).forEach(function(Ir){var Gr=Dt[Ir];Gr.lines.forEach(function(_r){Gr.index[_r.number]=_r})}),Dt}function Je(B){var ge=[];return B.split(`
`).forEach(function(Be){if(!(Be.length<5)){var kt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Be);kt?ge.push(new Vt(kt[1]|0,kt[2]|0,kt[3].trim())):Be.length>0&&ge.push(new Vt("unknown",0,Be))}}),ge}function wt(B,ge){ge.forEach(function(Be){var kt=B[Be.file];if(kt){var ur=kt.index[Be.line];if(ur){ur.errors.push(Be),kt.hasErrors=!0;return}}B.unknown.hasErrors=!0,B.unknown.lines[0].errors.push(Be)})}function Qe(B,ge,Be,kt,ur){if(!B.getShaderParameter(ge,B.COMPILE_STATUS)){var Dt=B.getShaderInfoLog(ge),er=kt===B.FRAGMENT_SHADER?"fragment":"vertex";De(Be,"string",er+" shader source must be a string",ur);var hr=ft(Be,ur),gr=Je(Dt);wt(hr,gr),Object.keys(hr).forEach(function(xr){var wr=hr[xr];if(!wr.hasErrors)return;var Ir=[""],Gr=[""];function _r(Tr,st){Ir.push(Tr),Gr.push(st||"")}_r("file number "+xr+": "+wr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),wr.lines.forEach(function(Tr){if(Tr.errors.length>0){_r(Ct(Tr.number,4)+"|  ","background-color:yellow; font-weight:bold"),_r(Tr.line+de,"color:red; background-color:yellow; font-weight:bold");var st=0;Tr.errors.forEach(function(jt){var br=jt.message,fr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(br);if(fr){var ar=fr[1];switch(br=fr[2],ar){case"assign":ar="=";break}st=Math.max(Tr.line.indexOf(ar,st),0)}else st=0;_r(Ct("| ",6)),_r(Ct("^^^",st+3)+de,"font-weight:bold"),_r(Ct("| ",6)),_r(br+de,"font-weight:bold")}),_r(Ct("| ",6)+de)}else _r(Ct(Tr.number,4)+"|  "),_r(Tr.line+de,"color:red")}),typeof document!="undefined"&&!window.chrome?(Gr[0]=Ir.join("%c"),console.log.apply(console,Gr)):console.log(Ir.join(""))}),fe.raise("Error compiling "+er+" shader, "+hr[0].name)}}function Qt(B,ge,Be,kt,ur){if(!B.getProgramParameter(ge,B.LINK_STATUS)){var Dt=B.getProgramInfoLog(ge),er=ft(Be,ur),hr=ft(kt,ur),gr='Error linking program with vertex shader, "'+hr[0].name+'", and fragment shader "'+er[0].name+'"';typeof document!="undefined"?console.log("%c"+gr+de+"%c"+Dt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(gr+de+Dt),fe.raise(gr)}}function Er(B){B._commandRef=q()}function Fr(B,ge,Be,kt){Er(B);function ur(gr){return gr?kt.id(gr):0}B._fragId=ur(B.static.frag),B._vertId=ur(B.static.vert);function Dt(gr,xr){Object.keys(xr).forEach(function(wr){gr[kt.id(wr)]=!0})}var er=B._uniformSet={};Dt(er,ge.static),Dt(er,ge.dynamic);var hr=B._attributeSet={};Dt(hr,Be.static),Dt(hr,Be.dynamic),B._hasCount="count"in B.static||"count"in B.dynamic||"elements"in B.static||"elements"in B.dynamic}function Jr(B,ge){var Be=$t();ce(B+" in command "+(ge||q())+(Be==="unknown"?"":" called from "+Be))}function A(B,ge,Be){B||Jr(ge,Be||q())}function Ce(B,ge,Be,kt){B in ge||Jr("unknown parameter ("+B+")"+Le(Be)+". possible values: "+Object.keys(ge).join(),kt||q())}function De(B,ge,Be,kt){et(B,ge)||Jr("invalid parameter type"+Le(Be)+". expected "+ge+", got "+typeof B,kt||q())}function Tt(B){B()}function gt(B,ge,Be){B.texture?rr(B.texture._texture.internalformat,ge,"unsupported texture format for attachment"):rr(B.renderbuffer._renderbuffer.format,Be,"unsupported renderbuffer format for attachment")}var Bt=33071,Kt=9728,Cr=9984,Qn=9985,vn=9986,fi=9987,Gn=5120,ii=5121,hi=5122,Wn=5123,pi=5124,la=5125,Gi=5126,Oi=32819,$i=32820,ca=33635,wi=34042,xa=36193,qn={};qn[Gn]=qn[ii]=1,qn[hi]=qn[Wn]=qn[xa]=qn[ca]=qn[Oi]=qn[$i]=2,qn[pi]=qn[la]=qn[Gi]=qn[wi]=4;function Ci(B,ge){return B===$i||B===Oi||B===ca?2:B===wi?4:qn[B]*ge}function Zi(B){return!(B&B-1)&&!!B}function Qi(B,ge,Be){var kt,ur=ge.width,Dt=ge.height,er=ge.channels;fe(ur>0&&ur<=Be.maxTextureSize&&Dt>0&&Dt<=Be.maxTextureSize,"invalid texture shape"),(B.wrapS!==Bt||B.wrapT!==Bt)&&fe(Zi(ur)&&Zi(Dt),"incompatible wrap mode for texture, both width and height must be power of 2"),ge.mipmask===1?ur!==1&&Dt!==1&&fe(B.minFilter!==Cr&&B.minFilter!==vn&&B.minFilter!==Qn&&B.minFilter!==fi,"min filter requires mipmap"):(fe(Zi(ur)&&Zi(Dt),"texture must be a square power of 2 to support mipmapping"),fe(ge.mipmask===(ur<<1)-1,"missing or incomplete mipmap data")),ge.type===Gi&&(Be.extensions.indexOf("oes_texture_float_linear")<0&&fe(B.minFilter===Kt&&B.magFilter===Kt,"filter not supported, must enable oes_texture_float_linear"),fe(!B.genMipmaps,"mipmap generation not supported with float textures"));var hr=ge.images;for(kt=0;kt<16;++kt)if(hr[kt]){var gr=ur>>kt,xr=Dt>>kt;fe(ge.mipmask&1<<kt,"missing mipmap data");var wr=hr[kt];if(fe(wr.width===gr&&wr.height===xr,"invalid shape for mip images"),fe(wr.format===ge.format&&wr.internalformat===ge.internalformat&&wr.type===ge.type,"incompatible type for mip image"),!wr.compressed)if(wr.data){var Ir=Math.ceil(Ci(wr.type,er)*gr/wr.unpackAlignment)*wr.unpackAlignment;fe(wr.data.byteLength===Ir*xr,"invalid data for image, buffer size is inconsistent with image format")}else wr.element||wr.copy}else B.genMipmaps||fe((ge.mipmask&1<<kt)==0,"extra mipmap data");ge.compressed&&fe(!B.genMipmaps,"mipmap generation for compressed images not supported")}function Zo(B,ge,Be,kt){var ur=B.width,Dt=B.height,er=B.channels;fe(ur>0&&ur<=kt.maxTextureSize&&Dt>0&&Dt<=kt.maxTextureSize,"invalid texture shape"),fe(ur===Dt,"cube map must be square"),fe(ge.wrapS===Bt&&ge.wrapT===Bt,"wrap mode not supported by cube map");for(var hr=0;hr<Be.length;++hr){var gr=Be[hr];fe(gr.width===ur&&gr.height===Dt,"inconsistent cube map face shape"),ge.genMipmaps&&(fe(!gr.compressed,"can not generate mipmap for compressed textures"),fe(gr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var xr=gr.images,wr=0;wr<16;++wr){var Ir=xr[wr];if(Ir){var Gr=ur>>wr,_r=Dt>>wr;fe(gr.mipmask&1<<wr,"missing mipmap data"),fe(Ir.width===Gr&&Ir.height===_r,"invalid shape for mip images"),fe(Ir.format===B.format&&Ir.internalformat===B.internalformat&&Ir.type===B.type,"incompatible type for mip image"),Ir.compressed||(Ir.data?fe(Ir.data.byteLength===Gr*_r*Math.max(Ci(Ir.type,er),Ir.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Ir.element||Ir.copy)}}}}var me=m(fe,{optional:Tt,raise:ce,commandRaise:Jr,command:A,parameter:J,commandParameter:Ce,constructor:Xt,type:Ze,commandType:De,isTypedArray:Xe,nni:yt,oneOf:rr,shaderError:Qe,linkError:Qt,callSite:$t,saveCommandRef:Er,saveDrawInfo:Fr,framebufferFormat:gt,guessCommand:q,texture2D:Qi,textureCube:Zo}),Dn=0,Xa=0,cs=5,Nt=6;function nr(B,ge){this.id=Dn++,this.type=B,this.data=ge}function Ar(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function en(B){if(B.length===0)return[];var ge=B.charAt(0),Be=B.charAt(B.length-1);if(B.length>1&&ge===Be&&(ge==='"'||ge==="'"))return['"'+Ar(B.substr(1,B.length-2))+'"'];var kt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(B);if(kt)return en(B.substr(0,kt.index)).concat(en(kt[1])).concat(en(B.substr(kt.index+kt[0].length)));var ur=B.split(".");if(ur.length===1)return['"'+Ar(B)+'"'];for(var Dt=[],er=0;er<ur.length;++er)Dt=Dt.concat(en(ur[er]));return Dt}function wn(B){return"["+en(B).join("][")+"]"}function Bn(B,ge){return new nr(B,wn(ge+""))}function di(B){return typeof B=="function"&&!B._reglType||B instanceof nr}function Jn(B,ge){if(typeof B=="function")return new nr(Xa,B);if(typeof B=="number"||typeof B=="boolean")return new nr(cs,B);if(Array.isArray(B))return new nr(Nt,B.map(function(Be,kt){return Jn(Be,ge+"["+kt+"]")}));if(B instanceof nr)return B;me(!1,"invalid option type in uniform "+ge)}var cn={DynamicVariable:nr,define:Bn,isDynamic:di,unbox:Jn,accessor:wn},Li={next:typeof requestAnimationFrame=="function"?function(B){return requestAnimationFrame(B)}:function(B){return setTimeout(B,16)},cancel:typeof cancelAnimationFrame=="function"?function(B){return cancelAnimationFrame(B)}:clearTimeout},Ri=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,oo=Ri?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ys(){var B={"":0},ge=[""];return{id:function(Be){var kt=B[Be];return kt||(kt=B[Be]=ge.length,ge.push(Be),kt)},str:function(Be){return ge[Be]}}}function Yo(B,ge,Be){var kt=document.createElement("canvas");m(kt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),B.appendChild(kt),B===document.body&&(kt.style.position="absolute",m(B.style,{margin:0,padding:0}));function ur(){var hr=window.innerWidth,gr=window.innerHeight;if(B!==document.body){var xr=kt.getBoundingClientRect();hr=xr.right-xr.left,gr=xr.bottom-xr.top}kt.width=Be*hr,kt.height=Be*gr}var Dt;B!==document.body&&typeof ResizeObserver=="function"?(Dt=new ResizeObserver(function(){setTimeout(ur)}),Dt.observe(B)):window.addEventListener("resize",ur,!1);function er(){Dt?Dt.disconnect():window.removeEventListener("resize",ur),B.removeChild(kt)}return ur(),{canvas:kt,onDestroy:er}}function Va(B,ge){function Be(kt){try{return B.getContext(kt,ge)}catch(ur){return null}}return Be("webgl")||Be("experimental-webgl")||Be("webgl-experimental")}function Aa(B){return typeof B.nodeName=="string"&&typeof B.appendChild=="function"&&typeof B.getBoundingClientRect=="function"}function H(B){return typeof B.drawArrays=="function"||typeof B.drawElements=="function"}function Q(B){return typeof B=="string"?B.split():(me(Array.isArray(B),"invalid extension array"),B)}function ae(B){return typeof B=="string"?(me(typeof document!="undefined","not supported outside of DOM"),document.querySelector(B)):B}function ye(B){var ge=B||{},Be,kt,ur,Dt,er={},hr=[],gr=[],xr=typeof window=="undefined"?1:window.devicePixelRatio,wr=!1,Ir=function(Tr){Tr&&me.raise(Tr)},Gr=function(){};if(typeof ge=="string"?(me(typeof document!="undefined","selector queries only supported in DOM environments"),Be=document.querySelector(ge),me(Be,"invalid query string for element")):typeof ge=="object"?Aa(ge)?Be=ge:H(ge)?(Dt=ge,ur=Dt.canvas):(me.constructor(ge),"gl"in ge?Dt=ge.gl:"canvas"in ge?ur=ae(ge.canvas):"container"in ge&&(kt=ae(ge.container)),"attributes"in ge&&(er=ge.attributes,me.type(er,"object","invalid context attributes")),"extensions"in ge&&(hr=Q(ge.extensions)),"optionalExtensions"in ge&&(gr=Q(ge.optionalExtensions)),"onDone"in ge&&(me.type(ge.onDone,"function","invalid or missing onDone callback"),Ir=ge.onDone),"profile"in ge&&(wr=!!ge.profile),"pixelRatio"in ge&&(xr=+ge.pixelRatio,me(xr>0,"invalid pixel ratio"))):me.raise("invalid arguments to regl"),Be&&(Be.nodeName.toLowerCase()==="canvas"?ur=Be:kt=Be),!Dt){if(!ur){me(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var _r=Yo(kt||document.body,Ir,xr);if(!_r)return null;ur=_r.canvas,Gr=_r.onDestroy}er.premultipliedAlpha===void 0&&(er.premultipliedAlpha=!0),Dt=Va(ur,er)}return Dt?{gl:Dt,canvas:ur,container:kt,extensions:hr,optionalExtensions:gr,pixelRatio:xr,profile:wr,onDone:Ir,onDestroy:Gr}:(Gr(),Ir("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Pe(B,ge){var Be={};function kt(hr){me.type(hr,"string","extension name must be string");var gr=hr.toLowerCase(),xr;try{xr=Be[gr]=ur(hr)}catch(wr){}return!!xr}function ur(hr){return B.getExtension(hr)?B.getExtension(hr):B.getExtension(hr.toLowerCase())?B.getExtension(hr.toLowerCase()):null}for(var Dt=0;Dt<ge.extensions.length;++Dt){var er=ge.extensions[Dt];if(!kt(er))return ge.onDestroy(),ge.onDone('"'+er+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ge.optionalExtensions.forEach(kt),{extensions:Be,restore:function(){Object.keys(Be).forEach(function(hr){if(Be[hr]&&!kt(hr))throw new Error("(regl): error restoring extension "+hr)})}}}function He(B,ge){for(var Be=Array(B),kt=0;kt<B;++kt)Be[kt]=ge(kt);return Be}var rt=5120,he=5121,ke=5122,vt=5123,dr=5124,Ft=5125,zt=5126;function vr(B){for(var ge=16;ge<=1<<28;ge*=16)if(B<=ge)return ge;return 0}function En(B){var ge,Be;return ge=(B>65535)<<4,B>>>=ge,Be=(B>255)<<3,B>>>=Be,ge|=Be,Be=(B>15)<<2,B>>>=Be,ge|=Be,Be=(B>3)<<1,B>>>=Be,ge|=Be,ge|B>>1}function pn(){var B=He(8,function(){return[]});function ge(Dt){var er=vr(Dt),hr=B[En(er)>>2];return hr.length>0?hr.pop():new ArrayBuffer(er)}function Be(Dt){B[En(Dt.byteLength)>>2].push(Dt)}function kt(Dt,er){var hr=null;switch(Dt){case rt:hr=new Int8Array(ge(er),0,er);break;case he:hr=new Uint8Array(ge(er),0,er);break;case ke:hr=new Int16Array(ge(2*er),0,er);break;case vt:hr=new Uint16Array(ge(2*er),0,er);break;case dr:hr=new Int32Array(ge(4*er),0,er);break;case Ft:hr=new Uint32Array(ge(4*er),0,er);break;case zt:hr=new Float32Array(ge(4*er),0,er);break;default:return null}return hr.length!==er?hr.subarray(0,er):hr}function ur(Dt){Be(Dt.buffer)}return{alloc:ge,free:Be,allocType:kt,freeType:ur}}var Ot=pn();Ot.zero=pn();var tn=3408,Zr=3410,Hr=3411,gi=3412,rn=3413,nn=3414,Wi=3415,vi=33901,Ti=33902,_i=3379,ht=3386,Pt=34921,Ma=36347,Ai=36348,Mi=35661,ji=35660,Pr=34930,an=36349,mt=34076,aa=34024,ue=7936,ns=7937,ta=7938,bu=35724,Ga=34047,Pa=36063,eo=34852,oa=3553,Io=34067,qo=34069,Du=33984,yo=6408,jo=5126,sa=5121,to=36160,Vo=36053,ro=36064,Rs=16384,Pl=function(B,ge){var Be=1;ge.ext_texture_filter_anisotropic&&(Be=B.getParameter(Ga));var kt=1,ur=1;ge.webgl_draw_buffers&&(kt=B.getParameter(eo),ur=B.getParameter(Pa));var Dt=!!ge.oes_texture_float;if(Dt){var er=B.createTexture();B.bindTexture(oa,er),B.texImage2D(oa,0,yo,1,1,0,yo,jo,null);var hr=B.createFramebuffer();if(B.bindFramebuffer(to,hr),B.framebufferTexture2D(to,ro,oa,er,0),B.bindTexture(oa,null),B.checkFramebufferStatus(to)!==Vo)Dt=!1;else{B.viewport(0,0,1,1),B.clearColor(1,0,0,1),B.clear(Rs);var gr=Ot.allocType(jo,4);B.readPixels(0,0,1,1,yo,jo,gr),B.getError()?Dt=!1:(B.deleteFramebuffer(hr),B.deleteTexture(er),Dt=gr[0]===1),Ot.freeType(gr)}}var xr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),wr=!0;if(!xr){var Ir=B.createTexture(),Gr=Ot.allocType(sa,36);B.activeTexture(Du),B.bindTexture(Io,Ir),B.texImage2D(qo,0,yo,3,3,0,yo,sa,Gr),Ot.freeType(Gr),B.bindTexture(Io,null),B.deleteTexture(Ir),wr=!B.getError()}return{colorBits:[B.getParameter(Zr),B.getParameter(Hr),B.getParameter(gi),B.getParameter(rn)],depthBits:B.getParameter(nn),stencilBits:B.getParameter(Wi),subpixelBits:B.getParameter(tn),extensions:Object.keys(ge).filter(function(_r){return!!ge[_r]}),maxAnisotropic:Be,maxDrawbuffers:kt,maxColorAttachments:ur,pointSizeDims:B.getParameter(vi),lineWidthDims:B.getParameter(Ti),maxViewportDims:B.getParameter(ht),maxCombinedTextureUnits:B.getParameter(Mi),maxCubeMapSize:B.getParameter(mt),maxRenderbufferSize:B.getParameter(aa),maxTextureUnits:B.getParameter(Pr),maxTextureSize:B.getParameter(_i),maxAttributes:B.getParameter(Pt),maxVertexUniforms:B.getParameter(Ma),maxVertexTextureUnits:B.getParameter(ji),maxVaryingVectors:B.getParameter(Ai),maxFragmentUniforms:B.getParameter(an),glsl:B.getParameter(bu),renderer:B.getParameter(ns),vendor:B.getParameter(ue),version:B.getParameter(ta),readFloat:Dt,npotTextureCube:wr}};function _s(B){return!!B&&typeof B=="object"&&Array.isArray(B.shape)&&Array.isArray(B.stride)&&typeof B.offset=="number"&&B.shape.length===B.stride.length&&(Array.isArray(B.data)||re(B.data))}var ne=function(B){return Object.keys(B).map(function(ge){return B[ge]})},be={shape:so,flatten:Pi};function Ke(B,ge,Be){for(var kt=0;kt<ge;++kt)Be[kt]=B[kt]}function Lt(B,ge,Be,kt){for(var ur=0,Dt=0;Dt<ge;++Dt)for(var er=B[Dt],hr=0;hr<Be;++hr)kt[ur++]=er[hr]}function Rr(B,ge,Be,kt,ur,Dt){for(var er=Dt,hr=0;hr<ge;++hr)for(var gr=B[hr],xr=0;xr<Be;++xr)for(var wr=gr[xr],Ir=0;Ir<kt;++Ir)ur[er++]=wr[Ir]}function In(B,ge,Be,kt,ur){for(var Dt=1,er=Be+1;er<ge.length;++er)Dt*=ge[er];var hr=ge[Be];if(ge.length-Be==4){var gr=ge[Be+1],xr=ge[Be+2],wr=ge[Be+3];for(er=0;er<hr;++er)Rr(B[er],gr,xr,wr,kt,ur),ur+=Dt}else for(er=0;er<hr;++er)In(B[er],ge,Be+1,kt,ur),ur+=Dt}function Pi(B,ge,Be,kt){var ur=1;if(ge.length)for(var Dt=0;Dt<ge.length;++Dt)ur*=ge[Dt];else ur=0;var er=kt||Ot.allocType(Be,ur);switch(ge.length){case 0:break;case 1:Ke(B,ge[0],er);break;case 2:Lt(B,ge[0],ge[1],er);break;case 3:Rr(B,ge[0],ge[1],ge[2],er,0);break;default:In(B,ge,0,er,0)}return er}function so(B){for(var ge=[],Be=B;Be.length;Be=Be[0])ge.push(Be.length);return ge}var Da={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ha=5120,Ko=5122,xs=5124,co=5121,Oo=5123,bs=5125,Ls=5126,Zs=5126,au={int8:Ha,int16:Ko,int32:xs,uint8:co,uint16:Oo,uint32:bs,float:Ls,float32:Zs},Es=35048,ba=35040,Ca={dynamic:Es,stream:ba,static:35044},fs=be.flatten,of=be.shape,Il=35044,qs=35040,ac=5121,Ju=5126,Ks=[];Ks[5120]=1,Ks[5122]=2,Ks[5124]=4,Ks[5121]=1,Ks[5123]=2,Ks[5125]=4,Ks[5126]=4;function pl(B){return Da[Object.prototype.toString.call(B)]|0}function _(B,ge){for(var Be=0;Be<ge.length;++Be)B[Be]=ge[Be]}function P(B,ge,Be,kt,ur,Dt,er){for(var hr=0,gr=0;gr<Be;++gr)for(var xr=0;xr<kt;++xr)B[hr++]=ge[ur*gr+Dt*xr+er]}function F(B,ge,Be,kt){var ur=0,Dt={};function er(st){this.id=ur++,this.buffer=B.createBuffer(),this.type=st,this.usage=Il,this.byteLength=0,this.dimension=1,this.dtype=ac,this.persistentData=null,Be.profile&&(this.stats={size:0})}er.prototype.bind=function(){B.bindBuffer(this.type,this.buffer)},er.prototype.destroy=function(){Gr(this)};var hr=[];function gr(st,jt){var br=hr.pop();return br||(br=new er(st)),br.bind(),Ir(br,jt,qs,0,1,!1),br}function xr(st){hr.push(st)}function wr(st,jt,br){st.byteLength=jt.byteLength,B.bufferData(st.type,jt,br)}function Ir(st,jt,br,fr,ar,Lr){var $r;if(st.usage=br,Array.isArray(jt)){if(st.dtype=fr||Ju,jt.length>0){var zn;if(Array.isArray(jt[0])){$r=of(jt);for(var tr=1,ir=1;ir<$r.length;++ir)tr*=$r[ir];st.dimension=tr,zn=fs(jt,$r,st.dtype),wr(st,zn,br),Lr?st.persistentData=zn:Ot.freeType(zn)}else if(typeof jt[0]=="number"){st.dimension=ar;var Sn=Ot.allocType(st.dtype,jt.length);_(Sn,jt),wr(st,Sn,br),Lr?st.persistentData=Sn:Ot.freeType(Sn)}else re(jt[0])?(st.dimension=jt[0].length,st.dtype=fr||pl(jt[0])||Ju,zn=fs(jt,[jt.length,jt[0].length],st.dtype),wr(st,zn,br),Lr?st.persistentData=zn:Ot.freeType(zn)):me.raise("invalid buffer data")}}else if(re(jt))st.dtype=fr||pl(jt),st.dimension=ar,wr(st,jt,br),Lr&&(st.persistentData=new Uint8Array(new Uint8Array(jt.buffer)));else if(_s(jt)){$r=jt.shape;var Vr=jt.stride,Sr=jt.offset,qr=0,Nr=0,ci=0,ei=0;$r.length===1?(qr=$r[0],Nr=1,ci=Vr[0],ei=0):$r.length===2?(qr=$r[0],Nr=$r[1],ci=Vr[0],ei=Vr[1]):me.raise("invalid shape"),st.dtype=fr||pl(jt.data)||Ju,st.dimension=Nr;var Wr=Ot.allocType(st.dtype,qr*Nr);P(Wr,jt.data,qr,Nr,ci,ei,Sr),wr(st,Wr,br),Lr?st.persistentData=Wr:Ot.freeType(Wr)}else jt instanceof ArrayBuffer?(st.dtype=ac,st.dimension=ar,wr(st,jt,br),Lr&&(st.persistentData=new Uint8Array(new Uint8Array(jt)))):me.raise("invalid buffer data")}function Gr(st){ge.bufferCount--,kt(st);var jt=st.buffer;me(jt,"buffer must not be deleted already"),B.deleteBuffer(jt),st.buffer=null,delete Dt[st.id]}function _r(st,jt,br,fr){ge.bufferCount++;var ar=new er(jt);Dt[ar.id]=ar;function Lr(tr){var ir=Il,Sn=null,Vr=0,Sr=0,qr=1;return Array.isArray(tr)||re(tr)||_s(tr)||tr instanceof ArrayBuffer?Sn=tr:typeof tr=="number"?Vr=tr|0:tr&&(me.type(tr,"object","buffer arguments must be an object, a number or an array"),"data"in tr&&(me(Sn===null||Array.isArray(Sn)||re(Sn)||_s(Sn),"invalid data for buffer"),Sn=tr.data),"usage"in tr&&(me.parameter(tr.usage,Ca,"invalid buffer usage"),ir=Ca[tr.usage]),"type"in tr&&(me.parameter(tr.type,au,"invalid buffer type"),Sr=au[tr.type]),"dimension"in tr&&(me.type(tr.dimension,"number","invalid dimension"),qr=tr.dimension|0),"length"in tr&&(me.nni(Vr,"buffer length must be a nonnegative integer"),Vr=tr.length|0)),ar.bind(),Sn?Ir(ar,Sn,ir,Sr,qr,fr):(Vr&&B.bufferData(ar.type,Vr,ir),ar.dtype=Sr||ac,ar.usage=ir,ar.dimension=qr,ar.byteLength=Vr),Be.profile&&(ar.stats.size=ar.byteLength*Ks[ar.dtype]),Lr}function $r(tr,ir){me(ir+tr.byteLength<=ar.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+tr.byteLength+" starting from offset "+ir+" to a buffer of size "+ar.byteLength),B.bufferSubData(ar.type,ir,tr)}function zn(tr,ir){var Sn=(ir||0)|0,Vr;if(ar.bind(),re(tr)||tr instanceof ArrayBuffer)$r(tr,Sn);else if(Array.isArray(tr)){if(tr.length>0)if(typeof tr[0]=="number"){var Sr=Ot.allocType(ar.dtype,tr.length);_(Sr,tr),$r(Sr,Sn),Ot.freeType(Sr)}else if(Array.isArray(tr[0])||re(tr[0])){Vr=of(tr);var qr=fs(tr,Vr,ar.dtype);$r(qr,Sn),Ot.freeType(qr)}else me.raise("invalid buffer data")}else if(_s(tr)){Vr=tr.shape;var Nr=tr.stride,ci=0,ei=0,Wr=0,Qr=0;Vr.length===1?(ci=Vr[0],ei=1,Wr=Nr[0],Qr=0):Vr.length===2?(ci=Vr[0],ei=Vr[1],Wr=Nr[0],Qr=Nr[1]):me.raise("invalid shape");var $n=Array.isArray(tr.data)?ar.dtype:pl(tr.data),ui=Ot.allocType($n,ci*ei);P(ui,tr.data,ci,ei,Wr,Qr,tr.offset),$r(ui,Sn),Ot.freeType(ui)}else me.raise("invalid data for buffer subdata");return Lr}return br||Lr(st),Lr._reglType="buffer",Lr._buffer=ar,Lr.subdata=zn,Be.profile&&(Lr.stats=ar.stats),Lr.destroy=function(){Gr(ar)},Lr}function Tr(){ne(Dt).forEach(function(st){st.buffer=B.createBuffer(),B.bindBuffer(st.type,st.buffer),B.bufferData(st.type,st.persistentData||st.byteLength,st.usage)})}return Be.profile&&(ge.getTotalBufferSize=function(){var st=0;return Object.keys(Dt).forEach(function(jt){st+=Dt[jt].stats.size}),st}),{create:_r,createStream:gr,destroyStream:xr,clear:function(){ne(Dt).forEach(Gr),hr.forEach(Gr)},getBuffer:function(st){return st&&st._buffer instanceof er?st._buffer:null},restore:Tr,_initBuffer:Ir}}var R=0,K=0,xe=1,We=1,pt=4,dt=4,sr={points:R,point:K,lines:xe,line:We,triangles:pt,triangle:dt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},cr=0,Pn=1,ai=4,kn=5120,Xi=5121,ga=5122,wa=5123,Hi=5124,Ss=5125,ou=34963,el=35040,sf=35044;function dl(B,ge,Be,kt){var ur={},Dt=0,er={uint8:Xi,uint16:wa};ge.oes_element_index_uint&&(er.uint32=Ss);function hr(Tr){this.id=Dt++,ur[this.id]=this,this.buffer=Tr,this.primType=ai,this.vertCount=0,this.type=0}hr.prototype.bind=function(){this.buffer.bind()};var gr=[];function xr(Tr){var st=gr.pop();return st||(st=new hr(Be.create(null,ou,!0,!1)._buffer)),Ir(st,Tr,el,-1,-1,0,0),st}function wr(Tr){gr.push(Tr)}function Ir(Tr,st,jt,br,fr,ar,Lr){Tr.buffer.bind();var $r;if(st){var zn=Lr;!Lr&&(!re(st)||_s(st)&&!re(st.data))&&(zn=ge.oes_element_index_uint?Ss:wa),Be._initBuffer(Tr.buffer,st,jt,zn,3)}else B.bufferData(ou,ar,jt),Tr.buffer.dtype=$r||Xi,Tr.buffer.usage=jt,Tr.buffer.dimension=3,Tr.buffer.byteLength=ar;if($r=Lr,!Lr){switch(Tr.buffer.dtype){case Xi:case kn:$r=Xi;break;case wa:case ga:$r=wa;break;case Ss:case Hi:$r=Ss;break;default:me.raise("unsupported type for element array")}Tr.buffer.dtype=$r}Tr.type=$r,me($r!==Ss||!!ge.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var tr=fr;tr<0&&(tr=Tr.buffer.byteLength,$r===wa?tr>>=1:$r===Ss&&(tr>>=2)),Tr.vertCount=tr;var ir=br;if(br<0){ir=ai;var Sn=Tr.buffer.dimension;Sn===1&&(ir=cr),Sn===2&&(ir=Pn),Sn===3&&(ir=ai)}Tr.primType=ir}function Gr(Tr){kt.elementsCount--,me(Tr.buffer!==null,"must not double destroy elements"),delete ur[Tr.id],Tr.buffer.destroy(),Tr.buffer=null}function _r(Tr,st){var jt=Be.create(null,ou,!0),br=new hr(jt._buffer);kt.elementsCount++;function fr(ar){if(!ar)jt(),br.primType=ai,br.vertCount=0,br.type=Xi;else if(typeof ar=="number")jt(ar),br.primType=ai,br.vertCount=ar|0,br.type=Xi;else{var Lr=null,$r=sf,zn=-1,tr=-1,ir=0,Sn=0;Array.isArray(ar)||re(ar)||_s(ar)?Lr=ar:(me.type(ar,"object","invalid arguments for elements"),"data"in ar&&(Lr=ar.data,me(Array.isArray(Lr)||re(Lr)||_s(Lr),"invalid data for element buffer")),"usage"in ar&&(me.parameter(ar.usage,Ca,"invalid element buffer usage"),$r=Ca[ar.usage]),"primitive"in ar&&(me.parameter(ar.primitive,sr,"invalid element buffer primitive"),zn=sr[ar.primitive]),"count"in ar&&(me(typeof ar.count=="number"&&ar.count>=0,"invalid vertex count for elements"),tr=ar.count|0),"type"in ar&&(me.parameter(ar.type,er,"invalid buffer type"),Sn=er[ar.type]),"length"in ar?ir=ar.length|0:(ir=tr,Sn===wa||Sn===ga?ir*=2:(Sn===Ss||Sn===Hi)&&(ir*=4))),Ir(br,Lr,$r,zn,tr,ir,Sn)}return fr}return fr(Tr),fr._reglType="elements",fr._elements=br,fr.subdata=function(ar,Lr){return jt.subdata(ar,Lr),fr},fr.destroy=function(){Gr(br)},fr}return{create:_r,createStream:xr,destroyStream:wr,getElements:function(Tr){return typeof Tr=="function"&&Tr._elements instanceof hr?Tr._elements:null},clear:function(){ne(ur).forEach(Gr)}}}var Dc=new Float32Array(1),Fu=new Uint32Array(Dc.buffer),Bu=5123;function Nu(B){for(var ge=Ot.allocType(Bu,B.length),Be=0;Be<B.length;++Be)if(isNaN(B[Be]))ge[Be]=65535;else if(B[Be]===Infinity)ge[Be]=31744;else if(B[Be]===-Infinity)ge[Be]=64512;else{Dc[0]=B[Be];var kt=Fu[0],ur=kt>>>31<<15,Dt=(kt<<1>>>24)-127,er=kt>>13&(1<<10)-1;if(Dt<-24)ge[Be]=ur;else if(Dt<-14){var hr=-14-Dt;ge[Be]=ur+(er+(1<<10)>>hr)}else Dt>15?ge[Be]=ur+31744:ge[Be]=ur+(Dt+15<<10)+er}return ge}function fo(B){return Array.isArray(B)||re(B)}var zf=function(B){return!(B&B-1)&&!!B},Uf=34467,is=3553,Fc=34067,zu=34069,su=6408,uf=6406,Ol=6407,Di=6409,Rl=6410,bh=32854,vl=32855,Bc=36194,Zf=32819,Eh=32820,jf=33635,Nc=34042,oc=6402,sc=34041,Ll=35904,ml=35906,kl=36193,tl=33776,$s=33777,lf=33778,cf=33779,Vf=35986,uu=35987,uc=34798,zc=35840,ff=35841,Dl=35842,np=35843,hf=36196,Fl=5121,pf=5123,df=5125,Bl=5126,Uc=10242,Sh=10243,Ch=10497,lc=33071,Ah=33648,Nl=10240,Ji=10241,cc=9728,fa=9729,Uu=9984,Yi=9985,Ia=9986,Cs=9987,Zc=33170,rl=4352,Wa=4353,fc=4354,zl=34046,nl=3317,jc=37440,Zu=37441,_o=37443,Ul=37444,hc=33984,xo=[Uu,Ia,Yi,Cs],yn=[0,Di,Rl,Ol,su],ho={};ho[Di]=ho[uf]=ho[oc]=1,ho[sc]=ho[Rl]=2,ho[Ol]=ho[Ll]=3,ho[su]=ho[ml]=4;function il(B){return"[object "+B+"]"}var Fa=il("HTMLCanvasElement"),lu=il("OffscreenCanvas"),ks=il("CanvasRenderingContext2D"),Vc=il("ImageBitmap"),Yr=il("HTMLImageElement"),vf=il("HTMLVideoElement"),pc=Object.keys(Da).concat([Fa,lu,ks,Vc,Yr,vf]),ju=[];ju[Fl]=1,ju[Bl]=4,ju[kl]=2,ju[pf]=2,ju[df]=4;var Ba=[];Ba[bh]=2,Ba[vl]=2,Ba[Bc]=2,Ba[sc]=4,Ba[tl]=.5,Ba[$s]=.5,Ba[lf]=1,Ba[cf]=1,Ba[Vf]=.5,Ba[uu]=1,Ba[uc]=1,Ba[zc]=.5,Ba[ff]=.25,Ba[Dl]=.5,Ba[np]=.25,Ba[hf]=.5;function As(B){return Array.isArray(B)&&(B.length===0||typeof B[0]=="number")}function Gc(B){if(!Array.isArray(B))return!1;var ge=B.length;return!(ge===0||!fo(B[0]))}function Vu(B){return Object.prototype.toString.call(B)}function as(B){return Vu(B)===Fa}function cu(B){return Vu(B)===lu}function wh(B){return Vu(B)===ks}function Hc(B){return Vu(B)===Vc}function Wc(B){return Vu(B)===Yr}function mf(B){return Vu(B)===vf}function fu(B){var ge=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ge&&B&&B.getContext)}function js(B){var ge=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ge&&B&&"src"in B&&"crossOrigin"in B)}function ki(B){if(!B)return!1;if(fu(B)||js(B))return!0;var ge=Vu(B);return pc.indexOf(ge)>=0?!0:As(B)||Gc(B)||_s(B)}function Eu(B){return Da[Object.prototype.toString.call(B)]|0}function Vs(B,ge){var Be=ge.length;switch(B.type){case Fl:case pf:case df:case Bl:var kt=Ot.allocType(B.type,Be);kt.set(ge),B.data=kt;break;case kl:B.data=Nu(ge);break;default:me.raise("unsupported texture type, must specify a typed array")}}function So(B,ge){return Ot.allocType(B.type===kl?Bl:B.type,ge)}function gl(B,ge){B.type===kl?(B.data=Nu(ge),Ot.freeType(ge)):B.data=ge}function al(B,ge,Be,kt,ur,Dt){for(var er=B.width,hr=B.height,gr=B.channels,xr=er*hr*gr,wr=So(B,xr),Ir=0,Gr=0;Gr<hr;++Gr)for(var _r=0;_r<er;++_r)for(var Tr=0;Tr<gr;++Tr)wr[Ir++]=ge[Be*_r+kt*Gr+ur*Tr+Dt];gl(B,wr)}function Qs(B,ge,Be,kt,ur,Dt){var er;if(typeof Ba[B]!="undefined"?er=Ba[B]:er=ho[B]*ju[ge],Dt&&(er*=6),ur){for(var hr=0,gr=Be;gr>=1;)hr+=er*gr*gr,gr/=2;return hr}else return er*Be*kt}function hs(B,ge,Be,kt,ur,Dt,er){var hr={"don't care":rl,"dont care":rl,nice:fc,fast:Wa},gr={repeat:Ch,clamp:lc,mirror:Ah},xr={nearest:cc,linear:fa},wr=m({mipmap:Cs,"nearest mipmap nearest":Uu,"linear mipmap nearest":Yi,"nearest mipmap linear":Ia,"linear mipmap linear":Cs},xr),Ir={none:0,browser:Ul},Gr={uint8:Fl,rgba4:Zf,rgb565:jf,"rgb5 a1":Eh},_r={alpha:uf,luminance:Di,"luminance alpha":Rl,rgb:Ol,rgba:su,rgba4:bh,"rgb5 a1":vl,rgb565:Bc},Tr={};ge.ext_srgb&&(_r.srgb=Ll,_r.srgba=ml),ge.oes_texture_float&&(Gr.float32=Gr.float=Bl),ge.oes_texture_half_float&&(Gr.float16=Gr["half float"]=kl),ge.webgl_depth_texture&&(m(_r,{depth:oc,"depth stencil":sc}),m(Gr,{uint16:pf,uint32:df,"depth stencil":Nc})),ge.webgl_compressed_texture_s3tc&&m(Tr,{"rgb s3tc dxt1":tl,"rgba s3tc dxt1":$s,"rgba s3tc dxt3":lf,"rgba s3tc dxt5":cf}),ge.webgl_compressed_texture_atc&&m(Tr,{"rgb atc":Vf,"rgba atc explicit alpha":uu,"rgba atc interpolated alpha":uc}),ge.webgl_compressed_texture_pvrtc&&m(Tr,{"rgb pvrtc 4bppv1":zc,"rgb pvrtc 2bppv1":ff,"rgba pvrtc 4bppv1":Dl,"rgba pvrtc 2bppv1":np}),ge.webgl_compressed_texture_etc1&&(Tr["rgb etc1"]=hf);var st=Array.prototype.slice.call(B.getParameter(Uf)||new Uint32Array(0));Object.keys(Tr).forEach(function(Te){var Ut=Tr[Te];st.indexOf(Ut)>=0&&(_r[Te]=Ut)});var jt=Object.keys(_r);Be.textureFormats=jt;var br=[];Object.keys(_r).forEach(function(Te){var Ut=_r[Te];br[Ut]=Te});var fr=[];Object.keys(Gr).forEach(function(Te){var Ut=Gr[Te];fr[Ut]=Te});var ar=[];Object.keys(xr).forEach(function(Te){var Ut=xr[Te];ar[Ut]=Te});var Lr=[];Object.keys(wr).forEach(function(Te){var Ut=wr[Te];Lr[Ut]=Te});var $r=[];Object.keys(gr).forEach(function(Te){var Ut=gr[Te];$r[Ut]=Te});var zn=jt.reduce(function(Te,Ut){var At=_r[Ut];return At===Di||At===uf||At===Di||At===Rl||At===oc||At===sc||ge.ext_srgb&&(At===Ll||At===ml)?Te[At]=At:At===vl||Ut.indexOf("rgba")>=0?Te[At]=su:Te[At]=Ol,Te},{});function tr(){this.internalformat=su,this.format=su,this.type=Fl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Ul,this.width=0,this.height=0,this.channels=0}function ir(Te,Ut){Te.internalformat=Ut.internalformat,Te.format=Ut.format,Te.type=Ut.type,Te.compressed=Ut.compressed,Te.premultiplyAlpha=Ut.premultiplyAlpha,Te.flipY=Ut.flipY,Te.unpackAlignment=Ut.unpackAlignment,Te.colorSpace=Ut.colorSpace,Te.width=Ut.width,Te.height=Ut.height,Te.channels=Ut.channels}function Sn(Te,Ut){if(!(typeof Ut!="object"||!Ut)){if("premultiplyAlpha"in Ut&&(me.type(Ut.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Te.premultiplyAlpha=Ut.premultiplyAlpha),"flipY"in Ut&&(me.type(Ut.flipY,"boolean","invalid texture flip"),Te.flipY=Ut.flipY),"alignment"in Ut&&(me.oneOf(Ut.alignment,[1,2,4,8],"invalid texture unpack alignment"),Te.unpackAlignment=Ut.alignment),"colorSpace"in Ut&&(me.parameter(Ut.colorSpace,Ir,"invalid colorSpace"),Te.colorSpace=Ir[Ut.colorSpace]),"type"in Ut){var At=Ut.type;me(ge.oes_texture_float||!(At==="float"||At==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),me(ge.oes_texture_half_float||!(At==="half float"||At==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),me(ge.webgl_depth_texture||!(At==="uint16"||At==="uint32"||At==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),me.parameter(At,Gr,"invalid texture type"),Te.type=Gr[At]}var mn=Te.width,Vi=Te.height,Se=Te.channels,oe=!1;"shape"in Ut?(me(Array.isArray(Ut.shape)&&Ut.shape.length>=2,"shape must be an array"),mn=Ut.shape[0],Vi=Ut.shape[1],Ut.shape.length===3&&(Se=Ut.shape[2],me(Se>0&&Se<=4,"invalid number of channels"),oe=!0),me(mn>=0&&mn<=Be.maxTextureSize,"invalid width"),me(Vi>=0&&Vi<=Be.maxTextureSize,"invalid height")):("radius"in Ut&&(mn=Vi=Ut.radius,me(mn>=0&&mn<=Be.maxTextureSize,"invalid radius")),"width"in Ut&&(mn=Ut.width,me(mn>=0&&mn<=Be.maxTextureSize,"invalid width")),"height"in Ut&&(Vi=Ut.height,me(Vi>=0&&Vi<=Be.maxTextureSize,"invalid height")),"channels"in Ut&&(Se=Ut.channels,me(Se>0&&Se<=4,"invalid number of channels"),oe=!0)),Te.width=mn|0,Te.height=Vi|0,Te.channels=Se|0;var Ve=!1;if("format"in Ut){var ct=Ut.format;me(ge.webgl_depth_texture||!(ct==="depth"||ct==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),me.parameter(ct,_r,"invalid texture format");var Rt=Te.internalformat=_r[ct];Te.format=zn[Rt],ct in Gr&&("type"in Ut||(Te.type=Gr[ct])),ct in Tr&&(Te.compressed=!0),Ve=!0}!oe&&Ve?Te.channels=ho[Te.format]:oe&&!Ve?Te.channels!==yn[Te.format]&&(Te.format=Te.internalformat=yn[Te.channels]):Ve&&oe&&me(Te.channels===ho[Te.format],"number of channels inconsistent with specified format")}}function Vr(Te){B.pixelStorei(jc,Te.flipY),B.pixelStorei(Zu,Te.premultiplyAlpha),B.pixelStorei(_o,Te.colorSpace),B.pixelStorei(nl,Te.unpackAlignment)}function Sr(){tr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function qr(Te,Ut){var At=null;if(ki(Ut)?At=Ut:Ut&&(me.type(Ut,"object","invalid pixel data type"),Sn(Te,Ut),"x"in Ut&&(Te.xOffset=Ut.x|0),"y"in Ut&&(Te.yOffset=Ut.y|0),ki(Ut.data)&&(At=Ut.data)),me(!Te.compressed||At instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Ut.copy){me(!At,"can not specify copy and data field for the same texture");var mn=ur.viewportWidth,Vi=ur.viewportHeight;Te.width=Te.width||mn-Te.xOffset,Te.height=Te.height||Vi-Te.yOffset,Te.needsCopy=!0,me(Te.xOffset>=0&&Te.xOffset<mn&&Te.yOffset>=0&&Te.yOffset<Vi&&Te.width>0&&Te.width<=mn&&Te.height>0&&Te.height<=Vi,"copy texture read out of bounds")}else if(!At)Te.width=Te.width||1,Te.height=Te.height||1,Te.channels=Te.channels||4;else if(re(At))Te.channels=Te.channels||4,Te.data=At,!("type"in Ut)&&Te.type===Fl&&(Te.type=Eu(At));else if(As(At))Te.channels=Te.channels||4,Vs(Te,At),Te.alignment=1,Te.needsFree=!0;else if(_s(At)){var Se=At.data;!Array.isArray(Se)&&Te.type===Fl&&(Te.type=Eu(Se));var oe=At.shape,Ve=At.stride,ct,Rt,Ye,Fe,nt,_e;oe.length===3?(Ye=oe[2],_e=Ve[2]):(me(oe.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Ye=1,_e=1),ct=oe[0],Rt=oe[1],Fe=Ve[0],nt=Ve[1],Te.alignment=1,Te.width=ct,Te.height=Rt,Te.channels=Ye,Te.format=Te.internalformat=yn[Ye],Te.needsFree=!0,al(Te,Se,Fe,nt,_e,At.offset)}else if(fu(At)||as(At)||cu(At)||wh(At))fu(At)||as(At)||cu(At)?Te.element=At:Te.element=At.canvas,Te.width=Te.element.width,Te.height=Te.element.height,Te.channels=4;else if(Hc(At))Te.element=At,Te.width=At.width,Te.height=At.height,Te.channels=4;else if(Wc(At))Te.element=At,Te.width=At.naturalWidth,Te.height=At.naturalHeight,Te.channels=4;else if(js(At))Te.element=At,Te.width=At.width,Te.height=At.height,Te.channels=4;else if(mf(At))Te.element=At,Te.width=At.videoWidth,Te.height=At.videoHeight,Te.channels=4;else if(Gc(At)){var ze=Te.width||At[0].length,Ae=Te.height||At.length,lt=Te.channels;fo(At[0][0])?lt=lt||At[0][0].length:lt=lt||1;for(var St=be.shape(At),pr=1,jr=0;jr<St.length;++jr)pr*=St[jr];var Ur=So(Te,pr);be.flatten(At,St,"",Ur),gl(Te,Ur),Te.alignment=1,Te.width=ze,Te.height=Ae,Te.channels=lt,Te.format=Te.internalformat=yn[lt],Te.needsFree=!0}Te.type===Bl?me(Be.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Te.type===kl&&me(Be.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Nr(Te,Ut,At){var mn=Te.element,Vi=Te.data,Se=Te.internalformat,oe=Te.format,Ve=Te.type,ct=Te.width,Rt=Te.height;Vr(Te),mn?B.texImage2D(Ut,At,oe,oe,Ve,mn):Te.compressed?B.compressedTexImage2D(Ut,At,Se,ct,Rt,0,Vi):Te.needsCopy?(kt(),B.copyTexImage2D(Ut,At,oe,Te.xOffset,Te.yOffset,ct,Rt,0)):B.texImage2D(Ut,At,oe,ct,Rt,0,oe,Ve,Vi||null)}function ci(Te,Ut,At,mn,Vi){var Se=Te.element,oe=Te.data,Ve=Te.internalformat,ct=Te.format,Rt=Te.type,Ye=Te.width,Fe=Te.height;Vr(Te),Se?B.texSubImage2D(Ut,Vi,At,mn,ct,Rt,Se):Te.compressed?B.compressedTexSubImage2D(Ut,Vi,At,mn,Ve,Ye,Fe,oe):Te.needsCopy?(kt(),B.copyTexSubImage2D(Ut,Vi,At,mn,Te.xOffset,Te.yOffset,Ye,Fe)):B.texSubImage2D(Ut,Vi,At,mn,Ye,Fe,ct,Rt,oe)}var ei=[];function Wr(){return ei.pop()||new Sr}function Qr(Te){Te.needsFree&&Ot.freeType(Te.data),Sr.call(Te),ei.push(Te)}function $n(){tr.call(this),this.genMipmaps=!1,this.mipmapHint=rl,this.mipmask=0,this.images=Array(16)}function ui(Te,Ut,At){var mn=Te.images[0]=Wr();Te.mipmask=1,mn.width=Te.width=Ut,mn.height=Te.height=At,mn.channels=Te.channels=4}function Bi(Te,Ut){var At=null;if(ki(Ut))At=Te.images[0]=Wr(),ir(At,Te),qr(At,Ut),Te.mipmask=1;else if(Sn(Te,Ut),Array.isArray(Ut.mipmap))for(var mn=Ut.mipmap,Vi=0;Vi<mn.length;++Vi)At=Te.images[Vi]=Wr(),ir(At,Te),At.width>>=Vi,At.height>>=Vi,qr(At,mn[Vi]),Te.mipmask|=1<<Vi;else At=Te.images[0]=Wr(),ir(At,Te),qr(At,Ut),Te.mipmask=1;ir(Te,Te.images[0]),Te.compressed&&(Te.internalformat===tl||Te.internalformat===$s||Te.internalformat===lf||Te.internalformat===cf)&&me(Te.width%4==0&&Te.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function uo(Te,Ut){for(var At=Te.images,mn=0;mn<At.length;++mn){if(!At[mn])return;Nr(At[mn],Ut,mn)}}var vo=[];function Ni(){var Te=vo.pop()||new $n;tr.call(Te),Te.mipmask=0;for(var Ut=0;Ut<16;++Ut)Te.images[Ut]=null;return Te}function ss(Te){for(var Ut=Te.images,At=0;At<Ut.length;++At)Ut[At]&&Qr(Ut[At]),Ut[At]=null;vo.push(Te)}function Ka(){this.minFilter=cc,this.magFilter=cc,this.wrapS=lc,this.wrapT=lc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=rl}function Ho(Te,Ut){if("min"in Ut){var At=Ut.min;me.parameter(At,wr),Te.minFilter=wr[At],xo.indexOf(Te.minFilter)>=0&&!("faces"in Ut)&&(Te.genMipmaps=!0)}if("mag"in Ut){var mn=Ut.mag;me.parameter(mn,xr),Te.magFilter=xr[mn]}var Vi=Te.wrapS,Se=Te.wrapT;if("wrap"in Ut){var oe=Ut.wrap;typeof oe=="string"?(me.parameter(oe,gr),Vi=Se=gr[oe]):Array.isArray(oe)&&(me.parameter(oe[0],gr),me.parameter(oe[1],gr),Vi=gr[oe[0]],Se=gr[oe[1]])}else{if("wrapS"in Ut){var Ve=Ut.wrapS;me.parameter(Ve,gr),Vi=gr[Ve]}if("wrapT"in Ut){var ct=Ut.wrapT;me.parameter(ct,gr),Se=gr[ct]}}if(Te.wrapS=Vi,Te.wrapT=Se,"anisotropic"in Ut){var Rt=Ut.anisotropic;me(typeof Rt=="number"&&Rt>=1&&Rt<=Be.maxAnisotropic,"aniso samples must be between 1 and "),Te.anisotropic=Ut.anisotropic}if("mipmap"in Ut){var Ye=!1;switch(typeof Ut.mipmap){case"string":me.parameter(Ut.mipmap,hr,"invalid mipmap hint"),Te.mipmapHint=hr[Ut.mipmap],Te.genMipmaps=!0,Ye=!0;break;case"boolean":Ye=Te.genMipmaps=Ut.mipmap;break;case"object":me(Array.isArray(Ut.mipmap),"invalid mipmap type"),Te.genMipmaps=!1,Ye=!0;break;default:me.raise("invalid mipmap type")}Ye&&!("min"in Ut)&&(Te.minFilter=Uu)}}function wo(Te,Ut){B.texParameteri(Ut,Ji,Te.minFilter),B.texParameteri(Ut,Nl,Te.magFilter),B.texParameteri(Ut,Uc,Te.wrapS),B.texParameteri(Ut,Sh,Te.wrapT),ge.ext_texture_filter_anisotropic&&B.texParameteri(Ut,zl,Te.anisotropic),Te.genMipmaps&&(B.hint(Zc,Te.mipmapHint),B.generateMipmap(Ut))}var Qo=0,Bo={},ms=Be.maxTextureUnits,mo=Array(ms).map(function(){return null});function xi(Te){tr.call(this),this.mipmask=0,this.internalformat=su,this.id=Qo++,this.refCount=1,this.target=Te,this.texture=B.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ka,er.profile&&(this.stats={size:0})}function Wo(Te){B.activeTexture(hc),B.bindTexture(Te.target,Te.texture)}function na(){var Te=mo[0];Te?B.bindTexture(Te.target,Te.texture):B.bindTexture(is,null)}function Jo(Te){var Ut=Te.texture;me(Ut,"must not double destroy texture");var At=Te.unit,mn=Te.target;At>=0&&(B.activeTexture(hc+At),B.bindTexture(mn,null),mo[At]=null),B.deleteTexture(Ut),Te.texture=null,Te.params=null,Te.pixels=null,Te.refCount=0,delete Bo[Te.id],Dt.textureCount--}m(xi.prototype,{bind:function(){var Te=this;Te.bindCount+=1;var Ut=Te.unit;if(Ut<0){for(var At=0;At<ms;++At){var mn=mo[At];if(mn){if(mn.bindCount>0)continue;mn.unit=-1}mo[At]=Te,Ut=At;break}Ut>=ms&&me.raise("insufficient number of texture units"),er.profile&&Dt.maxTextureUnits<Ut+1&&(Dt.maxTextureUnits=Ut+1),Te.unit=Ut,B.activeTexture(hc+Ut),B.bindTexture(Te.target,Te.texture)}return Ut},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Jo(this)}});function ri(Te,Ut){var At=new xi(is);Bo[At.id]=At,Dt.textureCount++;function mn(oe,Ve){var ct=At.texInfo;Ka.call(ct);var Rt=Ni();return typeof oe=="number"?typeof Ve=="number"?ui(Rt,oe|0,Ve|0):ui(Rt,oe|0,oe|0):oe?(me.type(oe,"object","invalid arguments to regl.texture"),Ho(ct,oe),Bi(Rt,oe)):ui(Rt,1,1),ct.genMipmaps&&(Rt.mipmask=(Rt.width<<1)-1),At.mipmask=Rt.mipmask,ir(At,Rt),me.texture2D(ct,Rt,Be),At.internalformat=Rt.internalformat,mn.width=Rt.width,mn.height=Rt.height,Wo(At),uo(Rt,is),wo(ct,is),na(),ss(Rt),er.profile&&(At.stats.size=Qs(At.internalformat,At.type,Rt.width,Rt.height,ct.genMipmaps,!1)),mn.format=br[At.internalformat],mn.type=fr[At.type],mn.mag=ar[ct.magFilter],mn.min=Lr[ct.minFilter],mn.wrapS=$r[ct.wrapS],mn.wrapT=$r[ct.wrapT],mn}function Vi(oe,Ve,ct,Rt){me(!!oe,"must specify image data");var Ye=Ve|0,Fe=ct|0,nt=Rt|0,_e=Wr();return ir(_e,At),_e.width=0,_e.height=0,qr(_e,oe),_e.width=_e.width||(At.width>>nt)-Ye,_e.height=_e.height||(At.height>>nt)-Fe,me(At.type===_e.type&&At.format===_e.format&&At.internalformat===_e.internalformat,"incompatible format for texture.subimage"),me(Ye>=0&&Fe>=0&&Ye+_e.width<=At.width&&Fe+_e.height<=At.height,"texture.subimage write out of bounds"),me(At.mipmask&1<<nt,"missing mipmap data"),me(_e.data||_e.element||_e.needsCopy,"missing image data"),Wo(At),ci(_e,is,Ye,Fe,nt),na(),Qr(_e),mn}function Se(oe,Ve){var ct=oe|0,Rt=Ve|0||ct;if(ct===At.width&&Rt===At.height)return mn;mn.width=At.width=ct,mn.height=At.height=Rt,Wo(At);for(var Ye=0;At.mipmask>>Ye;++Ye){var Fe=ct>>Ye,nt=Rt>>Ye;if(!Fe||!nt)break;B.texImage2D(is,Ye,At.format,Fe,nt,0,At.format,At.type,null)}return na(),er.profile&&(At.stats.size=Qs(At.internalformat,At.type,ct,Rt,!1,!1)),mn}return mn(Te,Ut),mn.subimage=Vi,mn.resize=Se,mn._reglType="texture2d",mn._texture=At,er.profile&&(mn.stats=At.stats),mn.destroy=function(){At.decRef()},mn}function zi(Te,Ut,At,mn,Vi,Se){var oe=new xi(Fc);Bo[oe.id]=oe,Dt.cubeCount++;var Ve=new Array(6);function ct(Fe,nt,_e,ze,Ae,lt){var St,pr=oe.texInfo;for(Ka.call(pr),St=0;St<6;++St)Ve[St]=Ni();if(typeof Fe=="number"||!Fe){var jr=Fe|0||1;for(St=0;St<6;++St)ui(Ve[St],jr,jr)}else if(typeof Fe=="object")if(nt)Bi(Ve[0],Fe),Bi(Ve[1],nt),Bi(Ve[2],_e),Bi(Ve[3],ze),Bi(Ve[4],Ae),Bi(Ve[5],lt);else if(Ho(pr,Fe),Sn(oe,Fe),"faces"in Fe){var Ur=Fe.faces;for(me(Array.isArray(Ur)&&Ur.length===6,"cube faces must be a length 6 array"),St=0;St<6;++St)me(typeof Ur[St]=="object"&&!!Ur[St],"invalid input for cube map face"),ir(Ve[St],oe),Bi(Ve[St],Ur[St])}else for(St=0;St<6;++St)Bi(Ve[St],Fe);else me.raise("invalid arguments to cube map");for(ir(oe,Ve[0]),me.optional(function(){Be.npotTextureCube||me(zf(oe.width)&&zf(oe.height),"your browser does not support non power or two texture dimensions")}),pr.genMipmaps?oe.mipmask=(Ve[0].width<<1)-1:oe.mipmask=Ve[0].mipmask,me.textureCube(oe,pr,Ve,Be),oe.internalformat=Ve[0].internalformat,ct.width=Ve[0].width,ct.height=Ve[0].height,Wo(oe),St=0;St<6;++St)uo(Ve[St],zu+St);for(wo(pr,Fc),na(),er.profile&&(oe.stats.size=Qs(oe.internalformat,oe.type,ct.width,ct.height,pr.genMipmaps,!0)),ct.format=br[oe.internalformat],ct.type=fr[oe.type],ct.mag=ar[pr.magFilter],ct.min=Lr[pr.minFilter],ct.wrapS=$r[pr.wrapS],ct.wrapT=$r[pr.wrapT],St=0;St<6;++St)ss(Ve[St]);return ct}function Rt(Fe,nt,_e,ze,Ae){me(!!nt,"must specify image data"),me(typeof Fe=="number"&&Fe===(Fe|0)&&Fe>=0&&Fe<6,"invalid face");var lt=_e|0,St=ze|0,pr=Ae|0,jr=Wr();return ir(jr,oe),jr.width=0,jr.height=0,qr(jr,nt),jr.width=jr.width||(oe.width>>pr)-lt,jr.height=jr.height||(oe.height>>pr)-St,me(oe.type===jr.type&&oe.format===jr.format&&oe.internalformat===jr.internalformat,"incompatible format for texture.subimage"),me(lt>=0&&St>=0&&lt+jr.width<=oe.width&&St+jr.height<=oe.height,"texture.subimage write out of bounds"),me(oe.mipmask&1<<pr,"missing mipmap data"),me(jr.data||jr.element||jr.needsCopy,"missing image data"),Wo(oe),ci(jr,zu+Fe,lt,St,pr),na(),Qr(jr),ct}function Ye(Fe){var nt=Fe|0;if(nt!==oe.width){ct.width=oe.width=nt,ct.height=oe.height=nt,Wo(oe);for(var _e=0;_e<6;++_e)for(var ze=0;oe.mipmask>>ze;++ze)B.texImage2D(zu+_e,ze,oe.format,nt>>ze,nt>>ze,0,oe.format,oe.type,null);return na(),er.profile&&(oe.stats.size=Qs(oe.internalformat,oe.type,ct.width,ct.height,!1,!0)),ct}}return ct(Te,Ut,At,mn,Vi,Se),ct.subimage=Rt,ct.resize=Ye,ct._reglType="textureCube",ct._texture=oe,er.profile&&(ct.stats=oe.stats),ct.destroy=function(){oe.decRef()},ct}function _a(){for(var Te=0;Te<ms;++Te)B.activeTexture(hc+Te),B.bindTexture(is,null),mo[Te]=null;ne(Bo).forEach(Jo),Dt.cubeCount=0,Dt.textureCount=0}er.profile&&(Dt.getTotalTextureSize=function(){var Te=0;return Object.keys(Bo).forEach(function(Ut){Te+=Bo[Ut].stats.size}),Te});function bo(){for(var Te=0;Te<ms;++Te){var Ut=mo[Te];Ut&&(Ut.bindCount=0,Ut.unit=-1,mo[Te]=null)}ne(Bo).forEach(function(At){At.texture=B.createTexture(),B.bindTexture(At.target,At.texture);for(var mn=0;mn<32;++mn)if((At.mipmask&1<<mn)!=0)if(At.target===is)B.texImage2D(is,mn,At.internalformat,At.width>>mn,At.height>>mn,0,At.internalformat,At.type,null);else for(var Vi=0;Vi<6;++Vi)B.texImage2D(zu+Vi,mn,At.internalformat,At.width>>mn,At.height>>mn,0,At.internalformat,At.type,null);wo(At.texInfo,At.target)})}function wl(){for(var Te=0;Te<ms;++Te){var Ut=mo[Te];Ut&&(Ut.bindCount=0,Ut.unit=-1,mo[Te]=null),B.activeTexture(hc+Te),B.bindTexture(is,null),B.bindTexture(Fc,null)}}return{create2D:ri,createCube:zi,clear:_a,getTexture:function(Te){return null},restore:bo,refresh:wl}}var Gs=36161,Fn=32854,Tn=32855,Xc=36194,ps=33189,Ro=36168,os=34041,Gu=35907,gf=34836,yf=34842,ra=34843,Oa=[];Oa[Fn]=2,Oa[Tn]=2,Oa[Xc]=2,Oa[ps]=2,Oa[Ro]=1,Oa[os]=4,Oa[Gu]=4,Oa[gf]=16,Oa[yf]=8,Oa[ra]=6;function Gf(B,ge,Be){return Oa[B]*ge*Be}var yl=function(B,ge,Be,kt,ur){var Dt={rgba4:Fn,rgb565:Xc,"rgb5 a1":Tn,depth:ps,stencil:Ro,"depth stencil":os};ge.ext_srgb&&(Dt.srgba=Gu),ge.ext_color_buffer_half_float&&(Dt.rgba16f=yf,Dt.rgb16f=ra),ge.webgl_color_buffer_float&&(Dt.rgba32f=gf);var er=[];Object.keys(Dt).forEach(function(_r){var Tr=Dt[_r];er[Tr]=_r});var hr=0,gr={};function xr(_r){this.id=hr++,this.refCount=1,this.renderbuffer=_r,this.format=Fn,this.width=0,this.height=0,ur.profile&&(this.stats={size:0})}xr.prototype.decRef=function(){--this.refCount<=0&&wr(this)};function wr(_r){var Tr=_r.renderbuffer;me(Tr,"must not double destroy renderbuffer"),B.bindRenderbuffer(Gs,null),B.deleteRenderbuffer(Tr),_r.renderbuffer=null,_r.refCount=0,delete gr[_r.id],kt.renderbufferCount--}function Ir(_r,Tr){var st=new xr(B.createRenderbuffer());gr[st.id]=st,kt.renderbufferCount++;function jt(fr,ar){var Lr=0,$r=0,zn=Fn;if(typeof fr=="object"&&fr){var tr=fr;if("shape"in tr){var ir=tr.shape;me(Array.isArray(ir)&&ir.length>=2,"invalid renderbuffer shape"),Lr=ir[0]|0,$r=ir[1]|0}else"radius"in tr&&(Lr=$r=tr.radius|0),"width"in tr&&(Lr=tr.width|0),"height"in tr&&($r=tr.height|0);"format"in tr&&(me.parameter(tr.format,Dt,"invalid renderbuffer format"),zn=Dt[tr.format])}else typeof fr=="number"?(Lr=fr|0,typeof ar=="number"?$r=ar|0:$r=Lr):fr?me.raise("invalid arguments to renderbuffer constructor"):Lr=$r=1;if(me(Lr>0&&$r>0&&Lr<=Be.maxRenderbufferSize&&$r<=Be.maxRenderbufferSize,"invalid renderbuffer size"),!(Lr===st.width&&$r===st.height&&zn===st.format))return jt.width=st.width=Lr,jt.height=st.height=$r,st.format=zn,B.bindRenderbuffer(Gs,st.renderbuffer),B.renderbufferStorage(Gs,zn,Lr,$r),me(B.getError()===0,"invalid render buffer format"),ur.profile&&(st.stats.size=Gf(st.format,st.width,st.height)),jt.format=er[st.format],jt}function br(fr,ar){var Lr=fr|0,$r=ar|0||Lr;return Lr===st.width&&$r===st.height||(me(Lr>0&&$r>0&&Lr<=Be.maxRenderbufferSize&&$r<=Be.maxRenderbufferSize,"invalid renderbuffer size"),jt.width=st.width=Lr,jt.height=st.height=$r,B.bindRenderbuffer(Gs,st.renderbuffer),B.renderbufferStorage(Gs,st.format,Lr,$r),me(B.getError()===0,"invalid render buffer format"),ur.profile&&(st.stats.size=Gf(st.format,st.width,st.height))),jt}return jt(_r,Tr),jt.resize=br,jt._reglType="renderbuffer",jt._renderbuffer=st,ur.profile&&(jt.stats=st.stats),jt.destroy=function(){st.decRef()},jt}ur.profile&&(kt.getTotalRenderbufferSize=function(){var _r=0;return Object.keys(gr).forEach(function(Tr){_r+=gr[Tr].stats.size}),_r});function Gr(){ne(gr).forEach(function(_r){_r.renderbuffer=B.createRenderbuffer(),B.bindRenderbuffer(Gs,_r.renderbuffer),B.renderbufferStorage(Gs,_r.format,_r.width,_r.height)}),B.bindRenderbuffer(Gs,null)}return{create:Ir,clear:function(){ne(gr).forEach(wr)},restore:Gr}},hu=36160,Su=36161,Lo=3553,_l=34069,Cu=36064,_f=36096,Zl=36128,Au=33306,Hf=36053,xl=36054,bl=36055,Ea=36057,Js=36061,pu=36193,jl=5121,wu=5126,ws=6407,Yc=6408,Na=6402,ol=[ws,Yc],Hu=[];Hu[Yc]=4,Hu[ws]=3;var l=[];l[jl]=1,l[wu]=4,l[pu]=2;var h=32854,c=32855,d=36194,E=33189,w=36168,M=34041,L=35907,U=34836,Y=34842,le=34843,pe=[h,c,d,L,Y,le,U],ve={};ve[Hf]="complete",ve[xl]="incomplete attachment",ve[Ea]="incomplete dimensions",ve[bl]="incomplete, missing attachment",ve[Js]="unsupported";function Re(B,ge,Be,kt,ur,Dt){var er={cur:null,next:null,dirty:!1,setFBO:null},hr=["rgba"],gr=["rgba4","rgb565","rgb5 a1"];ge.ext_srgb&&gr.push("srgba"),ge.ext_color_buffer_half_float&&gr.push("rgba16f","rgb16f"),ge.webgl_color_buffer_float&&gr.push("rgba32f");var xr=["uint8"];ge.oes_texture_half_float&&xr.push("half float","float16"),ge.oes_texture_float&&xr.push("float","float32");function wr(Sr,qr,Nr){this.target=Sr,this.texture=qr,this.renderbuffer=Nr;var ci=0,ei=0;qr?(ci=qr.width,ei=qr.height):Nr&&(ci=Nr.width,ei=Nr.height),this.width=ci,this.height=ei}function Ir(Sr){Sr&&(Sr.texture&&Sr.texture._texture.decRef(),Sr.renderbuffer&&Sr.renderbuffer._renderbuffer.decRef())}function Gr(Sr,qr,Nr){if(!!Sr)if(Sr.texture){var ci=Sr.texture._texture,ei=Math.max(1,ci.width),Wr=Math.max(1,ci.height);me(ei===qr&&Wr===Nr,"inconsistent width/height for supplied texture"),ci.refCount+=1}else{var Qr=Sr.renderbuffer._renderbuffer;me(Qr.width===qr&&Qr.height===Nr,"inconsistent width/height for renderbuffer"),Qr.refCount+=1}}function _r(Sr,qr){qr&&(qr.texture?B.framebufferTexture2D(hu,Sr,qr.target,qr.texture._texture.texture,0):B.framebufferRenderbuffer(hu,Sr,Su,qr.renderbuffer._renderbuffer.renderbuffer))}function Tr(Sr){var qr=Lo,Nr=null,ci=null,ei=Sr;typeof Sr=="object"&&(ei=Sr.data,"target"in Sr&&(qr=Sr.target|0)),me.type(ei,"function","invalid attachment data");var Wr=ei._reglType;return Wr==="texture2d"?(Nr=ei,me(qr===Lo)):Wr==="textureCube"?(Nr=ei,me(qr>=_l&&qr<_l+6,"invalid cube map target")):Wr==="renderbuffer"?(ci=ei,qr=Su):me.raise("invalid regl object for attachment"),new wr(qr,Nr,ci)}function st(Sr,qr,Nr,ci,ei){if(Nr){var Wr=kt.create2D({width:Sr,height:qr,format:ci,type:ei});return Wr._texture.refCount=0,new wr(Lo,Wr,null)}else{var Qr=ur.create({width:Sr,height:qr,format:ci});return Qr._renderbuffer.refCount=0,new wr(Su,null,Qr)}}function jt(Sr){return Sr&&(Sr.texture||Sr.renderbuffer)}function br(Sr,qr,Nr){Sr&&(Sr.texture?Sr.texture.resize(qr,Nr):Sr.renderbuffer&&Sr.renderbuffer.resize(qr,Nr),Sr.width=qr,Sr.height=Nr)}var fr=0,ar={};function Lr(){this.id=fr++,ar[this.id]=this,this.framebuffer=B.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function $r(Sr){Sr.colorAttachments.forEach(Ir),Ir(Sr.depthAttachment),Ir(Sr.stencilAttachment),Ir(Sr.depthStencilAttachment)}function zn(Sr){var qr=Sr.framebuffer;me(qr,"must not double destroy framebuffer"),B.deleteFramebuffer(qr),Sr.framebuffer=null,Dt.framebufferCount--,delete ar[Sr.id]}function tr(Sr){var qr;B.bindFramebuffer(hu,Sr.framebuffer);var Nr=Sr.colorAttachments;for(qr=0;qr<Nr.length;++qr)_r(Cu+qr,Nr[qr]);for(qr=Nr.length;qr<Be.maxColorAttachments;++qr)B.framebufferTexture2D(hu,Cu+qr,Lo,null,0);B.framebufferTexture2D(hu,Au,Lo,null,0),B.framebufferTexture2D(hu,_f,Lo,null,0),B.framebufferTexture2D(hu,Zl,Lo,null,0),_r(_f,Sr.depthAttachment),_r(Zl,Sr.stencilAttachment),_r(Au,Sr.depthStencilAttachment);var ci=B.checkFramebufferStatus(hu);!B.isContextLost()&&ci!==Hf&&me.raise("framebuffer configuration not supported, status = "+ve[ci]),B.bindFramebuffer(hu,er.next?er.next.framebuffer:null),er.cur=er.next,B.getError()}function ir(Sr,qr){var Nr=new Lr;Dt.framebufferCount++;function ci(Wr,Qr){var $n;me(er.next!==Nr,"can not update framebuffer which is currently in use");var ui=0,Bi=0,uo=!0,vo=!0,Ni=null,ss=!0,Ka="rgba",Ho="uint8",wo=1,Qo=null,Bo=null,ms=null,mo=!1;if(typeof Wr=="number")ui=Wr|0,Bi=Qr|0||ui;else if(!Wr)ui=Bi=1;else{me.type(Wr,"object","invalid arguments for framebuffer");var xi=Wr;if("shape"in xi){var Wo=xi.shape;me(Array.isArray(Wo)&&Wo.length>=2,"invalid shape for framebuffer"),ui=Wo[0],Bi=Wo[1]}else"radius"in xi&&(ui=Bi=xi.radius),"width"in xi&&(ui=xi.width),"height"in xi&&(Bi=xi.height);("color"in xi||"colors"in xi)&&(Ni=xi.color||xi.colors,Array.isArray(Ni)&&me(Ni.length===1||ge.webgl_draw_buffers,"multiple render targets not supported")),Ni||("colorCount"in xi&&(wo=xi.colorCount|0,me(wo>0,"invalid color buffer count")),"colorTexture"in xi&&(ss=!!xi.colorTexture,Ka="rgba4"),"colorType"in xi&&(Ho=xi.colorType,ss?(me(ge.oes_texture_float||!(Ho==="float"||Ho==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),me(ge.oes_texture_half_float||!(Ho==="half float"||Ho==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ho==="half float"||Ho==="float16"?(me(ge.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ka="rgba16f"):(Ho==="float"||Ho==="float32")&&(me(ge.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ka="rgba32f"),me.oneOf(Ho,xr,"invalid color type")),"colorFormat"in xi&&(Ka=xi.colorFormat,hr.indexOf(Ka)>=0?ss=!0:gr.indexOf(Ka)>=0?ss=!1:me.optional(function(){ss?me.oneOf(xi.colorFormat,hr,"invalid color format for texture"):me.oneOf(xi.colorFormat,gr,"invalid color format for renderbuffer")}))),("depthTexture"in xi||"depthStencilTexture"in xi)&&(mo=!!(xi.depthTexture||xi.depthStencilTexture),me(!mo||ge.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in xi&&(typeof xi.depth=="boolean"?uo=xi.depth:(Qo=xi.depth,vo=!1)),"stencil"in xi&&(typeof xi.stencil=="boolean"?vo=xi.stencil:(Bo=xi.stencil,uo=!1)),"depthStencil"in xi&&(typeof xi.depthStencil=="boolean"?uo=vo=xi.depthStencil:(ms=xi.depthStencil,uo=!1,vo=!1))}var na=null,Jo=null,ri=null,zi=null;if(Array.isArray(Ni))na=Ni.map(Tr);else if(Ni)na=[Tr(Ni)];else for(na=new Array(wo),$n=0;$n<wo;++$n)na[$n]=st(ui,Bi,ss,Ka,Ho);me(ge.webgl_draw_buffers||na.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),me(na.length<=Be.maxColorAttachments,"too many color attachments, not supported"),ui=ui||na[0].width,Bi=Bi||na[0].height,Qo?Jo=Tr(Qo):uo&&!vo&&(Jo=st(ui,Bi,mo,"depth","uint32")),Bo?ri=Tr(Bo):vo&&!uo&&(ri=st(ui,Bi,!1,"stencil","uint8")),ms?zi=Tr(ms):!Qo&&!Bo&&vo&&uo&&(zi=st(ui,Bi,mo,"depth stencil","depth stencil")),me(!!Qo+!!Bo+!!ms<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var _a=null;for($n=0;$n<na.length;++$n)if(Gr(na[$n],ui,Bi),me(!na[$n]||na[$n].texture&&ol.indexOf(na[$n].texture._texture.format)>=0||na[$n].renderbuffer&&pe.indexOf(na[$n].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+$n+" is invalid"),na[$n]&&na[$n].texture){var bo=Hu[na[$n].texture._texture.format]*l[na[$n].texture._texture.type];_a===null?_a=bo:me(_a===bo,"all color attachments much have the same number of bits per pixel.")}return Gr(Jo,ui,Bi),me(!Jo||Jo.texture&&Jo.texture._texture.format===Na||Jo.renderbuffer&&Jo.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),Gr(ri,ui,Bi),me(!ri||ri.renderbuffer&&ri.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),Gr(zi,ui,Bi),me(!zi||zi.texture&&zi.texture._texture.format===M||zi.renderbuffer&&zi.renderbuffer._renderbuffer.format===M,"invalid depth-stencil attachment for framebuffer object"),$r(Nr),Nr.width=ui,Nr.height=Bi,Nr.colorAttachments=na,Nr.depthAttachment=Jo,Nr.stencilAttachment=ri,Nr.depthStencilAttachment=zi,ci.color=na.map(jt),ci.depth=jt(Jo),ci.stencil=jt(ri),ci.depthStencil=jt(zi),ci.width=Nr.width,ci.height=Nr.height,tr(Nr),ci}function ei(Wr,Qr){me(er.next!==Nr,"can not resize a framebuffer which is currently in use");var $n=Math.max(Wr|0,1),ui=Math.max(Qr|0||$n,1);if($n===Nr.width&&ui===Nr.height)return ci;for(var Bi=Nr.colorAttachments,uo=0;uo<Bi.length;++uo)br(Bi[uo],$n,ui);return br(Nr.depthAttachment,$n,ui),br(Nr.stencilAttachment,$n,ui),br(Nr.depthStencilAttachment,$n,ui),Nr.width=ci.width=$n,Nr.height=ci.height=ui,tr(Nr),ci}return ci(Sr,qr),m(ci,{resize:ei,_reglType:"framebuffer",_framebuffer:Nr,destroy:function(){zn(Nr),$r(Nr)},use:function(Wr){er.setFBO({framebuffer:ci},Wr)}})}function Sn(Sr){var qr=Array(6);function Nr(ei){var Wr;me(qr.indexOf(er.next)<0,"can not update framebuffer which is currently in use");var Qr={color:null},$n=0,ui=null,Bi="rgba",uo="uint8",vo=1;if(typeof ei=="number")$n=ei|0;else if(!ei)$n=1;else{me.type(ei,"object","invalid arguments for framebuffer");var Ni=ei;if("shape"in Ni){var ss=Ni.shape;me(Array.isArray(ss)&&ss.length>=2,"invalid shape for framebuffer"),me(ss[0]===ss[1],"cube framebuffer must be square"),$n=ss[0]}else"radius"in Ni&&($n=Ni.radius|0),"width"in Ni?($n=Ni.width|0,"height"in Ni&&me(Ni.height===$n,"must be square")):"height"in Ni&&($n=Ni.height|0);("color"in Ni||"colors"in Ni)&&(ui=Ni.color||Ni.colors,Array.isArray(ui)&&me(ui.length===1||ge.webgl_draw_buffers,"multiple render targets not supported")),ui||("colorCount"in Ni&&(vo=Ni.colorCount|0,me(vo>0,"invalid color buffer count")),"colorType"in Ni&&(me.oneOf(Ni.colorType,xr,"invalid color type"),uo=Ni.colorType),"colorFormat"in Ni&&(Bi=Ni.colorFormat,me.oneOf(Ni.colorFormat,hr,"invalid color format for texture"))),"depth"in Ni&&(Qr.depth=Ni.depth),"stencil"in Ni&&(Qr.stencil=Ni.stencil),"depthStencil"in Ni&&(Qr.depthStencil=Ni.depthStencil)}var Ka;if(ui)if(Array.isArray(ui))for(Ka=[],Wr=0;Wr<ui.length;++Wr)Ka[Wr]=ui[Wr];else Ka=[ui];else{Ka=Array(vo);var Ho={radius:$n,format:Bi,type:uo};for(Wr=0;Wr<vo;++Wr)Ka[Wr]=kt.createCube(Ho)}for(Qr.color=Array(Ka.length),Wr=0;Wr<Ka.length;++Wr){var wo=Ka[Wr];me(typeof wo=="function"&&wo._reglType==="textureCube","invalid cube map"),$n=$n||wo.width,me(wo.width===$n&&wo.height===$n,"invalid cube map shape"),Qr.color[Wr]={target:_l,data:Ka[Wr]}}for(Wr=0;Wr<6;++Wr){for(var Qo=0;Qo<Ka.length;++Qo)Qr.color[Qo].target=_l+Wr;Wr>0&&(Qr.depth=qr[0].depth,Qr.stencil=qr[0].stencil,Qr.depthStencil=qr[0].depthStencil),qr[Wr]?qr[Wr](Qr):qr[Wr]=ir(Qr)}return m(Nr,{width:$n,height:$n,color:Ka})}function ci(ei){var Wr,Qr=ei|0;if(me(Qr>0&&Qr<=Be.maxCubeMapSize,"invalid radius for cube fbo"),Qr===Nr.width)return Nr;var $n=Nr.color;for(Wr=0;Wr<$n.length;++Wr)$n[Wr].resize(Qr);for(Wr=0;Wr<6;++Wr)qr[Wr].resize(Qr);return Nr.width=Nr.height=Qr,Nr}return Nr(Sr),m(Nr,{faces:qr,resize:ci,_reglType:"framebufferCube",destroy:function(){qr.forEach(function(ei){ei.destroy()})}})}function Vr(){er.cur=null,er.next=null,er.dirty=!0,ne(ar).forEach(function(Sr){Sr.framebuffer=B.createFramebuffer(),tr(Sr)})}return m(er,{getFramebuffer:function(Sr){if(typeof Sr=="function"&&Sr._reglType==="framebuffer"){var qr=Sr._framebuffer;if(qr instanceof Lr)return qr}return null},create:ir,createCube:Sn,clear:function(){ne(ar).forEach(zn)},restore:Vr})}var Ie=5126,je=34962,we=34963,Ge=["attributes","elements","offset","count","primitive","instances"];function tt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ie,this.offset=0,this.stride=0,this.divisor=0}function xt(B,ge,Be,kt,ur,Dt,er){for(var hr=Be.maxAttributes,gr=new Array(hr),xr=0;xr<hr;++xr)gr[xr]=new tt;var wr=0,Ir={},Gr={Record:tt,scope:{},state:gr,currentVAO:null,targetVAO:null,restore:Tr()?$r:function(){},createVAO:zn,getVAO:jt,destroyBuffer:_r,setVAO:Tr()?br:fr,clear:Tr()?ar:function(){}};function _r(tr){for(var ir=0;ir<gr.length;++ir){var Sn=gr[ir];Sn.buffer===tr&&(B.disableVertexAttribArray(ir),Sn.buffer=null)}}function Tr(){return ge.oes_vertex_array_object}function st(){return ge.angle_instanced_arrays}function jt(tr){return typeof tr=="function"&&tr._vao?tr._vao:null}function br(tr){if(tr!==Gr.currentVAO){var ir=Tr();tr?ir.bindVertexArrayOES(tr.vao):ir.bindVertexArrayOES(null),Gr.currentVAO=tr}}function fr(tr){if(tr!==Gr.currentVAO){if(tr)tr.bindAttrs();else{for(var ir=st(),Sn=0;Sn<gr.length;++Sn){var Vr=gr[Sn];Vr.buffer?(B.enableVertexAttribArray(Sn),Vr.buffer.bind(),B.vertexAttribPointer(Sn,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offfset),ir&&Vr.divisor&&ir.vertexAttribDivisorANGLE(Sn,Vr.divisor)):(B.disableVertexAttribArray(Sn),B.vertexAttrib4f(Sn,Vr.x,Vr.y,Vr.z,Vr.w))}er.elements?B.bindBuffer(we,er.elements.buffer.buffer):B.bindBuffer(we,null)}Gr.currentVAO=tr}}function ar(){ne(Ir).forEach(function(tr){tr.destroy()})}function Lr(){this.id=++wr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var tr=Tr();tr?this.vao=tr.createVertexArrayOES():this.vao=null,Ir[this.id]=this,this.buffers=[]}Lr.prototype.bindAttrs=function(){for(var tr=st(),ir=this.attributes,Sn=0;Sn<ir.length;++Sn){var Vr=ir[Sn];Vr.buffer?(B.enableVertexAttribArray(Sn),B.bindBuffer(je,Vr.buffer.buffer),B.vertexAttribPointer(Sn,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offset),tr&&Vr.divisor&&tr.vertexAttribDivisorANGLE(Sn,Vr.divisor)):(B.disableVertexAttribArray(Sn),B.vertexAttrib4f(Sn,Vr.x,Vr.y,Vr.z,Vr.w))}for(var Sr=ir.length;Sr<hr;++Sr)B.disableVertexAttribArray(Sr);var qr=Dt.getElements(this.elements);qr?B.bindBuffer(we,qr.buffer.buffer):B.bindBuffer(we,null)},Lr.prototype.refresh=function(){var tr=Tr();tr&&(tr.bindVertexArrayOES(this.vao),this.bindAttrs(),Gr.currentVAO=null,tr.bindVertexArrayOES(null))},Lr.prototype.destroy=function(){if(this.vao){var tr=Tr();this===Gr.currentVAO&&(Gr.currentVAO=null,tr.bindVertexArrayOES(null)),tr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Ir[this.id]&&(delete Ir[this.id],kt.vaoCount-=1)};function $r(){var tr=Tr();tr&&ne(Ir).forEach(function(ir){ir.refresh()})}function zn(tr){var ir=new Lr;kt.vaoCount+=1;function Sn(Vr){var Sr;if(Array.isArray(Vr))Sr=Vr,ir.elements&&ir.ownsElements&&ir.elements.destroy(),ir.elements=null,ir.ownsElements=!1,ir.offset=0,ir.count=0,ir.instances=-1,ir.primitive=4;else{if(me(typeof Vr=="object","invalid arguments for create vao"),me("attributes"in Vr,"must specify attributes for vao"),Vr.elements){var qr=Vr.elements;ir.ownsElements?typeof qr=="function"&&qr._reglType==="elements"?(ir.elements.destroy(),ir.ownsElements=!1):(ir.elements(qr),ir.ownsElements=!1):Dt.getElements(Vr.elements)?(ir.elements=Vr.elements,ir.ownsElements=!1):(ir.elements=Dt.create(Vr.elements),ir.ownsElements=!0)}else ir.elements=null,ir.ownsElements=!1;Sr=Vr.attributes,ir.offset=0,ir.count=-1,ir.instances=-1,ir.primitive=4,ir.elements&&(ir.count=ir.elements._elements.vertCount,ir.primitive=ir.elements._elements.primType),"offset"in Vr&&(ir.offset=Vr.offset|0),"count"in Vr&&(ir.count=Vr.count|0),"instances"in Vr&&(ir.instances=Vr.instances|0),"primitive"in Vr&&(me(Vr.primitive in sr,"bad primitive type: "+Vr.primitive),ir.primitive=sr[Vr.primitive]),me.optional(function(){for(var uo=Object.keys(Vr),vo=0;vo<uo.length;++vo)me(Ge.indexOf(uo[vo])>=0,'invalid option for vao: "'+uo[vo]+'" valid options are '+Ge)}),me(Array.isArray(Sr),"attributes must be an array")}me(Sr.length<hr,"too many attributes"),me(Sr.length>0,"must specify at least one attribute");var Nr={},ci=ir.attributes;ci.length=Sr.length;for(var ei=0;ei<Sr.length;++ei){var Wr=Sr[ei],Qr=ci[ei]=new tt,$n=Wr.data||Wr;if(Array.isArray($n)||re($n)||_s($n)){var ui;ir.buffers[ei]&&(ui=ir.buffers[ei],re($n)&&ui._buffer.byteLength>=$n.byteLength?ui.subdata($n):(ui.destroy(),ir.buffers[ei]=null)),ir.buffers[ei]||(ui=ir.buffers[ei]=ur.create(Wr,je,!1,!0)),Qr.buffer=ur.getBuffer(ui),Qr.size=Qr.buffer.dimension|0,Qr.normalized=!1,Qr.type=Qr.buffer.dtype,Qr.offset=0,Qr.stride=0,Qr.divisor=0,Qr.state=1,Nr[ei]=1}else ur.getBuffer(Wr)?(Qr.buffer=ur.getBuffer(Wr),Qr.size=Qr.buffer.dimension|0,Qr.normalized=!1,Qr.type=Qr.buffer.dtype,Qr.offset=0,Qr.stride=0,Qr.divisor=0,Qr.state=1):ur.getBuffer(Wr.buffer)?(Qr.buffer=ur.getBuffer(Wr.buffer),Qr.size=(+Wr.size||Qr.buffer.dimension)|0,Qr.normalized=!!Wr.normalized||!1,"type"in Wr?(me.parameter(Wr.type,au,"invalid buffer type"),Qr.type=au[Wr.type]):Qr.type=Qr.buffer.dtype,Qr.offset=(Wr.offset||0)|0,Qr.stride=(Wr.stride||0)|0,Qr.divisor=(Wr.divisor||0)|0,Qr.state=1,me(Qr.size>=1&&Qr.size<=4,"size must be between 1 and 4"),me(Qr.offset>=0,"invalid offset"),me(Qr.stride>=0&&Qr.stride<=255,"stride must be between 0 and 255"),me(Qr.divisor>=0,"divisor must be positive"),me(!Qr.divisor||!!ge.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Wr?(me(ei>0,"first attribute must not be a constant"),Qr.x=+Wr.x||0,Qr.y=+Wr.y||0,Qr.z=+Wr.z||0,Qr.w=+Wr.w||0,Qr.state=2):me(!1,"invalid attribute spec for location "+ei)}for(var Bi=0;Bi<ir.buffers.length;++Bi)!Nr[Bi]&&ir.buffers[Bi]&&(ir.buffers[Bi].destroy(),ir.buffers[Bi]=null);return ir.refresh(),Sn}return Sn.destroy=function(){for(var Vr=0;Vr<ir.buffers.length;++Vr)ir.buffers[Vr]&&ir.buffers[Vr].destroy();ir.buffers.length=0,ir.ownsElements&&(ir.elements.destroy(),ir.elements=null,ir.ownsElements=!1),ir.destroy()},Sn._vao=ir,Sn._reglType="vao",Sn(tr)}return Gr}var Ht=35632,Zt=35633,Jt=35718,mr=35721;function Br(B,ge,Be,kt){var ur={},Dt={};function er(st,jt,br,fr){this.name=st,this.id=jt,this.location=br,this.info=fr}function hr(st,jt){for(var br=0;br<st.length;++br)if(st[br].id===jt.id){st[br].location=jt.location;return}st.push(jt)}function gr(st,jt,br){var fr=st===Ht?ur:Dt,ar=fr[jt];if(!ar){var Lr=ge.str(jt);ar=B.createShader(st),B.shaderSource(ar,Lr),B.compileShader(ar),me.shaderError(B,ar,Lr,st,br),fr[jt]=ar}return ar}var xr={},wr=[],Ir=0;function Gr(st,jt){this.id=Ir++,this.fragId=st,this.vertId=jt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,kt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function _r(st,jt,br){var fr,ar,Lr=gr(Ht,st.fragId),$r=gr(Zt,st.vertId),zn=st.program=B.createProgram();if(B.attachShader(zn,Lr),B.attachShader(zn,$r),br)for(fr=0;fr<br.length;++fr){var tr=br[fr];B.bindAttribLocation(zn,tr[0],tr[1])}B.linkProgram(zn),me.linkError(B,zn,ge.str(st.fragId),ge.str(st.vertId),jt);var ir=B.getProgramParameter(zn,Jt);kt.profile&&(st.stats.uniformsCount=ir);var Sn=st.uniforms;for(fr=0;fr<ir;++fr)if(ar=B.getActiveUniform(zn,fr),ar)if(ar.size>1)for(var Vr=0;Vr<ar.size;++Vr){var Sr=ar.name.replace("[0]","["+Vr+"]");hr(Sn,new er(Sr,ge.id(Sr),B.getUniformLocation(zn,Sr),ar))}else hr(Sn,new er(ar.name,ge.id(ar.name),B.getUniformLocation(zn,ar.name),ar));var qr=B.getProgramParameter(zn,mr);kt.profile&&(st.stats.attributesCount=qr);var Nr=st.attributes;for(fr=0;fr<qr;++fr)ar=B.getActiveAttrib(zn,fr),ar&&hr(Nr,new er(ar.name,ge.id(ar.name),B.getAttribLocation(zn,ar.name),ar))}kt.profile&&(Be.getMaxUniformsCount=function(){var st=0;return wr.forEach(function(jt){jt.stats.uniformsCount>st&&(st=jt.stats.uniformsCount)}),st},Be.getMaxAttributesCount=function(){var st=0;return wr.forEach(function(jt){jt.stats.attributesCount>st&&(st=jt.stats.attributesCount)}),st});function Tr(){ur={},Dt={};for(var st=0;st<wr.length;++st)_r(wr[st],null,wr[st].attributes.map(function(jt){return[jt.location,jt.name]}))}return{clear:function(){var st=B.deleteShader.bind(B);ne(ur).forEach(st),ur={},ne(Dt).forEach(st),Dt={},wr.forEach(function(jt){B.deleteProgram(jt.program)}),wr.length=0,xr={},Be.shaderCount=0},program:function(st,jt,br,fr){me.command(st>=0,"missing vertex shader",br),me.command(jt>=0,"missing fragment shader",br);var ar=xr[jt];ar||(ar=xr[jt]={});var Lr=ar[st];if(Lr&&(Lr.refCount++,!fr))return Lr;var $r=new Gr(jt,st);return Be.shaderCount++,_r($r,br,fr),Lr||(ar[st]=$r),wr.push($r),m($r,{destroy:function(){if($r.refCount--,$r.refCount<=0){B.deleteProgram($r.program);var zn=wr.indexOf($r);wr.splice(zn,1),Be.shaderCount--}ar[$r.vertId].refCount<=0&&(B.deleteShader(Dt[$r.vertId]),delete Dt[$r.vertId],delete xr[$r.fragId][$r.vertId]),Object.keys(xr[$r.fragId]).length||(B.deleteShader(ur[$r.fragId]),delete ur[$r.fragId],delete xr[$r.fragId])}})},restore:Tr,shader:gr,frag:-1,vert:-1}}var kr=6408,un=5121,Mn=3333,Nn=5126;function Rn(B,ge,Be,kt,ur,Dt,er){function hr(wr){var Ir;ge.next===null?(me(ur.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Ir=un):(me(ge.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Ir=ge.next.colorAttachments[0].texture._texture.type,me.optional(function(){Dt.oes_texture_float?(me(Ir===un||Ir===Nn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Ir===Nn&&me(er.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):me(Ir===un,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Gr=0,_r=0,Tr=kt.framebufferWidth,st=kt.framebufferHeight,jt=null;re(wr)?jt=wr:wr&&(me.type(wr,"object","invalid arguments to regl.read()"),Gr=wr.x|0,_r=wr.y|0,me(Gr>=0&&Gr<kt.framebufferWidth,"invalid x offset for regl.read"),me(_r>=0&&_r<kt.framebufferHeight,"invalid y offset for regl.read"),Tr=(wr.width||kt.framebufferWidth-Gr)|0,st=(wr.height||kt.framebufferHeight-_r)|0,jt=wr.data||null),jt&&(Ir===un?me(jt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Ir===Nn&&me(jt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),me(Tr>0&&Tr+Gr<=kt.framebufferWidth,"invalid width for read pixels"),me(st>0&&st+_r<=kt.framebufferHeight,"invalid height for read pixels"),Be();var br=Tr*st*4;return jt||(Ir===un?jt=new Uint8Array(br):Ir===Nn&&(jt=jt||new Float32Array(br))),me.isTypedArray(jt,"data buffer for regl.read() must be a typedarray"),me(jt.byteLength>=br,"data buffer for regl.read() too small"),B.pixelStorei(Mn,4),B.readPixels(Gr,_r,Tr,st,kr,Ir,jt),jt}function gr(wr){var Ir;return ge.setFBO({framebuffer:wr.framebuffer},function(){Ir=hr(wr)}),Ir}function xr(wr){return!wr||!("framebuffer"in wr)?hr(wr):gr(wr)}return xr}function Fi(B){return Array.prototype.slice.call(B)}function ln(B){return Fi(B).join("")}function oi(){var B=0,ge=[],Be=[];function kt(Ir){for(var Gr=0;Gr<Be.length;++Gr)if(Be[Gr]===Ir)return ge[Gr];var _r="g"+B++;return ge.push(_r),Be.push(Ir),_r}function ur(){var Ir=[];function Gr(){Ir.push.apply(Ir,Fi(arguments))}var _r=[];function Tr(){var st="v"+B++;return _r.push(st),arguments.length>0&&(Ir.push(st,"="),Ir.push.apply(Ir,Fi(arguments)),Ir.push(";")),st}return m(Gr,{def:Tr,toString:function(){return ln([_r.length>0?"var "+_r.join(",")+";":"",ln(Ir)])}})}function Dt(){var Ir=ur(),Gr=ur(),_r=Ir.toString,Tr=Gr.toString;function st(jt,br){Gr(jt,br,"=",Ir.def(jt,br),";")}return m(function(){Ir.apply(Ir,Fi(arguments))},{def:Ir.def,entry:Ir,exit:Gr,save:st,set:function(jt,br,fr){st(jt,br),Ir(jt,br,"=",fr,";")},toString:function(){return _r()+Tr()}})}function er(){var Ir=ln(arguments),Gr=Dt(),_r=Dt(),Tr=Gr.toString,st=_r.toString;return m(Gr,{then:function(){return Gr.apply(Gr,Fi(arguments)),this},else:function(){return _r.apply(_r,Fi(arguments)),this},toString:function(){var jt=st();return jt&&(jt="else{"+jt+"}"),ln(["if(",Ir,"){",Tr(),"}",jt])}})}var hr=ur(),gr={};function xr(Ir,Gr){var _r=[];function Tr(){var ar="a"+_r.length;return _r.push(ar),ar}Gr=Gr||0;for(var st=0;st<Gr;++st)Tr();var jt=Dt(),br=jt.toString,fr=gr[Ir]=m(jt,{arg:Tr,toString:function(){return ln(["function(",_r.join(),"){",br(),"}"])}});return fr}function wr(){var Ir=['"use strict";',hr,"return {"];Object.keys(gr).forEach(function(st){Ir.push('"',st,'":',gr[st].toString(),",")}),Ir.push("}");var Gr=ln(Ir).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),_r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Tr=_r?ie.Function.apply(null,ge.concat(Gr)):Function.apply(null,ge.concat(Gr));return Tr.apply(null,Be)}return{global:hr,link:kt,block:ur,proc:xr,scope:Dt,cond:er,compile:wr}}var si="xyzw".split(""),ni=5121,Xn=1,yi=2,Kn=0,Yn=1,Co=2,Ya=3,Ao=4,Go=5,no=6,po="dither",Ds="blend.enable",ds="blend.color",Wu="blend.equation",qa="blend.func",du="depth.enable",$o="depth.func",dc="depth.range",vu="depth.mask",mu="colorMask",Vl="cull.enable",vc="cull.face",gu="frontFace",Gl="lineWidth",Ra="polygonOffset.enable",qi="polygonOffset.offset",eu="sample.alpha",Xu="sample.enable",Hs="sample.coverage",ha="stencil.enable",tu="stencil.mask",Ts="stencil.func",El="stencil.opFront",mc="stencil.opBack",Fs="scissor.enable",Wf="scissor.box",yu="viewport",qc="profile",vs="framebuffer",Yu="vert",Sl="frag",_u="elements",ko="primitive",Cl="count",gc="offset",Xf="instances",xf="vao",Yf="Width",Th="Height",yc=vs+Yf,Kc=vs+Th,Tu=yu+Yf,ip=yu+Th,Hl="drawingBuffer",bf=Hl+Yf,Gp=Hl+Th,Ad=[qa,Wu,Ts,El,mc,Hs,yu,Wf,qi],Ef=34962,ap=34963,op=35632,wd=35633,sp=3553,Mh=34067,Hp=2884,$c=3042,Td=3024,Do=2960,Ph=2929,up=3089,Ih=32823,Oh=32926,qf=32928,Kf=5126,Wl=35664,_c=35665,Sf=35666,$f=5124,Rh=35667,xc=35668,Qf=35669,Jf=35670,eh=35671,bc=35672,Cf=35673,ru=35674,th=35675,rh=35676,nh=35678,ih=35680,Xl=4,Al=1028,Qc=1029,Wp=2304,Lh=2305,lp=32775,Xp=32776,Md=519,Mu=7680,cp=0,ah=1,Af=32774,sl=513,Yp=36160,Pd=36064,qu={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},oh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],zr={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ec={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Yt={frag:op,vert:wd},fp={cw:Wp,ccw:Lh};function kh(B){return Array.isArray(B)||re(B)||_s(B)}function Dh(B){return B.sort(function(ge,Be){return ge===yu?-1:Be===yu?1:ge<Be?-1:1})}function ya(B,ge,Be,kt){this.thisDep=B,this.contextDep=ge,this.propDep=Be,this.append=kt}function Yl(B){return B&&!(B.thisDep||B.contextDep||B.propDep)}function Fo(B){return new ya(!1,!1,!1,B)}function Ws(B,ge){var Be=B.type;if(Be===Kn){var kt=B.data.length;return new ya(!0,kt>=1,kt>=2,ge)}else if(Be===Ao){var ur=B.data;return new ya(ur.thisDep,ur.contextDep,ur.propDep,ge)}else{if(Be===Go)return new ya(!1,!1,!1,ge);if(Be===no){for(var Dt=!1,er=!1,hr=!1,gr=0;gr<B.data.length;++gr){var xr=B.data[gr];if(xr.type===Yn)hr=!0;else if(xr.type===Co)er=!0;else if(xr.type===Ya)Dt=!0;else if(xr.type===Kn){Dt=!0;var wr=xr.data;wr>=1&&(er=!0),wr>=2&&(hr=!0)}else xr.type===Ao&&(Dt=Dt||xr.data.thisDep,er=er||xr.data.contextDep,hr=hr||xr.data.propDep)}return new ya(Dt,er,hr,ge)}else return new ya(Be===Ya,Be===Co,Be===Yn,ge)}}var wf=new ya(!1,!1,!1,function(){});function qp(B,ge,Be,kt,ur,Dt,er,hr,gr,xr,wr,Ir,Gr,_r,Tr){var st=xr.Record,jt={add:32774,subtract:32778,"reverse subtract":32779};Be.ext_blend_minmax&&(jt.min=lp,jt.max=Xp);var br=Be.angle_instanced_arrays,fr=Be.webgl_draw_buffers,ar=Be.oes_vertex_array_object,Lr={dirty:!0,profile:Tr.profile},$r={},zn=[],tr={},ir={};function Sn(Se){return Se.replace(".","_")}function Vr(Se,oe,Ve){var ct=Sn(Se);zn.push(Se),$r[ct]=Lr[ct]=!!Ve,tr[ct]=oe}function Sr(Se,oe,Ve){var ct=Sn(Se);zn.push(Se),Array.isArray(Ve)?(Lr[ct]=Ve.slice(),$r[ct]=Ve.slice()):Lr[ct]=$r[ct]=Ve,ir[ct]=oe}Vr(po,Td),Vr(Ds,$c),Sr(ds,"blendColor",[0,0,0,0]),Sr(Wu,"blendEquationSeparate",[Af,Af]),Sr(qa,"blendFuncSeparate",[ah,cp,ah,cp]),Vr(du,Ph,!0),Sr($o,"depthFunc",sl),Sr(dc,"depthRange",[0,1]),Sr(vu,"depthMask",!0),Sr(mu,mu,[!0,!0,!0,!0]),Vr(Vl,Hp),Sr(vc,"cullFace",Qc),Sr(gu,gu,Lh),Sr(Gl,Gl,1),Vr(Ra,Ih),Sr(qi,"polygonOffset",[0,0]),Vr(eu,Oh),Vr(Xu,qf),Sr(Hs,"sampleCoverage",[1,!1]),Vr(ha,Do),Sr(tu,"stencilMask",-1),Sr(Ts,"stencilFunc",[Md,0,-1]),Sr(El,"stencilOpSeparate",[Al,Mu,Mu,Mu]),Sr(mc,"stencilOpSeparate",[Qc,Mu,Mu,Mu]),Vr(Fs,up),Sr(Wf,"scissor",[0,0,B.drawingBufferWidth,B.drawingBufferHeight]),Sr(yu,yu,[0,0,B.drawingBufferWidth,B.drawingBufferHeight]);var qr={gl:B,context:Gr,strings:ge,next:$r,current:Lr,draw:Ir,elements:Dt,buffer:ur,shader:wr,attributes:xr.state,vao:xr,uniforms:gr,framebuffer:hr,extensions:Be,timer:_r,isBufferArgs:kh},Nr={primTypes:sr,compareFuncs:zr,blendFuncs:qu,blendEquations:jt,stencilOps:Ec,glTypes:au,orientationType:fp};me.optional(function(){qr.isArrayLike=fo}),fr&&(Nr.backBuffer=[Qc],Nr.drawBuffer=He(kt.maxDrawbuffers,function(Se){return Se===0?[0]:He(Se,function(oe){return Pd+oe})}));var ci=0;function ei(){var Se=oi(),oe=Se.link,Ve=Se.global;Se.id=ci++,Se.batchId="0";var ct=oe(qr),Rt=Se.shared={props:"a0"};Object.keys(qr).forEach(function(ze){Rt[ze]=Ve.def(ct,".",ze)}),me.optional(function(){Se.CHECK=oe(me),Se.commandStr=me.guessCommand(),Se.command=oe(Se.commandStr),Se.assert=function(ze,Ae,lt){ze("if(!(",Ae,"))",this.CHECK,".commandRaise(",oe(lt),",",this.command,");")},Nr.invalidBlendCombinations=oh});var Ye=Se.next={},Fe=Se.current={};Object.keys(ir).forEach(function(ze){Array.isArray(Lr[ze])&&(Ye[ze]=Ve.def(Rt.next,".",ze),Fe[ze]=Ve.def(Rt.current,".",ze))});var nt=Se.constants={};Object.keys(Nr).forEach(function(ze){nt[ze]=Ve.def(JSON.stringify(Nr[ze]))}),Se.invoke=function(ze,Ae){switch(Ae.type){case Kn:var lt=["this",Rt.context,Rt.props,Se.batchId];return ze.def(oe(Ae.data),".call(",lt.slice(0,Math.max(Ae.data.length+1,4)),")");case Yn:return ze.def(Rt.props,Ae.data);case Co:return ze.def(Rt.context,Ae.data);case Ya:return ze.def("this",Ae.data);case Ao:return Ae.data.append(Se,ze),Ae.data.ref;case Go:return Ae.data.toString();case no:return Ae.data.map(function(St){return Se.invoke(ze,St)})}},Se.attribCache={};var _e={};return Se.scopeAttrib=function(ze){var Ae=ge.id(ze);if(Ae in _e)return _e[Ae];var lt=xr.scope[Ae];lt||(lt=xr.scope[Ae]=new st);var St=_e[Ae]=oe(lt);return St},Se}function Wr(Se){var oe=Se.static,Ve=Se.dynamic,ct;if(qc in oe){var Rt=!!oe[qc];ct=Fo(function(Fe,nt){return Rt}),ct.enable=Rt}else if(qc in Ve){var Ye=Ve[qc];ct=Ws(Ye,function(Fe,nt){return Fe.invoke(nt,Ye)})}return ct}function Qr(Se,oe){var Ve=Se.static,ct=Se.dynamic;if(vs in Ve){var Rt=Ve[vs];return Rt?(Rt=hr.getFramebuffer(Rt),me.command(Rt,"invalid framebuffer object"),Fo(function(Fe,nt){var _e=Fe.link(Rt),ze=Fe.shared;nt.set(ze.framebuffer,".next",_e);var Ae=ze.context;return nt.set(Ae,"."+yc,_e+".width"),nt.set(Ae,"."+Kc,_e+".height"),_e})):Fo(function(Fe,nt){var _e=Fe.shared;nt.set(_e.framebuffer,".next","null");var ze=_e.context;return nt.set(ze,"."+yc,ze+"."+bf),nt.set(ze,"."+Kc,ze+"."+Gp),"null"})}else if(vs in ct){var Ye=ct[vs];return Ws(Ye,function(Fe,nt){var _e=Fe.invoke(nt,Ye),ze=Fe.shared,Ae=ze.framebuffer,lt=nt.def(Ae,".getFramebuffer(",_e,")");me.optional(function(){Fe.assert(nt,"!"+_e+"||"+lt,"invalid framebuffer object")}),nt.set(Ae,".next",lt);var St=ze.context;return nt.set(St,"."+yc,lt+"?"+lt+".width:"+St+"."+bf),nt.set(St,"."+Kc,lt+"?"+lt+".height:"+St+"."+Gp),lt})}else return null}function $n(Se,oe,Ve){var ct=Se.static,Rt=Se.dynamic;function Ye(_e){if(_e in ct){var ze=ct[_e];me.commandType(ze,"object","invalid "+_e,Ve.commandStr);var Ae=!0,lt=ze.x|0,St=ze.y|0,pr,jr;return"width"in ze?(pr=ze.width|0,me.command(pr>=0,"invalid "+_e,Ve.commandStr)):Ae=!1,"height"in ze?(jr=ze.height|0,me.command(jr>=0,"invalid "+_e,Ve.commandStr)):Ae=!1,new ya(!Ae&&oe&&oe.thisDep,!Ae&&oe&&oe.contextDep,!Ae&&oe&&oe.propDep,function(Dr,Cn){var fn=Dr.shared.context,bn=pr;"width"in ze||(bn=Cn.def(fn,".",yc,"-",lt));var _n=jr;return"height"in ze||(_n=Cn.def(fn,".",Kc,"-",St)),[lt,St,bn,_n]})}else if(_e in Rt){var Ur=Rt[_e],on=Ws(Ur,function(Dr,Cn){var fn=Dr.invoke(Cn,Ur);me.optional(function(){Dr.assert(Cn,fn+"&&typeof "+fn+'==="object"',"invalid "+_e)});var bn=Dr.shared.context,_n=Cn.def(fn,".x|0"),gn=Cn.def(fn,".y|0"),ti=Cn.def('"width" in ',fn,"?",fn,".width|0:","(",bn,".",yc,"-",_n,")"),Sa=Cn.def('"height" in ',fn,"?",fn,".height|0:","(",bn,".",Kc,"-",gn,")");return me.optional(function(){Dr.assert(Cn,ti+">=0&&"+Sa+">=0","invalid "+_e)}),[_n,gn,ti,Sa]});return oe&&(on.thisDep=on.thisDep||oe.thisDep,on.contextDep=on.contextDep||oe.contextDep,on.propDep=on.propDep||oe.propDep),on}else return oe?new ya(oe.thisDep,oe.contextDep,oe.propDep,function(Dr,Cn){var fn=Dr.shared.context;return[0,0,Cn.def(fn,".",yc),Cn.def(fn,".",Kc)]}):null}var Fe=Ye(yu);if(Fe){var nt=Fe;Fe=new ya(Fe.thisDep,Fe.contextDep,Fe.propDep,function(_e,ze){var Ae=nt.append(_e,ze),lt=_e.shared.context;return ze.set(lt,"."+Tu,Ae[2]),ze.set(lt,"."+ip,Ae[3]),Ae})}return{viewport:Fe,scissor_box:Ye(Wf)}}function ui(Se,oe){var Ve=Se.static,ct=typeof Ve[Sl]=="string"&&typeof Ve[Yu]=="string";if(ct){if(Object.keys(oe.dynamic).length>0)return null;var Rt=oe.static,Ye=Object.keys(Rt);if(Ye.length>0&&typeof Rt[Ye[0]]=="number"){for(var Fe=[],nt=0;nt<Ye.length;++nt)me(typeof Rt[Ye[nt]]=="number","must specify all vertex attribute locations when using vaos"),Fe.push([Rt[Ye[nt]]|0,Ye[nt]]);return Fe}}return null}function Bi(Se,oe,Ve){var ct=Se.static,Rt=Se.dynamic;function Ye(Ae){if(Ae in ct){var lt=ge.id(ct[Ae]);me.optional(function(){wr.shader(Yt[Ae],lt,me.guessCommand())});var St=Fo(function(){return lt});return St.id=lt,St}else if(Ae in Rt){var pr=Rt[Ae];return Ws(pr,function(jr,Ur){var on=jr.invoke(Ur,pr),Dr=Ur.def(jr.shared.strings,".id(",on,")");return me.optional(function(){Ur(jr.shared.shader,".shader(",Yt[Ae],",",Dr,",",jr.command,");")}),Dr})}return null}var Fe=Ye(Sl),nt=Ye(Yu),_e=null,ze;return Yl(Fe)&&Yl(nt)?(_e=wr.program(nt.id,Fe.id,null,Ve),ze=Fo(function(Ae,lt){return Ae.link(_e)})):ze=new ya(Fe&&Fe.thisDep||nt&&nt.thisDep,Fe&&Fe.contextDep||nt&&nt.contextDep,Fe&&Fe.propDep||nt&&nt.propDep,function(Ae,lt){var St=Ae.shared.shader,pr;Fe?pr=Fe.append(Ae,lt):pr=lt.def(St,".",Sl);var jr;nt?jr=nt.append(Ae,lt):jr=lt.def(St,".",Yu);var Ur=St+".program("+jr+","+pr;return me.optional(function(){Ur+=","+Ae.command}),lt.def(Ur+")")}),{frag:Fe,vert:nt,progVar:ze,program:_e}}function uo(Se,oe){var Ve=Se.static,ct=Se.dynamic,Rt={},Ye=!1;function Fe(){if(xf in Ve){var Cn=Ve[xf];return Cn!==null&&xr.getVAO(Cn)===null&&(Cn=xr.createVAO(Cn)),Ye=!0,Rt.vao=Cn,Fo(function(bn){var _n=xr.getVAO(Cn);return _n?bn.link(_n):"null"})}else if(xf in ct){Ye=!0;var fn=ct[xf];return Ws(fn,function(bn,_n){var gn=bn.invoke(_n,fn);return _n.def(bn.shared.vao+".getVAO("+gn+")")})}return null}var nt=Fe(),_e=!1;function ze(){if(_u in Ve){var Cn=Ve[_u];if(Rt.elements=Cn,kh(Cn)){var fn=Rt.elements=Dt.create(Cn,!0);Cn=Dt.getElements(fn),_e=!0}else Cn&&(Cn=Dt.getElements(Cn),_e=!0,me.command(Cn,"invalid elements",oe.commandStr));var bn=Fo(function(gn,ti){if(Cn){var Sa=gn.link(Cn);return gn.ELEMENTS=Sa,Sa}return gn.ELEMENTS=null,null});return bn.value=Cn,bn}else if(_u in ct){_e=!0;var _n=ct[_u];return Ws(_n,function(gn,ti){var Sa=gn.shared,us=Sa.isBufferArgs,za=Sa.elements,pa=gn.invoke(ti,_n),ul=ti.def("null"),Ms=ti.def(us,"(",pa,")"),Pu=gn.cond(Ms).then(ul,"=",za,".createStream(",pa,");").else(ul,"=",za,".getElements(",pa,");");return me.optional(function(){gn.assert(Pu.else,"!"+pa+"||"+ul,"invalid elements")}),ti.entry(Pu),ti.exit(gn.cond(Ms).then(za,".destroyStream(",ul,");")),gn.ELEMENTS=ul,ul})}else if(Ye)return new ya(nt.thisDep,nt.contextDep,nt.propDep,function(gn,ti){return ti.def(gn.shared.vao+".currentVAO?"+gn.shared.elements+".getElements("+gn.shared.vao+".currentVAO.elements):null")});return null}var Ae=ze();function lt(){if(ko in Ve){var Cn=Ve[ko];return Rt.primitive=Cn,me.commandParameter(Cn,sr,"invalid primitve",oe.commandStr),Fo(function(bn,_n){return sr[Cn]})}else if(ko in ct){var fn=ct[ko];return Ws(fn,function(bn,_n){var gn=bn.constants.primTypes,ti=bn.invoke(_n,fn);return me.optional(function(){bn.assert(_n,ti+" in "+gn,"invalid primitive, must be one of "+Object.keys(sr))}),_n.def(gn,"[",ti,"]")})}else{if(_e)return Yl(Ae)?Ae.value?Fo(function(bn,_n){return _n.def(bn.ELEMENTS,".primType")}):Fo(function(){return Xl}):new ya(Ae.thisDep,Ae.contextDep,Ae.propDep,function(bn,_n){var gn=bn.ELEMENTS;return _n.def(gn,"?",gn,".primType:",Xl)});if(Ye)return new ya(nt.thisDep,nt.contextDep,nt.propDep,function(bn,_n){return _n.def(bn.shared.vao+".currentVAO?"+bn.shared.vao+".currentVAO.primitive:"+Xl)})}return null}function St(Cn,fn){if(Cn in Ve){var bn=Ve[Cn]|0;return fn?Rt.offset=bn:Rt.instances=bn,me.command(!fn||bn>=0,"invalid "+Cn,oe.commandStr),Fo(function(gn,ti){return fn&&(gn.OFFSET=bn),bn})}else if(Cn in ct){var _n=ct[Cn];return Ws(_n,function(gn,ti){var Sa=gn.invoke(ti,_n);return fn&&(gn.OFFSET=Sa,me.optional(function(){gn.assert(ti,Sa+">=0","invalid "+Cn)})),Sa})}else if(fn){if(_e)return Fo(function(gn,ti){return gn.OFFSET=0,0});if(Ye)return new ya(nt.thisDep,nt.contextDep,nt.propDep,function(gn,ti){return ti.def(gn.shared.vao+".currentVAO?"+gn.shared.vao+".currentVAO.offset:0")})}else if(Ye)return new ya(nt.thisDep,nt.contextDep,nt.propDep,function(gn,ti){return ti.def(gn.shared.vao+".currentVAO?"+gn.shared.vao+".currentVAO.instances:-1")});return null}var pr=St(gc,!0);function jr(){if(Cl in Ve){var Cn=Ve[Cl]|0;return Rt.count=Cn,me.command(typeof Cn=="number"&&Cn>=0,"invalid vertex count",oe.commandStr),Fo(function(){return Cn})}else if(Cl in ct){var fn=ct[Cl];return Ws(fn,function(ti,Sa){var us=ti.invoke(Sa,fn);return me.optional(function(){ti.assert(Sa,"typeof "+us+'==="number"&&'+us+">=0&&"+us+"===("+us+"|0)","invalid vertex count")}),us})}else if(_e)if(Yl(Ae)){if(Ae)return pr?new ya(pr.thisDep,pr.contextDep,pr.propDep,function(ti,Sa){var us=Sa.def(ti.ELEMENTS,".vertCount-",ti.OFFSET);return me.optional(function(){ti.assert(Sa,us+">=0","invalid vertex offset/element buffer too small")}),us}):Fo(function(ti,Sa){return Sa.def(ti.ELEMENTS,".vertCount")});var bn=Fo(function(){return-1});return me.optional(function(){bn.MISSING=!0}),bn}else{var _n=new ya(Ae.thisDep||pr.thisDep,Ae.contextDep||pr.contextDep,Ae.propDep||pr.propDep,function(ti,Sa){var us=ti.ELEMENTS;return ti.OFFSET?Sa.def(us,"?",us,".vertCount-",ti.OFFSET,":-1"):Sa.def(us,"?",us,".vertCount:-1")});return me.optional(function(){_n.DYNAMIC=!0}),_n}else if(Ye){var gn=new ya(nt.thisDep,nt.contextDep,nt.propDep,function(ti,Sa){return Sa.def(ti.shared.vao,".currentVAO?",ti.shared.vao,".currentVAO.count:-1")});return gn}return null}var Ur=lt(),on=jr(),Dr=St(Xf,!1);return{elements:Ae,primitive:Ur,count:on,instances:Dr,offset:pr,vao:nt,vaoActive:Ye,elementsActive:_e,static:Rt}}function vo(Se,oe){var Ve=Se.static,ct=Se.dynamic,Rt={};return zn.forEach(function(Ye){var Fe=Sn(Ye);function nt(_e,ze){if(Ye in Ve){var Ae=_e(Ve[Ye]);Rt[Fe]=Fo(function(){return Ae})}else if(Ye in ct){var lt=ct[Ye];Rt[Fe]=Ws(lt,function(St,pr){return ze(St,pr,St.invoke(pr,lt))})}}switch(Ye){case Vl:case Ds:case po:case ha:case du:case Fs:case Ra:case eu:case Xu:case vu:return nt(function(_e){return me.commandType(_e,"boolean",Ye,oe.commandStr),_e},function(_e,ze,Ae){return me.optional(function(){_e.assert(ze,"typeof "+Ae+'==="boolean"',"invalid flag "+Ye,_e.commandStr)}),Ae});case $o:return nt(function(_e){return me.commandParameter(_e,zr,"invalid "+Ye,oe.commandStr),zr[_e]},function(_e,ze,Ae){var lt=_e.constants.compareFuncs;return me.optional(function(){_e.assert(ze,Ae+" in "+lt,"invalid "+Ye+", must be one of "+Object.keys(zr))}),ze.def(lt,"[",Ae,"]")});case dc:return nt(function(_e){return me.command(fo(_e)&&_e.length===2&&typeof _e[0]=="number"&&typeof _e[1]=="number"&&_e[0]<=_e[1],"depth range is 2d array",oe.commandStr),_e},function(_e,ze,Ae){me.optional(function(){_e.assert(ze,_e.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===2&&typeof "+Ae+'[0]==="number"&&typeof '+Ae+'[1]==="number"&&'+Ae+"[0]<="+Ae+"[1]","depth range must be a 2d array")});var lt=ze.def("+",Ae,"[0]"),St=ze.def("+",Ae,"[1]");return[lt,St]});case qa:return nt(function(_e){me.commandType(_e,"object","blend.func",oe.commandStr);var ze="srcRGB"in _e?_e.srcRGB:_e.src,Ae="srcAlpha"in _e?_e.srcAlpha:_e.src,lt="dstRGB"in _e?_e.dstRGB:_e.dst,St="dstAlpha"in _e?_e.dstAlpha:_e.dst;return me.commandParameter(ze,qu,Fe+".srcRGB",oe.commandStr),me.commandParameter(Ae,qu,Fe+".srcAlpha",oe.commandStr),me.commandParameter(lt,qu,Fe+".dstRGB",oe.commandStr),me.commandParameter(St,qu,Fe+".dstAlpha",oe.commandStr),me.command(oh.indexOf(ze+", "+lt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+ze+", "+lt+")",oe.commandStr),[qu[ze],qu[lt],qu[Ae],qu[St]]},function(_e,ze,Ae){var lt=_e.constants.blendFuncs;me.optional(function(){_e.assert(ze,Ae+"&&typeof "+Ae+'==="object"',"invalid blend func, must be an object")});function St(fn,bn){var _n=ze.def('"',fn,bn,'" in ',Ae,"?",Ae,".",fn,bn,":",Ae,".",fn);return me.optional(function(){_e.assert(ze,_n+" in "+lt,"invalid "+Ye+"."+fn+bn+", must be one of "+Object.keys(qu))}),_n}var pr=St("src","RGB"),jr=St("dst","RGB");me.optional(function(){var fn=_e.constants.invalidBlendCombinations;_e.assert(ze,fn+".indexOf("+pr+'+", "+'+jr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Ur=ze.def(lt,"[",pr,"]"),on=ze.def(lt,"[",St("src","Alpha"),"]"),Dr=ze.def(lt,"[",jr,"]"),Cn=ze.def(lt,"[",St("dst","Alpha"),"]");return[Ur,Dr,on,Cn]});case Wu:return nt(function(_e){if(typeof _e=="string")return me.commandParameter(_e,jt,"invalid "+Ye,oe.commandStr),[jt[_e],jt[_e]];if(typeof _e=="object")return me.commandParameter(_e.rgb,jt,Ye+".rgb",oe.commandStr),me.commandParameter(_e.alpha,jt,Ye+".alpha",oe.commandStr),[jt[_e.rgb],jt[_e.alpha]];me.commandRaise("invalid blend.equation",oe.commandStr)},function(_e,ze,Ae){var lt=_e.constants.blendEquations,St=ze.def(),pr=ze.def(),jr=_e.cond("typeof ",Ae,'==="string"');return me.optional(function(){function Ur(on,Dr,Cn){_e.assert(on,Cn+" in "+lt,"invalid "+Dr+", must be one of "+Object.keys(jt))}Ur(jr.then,Ye,Ae),_e.assert(jr.else,Ae+"&&typeof "+Ae+'==="object"',"invalid "+Ye),Ur(jr.else,Ye+".rgb",Ae+".rgb"),Ur(jr.else,Ye+".alpha",Ae+".alpha")}),jr.then(St,"=",pr,"=",lt,"[",Ae,"];"),jr.else(St,"=",lt,"[",Ae,".rgb];",pr,"=",lt,"[",Ae,".alpha];"),ze(jr),[St,pr]});case ds:return nt(function(_e){return me.command(fo(_e)&&_e.length===4,"blend.color must be a 4d array",oe.commandStr),He(4,function(ze){return+_e[ze]})},function(_e,ze,Ae){return me.optional(function(){_e.assert(ze,_e.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===4","blend.color must be a 4d array")}),He(4,function(lt){return ze.def("+",Ae,"[",lt,"]")})});case tu:return nt(function(_e){return me.commandType(_e,"number",Fe,oe.commandStr),_e|0},function(_e,ze,Ae){return me.optional(function(){_e.assert(ze,"typeof "+Ae+'==="number"',"invalid stencil.mask")}),ze.def(Ae,"|0")});case Ts:return nt(function(_e){me.commandType(_e,"object",Fe,oe.commandStr);var ze=_e.cmp||"keep",Ae=_e.ref||0,lt="mask"in _e?_e.mask:-1;return me.commandParameter(ze,zr,Ye+".cmp",oe.commandStr),me.commandType(Ae,"number",Ye+".ref",oe.commandStr),me.commandType(lt,"number",Ye+".mask",oe.commandStr),[zr[ze],Ae,lt]},function(_e,ze,Ae){var lt=_e.constants.compareFuncs;me.optional(function(){function Ur(){_e.assert(ze,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Ur(Ae+"&&typeof ",Ae,'==="object"'),Ur('!("cmp" in ',Ae,")||(",Ae,".cmp in ",lt,")")});var St=ze.def('"cmp" in ',Ae,"?",lt,"[",Ae,".cmp]",":",Mu),pr=ze.def(Ae,".ref|0"),jr=ze.def('"mask" in ',Ae,"?",Ae,".mask|0:-1");return[St,pr,jr]});case El:case mc:return nt(function(_e){me.commandType(_e,"object",Fe,oe.commandStr);var ze=_e.fail||"keep",Ae=_e.zfail||"keep",lt=_e.zpass||"keep";return me.commandParameter(ze,Ec,Ye+".fail",oe.commandStr),me.commandParameter(Ae,Ec,Ye+".zfail",oe.commandStr),me.commandParameter(lt,Ec,Ye+".zpass",oe.commandStr),[Ye===mc?Qc:Al,Ec[ze],Ec[Ae],Ec[lt]]},function(_e,ze,Ae){var lt=_e.constants.stencilOps;me.optional(function(){_e.assert(ze,Ae+"&&typeof "+Ae+'==="object"',"invalid "+Ye)});function St(pr){return me.optional(function(){_e.assert(ze,'!("'+pr+'" in '+Ae+")||("+Ae+"."+pr+" in "+lt+")","invalid "+Ye+"."+pr+", must be one of "+Object.keys(Ec))}),ze.def('"',pr,'" in ',Ae,"?",lt,"[",Ae,".",pr,"]:",Mu)}return[Ye===mc?Qc:Al,St("fail"),St("zfail"),St("zpass")]});case qi:return nt(function(_e){me.commandType(_e,"object",Fe,oe.commandStr);var ze=_e.factor|0,Ae=_e.units|0;return me.commandType(ze,"number",Fe+".factor",oe.commandStr),me.commandType(Ae,"number",Fe+".units",oe.commandStr),[ze,Ae]},function(_e,ze,Ae){me.optional(function(){_e.assert(ze,Ae+"&&typeof "+Ae+'==="object"',"invalid "+Ye)});var lt=ze.def(Ae,".factor|0"),St=ze.def(Ae,".units|0");return[lt,St]});case vc:return nt(function(_e){var ze=0;return _e==="front"?ze=Al:_e==="back"&&(ze=Qc),me.command(!!ze,Fe,oe.commandStr),ze},function(_e,ze,Ae){return me.optional(function(){_e.assert(ze,Ae+'==="front"||'+Ae+'==="back"',"invalid cull.face")}),ze.def(Ae,'==="front"?',Al,":",Qc)});case Gl:return nt(function(_e){return me.command(typeof _e=="number"&&_e>=kt.lineWidthDims[0]&&_e<=kt.lineWidthDims[1],"invalid line width, must be a positive number between "+kt.lineWidthDims[0]+" and "+kt.lineWidthDims[1],oe.commandStr),_e},function(_e,ze,Ae){return me.optional(function(){_e.assert(ze,"typeof "+Ae+'==="number"&&'+Ae+">="+kt.lineWidthDims[0]+"&&"+Ae+"<="+kt.lineWidthDims[1],"invalid line width")}),Ae});case gu:return nt(function(_e){return me.commandParameter(_e,fp,Fe,oe.commandStr),fp[_e]},function(_e,ze,Ae){return me.optional(function(){_e.assert(ze,Ae+'==="cw"||'+Ae+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),ze.def(Ae+'==="cw"?'+Wp+":"+Lh)});case mu:return nt(function(_e){return me.command(fo(_e)&&_e.length===4,"color.mask must be length 4 array",oe.commandStr),_e.map(function(ze){return!!ze})},function(_e,ze,Ae){return me.optional(function(){_e.assert(ze,_e.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===4","invalid color.mask")}),He(4,function(lt){return"!!"+Ae+"["+lt+"]"})});case Hs:return nt(function(_e){me.command(typeof _e=="object"&&_e,Fe,oe.commandStr);var ze="value"in _e?_e.value:1,Ae=!!_e.invert;return me.command(typeof ze=="number"&&ze>=0&&ze<=1,"sample.coverage.value must be a number between 0 and 1",oe.commandStr),[ze,Ae]},function(_e,ze,Ae){me.optional(function(){_e.assert(ze,Ae+"&&typeof "+Ae+'==="object"',"invalid sample.coverage")});var lt=ze.def('"value" in ',Ae,"?+",Ae,".value:1"),St=ze.def("!!",Ae,".invert");return[lt,St]})}}),Rt}function Ni(Se,oe){var Ve=Se.static,ct=Se.dynamic,Rt={};return Object.keys(Ve).forEach(function(Ye){var Fe=Ve[Ye],nt;if(typeof Fe=="number"||typeof Fe=="boolean")nt=Fo(function(){return Fe});else if(typeof Fe=="function"){var _e=Fe._reglType;_e==="texture2d"||_e==="textureCube"?nt=Fo(function(ze){return ze.link(Fe)}):_e==="framebuffer"||_e==="framebufferCube"?(me.command(Fe.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Ye+'"',oe.commandStr),nt=Fo(function(ze){return ze.link(Fe.color[0])})):me.commandRaise('invalid data for uniform "'+Ye+'"',oe.commandStr)}else fo(Fe)?nt=Fo(function(ze){var Ae=ze.global.def("[",He(Fe.length,function(lt){return me.command(typeof Fe[lt]=="number"||typeof Fe[lt]=="boolean","invalid uniform "+Ye,ze.commandStr),Fe[lt]}),"]");return Ae}):me.commandRaise('invalid or missing data for uniform "'+Ye+'"',oe.commandStr);nt.value=Fe,Rt[Ye]=nt}),Object.keys(ct).forEach(function(Ye){var Fe=ct[Ye];Rt[Ye]=Ws(Fe,function(nt,_e){return nt.invoke(_e,Fe)})}),Rt}function ss(Se,oe){var Ve=Se.static,ct=Se.dynamic,Rt={};return Object.keys(Ve).forEach(function(Ye){var Fe=Ve[Ye],nt=ge.id(Ye),_e=new st;if(kh(Fe))_e.state=Xn,_e.buffer=ur.getBuffer(ur.create(Fe,Ef,!1,!0)),_e.type=0;else{var ze=ur.getBuffer(Fe);if(ze)_e.state=Xn,_e.buffer=ze,_e.type=0;else if(me.command(typeof Fe=="object"&&Fe,"invalid data for attribute "+Ye,oe.commandStr),"constant"in Fe){var Ae=Fe.constant;_e.buffer="null",_e.state=yi,typeof Ae=="number"?_e.x=Ae:(me.command(fo(Ae)&&Ae.length>0&&Ae.length<=4,"invalid constant for attribute "+Ye,oe.commandStr),si.forEach(function(Dr,Cn){Cn<Ae.length&&(_e[Dr]=Ae[Cn])}))}else{kh(Fe.buffer)?ze=ur.getBuffer(ur.create(Fe.buffer,Ef,!1,!0)):ze=ur.getBuffer(Fe.buffer),me.command(!!ze,'missing buffer for attribute "'+Ye+'"',oe.commandStr);var lt=Fe.offset|0;me.command(lt>=0,'invalid offset for attribute "'+Ye+'"',oe.commandStr);var St=Fe.stride|0;me.command(St>=0&&St<256,'invalid stride for attribute "'+Ye+'", must be integer betweeen [0, 255]',oe.commandStr);var pr=Fe.size|0;me.command(!("size"in Fe)||pr>0&&pr<=4,'invalid size for attribute "'+Ye+'", must be 1,2,3,4',oe.commandStr);var jr=!!Fe.normalized,Ur=0;"type"in Fe&&(me.commandParameter(Fe.type,au,"invalid type for attribute "+Ye,oe.commandStr),Ur=au[Fe.type]);var on=Fe.divisor|0;me.optional(function(){"divisor"in Fe&&(me.command(on===0||br,'cannot specify divisor for attribute "'+Ye+'", instancing not supported',oe.commandStr),me.command(on>=0,'invalid divisor for attribute "'+Ye+'"',oe.commandStr));var Dr=oe.commandStr,Cn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Fe).forEach(function(fn){me.command(Cn.indexOf(fn)>=0,'unknown parameter "'+fn+'" for attribute pointer "'+Ye+'" (valid parameters are '+Cn+")",Dr)})}),_e.buffer=ze,_e.state=Xn,_e.size=pr,_e.normalized=jr,_e.type=Ur||ze.dtype,_e.offset=lt,_e.stride=St,_e.divisor=on}}Rt[Ye]=Fo(function(Dr,Cn){var fn=Dr.attribCache;if(nt in fn)return fn[nt];var bn={isStream:!1};return Object.keys(_e).forEach(function(_n){bn[_n]=_e[_n]}),_e.buffer&&(bn.buffer=Dr.link(_e.buffer),bn.type=bn.type||bn.buffer+".dtype"),fn[nt]=bn,bn})}),Object.keys(ct).forEach(function(Ye){var Fe=ct[Ye];function nt(_e,ze){var Ae=_e.invoke(ze,Fe),lt=_e.shared,St=_e.constants,pr=lt.isBufferArgs,jr=lt.buffer;me.optional(function(){_e.assert(ze,Ae+"&&(typeof "+Ae+'==="object"||typeof '+Ae+'==="function")&&('+pr+"("+Ae+")||"+jr+".getBuffer("+Ae+")||"+jr+".getBuffer("+Ae+".buffer)||"+pr+"("+Ae+'.buffer)||("constant" in '+Ae+"&&(typeof "+Ae+'.constant==="number"||'+lt.isArrayLike+"("+Ae+".constant))))",'invalid dynamic attribute "'+Ye+'"')});var Ur={isStream:ze.def(!1)},on=new st;on.state=Xn,Object.keys(on).forEach(function(bn){Ur[bn]=ze.def(""+on[bn])});var Dr=Ur.buffer,Cn=Ur.type;ze("if(",pr,"(",Ae,")){",Ur.isStream,"=true;",Dr,"=",jr,".createStream(",Ef,",",Ae,");",Cn,"=",Dr,".dtype;","}else{",Dr,"=",jr,".getBuffer(",Ae,");","if(",Dr,"){",Cn,"=",Dr,".dtype;",'}else if("constant" in ',Ae,"){",Ur.state,"=",yi,";","if(typeof "+Ae+'.constant === "number"){',Ur[si[0]],"=",Ae,".constant;",si.slice(1).map(function(bn){return Ur[bn]}).join("="),"=0;","}else{",si.map(function(bn,_n){return Ur[bn]+"="+Ae+".constant.length>"+_n+"?"+Ae+".constant["+_n+"]:0;"}).join(""),"}}else{","if(",pr,"(",Ae,".buffer)){",Dr,"=",jr,".createStream(",Ef,",",Ae,".buffer);","}else{",Dr,"=",jr,".getBuffer(",Ae,".buffer);","}",Cn,'="type" in ',Ae,"?",St.glTypes,"[",Ae,".type]:",Dr,".dtype;",Ur.normalized,"=!!",Ae,".normalized;");function fn(bn){ze(Ur[bn],"=",Ae,".",bn,"|0;")}return fn("size"),fn("offset"),fn("stride"),fn("divisor"),ze("}}"),ze.exit("if(",Ur.isStream,"){",jr,".destroyStream(",Dr,");","}"),Ur}Rt[Ye]=Ws(Fe,nt)}),Rt}function Ka(Se){var oe=Se.static,Ve=Se.dynamic,ct={};return Object.keys(oe).forEach(function(Rt){var Ye=oe[Rt];ct[Rt]=Fo(function(Fe,nt){return typeof Ye=="number"||typeof Ye=="boolean"?""+Ye:Fe.link(Ye)})}),Object.keys(Ve).forEach(function(Rt){var Ye=Ve[Rt];ct[Rt]=Ws(Ye,function(Fe,nt){return Fe.invoke(nt,Ye)})}),ct}function Ho(Se,oe,Ve,ct,Rt){var Ye=Se.static,Fe=Se.dynamic;me.optional(function(){var fn=[vs,Yu,Sl,_u,ko,gc,Cl,Xf,qc,xf].concat(zn);function bn(_n){Object.keys(_n).forEach(function(gn){me.command(fn.indexOf(gn)>=0,'unknown parameter "'+gn+'"',Rt.commandStr)})}bn(Ye),bn(Fe)});var nt=ui(Se,oe),_e=Qr(Se,Rt),ze=$n(Se,_e,Rt),Ae=uo(Se,Rt),lt=vo(Se,Rt),St=Bi(Se,Rt,nt);function pr(fn){var bn=ze[fn];bn&&(lt[fn]=bn)}pr(yu),pr(Sn(Wf));var jr=Object.keys(lt).length>0,Ur={framebuffer:_e,draw:Ae,shader:St,state:lt,dirty:jr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Ur.profile=Wr(Se,Rt),Ur.uniforms=Ni(Ve,Rt),Ur.drawVAO=Ur.scopeVAO=Ae.vao,!Ur.drawVAO&&St.program&&!nt&&Be.angle_instanced_arrays&&Ae.static.elements){var on=!0,Dr=St.program.attributes.map(function(fn){var bn=oe.static[fn];return on=on&&!!bn,bn});if(on&&Dr.length>0){var Cn=xr.getVAO(xr.createVAO({attributes:Dr,elements:Ae.static.elements}));Ur.drawVAO=new ya(null,null,null,function(fn,bn){return fn.link(Cn)}),Ur.useVAO=!0}}return nt?Ur.useVAO=!0:Ur.attributes=ss(oe,Rt),Ur.context=Ka(ct,Rt),Ur}function wo(Se,oe,Ve){var ct=Se.shared,Rt=ct.context,Ye=Se.scope();Object.keys(Ve).forEach(function(Fe){oe.save(Rt,"."+Fe);var nt=Ve[Fe],_e=nt.append(Se,oe);Array.isArray(_e)?Ye(Rt,".",Fe,"=[",_e.join(),"];"):Ye(Rt,".",Fe,"=",_e,";")}),oe(Ye)}function Qo(Se,oe,Ve,ct){var Rt=Se.shared,Ye=Rt.gl,Fe=Rt.framebuffer,nt;fr&&(nt=oe.def(Rt.extensions,".webgl_draw_buffers"));var _e=Se.constants,ze=_e.drawBuffer,Ae=_e.backBuffer,lt;Ve?lt=Ve.append(Se,oe):lt=oe.def(Fe,".next"),ct||oe("if(",lt,"!==",Fe,".cur){"),oe("if(",lt,"){",Ye,".bindFramebuffer(",Yp,",",lt,".framebuffer);"),fr&&oe(nt,".drawBuffersWEBGL(",ze,"[",lt,".colorAttachments.length]);"),oe("}else{",Ye,".bindFramebuffer(",Yp,",null);"),fr&&oe(nt,".drawBuffersWEBGL(",Ae,");"),oe("}",Fe,".cur=",lt,";"),ct||oe("}")}function Bo(Se,oe,Ve){var ct=Se.shared,Rt=ct.gl,Ye=Se.current,Fe=Se.next,nt=ct.current,_e=ct.next,ze=Se.cond(nt,".dirty");zn.forEach(function(Ae){var lt=Sn(Ae);if(!(lt in Ve.state)){var St,pr;if(lt in Fe){St=Fe[lt],pr=Ye[lt];var jr=He(Lr[lt].length,function(on){return ze.def(St,"[",on,"]")});ze(Se.cond(jr.map(function(on,Dr){return on+"!=="+pr+"["+Dr+"]"}).join("||")).then(Rt,".",ir[lt],"(",jr,");",jr.map(function(on,Dr){return pr+"["+Dr+"]="+on}).join(";"),";"))}else{St=ze.def(_e,".",lt);var Ur=Se.cond(St,"!==",nt,".",lt);ze(Ur),lt in tr?Ur(Se.cond(St).then(Rt,".enable(",tr[lt],");").else(Rt,".disable(",tr[lt],");"),nt,".",lt,"=",St,";"):Ur(Rt,".",ir[lt],"(",St,");",nt,".",lt,"=",St,";")}}}),Object.keys(Ve.state).length===0&&ze(nt,".dirty=false;"),oe(ze)}function ms(Se,oe,Ve,ct){var Rt=Se.shared,Ye=Se.current,Fe=Rt.current,nt=Rt.gl;Dh(Object.keys(Ve)).forEach(function(_e){var ze=Ve[_e];if(!(ct&&!ct(ze))){var Ae=ze.append(Se,oe);if(tr[_e]){var lt=tr[_e];Yl(ze)?Ae?oe(nt,".enable(",lt,");"):oe(nt,".disable(",lt,");"):oe(Se.cond(Ae).then(nt,".enable(",lt,");").else(nt,".disable(",lt,");")),oe(Fe,".",_e,"=",Ae,";")}else if(fo(Ae)){var St=Ye[_e];oe(nt,".",ir[_e],"(",Ae,");",Ae.map(function(pr,jr){return St+"["+jr+"]="+pr}).join(";"),";")}else oe(nt,".",ir[_e],"(",Ae,");",Fe,".",_e,"=",Ae,";")}})}function mo(Se,oe){br&&(Se.instancing=oe.def(Se.shared.extensions,".angle_instanced_arrays"))}function xi(Se,oe,Ve,ct,Rt){var Ye=Se.shared,Fe=Se.stats,nt=Ye.current,_e=Ye.timer,ze=Ve.profile;function Ae(){var fn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return fn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var lt,St;function pr(fn){lt=oe.def(),fn(lt,"=",Ae(),";"),typeof Rt=="string"?fn(Fe,".count+=",Rt,";"):fn(Fe,".count++;"),_r&&(ct?(St=oe.def(),fn(St,"=",_e,".getNumPendingQueries();")):fn(_e,".beginQuery(",Fe,");"))}function jr(fn){fn(Fe,".cpuTime+=",Ae(),"-",lt,";"),_r&&(ct?fn(_e,".pushScopeStats(",St,",",_e,".getNumPendingQueries(),",Fe,");"):fn(_e,".endQuery();"))}function Ur(fn){var bn=oe.def(nt,".profile");oe(nt,".profile=",fn,";"),oe.exit(nt,".profile=",bn,";")}var on;if(ze){if(Yl(ze)){ze.enable?(pr(oe),jr(oe.exit),Ur("true")):Ur("false");return}on=ze.append(Se,oe),Ur(on)}else on=oe.def(nt,".profile");var Dr=Se.block();pr(Dr),oe("if(",on,"){",Dr,"}");var Cn=Se.block();jr(Cn),oe.exit("if(",on,"){",Cn,"}")}function Wo(Se,oe,Ve,ct,Rt){var Ye=Se.shared;function Fe(_e){switch(_e){case Wl:case Rh:case eh:return 2;case _c:case xc:case bc:return 3;case Sf:case Qf:case Cf:return 4;default:return 1}}function nt(_e,ze,Ae){var lt=Ye.gl,St=oe.def(_e,".location"),pr=oe.def(Ye.attributes,"[",St,"]"),jr=Ae.state,Ur=Ae.buffer,on=[Ae.x,Ae.y,Ae.z,Ae.w],Dr=["buffer","normalized","offset","stride"];function Cn(){oe("if(!",pr,".buffer){",lt,".enableVertexAttribArray(",St,");}");var bn=Ae.type,_n;if(Ae.size?_n=oe.def(Ae.size,"||",ze):_n=ze,oe("if(",pr,".type!==",bn,"||",pr,".size!==",_n,"||",Dr.map(function(ti){return pr+"."+ti+"!=="+Ae[ti]}).join("||"),"){",lt,".bindBuffer(",Ef,",",Ur,".buffer);",lt,".vertexAttribPointer(",[St,_n,bn,Ae.normalized,Ae.stride,Ae.offset],");",pr,".type=",bn,";",pr,".size=",_n,";",Dr.map(function(ti){return pr+"."+ti+"="+Ae[ti]+";"}).join(""),"}"),br){var gn=Ae.divisor;oe("if(",pr,".divisor!==",gn,"){",Se.instancing,".vertexAttribDivisorANGLE(",[St,gn],");",pr,".divisor=",gn,";}")}}function fn(){oe("if(",pr,".buffer){",lt,".disableVertexAttribArray(",St,");",pr,".buffer=null;","}if(",si.map(function(bn,_n){return pr+"."+bn+"!=="+on[_n]}).join("||"),"){",lt,".vertexAttrib4f(",St,",",on,");",si.map(function(bn,_n){return pr+"."+bn+"="+on[_n]+";"}).join(""),"}")}jr===Xn?Cn():jr===yi?fn():(oe("if(",jr,"===",Xn,"){"),Cn(),oe("}else{"),fn(),oe("}"))}ct.forEach(function(_e){var ze=_e.name,Ae=Ve.attributes[ze],lt;if(Ae){if(!Rt(Ae))return;lt=Ae.append(Se,oe)}else{if(!Rt(wf))return;var St=Se.scopeAttrib(ze);me.optional(function(){Se.assert(oe,St+".state","missing attribute "+ze)}),lt={},Object.keys(new st).forEach(function(pr){lt[pr]=oe.def(St,".",pr)})}nt(Se.link(_e),Fe(_e.info.type),lt)})}function na(Se,oe,Ve,ct,Rt,Ye){for(var Fe=Se.shared,nt=Fe.gl,_e,ze=0;ze<ct.length;++ze){var Ae=ct[ze],lt=Ae.name,St=Ae.info.type,pr=Ve.uniforms[lt],jr=Se.link(Ae),Ur=jr+".location",on;if(pr){if(!Rt(pr))continue;if(Yl(pr)){var Dr=pr.value;if(me.command(Dr!==null&&typeof Dr!="undefined",'missing uniform "'+lt+'"',Se.commandStr),St===nh||St===ih){me.command(typeof Dr=="function"&&(St===nh&&(Dr._reglType==="texture2d"||Dr._reglType==="framebuffer")||St===ih&&(Dr._reglType==="textureCube"||Dr._reglType==="framebufferCube")),"invalid texture for uniform "+lt,Se.commandStr);var Cn=Se.link(Dr._texture||Dr.color[0]._texture);oe(nt,".uniform1i(",Ur,",",Cn+".bind());"),oe.exit(Cn,".unbind();")}else if(St===ru||St===th||St===rh){me.optional(function(){me.command(fo(Dr),"invalid matrix for uniform "+lt,Se.commandStr),me.command(St===ru&&Dr.length===4||St===th&&Dr.length===9||St===rh&&Dr.length===16,"invalid length for matrix uniform "+lt,Se.commandStr)});var fn=Se.global.def("new Float32Array(["+Array.prototype.slice.call(Dr)+"])"),bn=2;St===th?bn=3:St===rh&&(bn=4),oe(nt,".uniformMatrix",bn,"fv(",Ur,",false,",fn,");")}else{switch(St){case Kf:me.commandType(Dr,"number","uniform "+lt,Se.commandStr),_e="1f";break;case Wl:me.command(fo(Dr)&&Dr.length===2,"uniform "+lt,Se.commandStr),_e="2f";break;case _c:me.command(fo(Dr)&&Dr.length===3,"uniform "+lt,Se.commandStr),_e="3f";break;case Sf:me.command(fo(Dr)&&Dr.length===4,"uniform "+lt,Se.commandStr),_e="4f";break;case Jf:me.commandType(Dr,"boolean","uniform "+lt,Se.commandStr),_e="1i";break;case $f:me.commandType(Dr,"number","uniform "+lt,Se.commandStr),_e="1i";break;case eh:me.command(fo(Dr)&&Dr.length===2,"uniform "+lt,Se.commandStr),_e="2i";break;case Rh:me.command(fo(Dr)&&Dr.length===2,"uniform "+lt,Se.commandStr),_e="2i";break;case bc:me.command(fo(Dr)&&Dr.length===3,"uniform "+lt,Se.commandStr),_e="3i";break;case xc:me.command(fo(Dr)&&Dr.length===3,"uniform "+lt,Se.commandStr),_e="3i";break;case Cf:me.command(fo(Dr)&&Dr.length===4,"uniform "+lt,Se.commandStr),_e="4i";break;case Qf:me.command(fo(Dr)&&Dr.length===4,"uniform "+lt,Se.commandStr),_e="4i";break}oe(nt,".uniform",_e,"(",Ur,",",fo(Dr)?Array.prototype.slice.call(Dr):Dr,");")}continue}else on=pr.append(Se,oe)}else{if(!Rt(wf))continue;on=oe.def(Fe.uniforms,"[",ge.id(lt),"]")}St===nh?(me(!Array.isArray(on),"must specify a scalar prop for textures"),oe("if(",on,"&&",on,'._reglType==="framebuffer"){',on,"=",on,".color[0];","}")):St===ih&&(me(!Array.isArray(on),"must specify a scalar prop for cube maps"),oe("if(",on,"&&",on,'._reglType==="framebufferCube"){',on,"=",on,".color[0];","}")),me.optional(function(){function Ms(Ou,mi){Se.assert(oe,Ou,'bad data or missing for uniform "'+lt+'".  '+mi)}function Pu(Ou){me(!Array.isArray(on),"must not specify an array type for uniform"),Ms("typeof "+on+'==="'+Ou+'"',"invalid type, expected "+Ou)}function Iu(Ou,mi){Array.isArray(on)?me(on.length===Ou,"must have length "+Ou):Ms(Fe.isArrayLike+"("+on+")&&"+on+".length==="+Ou,"invalid vector, should have length "+Ou,Se.commandStr)}function mp(Ou){me(!Array.isArray(on),"must not specify a value type"),Ms("typeof "+on+'==="function"&&'+on+'._reglType==="texture'+(Ou===sp?"2d":"Cube")+'"',"invalid texture type",Se.commandStr)}switch(St){case $f:Pu("number");break;case Rh:Iu(2,"number");break;case xc:Iu(3,"number");break;case Qf:Iu(4,"number");break;case Kf:Pu("number");break;case Wl:Iu(2,"number");break;case _c:Iu(3,"number");break;case Sf:Iu(4,"number");break;case Jf:Pu("boolean");break;case eh:Iu(2,"boolean");break;case bc:Iu(3,"boolean");break;case Cf:Iu(4,"boolean");break;case ru:Iu(4,"number");break;case th:Iu(9,"number");break;case rh:Iu(16,"number");break;case nh:mp(sp);break;case ih:mp(Mh);break}});var _n=1;switch(St){case nh:case ih:var gn=oe.def(on,"._texture");oe(nt,".uniform1i(",Ur,",",gn,".bind());"),oe.exit(gn,".unbind();");continue;case $f:case Jf:_e="1i";break;case Rh:case eh:_e="2i",_n=2;break;case xc:case bc:_e="3i",_n=3;break;case Qf:case Cf:_e="4i",_n=4;break;case Kf:_e="1f";break;case Wl:_e="2f",_n=2;break;case _c:_e="3f",_n=3;break;case Sf:_e="4f",_n=4;break;case ru:_e="Matrix2fv";break;case th:_e="Matrix3fv";break;case rh:_e="Matrix4fv";break}if(_e.charAt(0)==="M"){oe(nt,".uniform",_e,"(",Ur,",");var ti=Math.pow(St-ru+2,2),Sa=Se.global.def("new Float32Array(",ti,")");Array.isArray(on)?oe("false,(",He(ti,function(Ms){return Sa+"["+Ms+"]="+on[Ms]}),",",Sa,")"):oe("false,(Array.isArray(",on,")||",on," instanceof Float32Array)?",on,":(",He(ti,function(Ms){return Sa+"["+Ms+"]="+on+"["+Ms+"]"}),",",Sa,")"),oe(");")}else if(_n>1){for(var us=[],za=[],pa=0;pa<_n;++pa)Array.isArray(on)?za.push(on[pa]):za.push(oe.def(on+"["+pa+"]")),Ye&&us.push(oe.def());Ye&&oe("if(!",Se.batchId,"||",us.map(function(Ms,Pu){return Ms+"!=="+za[Pu]}).join("||"),"){",us.map(function(Ms,Pu){return Ms+"="+za[Pu]+";"}).join("")),oe(nt,".uniform",_e,"(",Ur,",",za.join(","),");"),Ye&&oe("}")}else{if(me(!Array.isArray(on),"uniform value must not be an array"),Ye){var ul=oe.def();oe("if(!",Se.batchId,"||",ul,"!==",on,"){",ul,"=",on,";")}oe(nt,".uniform",_e,"(",Ur,",",on,");"),Ye&&oe("}")}}}function Jo(Se,oe,Ve,ct){var Rt=Se.shared,Ye=Rt.gl,Fe=Rt.draw,nt=ct.draw;function _e(){var _n=nt.elements,gn,ti=oe;return _n?((_n.contextDep&&ct.contextDynamic||_n.propDep)&&(ti=Ve),gn=_n.append(Se,ti),nt.elementsActive&&ti("if("+gn+")"+Ye+".bindBuffer("+ap+","+gn+".buffer.buffer);")):(gn=ti.def(),ti(gn,"=",Fe,".",_u,";","if(",gn,"){",Ye,".bindBuffer(",ap,",",gn,".buffer.buffer);}","else if(",Rt.vao,".currentVAO){",gn,"=",Se.shared.elements+".getElements("+Rt.vao,".currentVAO.elements);",ar?"":"if("+gn+")"+Ye+".bindBuffer("+ap+","+gn+".buffer.buffer);","}")),gn}function ze(){var _n=nt.count,gn,ti=oe;return _n?((_n.contextDep&&ct.contextDynamic||_n.propDep)&&(ti=Ve),gn=_n.append(Se,ti),me.optional(function(){_n.MISSING&&Se.assert(oe,"false","missing vertex count"),_n.DYNAMIC&&Se.assert(ti,gn+">=0","missing vertex count")})):(gn=ti.def(Fe,".",Cl),me.optional(function(){Se.assert(ti,gn+">=0","missing vertex count")})),gn}var Ae=_e();function lt(_n){var gn=nt[_n];return gn?gn.contextDep&&ct.contextDynamic||gn.propDep?gn.append(Se,Ve):gn.append(Se,oe):oe.def(Fe,".",_n)}var St=lt(ko),pr=lt(gc),jr=ze();if(typeof jr=="number"){if(jr===0)return}else Ve("if(",jr,"){"),Ve.exit("}");var Ur,on;br&&(Ur=lt(Xf),on=Se.instancing);var Dr=Ae+".type",Cn=nt.elements&&Yl(nt.elements)&&!nt.vaoActive;function fn(){function _n(){Ve(on,".drawElementsInstancedANGLE(",[St,jr,Dr,pr+"<<(("+Dr+"-"+ni+")>>1)",Ur],");")}function gn(){Ve(on,".drawArraysInstancedANGLE(",[St,pr,jr,Ur],");")}Ae&&Ae!=="null"?Cn?_n():(Ve("if(",Ae,"){"),_n(),Ve("}else{"),gn(),Ve("}")):gn()}function bn(){function _n(){Ve(Ye+".drawElements("+[St,jr,Dr,pr+"<<(("+Dr+"-"+ni+")>>1)"]+");")}function gn(){Ve(Ye+".drawArrays("+[St,pr,jr]+");")}Ae&&Ae!=="null"?Cn?_n():(Ve("if(",Ae,"){"),_n(),Ve("}else{"),gn(),Ve("}")):gn()}br&&(typeof Ur!="number"||Ur>=0)?typeof Ur=="string"?(Ve("if(",Ur,">0){"),fn(),Ve("}else if(",Ur,"<0){"),bn(),Ve("}")):fn():bn()}function ri(Se,oe,Ve,ct,Rt){var Ye=ei(),Fe=Ye.proc("body",Rt);return me.optional(function(){Ye.commandStr=oe.commandStr,Ye.command=Ye.link(oe.commandStr)}),br&&(Ye.instancing=Fe.def(Ye.shared.extensions,".angle_instanced_arrays")),Se(Ye,Fe,Ve,ct),Ye.compile().body}function zi(Se,oe,Ve,ct){mo(Se,oe),Ve.useVAO?Ve.drawVAO?oe(Se.shared.vao,".setVAO(",Ve.drawVAO.append(Se,oe),");"):oe(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(oe(Se.shared.vao,".setVAO(null);"),Wo(Se,oe,Ve,ct.attributes,function(){return!0})),na(Se,oe,Ve,ct.uniforms,function(){return!0},!1),Jo(Se,oe,oe,Ve)}function _a(Se,oe){var Ve=Se.proc("draw",1);mo(Se,Ve),wo(Se,Ve,oe.context),Qo(Se,Ve,oe.framebuffer),Bo(Se,Ve,oe),ms(Se,Ve,oe.state),xi(Se,Ve,oe,!1,!0);var ct=oe.shader.progVar.append(Se,Ve);if(Ve(Se.shared.gl,".useProgram(",ct,".program);"),oe.shader.program)zi(Se,Ve,oe,oe.shader.program);else{Ve(Se.shared.vao,".setVAO(null);");var Rt=Se.global.def("{}"),Ye=Ve.def(ct,".id"),Fe=Ve.def(Rt,"[",Ye,"]");Ve(Se.cond(Fe).then(Fe,".call(this,a0);").else(Fe,"=",Rt,"[",Ye,"]=",Se.link(function(nt){return ri(zi,Se,oe,nt,1)}),"(",ct,");",Fe,".call(this,a0);"))}Object.keys(oe.state).length>0&&Ve(Se.shared.current,".dirty=true;"),Se.shared.vao&&Ve(Se.shared.vao,".setVAO(null);")}function bo(Se,oe,Ve,ct){Se.batchId="a1",mo(Se,oe);function Rt(){return!0}Wo(Se,oe,Ve,ct.attributes,Rt),na(Se,oe,Ve,ct.uniforms,Rt,!1),Jo(Se,oe,oe,Ve)}function wl(Se,oe,Ve,ct){mo(Se,oe);var Rt=Ve.contextDep,Ye=oe.def(),Fe="a0",nt="a1",_e=oe.def();Se.shared.props=_e,Se.batchId=Ye;var ze=Se.scope(),Ae=Se.scope();oe(ze.entry,"for(",Ye,"=0;",Ye,"<",nt,";++",Ye,"){",_e,"=",Fe,"[",Ye,"];",Ae,"}",ze.exit);function lt(Dr){return Dr.contextDep&&Rt||Dr.propDep}function St(Dr){return!lt(Dr)}if(Ve.needsContext&&wo(Se,Ae,Ve.context),Ve.needsFramebuffer&&Qo(Se,Ae,Ve.framebuffer),ms(Se,Ae,Ve.state,lt),Ve.profile&&lt(Ve.profile)&&xi(Se,Ae,Ve,!1,!0),ct)Ve.useVAO?Ve.drawVAO?lt(Ve.drawVAO)?Ae(Se.shared.vao,".setVAO(",Ve.drawVAO.append(Se,Ae),");"):ze(Se.shared.vao,".setVAO(",Ve.drawVAO.append(Se,ze),");"):ze(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(ze(Se.shared.vao,".setVAO(null);"),Wo(Se,ze,Ve,ct.attributes,St),Wo(Se,Ae,Ve,ct.attributes,lt)),na(Se,ze,Ve,ct.uniforms,St,!1),na(Se,Ae,Ve,ct.uniforms,lt,!0),Jo(Se,ze,Ae,Ve);else{var pr=Se.global.def("{}"),jr=Ve.shader.progVar.append(Se,Ae),Ur=Ae.def(jr,".id"),on=Ae.def(pr,"[",Ur,"]");Ae(Se.shared.gl,".useProgram(",jr,".program);","if(!",on,"){",on,"=",pr,"[",Ur,"]=",Se.link(function(Dr){return ri(bo,Se,Ve,Dr,2)}),"(",jr,");}",on,".call(this,a0[",Ye,"],",Ye,");")}}function Te(Se,oe){var Ve=Se.proc("batch",2);Se.batchId="0",mo(Se,Ve);var ct=!1,Rt=!0;Object.keys(oe.context).forEach(function(pr){ct=ct||oe.context[pr].propDep}),ct||(wo(Se,Ve,oe.context),Rt=!1);var Ye=oe.framebuffer,Fe=!1;Ye?(Ye.propDep?ct=Fe=!0:Ye.contextDep&&ct&&(Fe=!0),Fe||Qo(Se,Ve,Ye)):Qo(Se,Ve,null),oe.state.viewport&&oe.state.viewport.propDep&&(ct=!0);function nt(pr){return pr.contextDep&&ct||pr.propDep}Bo(Se,Ve,oe),ms(Se,Ve,oe.state,function(pr){return!nt(pr)}),(!oe.profile||!nt(oe.profile))&&xi(Se,Ve,oe,!1,"a1"),oe.contextDep=ct,oe.needsContext=Rt,oe.needsFramebuffer=Fe;var _e=oe.shader.progVar;if(_e.contextDep&&ct||_e.propDep)wl(Se,Ve,oe,null);else{var ze=_e.append(Se,Ve);if(Ve(Se.shared.gl,".useProgram(",ze,".program);"),oe.shader.program)wl(Se,Ve,oe,oe.shader.program);else{Ve(Se.shared.vao,".setVAO(null);");var Ae=Se.global.def("{}"),lt=Ve.def(ze,".id"),St=Ve.def(Ae,"[",lt,"]");Ve(Se.cond(St).then(St,".call(this,a0,a1);").else(St,"=",Ae,"[",lt,"]=",Se.link(function(pr){return ri(wl,Se,oe,pr,2)}),"(",ze,");",St,".call(this,a0,a1);"))}}Object.keys(oe.state).length>0&&Ve(Se.shared.current,".dirty=true;"),Se.shared.vao&&Ve(Se.shared.vao,".setVAO(null);")}function Ut(Se,oe){var Ve=Se.proc("scope",3);Se.batchId="a2";var ct=Se.shared,Rt=ct.current;wo(Se,Ve,oe.context),oe.framebuffer&&oe.framebuffer.append(Se,Ve),Dh(Object.keys(oe.state)).forEach(function(Fe){var nt=oe.state[Fe],_e=nt.append(Se,Ve);fo(_e)?_e.forEach(function(ze,Ae){Ve.set(Se.next[Fe],"["+Ae+"]",ze)}):Ve.set(ct.next,"."+Fe,_e)}),xi(Se,Ve,oe,!0,!0),[_u,gc,Cl,Xf,ko].forEach(function(Fe){var nt=oe.draw[Fe];!nt||Ve.set(ct.draw,"."+Fe,""+nt.append(Se,Ve))}),Object.keys(oe.uniforms).forEach(function(Fe){var nt=oe.uniforms[Fe].append(Se,Ve);Array.isArray(nt)&&(nt="["+nt.join()+"]"),Ve.set(ct.uniforms,"["+ge.id(Fe)+"]",nt)}),Object.keys(oe.attributes).forEach(function(Fe){var nt=oe.attributes[Fe].append(Se,Ve),_e=Se.scopeAttrib(Fe);Object.keys(new st).forEach(function(ze){Ve.set(_e,"."+ze,nt[ze])})}),oe.scopeVAO&&Ve.set(ct.vao,".targetVAO",oe.scopeVAO.append(Se,Ve));function Ye(Fe){var nt=oe.shader[Fe];nt&&Ve.set(ct.shader,"."+Fe,nt.append(Se,Ve))}Ye(Yu),Ye(Sl),Object.keys(oe.state).length>0&&(Ve(Rt,".dirty=true;"),Ve.exit(Rt,".dirty=true;")),Ve("a1(",Se.shared.context,",a0,",Se.batchId,");")}function At(Se){if(!(typeof Se!="object"||fo(Se))){for(var oe=Object.keys(Se),Ve=0;Ve<oe.length;++Ve)if(cn.isDynamic(Se[oe[Ve]]))return!0;return!1}}function mn(Se,oe,Ve){var ct=oe.static[Ve];if(!ct||!At(ct))return;var Rt=Se.global,Ye=Object.keys(ct),Fe=!1,nt=!1,_e=!1,ze=Se.global.def("{}");Ye.forEach(function(lt){var St=ct[lt];if(cn.isDynamic(St)){typeof St=="function"&&(St=ct[lt]=cn.unbox(St));var pr=Ws(St,null);Fe=Fe||pr.thisDep,_e=_e||pr.propDep,nt=nt||pr.contextDep}else{switch(Rt(ze,".",lt,"="),typeof St){case"number":Rt(St);break;case"string":Rt('"',St,'"');break;case"object":Array.isArray(St)&&Rt("[",St.join(),"]");break;default:Rt(Se.link(St));break}Rt(";")}});function Ae(lt,St){Ye.forEach(function(pr){var jr=ct[pr];if(!!cn.isDynamic(jr)){var Ur=lt.invoke(St,jr);St(ze,".",pr,"=",Ur,";")}})}oe.dynamic[Ve]=new cn.DynamicVariable(Ao,{thisDep:Fe,contextDep:nt,propDep:_e,ref:ze,append:Ae}),delete oe.static[Ve]}function Vi(Se,oe,Ve,ct,Rt){var Ye=ei();Ye.stats=Ye.link(Rt),Object.keys(oe.static).forEach(function(nt){mn(Ye,oe,nt)}),Ad.forEach(function(nt){mn(Ye,Se,nt)});var Fe=Ho(Se,oe,Ve,ct,Ye);return _a(Ye,Fe),Ut(Ye,Fe),Te(Ye,Fe),m(Ye.compile(),{destroy:function(){Fe.shader.program.destroy()}})}return{next:$r,current:Lr,procs:function(){var Se=ei(),oe=Se.proc("poll"),Ve=Se.proc("refresh"),ct=Se.block();oe(ct),Ve(ct);var Rt=Se.shared,Ye=Rt.gl,Fe=Rt.next,nt=Rt.current;ct(nt,".dirty=false;"),Qo(Se,oe),Qo(Se,Ve,null,!0);var _e;br&&(_e=Se.link(br)),Be.oes_vertex_array_object&&Ve(Se.link(Be.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var ze=0;ze<kt.maxAttributes;++ze){var Ae=Ve.def(Rt.attributes,"[",ze,"]"),lt=Se.cond(Ae,".buffer");lt.then(Ye,".enableVertexAttribArray(",ze,");",Ye,".bindBuffer(",Ef,",",Ae,".buffer.buffer);",Ye,".vertexAttribPointer(",ze,",",Ae,".size,",Ae,".type,",Ae,".normalized,",Ae,".stride,",Ae,".offset);").else(Ye,".disableVertexAttribArray(",ze,");",Ye,".vertexAttrib4f(",ze,",",Ae,".x,",Ae,".y,",Ae,".z,",Ae,".w);",Ae,".buffer=null;"),Ve(lt),br&&Ve(_e,".vertexAttribDivisorANGLE(",ze,",",Ae,".divisor);")}return Ve(Se.shared.vao,".currentVAO=null;",Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"),Object.keys(tr).forEach(function(St){var pr=tr[St],jr=ct.def(Fe,".",St),Ur=Se.block();Ur("if(",jr,"){",Ye,".enable(",pr,")}else{",Ye,".disable(",pr,")}",nt,".",St,"=",jr,";"),Ve(Ur),oe("if(",jr,"!==",nt,".",St,"){",Ur,"}")}),Object.keys(ir).forEach(function(St){var pr=ir[St],jr=Lr[St],Ur,on,Dr=Se.block();if(Dr(Ye,".",pr,"("),fo(jr)){var Cn=jr.length;Ur=Se.global.def(Fe,".",St),on=Se.global.def(nt,".",St),Dr(He(Cn,function(fn){return Ur+"["+fn+"]"}),");",He(Cn,function(fn){return on+"["+fn+"]="+Ur+"["+fn+"];"}).join("")),oe("if(",He(Cn,function(fn){return Ur+"["+fn+"]!=="+on+"["+fn+"]"}).join("||"),"){",Dr,"}")}else Ur=ct.def(Fe,".",St),on=ct.def(nt,".",St),Dr(Ur,");",nt,".",St,"=",Ur,";"),oe("if(",Ur,"!==",on,"){",Dr,"}");Ve(Dr)}),Se.compile()}(),compile:Vi}}function Id(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Kp=34918,$p=34919,Fh=35007,Qp=function(B,ge){if(!ge.ext_disjoint_timer_query)return null;var Be=[];function kt(){return Be.pop()||ge.ext_disjoint_timer_query.createQueryEXT()}function ur(br){Be.push(br)}var Dt=[];function er(br){var fr=kt();ge.ext_disjoint_timer_query.beginQueryEXT(Fh,fr),Dt.push(fr),_r(Dt.length-1,Dt.length,br)}function hr(){ge.ext_disjoint_timer_query.endQueryEXT(Fh)}function gr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var xr=[];function wr(){return xr.pop()||new gr}function Ir(br){xr.push(br)}var Gr=[];function _r(br,fr,ar){var Lr=wr();Lr.startQueryIndex=br,Lr.endQueryIndex=fr,Lr.sum=0,Lr.stats=ar,Gr.push(Lr)}var Tr=[],st=[];function jt(){var br,fr,ar=Dt.length;if(ar!==0){st.length=Math.max(st.length,ar+1),Tr.length=Math.max(Tr.length,ar+1),Tr[0]=0,st[0]=0;var Lr=0;for(br=0,fr=0;fr<Dt.length;++fr){var $r=Dt[fr];ge.ext_disjoint_timer_query.getQueryObjectEXT($r,$p)?(Lr+=ge.ext_disjoint_timer_query.getQueryObjectEXT($r,Kp),ur($r)):Dt[br++]=$r,Tr[fr+1]=Lr,st[fr+1]=br}for(Dt.length=br,br=0,fr=0;fr<Gr.length;++fr){var zn=Gr[fr],tr=zn.startQueryIndex,ir=zn.endQueryIndex;zn.sum+=Tr[ir]-Tr[tr];var Sn=st[tr],Vr=st[ir];Vr===Sn?(zn.stats.gpuTime+=zn.sum/1e6,Ir(zn)):(zn.startQueryIndex=Sn,zn.endQueryIndex=Vr,Gr[br++]=zn)}Gr.length=br}}return{beginQuery:er,endQuery:hr,pushScopeStats:_r,update:jt,getNumPendingQueries:function(){return Dt.length},clear:function(){Be.push.apply(Be,Dt);for(var br=0;br<Be.length;br++)ge.ext_disjoint_timer_query.deleteQueryEXT(Be[br]);Dt.length=0,Be.length=0},restore:function(){Dt.length=0,Be.length=0}}},Jp=16384,sh=256,hp=1024,pp=34962,Jc="webglcontextlost",La="webglcontextrestored",dp=1,ql=2,Tf=3;function vp(B,ge){for(var Be=0;Be<B.length;++Be)if(B[Be]===ge)return Be;return-1}function Od(B){var ge=ye(B);if(!ge)return null;var Be=ge.gl,kt=Be.getContextAttributes(),ur=Be.isContextLost(),Dt=Pe(Be,ge);if(!Dt)return null;var er=ys(),hr=Id(),gr=Dt.extensions,xr=Qp(Be,gr),wr=oo(),Ir=Be.drawingBufferWidth,Gr=Be.drawingBufferHeight,_r={tick:0,time:0,viewportWidth:Ir,viewportHeight:Gr,framebufferWidth:Ir,framebufferHeight:Gr,drawingBufferWidth:Ir,drawingBufferHeight:Gr,pixelRatio:ge.pixelRatio},Tr={},st={elements:null,primitive:4,count:-1,offset:0,instances:-1},jt=Pl(Be,gr),br=F(Be,hr,ge,Lr),fr=dl(Be,gr,br,hr),ar=xt(Be,gr,jt,hr,br,fr,st);function Lr(ri){return ar.destroyBuffer(ri)}var $r=Br(Be,er,hr,ge),zn=hs(Be,gr,jt,function(){Sn.procs.poll()},_r,hr,ge),tr=yl(Be,gr,jt,hr,ge),ir=Re(Be,gr,jt,zn,tr,hr),Sn=qp(Be,er,gr,jt,br,fr,zn,ir,Tr,ar,$r,st,_r,xr,ge),Vr=Rn(Be,ir,Sn.procs.poll,_r,kt,gr,jt),Sr=Sn.next,qr=Be.canvas,Nr=[],ci=[],ei=[],Wr=[ge.onDestroy],Qr=null;function $n(){if(Nr.length===0){xr&&xr.update(),Qr=null;return}Qr=Li.next($n),mo();for(var ri=Nr.length-1;ri>=0;--ri){var zi=Nr[ri];zi&&zi(_r,null,0)}Be.flush(),xr&&xr.update()}function ui(){!Qr&&Nr.length>0&&(Qr=Li.next($n))}function Bi(){Qr&&(Li.cancel($n),Qr=null)}function uo(ri){ri.preventDefault(),ur=!0,Bi(),ci.forEach(function(zi){zi()})}function vo(ri){Be.getError(),ur=!1,Dt.restore(),$r.restore(),br.restore(),zn.restore(),tr.restore(),ir.restore(),ar.restore(),xr&&xr.restore(),Sn.procs.refresh(),ui(),ei.forEach(function(zi){zi()})}var Ni=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Ni&&qr&&(qr.addEventListener(Jc,uo,!1),qr.addEventListener(La,vo,!1));function ss(){Nr.length=0,Bi(),!Ni&&qr&&(qr.removeEventListener(Jc,uo),qr.removeEventListener(La,vo)),$r.clear(),ir.clear(),tr.clear(),ar.clear(),zn.clear(),fr.clear(),br.clear(),xr&&xr.clear(),Wr.forEach(function(ri){ri()})}function Ka(ri){me(!!ri,"invalid args to regl({...})"),me.type(ri,"object","invalid args to regl({...})");function zi(Ye){var Fe=m({},Ye);delete Fe.uniforms,delete Fe.attributes,delete Fe.context,delete Fe.vao,"stencil"in Fe&&Fe.stencil.op&&(Fe.stencil.opBack=Fe.stencil.opFront=Fe.stencil.op,delete Fe.stencil.op);function nt(_e){if(_e in Fe){var ze=Fe[_e];delete Fe[_e],Object.keys(ze).forEach(function(Ae){Fe[_e+"."+Ae]=ze[Ae]})}}return nt("blend"),nt("depth"),nt("cull"),nt("stencil"),nt("polygonOffset"),nt("scissor"),nt("sample"),"vao"in Ye&&(Fe.vao=Ye.vao),Fe}function _a(Ye,Fe){var nt={},_e={};return Object.keys(Ye).forEach(function(ze){var Ae=Ye[ze];if(cn.isDynamic(Ae)){_e[ze]=cn.unbox(Ae,ze);return}else if(Fe&&Array.isArray(Ae)){for(var lt=0;lt<Ae.length;++lt)if(cn.isDynamic(Ae[lt])){_e[ze]=cn.unbox(Ae,ze);return}}nt[ze]=Ae}),{dynamic:_e,static:nt}}var bo=_a(ri.context||{},!0),wl=_a(ri.uniforms||{},!0),Te=_a(ri.attributes||{},!1),Ut=_a(zi(ri),!1),At={gpuTime:0,cpuTime:0,count:0},mn=Sn.compile(Ut,Te,wl,bo,At),Vi=mn.draw,Se=mn.batch,oe=mn.scope,Ve=[];function ct(Ye){for(;Ve.length<Ye;)Ve.push(null);return Ve}function Rt(Ye,Fe){var nt;if(ur&&me.raise("context lost"),typeof Ye=="function")return oe.call(this,null,Ye,0);if(typeof Fe=="function")if(typeof Ye=="number")for(nt=0;nt<Ye;++nt)oe.call(this,null,Fe,nt);else if(Array.isArray(Ye))for(nt=0;nt<Ye.length;++nt)oe.call(this,Ye[nt],Fe,nt);else return oe.call(this,Ye,Fe,0);else if(typeof Ye=="number"){if(Ye>0)return Se.call(this,ct(Ye|0),Ye|0)}else if(Array.isArray(Ye)){if(Ye.length)return Se.call(this,Ye,Ye.length)}else return Vi.call(this,Ye)}return m(Rt,{stats:At,destroy:function(){mn.destroy()}})}var Ho=ir.setFBO=Ka({framebuffer:cn.define.call(null,dp,"framebuffer")});function wo(ri,zi){var _a=0;Sn.procs.poll();var bo=zi.color;bo&&(Be.clearColor(+bo[0]||0,+bo[1]||0,+bo[2]||0,+bo[3]||0),_a|=Jp),"depth"in zi&&(Be.clearDepth(+zi.depth),_a|=sh),"stencil"in zi&&(Be.clearStencil(zi.stencil|0),_a|=hp),me(!!_a,"called regl.clear with no buffer specified"),Be.clear(_a)}function Qo(ri){if(me(typeof ri=="object"&&ri,"regl.clear() takes an object as input"),"framebuffer"in ri)if(ri.framebuffer&&ri.framebuffer_reglType==="framebufferCube")for(var zi=0;zi<6;++zi)Ho(m({framebuffer:ri.framebuffer.faces[zi]},ri),wo);else Ho(ri,wo);else wo(null,ri)}function Bo(ri){me.type(ri,"function","regl.frame() callback must be a function"),Nr.push(ri);function zi(){var _a=vp(Nr,ri);me(_a>=0,"cannot cancel a frame twice");function bo(){var wl=vp(Nr,bo);Nr[wl]=Nr[Nr.length-1],Nr.length-=1,Nr.length<=0&&Bi()}Nr[_a]=bo}return ui(),{cancel:zi}}function ms(){var ri=Sr.viewport,zi=Sr.scissor_box;ri[0]=ri[1]=zi[0]=zi[1]=0,_r.viewportWidth=_r.framebufferWidth=_r.drawingBufferWidth=ri[2]=zi[2]=Be.drawingBufferWidth,_r.viewportHeight=_r.framebufferHeight=_r.drawingBufferHeight=ri[3]=zi[3]=Be.drawingBufferHeight}function mo(){_r.tick+=1,_r.time=Wo(),ms(),Sn.procs.poll()}function xi(){zn.refresh(),ms(),Sn.procs.refresh(),xr&&xr.update()}function Wo(){return(oo()-wr)/1e3}xi();function na(ri,zi){me.type(zi,"function","listener callback must be a function");var _a;switch(ri){case"frame":return Bo(zi);case"lost":_a=ci;break;case"restore":_a=ei;break;case"destroy":_a=Wr;break;default:me.raise("invalid event, must be one of frame,lost,restore,destroy")}return _a.push(zi),{cancel:function(){for(var bo=0;bo<_a.length;++bo)if(_a[bo]===zi){_a[bo]=_a[_a.length-1],_a.pop();return}}}}var Jo=m(Ka,{clear:Qo,prop:cn.define.bind(null,dp),context:cn.define.bind(null,ql),this:cn.define.bind(null,Tf),draw:Ka({}),buffer:function(ri){return br.create(ri,pp,!1,!1)},elements:function(ri){return fr.create(ri,!1)},texture:zn.create2D,cube:zn.createCube,renderbuffer:tr.create,framebuffer:ir.create,framebufferCube:ir.createCube,vao:ar.createVAO,attributes:kt,frame:Bo,on:na,limits:jt,hasExtension:function(ri){return jt.extensions.indexOf(ri.toLowerCase())>=0},read:Vr,destroy:ss,_gl:Be,_refresh:xi,poll:function(){mo(),xr&&xr.update()},now:Wo,stats:hr});return ge.onDone(null,Jo),Jo}return Od})},77412:function(It){function $(z,ie){for(var re=-1,m=z==null?0:z.length;++re<m&&ie(z[re],re,z)!==!1;);return z}It.exports=$},47443:function(It,$,z){var ie=z(42118);function re(m,de){var Z=m==null?0:m.length;return!!Z&&ie(m,de,0)>-1}It.exports=re},1196:function(It){function $(z,ie,re){for(var m=-1,de=z==null?0:z.length;++m<de;)if(re(ie,z[m]))return!0;return!1}It.exports=$},62663:function(It){function $(z,ie,re,m){var de=-1,Z=z==null?0:z.length;for(m&&Z&&(re=z[++de]);++de<Z;)re=ie(re,z[de],de,z);return re}It.exports=$},49029:function(It){var $=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function z(ie){return ie.match($)||[]}It.exports=z},44037:function(It,$,z){var ie=z(98363),re=z(3674);function m(de,Z){return de&&ie(Z,re(Z),de)}It.exports=m},63886:function(It,$,z){var ie=z(98363),re=z(81704);function m(de,Z){return de&&ie(Z,re(Z),de)}It.exports=m},29750:function(It){function $(z,ie,re){return z===z&&(re!==void 0&&(z=z<=re?z:re),ie!==void 0&&(z=z>=ie?z:ie)),z}It.exports=$},85990:function(It,$,z){var ie=z(46384),re=z(77412),m=z(34865),de=z(44037),Z=z(63886),ce=z(64626),fe=z(278),Le=z(18805),J=z(1911),Xe=z(58234),et=z(46904),Ze=z(64160),yt=z(43824),rr=z(29148),bt=z(38517),Xt=z(1469),Ct=z(44144),at=z(56688),it=z(13218),Vt=z(72928),q=z(3674),$t=z(81704),ft=1,Je=2,wt=4,Qe="[object Arguments]",Qt="[object Array]",Er="[object Boolean]",Fr="[object Date]",Jr="[object Error]",A="[object Function]",Ce="[object GeneratorFunction]",De="[object Map]",Tt="[object Number]",gt="[object Object]",Bt="[object RegExp]",Kt="[object Set]",Cr="[object String]",Qn="[object Symbol]",vn="[object WeakMap]",fi="[object ArrayBuffer]",Gn="[object DataView]",ii="[object Float32Array]",hi="[object Float64Array]",Wn="[object Int8Array]",pi="[object Int16Array]",la="[object Int32Array]",Gi="[object Uint8Array]",Oi="[object Uint8ClampedArray]",$i="[object Uint16Array]",ca="[object Uint32Array]",wi={};wi[Qe]=wi[Qt]=wi[fi]=wi[Gn]=wi[Er]=wi[Fr]=wi[ii]=wi[hi]=wi[Wn]=wi[pi]=wi[la]=wi[De]=wi[Tt]=wi[gt]=wi[Bt]=wi[Kt]=wi[Cr]=wi[Qn]=wi[Gi]=wi[Oi]=wi[$i]=wi[ca]=!0,wi[Jr]=wi[A]=wi[vn]=!1;function xa(qn,Ci,Zi,Qi,Zo,me){var Dn,Xa=Ci&ft,cs=Ci&Je,Nt=Ci&wt;if(Zi&&(Dn=Zo?Zi(qn,Qi,Zo,me):Zi(qn)),Dn!==void 0)return Dn;if(!it(qn))return qn;var nr=Xt(qn);if(nr){if(Dn=yt(qn),!Xa)return fe(qn,Dn)}else{var Ar=Ze(qn),en=Ar==A||Ar==Ce;if(Ct(qn))return ce(qn,Xa);if(Ar==gt||Ar==Qe||en&&!Zo){if(Dn=cs||en?{}:bt(qn),!Xa)return cs?J(qn,Z(Dn,qn)):Le(qn,de(Dn,qn))}else{if(!wi[Ar])return Zo?qn:{};Dn=rr(qn,Ar,Xa)}}me||(me=new ie);var wn=me.get(qn);if(wn)return wn;me.set(qn,Dn),Vt(qn)?qn.forEach(function(Jn){Dn.add(xa(Jn,Ci,Zi,Jn,qn,me))}):at(qn)&&qn.forEach(function(Jn,cn){Dn.set(cn,xa(Jn,Ci,Zi,cn,qn,me))});var Bn=Nt?cs?et:Xe:cs?$t:q,di=nr?void 0:Bn(qn);return re(di||qn,function(Jn,cn){di&&(cn=Jn,Jn=qn[cn]),m(Dn,cn,xa(Jn,Ci,Zi,cn,qn,me))}),Dn}It.exports=xa},41848:function(It){function $(z,ie,re,m){for(var de=z.length,Z=re+(m?1:-1);m?Z--:++Z<de;)if(ie(z[Z],Z,z))return Z;return-1}It.exports=$},42118:function(It,$,z){var ie=z(41848),re=z(62722),m=z(42351);function de(Z,ce,fe){return ce===ce?m(Z,ce,fe):ie(Z,re,fe)}It.exports=de},25588:function(It,$,z){var ie=z(64160),re=z(37005),m="[object Map]";function de(Z){return re(Z)&&ie(Z)==m}It.exports=de},62722:function(It){function $(z){return z!==z}It.exports=$},29221:function(It,$,z){var ie=z(64160),re=z(37005),m="[object Set]";function de(Z){return re(Z)&&ie(Z)==m}It.exports=de},40371:function(It){function $(z){return function(ie){return ie==null?void 0:ie[z]}}It.exports=$},18674:function(It){function $(z){return function(ie){return z==null?void 0:z[ie]}}It.exports=$},45652:function(It,$,z){var ie=z(88668),re=z(47443),m=z(1196),de=z(74757),Z=z(23593),ce=z(21814),fe=200;function Le(J,Xe,et){var Ze=-1,yt=re,rr=J.length,bt=!0,Xt=[],Ct=Xt;if(et)bt=!1,yt=m;else if(rr>=fe){var at=Xe?null:Z(J);if(at)return ce(at);bt=!1,yt=de,Ct=new ie}else Ct=Xe?[]:Xt;e:for(;++Ze<rr;){var it=J[Ze],Vt=Xe?Xe(it):it;if(it=et||it!==0?it:0,bt&&Vt===Vt){for(var q=Ct.length;q--;)if(Ct[q]===Vt)continue e;Xe&&Ct.push(Vt),Xt.push(it)}else yt(Ct,Vt,et)||(Ct!==Xt&&Ct.push(Vt),Xt.push(it))}return Xt}It.exports=Le},57157:function(It,$,z){var ie=z(74318);function re(m,de){var Z=de?ie(m.buffer):m.buffer;return new m.constructor(Z,m.byteOffset,m.byteLength)}It.exports=re},93147:function(It){var $=/\w*$/;function z(ie){var re=new ie.constructor(ie.source,$.exec(ie));return re.lastIndex=ie.lastIndex,re}It.exports=z},40419:function(It,$,z){var ie=z(62705),re=ie?ie.prototype:void 0,m=re?re.valueOf:void 0;function de(Z){return m?Object(m.call(Z)):{}}It.exports=de},18805:function(It,$,z){var ie=z(98363),re=z(99551);function m(de,Z){return ie(de,re(de),Z)}It.exports=m},1911:function(It,$,z){var ie=z(98363),re=z(51442);function m(de,Z){return ie(de,re(de),Z)}It.exports=m},98805:function(It,$,z){var ie=z(40180),re=z(62689),m=z(83140),de=z(79833);function Z(ce){return function(fe){fe=de(fe);var Le=re(fe)?m(fe):void 0,J=Le?Le[0]:fe.charAt(0),Xe=Le?ie(Le,1).join(""):fe.slice(1);return J[ce]()+Xe}}It.exports=Z},35393:function(It,$,z){var ie=z(62663),re=z(53816),m=z(58748),de="['\u2019]",Z=RegExp(de,"g");function ce(fe){return function(Le){return ie(m(re(Le).replace(Z,"")),fe,"")}}It.exports=ce},23593:function(It,$,z){var ie=z(58525),re=z(50308),m=z(21814),de=1/0,Z=ie&&1/m(new ie([,-0]))[1]==de?function(ce){return new ie(ce)}:re;It.exports=Z},69389:function(It,$,z){var ie=z(18674),re={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},m=ie(re);It.exports=m},46904:function(It,$,z){var ie=z(68866),re=z(51442),m=z(81704);function de(Z){return ie(Z,m,re)}It.exports=de},51442:function(It,$,z){var ie=z(62488),re=z(85924),m=z(99551),de=z(70479),Z=Object.getOwnPropertySymbols,ce=Z?function(fe){for(var Le=[];fe;)ie(Le,m(fe)),fe=re(fe);return Le}:de;It.exports=ce},93157:function(It){var $=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function z(ie){return $.test(ie)}It.exports=z},43824:function(It){var $=Object.prototype,z=$.hasOwnProperty;function ie(re){var m=re.length,de=new re.constructor(m);return m&&typeof re[0]=="string"&&z.call(re,"index")&&(de.index=re.index,de.input=re.input),de}It.exports=ie},29148:function(It,$,z){var ie=z(74318),re=z(57157),m=z(93147),de=z(40419),Z=z(77133),ce="[object Boolean]",fe="[object Date]",Le="[object Map]",J="[object Number]",Xe="[object RegExp]",et="[object Set]",Ze="[object String]",yt="[object Symbol]",rr="[object ArrayBuffer]",bt="[object DataView]",Xt="[object Float32Array]",Ct="[object Float64Array]",at="[object Int8Array]",it="[object Int16Array]",Vt="[object Int32Array]",q="[object Uint8Array]",$t="[object Uint8ClampedArray]",ft="[object Uint16Array]",Je="[object Uint32Array]";function wt(Qe,Qt,Er){var Fr=Qe.constructor;switch(Qt){case rr:return ie(Qe);case ce:case fe:return new Fr(+Qe);case bt:return re(Qe,Er);case Xt:case Ct:case at:case it:case Vt:case q:case $t:case ft:case Je:return Z(Qe,Er);case Le:return new Fr;case J:case Ze:return new Fr(Qe);case Xe:return m(Qe);case et:return new Fr;case yt:return de(Qe)}}It.exports=wt},42351:function(It){function $(z,ie,re){for(var m=re-1,de=z.length;++m<de;)if(z[m]===ie)return m;return-1}It.exports=$},2757:function(It){var $="\\ud800-\\udfff",z="\\u0300-\\u036f",ie="\\ufe20-\\ufe2f",re="\\u20d0-\\u20ff",m=z+ie+re,de="\\u2700-\\u27bf",Z="a-z\\xdf-\\xf6\\xf8-\\xff",ce="\\xac\\xb1\\xd7\\xf7",fe="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Le="\\u2000-\\u206f",J=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Xe="A-Z\\xc0-\\xd6\\xd8-\\xde",et="\\ufe0e\\ufe0f",Ze=ce+fe+Le+J,yt="['\u2019]",rr="["+Ze+"]",bt="["+m+"]",Xt="\\d+",Ct="["+de+"]",at="["+Z+"]",it="[^"+$+Ze+Xt+de+Z+Xe+"]",Vt="\\ud83c[\\udffb-\\udfff]",q="(?:"+bt+"|"+Vt+")",$t="[^"+$+"]",ft="(?:\\ud83c[\\udde6-\\uddff]){2}",Je="[\\ud800-\\udbff][\\udc00-\\udfff]",wt="["+Xe+"]",Qe="\\u200d",Qt="(?:"+at+"|"+it+")",Er="(?:"+wt+"|"+it+")",Fr="(?:"+yt+"(?:d|ll|m|re|s|t|ve))?",Jr="(?:"+yt+"(?:D|LL|M|RE|S|T|VE))?",A=q+"?",Ce="["+et+"]?",De="(?:"+Qe+"(?:"+[$t,ft,Je].join("|")+")"+Ce+A+")*",Tt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",gt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Bt=Ce+A+De,Kt="(?:"+[Ct,ft,Je].join("|")+")"+Bt,Cr=RegExp([wt+"?"+at+"+"+Fr+"(?="+[rr,wt,"$"].join("|")+")",Er+"+"+Jr+"(?="+[rr,wt+Qt,"$"].join("|")+")",wt+"?"+Qt+"+"+Fr,wt+"+"+Jr,gt,Tt,Xt,Kt].join("|"),"g");function Qn(vn){return vn.match(Cr)||[]}It.exports=Qn},68929:function(It,$,z){var ie=z(48403),re=z(35393),m=re(function(de,Z,ce){return Z=Z.toLowerCase(),de+(ce?ie(Z):Z)});It.exports=m},48403:function(It,$,z){var ie=z(79833),re=z(11700);function m(de){return re(ie(de).toLowerCase())}It.exports=m},74691:function(It,$,z){var ie=z(29750),re=z(14841);function m(de,Z,ce){return ce===void 0&&(ce=Z,Z=void 0),ce!==void 0&&(ce=re(ce),ce=ce===ce?ce:0),Z!==void 0&&(Z=re(Z),Z=Z===Z?Z:0),ie(re(de),Z,ce)}It.exports=m},50361:function(It,$,z){var ie=z(85990),re=1,m=4;function de(Z){return ie(Z,re|m)}It.exports=de},53816:function(It,$,z){var ie=z(69389),re=z(79833),m=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,de="\\u0300-\\u036f",Z="\\ufe20-\\ufe2f",ce="\\u20d0-\\u20ff",fe=de+Z+ce,Le="["+fe+"]",J=RegExp(Le,"g");function Xe(et){return et=re(et),et&&et.replace(m,ie).replace(J,"")}It.exports=Xe},56688:function(It,$,z){var ie=z(25588),re=z(7518),m=z(31167),de=m&&m.isMap,Z=de?re(de):ie;It.exports=Z},14293:function(It){function $(z){return z==null}It.exports=$},81763:function(It,$,z){var ie=z(44239),re=z(37005),m="[object Number]";function de(Z){return typeof Z=="number"||re(Z)&&ie(Z)==m}It.exports=de},72928:function(It,$,z){var ie=z(29221),re=z(7518),m=z(31167),de=m&&m.isSet,Z=de?re(de):ie;It.exports=Z},47037:function(It,$,z){var ie=z(44239),re=z(1469),m=z(37005),de="[object String]";function Z(ce){return typeof ce=="string"||!re(ce)&&m(ce)&&ie(ce)==de}It.exports=Z},52353:function(It){function $(z){return z===void 0}It.exports=$},30236:function(It,$,z){var ie=z(42980),re=z(21463),m=re(function(de,Z,ce,fe){ie(de,Z,ce,fe)});It.exports=m},50308:function(It){function $(){}It.exports=$},44908:function(It,$,z){var ie=z(45652);function re(m){return m&&m.length?ie(m):[]}It.exports=re},11700:function(It,$,z){var ie=z(98805),re=ie("toUpperCase");It.exports=re},58748:function(It,$,z){var ie=z(49029),re=z(93157),m=z(79833),de=z(2757);function Z(ce,fe,Le){return ce=m(ce),fe=Le?void 0:fe,fe===void 0?re(ce)?de(ce):ie(ce):ce.match(fe)||[]}It.exports=Z},6158:function(It){(function($,z){It.exports=z()})(this,function(){"use strict";var $,z,ie;function re(m,de){if(!$)$=de;else if(!z)z=de;else{var Z="var sharedChunk = {}; ("+$+")(sharedChunk); ("+z+")(sharedChunk);",ce={};$(ce),ie=de(ce),typeof window!="undefined"&&(ie.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}return re(["exports"],function(m){"use strict";function de(t,o){return t(o={exports:{}},o.exports),o.exports}var Z=ce;function ce(t,o,u,p){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=p,this.p2x=u,this.p2y=p}ce.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},ce.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},ce.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},ce.prototype.solveCurveX=function(t,o){var u,p,y,b,S;for(o===void 0&&(o=1e-6),y=t,S=0;S<8;S++){if(b=this.sampleCurveX(y)-t,Math.abs(b)<o)return y;var I=this.sampleCurveDerivativeX(y);if(Math.abs(I)<1e-6)break;y-=b/I}if((y=t)<(u=0))return u;if(y>(p=1))return p;for(;u<p;){if(b=this.sampleCurveX(y),Math.abs(b-t)<o)return y;t>b?u=y:p=y,y=.5*(p-u)+u}return y},ce.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var fe=Le;function Le(t,o){this.x=t,this.y=o}Le.prototype={clone:function(){return new Le(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),p=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=p,this},_rotateAround:function(t,o){var u=Math.cos(t),p=Math.sin(t),y=o.y+p*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-p*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Le.convert=function(t){return t instanceof Le?t:Array.isArray(t)?new Le(t[0],t[1]):t};var J=typeof self!="undefined"?self:{},Xe=Math.pow(2,53)-1;function et(t,o,u,p){var y=new Z(t,o,u,p);return function(b){return y.solve(b)}}var Ze=et(.25,.1,.25,1);function yt(t,o,u){return Math.min(u,Math.max(o,t))}function rr(t,o,u){var p=u-o,y=((t-o)%p+p)%p+o;return y===o?u:y}function bt(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,y=o;p<y.length;p+=1){var b=y[p];for(var S in b)t[S]=b[S]}return t}var Xt=1;function Ct(){return Xt++}function at(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function it(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Vt(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function q(t,o){return t.indexOf(o,t.length-o.length)!==-1}function $t(t,o,u){var p={};for(var y in t)p[y]=o.call(u||this,t[y],y,t);return p}function ft(t,o,u){var p={};for(var y in t)o.call(u||this,t[y],y,t)&&(p[y]=t[y]);return p}function Je(t){return Array.isArray(t)?t.map(Je):typeof t=="object"&&t?$t(t,Je):t}var wt={};function Qe(t){wt[t]||(typeof console!="undefined"&&console.warn(t),wt[t]=!0)}function Qt(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function Er(t){for(var o=0,u=0,p=t.length,y=p-1,b=void 0,S=void 0;u<p;y=u++)o+=((S=t[y]).x-(b=t[u]).x)*(b.y+S.y);return o}function Fr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Jr(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,y,b,S){var I=b||S;return o[y]=!I||I.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var A=null;function Ce(t){if(A==null){var o=t.navigator?t.navigator.userAgent:null;A=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return A}function De(t){try{var o=J[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var Tt,gt,Bt,Kt,Cr=J.performance&&J.performance.now?J.performance.now.bind(J.performance):Date.now.bind(Date),Qn=J.requestAnimationFrame||J.mozRequestAnimationFrame||J.webkitRequestAnimationFrame||J.msRequestAnimationFrame,vn=J.cancelAnimationFrame||J.mozCancelAnimationFrame||J.webkitCancelAnimationFrame||J.msCancelAnimationFrame,fi={now:Cr,frame:function(t){var o=Qn(t);return{cancel:function(){return vn(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=J.document.createElement("canvas"),p=u.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,p.drawImage(t,0,0,t.width,t.height),p.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return Tt||(Tt=J.document.createElement("a")),Tt.href=t,Tt.href},hardwareConcurrency:J.navigator&&J.navigator.hardwareConcurrency||4,get devicePixelRatio(){return J.devicePixelRatio},get prefersReducedMotion(){return!!J.matchMedia&&(gt==null&&(gt=J.matchMedia("(prefers-reduced-motion: reduce)")),gt.matches)}},Gn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ii={supported:!1,testSupport:function(t){!hi&&Kt&&(Wn?pi(t):Bt=t)}},hi=!1,Wn=!1;function pi(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Kt),t.isContextLost())return;ii.supported=!0}catch(u){}t.deleteTexture(o),hi=!0}J.document&&((Kt=J.document.createElement("img")).onload=function(){Bt&&pi(Bt),Bt=null,Wn=!0},Kt.onerror=function(){hi=!0,Bt=null},Kt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var la="01",Gi=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Oi(t){return t.indexOf("mapbox:")===0}Gi.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",la,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Gi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Gi.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},Gi.prototype.normalizeStyleURL=function(t,o){if(!Oi(t))return t;var u=xa(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Gi.prototype.normalizeGlyphsURL=function(t,o){if(!Oi(t))return t;var u=xa(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Gi.prototype.normalizeSourceURL=function(t,o){if(!Oi(t))return t;var u=xa(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Gi.prototype.normalizeSpriteURL=function(t,o,u,p){var y=xa(t);return Oi(t)?(y.path="/styles/v1"+y.path+"/sprite"+o+u,this._makeAPIURL(y,this._customAccessToken||p)):(y.path+=""+o+u,qn(y))},Gi.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Oi(t))return t;var u=xa(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(fi.devicePixelRatio>=2||o===512?"@2x":"")+(ii.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var p=this._customAccessToken||function(y){for(var b=0,S=y;b<S.length;b+=1){var I=S[b].match(/^access_token=(.*)$/);if(I)return I[1]}return null}(u.params)||Gn.ACCESS_TOKEN;return Gn.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,p)},Gi.prototype.canonicalizeTileURL=function(t,o){var u=xa(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var p="mapbox://tiles/";p+=u.path.replace("/v4/","");var y=u.params;return o&&(y=y.filter(function(b){return!b.match(/^access_token=/)})),y.length&&(p+="?"+y.join("&")),p},Gi.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Oi(o),p=[],y=0,b=t.tiles||[];y<b.length;y+=1){var S=b[y];ca(S)?p.push(this.canonicalizeTileURL(S,u)):p.push(S)}return p},Gi.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=xa(Gn.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){var y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(p.path!=="/"&&(t.path=""+p.path+t.path),!Gn.REQUIRE_ACCESS_TOKEN)return qn(t);if(!(o=o||Gn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),qn(t)};var $i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ca(t){return $i.test(t)}var wi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xa(t){var o=t.match(wi);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function qn(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function Ci(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(J.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var Zi=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Zi.prototype.getStorageKey=function(t){var o,u=Ci(Gn.ACCESS_TOKEN);return o=u&&u.u?J.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(p,y){return String.fromCharCode(Number("0x"+y))})):Gn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},Zi.prototype.fetchEventData=function(){var t=De("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var p=J.localStorage.getItem(o);p&&(this.eventData=JSON.parse(p));var y=J.localStorage.getItem(u);y&&(this.anonId=y)}catch(b){Qe("Unable to read from LocalStorage")}},Zi.prototype.saveEventData=function(){var t=De("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{J.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&J.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(p){Qe("Unable to write to LocalStorage")}},Zi.prototype.processRequests=function(t){},Zi.prototype.postEvent=function(t,o,u,p){var y=this;if(Gn.EVENTS_URL){var b=xa(Gn.EVENTS_URL);b.params.push("access_token="+(p||Gn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:la,userId:this.anonId},I=o?bt(S,o):S,D={url:qn(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=Aa(D,function(N){y.pendingRequest=null,u(N),y.saveEventData(),y.processRequests(p)})}},Zi.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var Qi,Zo,me=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,p,y,b){this.skuToken=y,(Gn.EVENTS_URL&&b||Gn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return Oi(S)||ca(S)}))&&this.queueRequest({id:p,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),b=y.id,S=y.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),it(this.anonId)||(this.anonId=at()),this.postEvent(S,{skuToken:this.skuToken},function(I){I||b&&(p.success[b]=!0)},u))}},o}(Zi),Dn=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,p){Gn.EVENTS_URL&&Gn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return Oi(y)||ca(y)})&&this.queueRequest(Date.now(),p)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=Ci(Gn.ACCESS_TOKEN),b=y?y.u:Gn.ACCESS_TOKEN,S=b!==this.eventData.tokenU;it(this.anonId)||(this.anonId=at(),S=!0);var I=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),N=new Date(I),V=(I-this.eventData.lastSuccess)/864e5;S=S||V>=1||V<-1||D.getDate()!==N.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(I,{"enabled.telemetry":!1},function(W){W||(p.eventData.lastSuccess=I,p.eventData.tokenU=b)},u)}},o}(Zi)),Xa=Dn.postTurnstileEvent.bind(Dn),cs=new me,Nt=cs.postMapLoadEvent.bind(cs),nr=500,Ar=50;function en(){J.caches&&!Qi&&(Qi=J.caches.open("mapbox-tiles"))}function wn(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var Bn,di=1/0;function Jn(){return Bn==null&&(Bn=J.OffscreenCanvas&&new J.OffscreenCanvas(1,1).getContext("2d")&&typeof J.createImageBitmap=="function"),Bn}var cn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(cn);var Li=function(t){function o(u,p,y){p===401&&ca(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=p,this.url=y,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Ri=Fr()?function(){return self.worker&&self.worker.referrer}:function(){return(J.location.protocol==="blob:"?J.parent:J).location.href},oo,ys,Yo=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Ri())&&!/^\w+:/.test(u))){if(J.fetch&&J.Request&&J.AbortController&&J.Request.prototype.hasOwnProperty("signal"))return function(p,y){var b,S=new J.AbortController,I=new J.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:Ri(),signal:S.signal}),D=!1,N=!1,V=(b=I.url).indexOf("sku=")>0&&ca(b);p.type==="json"&&I.headers.set("Accept","application/json");var W=function(se,Me,Oe){if(!N){if(se&&se.message!=="SecurityError"&&Qe(se),Me&&Oe)return ee(Me);var qe=Date.now();J.fetch(I).then(function(Ue){if(Ue.ok){var ut=V?Ue.clone():null;return ee(Ue,ut,qe)}return y(new Li(Ue.statusText,Ue.status,p.url))}).catch(function(Ue){Ue.code!==20&&y(new Error(Ue.message))})}},ee=function(se,Me,Oe){(p.type==="arrayBuffer"?se.arrayBuffer():p.type==="json"?se.json():se.text()).then(function(qe){N||(Me&&Oe&&function(Ue,ut,Mt){if(en(),Qi){var Gt={status:ut.status,statusText:ut.statusText,headers:new J.Headers};ut.headers.forEach(function(lr,Or){return Gt.headers.set(Or,lr)});var Wt=Jr(ut.headers.get("Cache-Control")||"");Wt["no-store"]||(Wt["max-age"]&&Gt.headers.set("Expires",new Date(Mt+1e3*Wt["max-age"]).toUTCString()),new Date(Gt.headers.get("Expires")).getTime()-Mt<42e4||function(lr,Or){if(Zo===void 0)try{new Response(new ReadableStream),Zo=!0}catch(Kr){Zo=!1}Zo?Or(lr.body):lr.blob().then(Or)}(ut,function(lr){var Or=new J.Response(lr,Gt);en(),Qi&&Qi.then(function(Kr){return Kr.put(wn(Ue.url),Or)}).catch(function(Kr){return Qe(Kr.message)})}))}}(I,Me,Oe),D=!0,y(null,qe,se.headers.get("Cache-Control"),se.headers.get("Expires")))}).catch(function(qe){N||y(new Error(qe.message))})};return V?function(se,Me){if(en(),!Qi)return Me(null);var Oe=wn(se.url);Qi.then(function(qe){qe.match(Oe).then(function(Ue){var ut=function(Mt){if(!Mt)return!1;var Gt=new Date(Mt.headers.get("Expires")||0),Wt=Jr(Mt.headers.get("Cache-Control")||"");return Gt>Date.now()&&!Wt["no-cache"]}(Ue);qe.delete(Oe),ut&&qe.put(Oe,Ue.clone()),Me(null,Ue,ut)}).catch(Me)}).catch(Me)}(I,W):W(null,null),{cancel:function(){N=!0,D||S.abort()}}}(t,o);if(Fr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(p,y){var b=new J.XMLHttpRequest;for(var S in b.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(b.responseType="arraybuffer"),p.headers)b.setRequestHeader(S,p.headers[S]);return p.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=p.credentials==="include",b.onerror=function(){y(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var I=b.response;if(p.type==="json")try{I=JSON.parse(b.response)}catch(D){return y(D)}y(null,I,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else y(new Li(b.statusText,b.status,p.url))},b.send(p.body),{cancel:function(){return b.abort()}}}(t,o)},Va=function(t,o){return Yo(bt(t,{type:"arrayBuffer"}),o)},Aa=function(t,o){return Yo(bt(t,{method:"POST"}),o)},H="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";oo=[],ys=0;var Q=function(t,o){if(ii.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ys>=Gn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return oo.push(u),u}ys++;var p=!1,y=function(){if(!p)for(p=!0,ys--;oo.length&&ys<Gn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=oo.shift();S.cancelled||(S.cancel=Q(S.requestParameters,S.callback).cancel)}},b=Va(t,function(S,I,D,N){y(),S?o(S):I&&(Jn()?function(V,W){var ee=new J.Blob([new Uint8Array(V)],{type:"image/png"});J.createImageBitmap(ee).then(function(se){W(null,se)}).catch(function(se){W(new Error("Could not load image because of "+se.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(I,o):function(V,W,ee,se){var Me=new J.Image,Oe=J.URL;Me.onload=function(){W(null,Me),Oe.revokeObjectURL(Me.src),Me.onload=null,J.requestAnimationFrame(function(){Me.src=H})},Me.onerror=function(){return W(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var qe=new J.Blob([new Uint8Array(V)],{type:"image/png"});Me.cacheControl=ee,Me.expires=se,Me.src=V.byteLength?Oe.createObjectURL(qe):H}(I,o,D,N))});return{cancel:function(){b.cancel(),y()}}};function ae(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function ye(t,o,u){if(u&&u[t]){var p=u[t].indexOf(o);p!==-1&&u[t].splice(p,1)}}var Pe=function(t,o){o===void 0&&(o={}),bt(this,o),this.type=t},He=function(t){function o(u,p){p===void 0&&(p={}),t.call(this,"error",bt({error:u},p))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Pe),rt=function(){};rt.prototype.on=function(t,o){return this._listeners=this._listeners||{},ae(t,o,this._listeners),this},rt.prototype.off=function(t,o){return ye(t,o,this._listeners),ye(t,o,this._oneTimeListeners),this},rt.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},ae(t,o,this._oneTimeListeners),this},rt.prototype.fire=function(t,o){typeof t=="string"&&(t=new Pe(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var p=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];p<y.length;p+=1)y[p].call(this,t);for(var b=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<S.length;b+=1){var I=S[b];ye(u,I,this._oneTimeListeners),I.call(this,t)}var D=this._eventedParent;D&&(bt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(t))}else t instanceof He&&console.error(t.error);return this},rt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},rt.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var he={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},ke=function(t,o,u,p){this.message=(t?t+": ":"")+u,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)};function vt(t){var o=t.value;return o?[new ke(t.key,o,"constants have been deprecated as of v8")]:[]}function dr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,y=o;p<y.length;p+=1){var b=y[p];for(var S in b)t[S]=b[S]}return t}function Ft(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function zt(t){if(Array.isArray(t))return t.map(zt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=zt(t[u]);return o}return Ft(t)}var vr=function(t){function o(u,p){t.call(this,p),this.message=p,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),En=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,p=o;u<p.length;u+=1){var y=p[u];this.bindings[y[0]]=y[1]}};En.prototype.concat=function(t){return new En(this,t)},En.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},En.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var pn={kind:"null"},Ot={kind:"number"},tn={kind:"string"},Zr={kind:"boolean"},Hr={kind:"color"},gi={kind:"object"},rn={kind:"value"},nn={kind:"collator"},Wi={kind:"formatted"},vi={kind:"resolvedImage"};function Ti(t,o){return{kind:"array",itemType:t,N:o}}function _i(t){if(t.kind==="array"){var o=_i(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var ht=[pn,Ot,tn,Zr,Hr,Wi,gi,Ti(rn),vi];function Pt(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Pt(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,p=ht;u<p.length;u+=1)if(!Pt(p[u],o))return null}}return"Expected "+_i(t)+" but found "+_i(o)+" instead."}function Ma(t,o){return o.some(function(u){return u.kind===t.kind})}function Ai(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Mi=de(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(I){return(I=Math.round(I))<0?0:I>255?255:I}function y(I){return p(I[I.length-1]==="%"?parseFloat(I)/100*255:parseInt(I))}function b(I){return(D=I[I.length-1]==="%"?parseFloat(I)/100:parseFloat(I))<0?0:D>1?1:D;var D}function S(I,D,N){return N<0?N+=1:N>1&&(N-=1),6*N<1?I+(D-I)*N*6:2*N<1?D:3*N<2?I+(D-I)*(2/3-N)*6:I}try{o.parseCSSColor=function(I){var D,N=I.replace(/ /g,"").toLowerCase();if(N in u)return u[N].slice();if(N[0]==="#")return N.length===4?(D=parseInt(N.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:N.length===7&&(D=parseInt(N.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var V=N.indexOf("("),W=N.indexOf(")");if(V!==-1&&W+1===N.length){var ee=N.substr(0,V),se=N.substr(V+1,W-(V+1)).split(","),Me=1;switch(ee){case"rgba":if(se.length!==4)return null;Me=b(se.pop());case"rgb":return se.length!==3?null:[y(se[0]),y(se[1]),y(se[2]),Me];case"hsla":if(se.length!==4)return null;Me=b(se.pop());case"hsl":if(se.length!==3)return null;var Oe=(parseFloat(se[0])%360+360)%360/360,qe=b(se[1]),Ue=b(se[2]),ut=Ue<=.5?Ue*(qe+1):Ue+qe-Ue*qe,Mt=2*Ue-ut;return[p(255*S(Mt,ut,Oe+1/3)),p(255*S(Mt,ut,Oe)),p(255*S(Mt,ut,Oe-1/3)),Me];default:return null}}return null}}catch(I){}}).parseCSSColor,ji=function(t,o,u,p){p===void 0&&(p=1),this.r=t,this.g=o,this.b=u,this.a=p};ji.parse=function(t){if(t){if(t instanceof ji)return t;if(typeof t=="string"){var o=Mi(t);if(o)return new ji(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},ji.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],p=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+p+")"},ji.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},ji.black=new ji(0,0,0,1),ji.white=new ji(1,1,1,1),ji.transparent=new ji(0,0,0,0),ji.red=new ji(1,0,0,1);var Pr=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Pr.prototype.compare=function(t,o){return this.collator.compare(t,o)},Pr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var an=function(t,o,u,p,y){this.text=t,this.image=o,this.scale=u,this.fontStack=p,this.textColor=y},mt=function(t){this.sections=t};mt.fromString=function(t){return new mt([new an(t,null,null,null,null)])},mt.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},mt.factory=function(t){return t instanceof mt?t:mt.fromString(t)},mt.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},mt.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];if(p.image)t.push(["image",p.image.name]);else{t.push(p.text);var y={};p.fontStack&&(y["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(y["font-scale"]=p.scale),p.textColor&&(y["text-color"]=["rgba"].concat(p.textColor.toArray())),t.push(y)}}return t};var aa=function(t){this.name=t.name,this.available=t.available};function ue(t,o,u,p){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[t,o,u,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[t,o,u,p]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ns(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof ji||t instanceof Pr||t instanceof mt||t instanceof aa)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!ns(u[o]))return!1;return!0}if(typeof t=="object"){for(var p in t)if(!ns(t[p]))return!1;return!0}return!1}function ta(t){if(t===null)return pn;if(typeof t=="string")return tn;if(typeof t=="boolean")return Zr;if(typeof t=="number")return Ot;if(t instanceof ji)return Hr;if(t instanceof Pr)return nn;if(t instanceof mt)return Wi;if(t instanceof aa)return vi;if(Array.isArray(t)){for(var o,u=t.length,p=0,y=t;p<y.length;p+=1){var b=ta(y[p]);if(o){if(o===b)continue;o=rn;break}o=b}return Ti(o||rn,u)}return gi}function bu(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof ji||t instanceof mt||t instanceof aa?t.toString():JSON.stringify(t)}aa.prototype.toString=function(){return this.name},aa.fromString=function(t){return t?new aa({name:t,available:!1}):null},aa.prototype.serialize=function(){return["image",this.name]};var Ga=function(t,o){this.type=t,this.value=o};Ga.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!ns(t[1]))return o.error("invalid value");var u=t[1],p=ta(u),y=o.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new Ga(p,u)},Ga.prototype.evaluate=function(){return this.value},Ga.prototype.eachChild=function(){},Ga.prototype.outputDefined=function(){return!0},Ga.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ji?["rgba"].concat(this.value.toArray()):this.value instanceof mt?this.value.serialize():this.value};var Pa=function(t){this.name="ExpressionEvaluationError",this.message=t};Pa.prototype.toJSON=function(){return this.message};var eo={string:tn,number:Ot,boolean:Zr,object:gi},oa=function(t,o){this.type=t,this.args=o};oa.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,p=1,y=t[0];if(y==="array"){var b,S;if(t.length>2){var I=t[1];if(typeof I!="string"||!(I in eo)||I==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=eo[I],p++}else b=rn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],p++}u=Ti(b,S)}else u=eo[y];for(var D=[];p<t.length;p++){var N=o.parse(t[p],p,rn);if(!N)return null;D.push(N)}return new oa(u,D)},oa.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!Pt(this.type,ta(u)))return u;if(o===this.args.length-1)throw new Pa("Expected value to be of type "+_i(this.type)+", but found "+_i(ta(u))+" instead.")}return null},oa.prototype.eachChild=function(t){this.args.forEach(t)},oa.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},oa.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var p=t.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(function(y){return y.serialize()}))};var Io=function(t){this.type=Wi,this.sections=t};Io.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var p=[],y=!1,b=1;b<=t.length-1;++b){var S=t[b];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;var I=null;if(S["font-scale"]&&!(I=o.parse(S["font-scale"],1,Ot)))return null;var D=null;if(S["text-font"]&&!(D=o.parse(S["text-font"],1,Ti(tn))))return null;var N=null;if(S["text-color"]&&!(N=o.parse(S["text-color"],1,Hr)))return null;var V=p[p.length-1];V.scale=I,V.font=D,V.textColor=N}else{var W=o.parse(t[b],1,rn);if(!W)return null;var ee=W.type.kind;if(ee!=="string"&&ee!=="value"&&ee!=="null"&&ee!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:W,scale:null,font:null,textColor:null})}}return new Io(p)},Io.prototype.evaluate=function(t){return new mt(this.sections.map(function(o){var u=o.content.evaluate(t);return ta(u)===vi?new an("",u,null,null,null):new an(bu(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},Io.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t(p.content),p.scale&&t(p.scale),p.font&&t(p.font),p.textColor&&t(p.textColor)}},Io.prototype.outputDefined=function(){return!1},Io.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t.push(p.content.serialize());var y={};p.scale&&(y["font-scale"]=p.scale.serialize()),p.font&&(y["text-font"]=p.font.serialize()),p.textColor&&(y["text-color"]=p.textColor.serialize()),t.push(y)}return t};var qo=function(t){this.type=vi,this.input=t};qo.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,tn);return u?new qo(u):o.error("No image name provided.")},qo.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=aa.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},qo.prototype.eachChild=function(t){t(this.input)},qo.prototype.outputDefined=function(){return!1},qo.prototype.serialize=function(){return["image",this.input.serialize()]};var Du={"to-boolean":Zr,"to-color":Hr,"to-number":Ot,"to-string":tn},yo=function(t,o){this.type=t,this.args=o};yo.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var p=Du[u],y=[],b=1;b<t.length;b++){var S=o.parse(t[b],b,rn);if(!S)return null;y.push(S)}return new yo(p,y)},yo.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,p=0,y=this.args;p<y.length;p+=1){if(u=null,(o=y[p].evaluate(t))instanceof ji)return o;if(typeof o=="string"){var b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":ue(o[0],o[1],o[2],o[3])))return new ji(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Pa(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,I=0,D=this.args;I<D.length;I+=1){if((S=D[I].evaluate(t))===null)return 0;var N=Number(S);if(!isNaN(N))return N}throw new Pa("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?mt.fromString(bu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?aa.fromString(bu(this.args[0].evaluate(t))):bu(this.args[0].evaluate(t))},yo.prototype.eachChild=function(t){this.args.forEach(t)},yo.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},yo.prototype.serialize=function(){if(this.type.kind==="formatted")return new Io([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new qo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var jo=["Unknown","Point","LineString","Polygon"],sa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};sa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},sa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?jo[this.feature.type]:this.feature.type:null},sa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},sa.prototype.canonicalID=function(){return this.canonical},sa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},sa.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=ji.parse(t)),o};var to=function(t,o,u,p){this.name=t,this.type=o,this._evaluate=u,this.args=p};to.prototype.evaluate=function(t){return this._evaluate(t,this.args)},to.prototype.eachChild=function(t){this.args.forEach(t)},to.prototype.outputDefined=function(){return!1},to.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},to.parse=function(t,o){var u,p=t[0],y=to.definitions[p];if(!y)return o.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,I=S.filter(function(Vn){var dn=Vn[0];return!Array.isArray(dn)||dn.length===t.length-1}),D=null,N=0,V=I;N<V.length;N+=1){var W=V[N],ee=W[0],se=W[1];D=new Zs(o.registry,o.path,null,o.scope);for(var Me=[],Oe=!1,qe=1;qe<t.length;qe++){var Ue=t[qe],ut=Array.isArray(ee)?ee[qe-1]:ee.type,Mt=D.parse(Ue,1+Me.length,ut);if(!Mt){Oe=!0;break}Me.push(Mt)}if(!Oe)if(Array.isArray(ee)&&ee.length!==Me.length)D.error("Expected "+ee.length+" arguments, but found "+Me.length+" instead.");else{for(var Gt=0;Gt<Me.length;Gt++){var Wt=Array.isArray(ee)?ee[Gt]:ee.type,lr=Me[Gt];D.concat(Gt+1).checkSubtype(Wt,lr.type)}if(D.errors.length===0)return new to(p,b,se,Me)}}if(I.length===1)(u=o.errors).push.apply(u,D.errors);else{for(var Or=(I.length?I:S).map(function(Vn){var dn;return dn=Vn[0],Array.isArray(dn)?"("+dn.map(_i).join(", ")+")":"("+_i(dn.type)+"...)"}).join(" | "),Kr=[],Un=1;Un<t.length;Un++){var hn=o.parse(t[Un],1+Kr.length);if(!hn)return null;Kr.push(_i(hn.type))}o.error("Expected arguments of type "+Or+", but found ("+Kr.join(", ")+") instead.")}return null},to.register=function(t,o){for(var u in to.definitions=o,o)t[u]=to};var Vo=function(t,o,u){this.type=nn,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function ro(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function Rs(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function Pl(t,o){var u=(180+t[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*8192),Math.round(p*y*8192)]}function _s(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function ne(t,o){for(var u,p,y,b,S,I,D,N=!1,V=0,W=o.length;V<W;V++)for(var ee=o[V],se=0,Me=ee.length;se<Me-1;se++){if((b=(u=t)[0]-(p=ee[se])[0])*(D=u[1]-(y=ee[se+1])[1])-(I=u[0]-y[0])*(S=u[1]-p[1])==0&&b*I<=0&&S*D<=0)return!1;_s(t,ee[se],ee[se+1])&&(N=!N)}return N}function be(t,o){for(var u=0;u<o.length;u++)if(ne(t,o[u]))return!0;return!1}function Ke(t,o,u,p){var y=p[0]-u[0],b=p[1]-u[1],S=(t[0]-u[0])*b-y*(t[1]-u[1]),I=(o[0]-u[0])*b-y*(o[1]-u[1]);return S>0&&I<0||S<0&&I>0}function Lt(t,o,u){for(var p=0,y=u;p<y.length;p+=1)for(var b=y[p],S=0;S<b.length-1;++S)if((W=[(V=b[S+1])[0]-(N=b[S])[0],V[1]-N[1]])[0]*(ee=[(D=o)[0]-(I=t)[0],D[1]-I[1]])[1]-W[1]*ee[0]!=0&&Ke(I,D,N,V)&&Ke(N,V,I,D))return!0;var I,D,N,V,W,ee;return!1}function Rr(t,o){for(var u=0;u<t.length;++u)if(!ne(t[u],o))return!1;for(var p=0;p<t.length-1;++p)if(Lt(t[p],t[p+1],o))return!1;return!0}function In(t,o){for(var u=0;u<o.length;u++)if(Rr(t,o[u]))return!0;return!1}function Pi(t,o,u){for(var p=[],y=0;y<t.length;y++){for(var b=[],S=0;S<t[y].length;S++){var I=Pl(t[y][S],u);ro(o,I),b.push(I)}p.push(b)}return p}function so(t,o,u){for(var p=[],y=0;y<t.length;y++){var b=Pi(t[y],o,u);p.push(b)}return p}function Da(t,o,u,p){if(t[0]<u[0]||t[0]>u[2]){var y=.5*p,b=t[0]-u[0]>y?-p:u[0]-t[0]>y?p:0;b===0&&(b=t[0]-u[2]>y?-p:u[2]-t[0]>y?p:0),t[0]+=b}ro(o,t)}function Ha(t,o,u,p){for(var y=8192*Math.pow(2,p.z),b=[8192*p.x,8192*p.y],S=[],I=0,D=t;I<D.length;I+=1)for(var N=0,V=D[I];N<V.length;N+=1){var W=V[N],ee=[W.x+b[0],W.y+b[1]];Da(ee,o,u,y),S.push(ee)}return S}function Ko(t,o,u,p){for(var y,b=8192*Math.pow(2,p.z),S=[8192*p.x,8192*p.y],I=[],D=0,N=t;D<N.length;D+=1){for(var V=[],W=0,ee=N[D];W<ee.length;W+=1){var se=ee[W],Me=[se.x+S[0],se.y+S[1]];ro(o,Me),V.push(Me)}I.push(V)}if(o[2]-o[0]<=b/2){(y=o)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var Oe=0,qe=I;Oe<qe.length;Oe+=1)for(var Ue=0,ut=qe[Oe];Ue<ut.length;Ue+=1)Da(ut[Ue],o,u,b)}return I}Vo.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var p=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Zr);if(!p)return null;var y=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Zr);if(!y)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,tn))?null:new Vo(p,y,b)},Vo.prototype.evaluate=function(t){return new Pr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Vo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Vo.prototype.outputDefined=function(){return!1},Vo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var xs=function(t,o){this.type=Zr,this.geojson=t,this.geometries=o};function co(t){if(t instanceof to&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof xs)return!1;var o=!0;return t.eachChild(function(u){o&&!co(u)&&(o=!1)}),o}function Oo(t){if(t instanceof to&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!Oo(u)&&(o=!1)}),o}function bs(t,o){if(t instanceof to&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(p){u&&!bs(p,o)&&(u=!1)}),u}xs.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(ns(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var p=0;p<u.features.length;++p){var y=u.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new xs(u,u.features[p].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new xs(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new xs(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},xs.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Pi(u.coordinates,y,b),I=Ha(o.geometry(),p,y,b);if(!Rs(p,y))return!1;for(var D=0,N=I;D<N.length;D+=1)if(!ne(N[D],S))return!1}if(u.type==="MultiPolygon"){var V=so(u.coordinates,y,b),W=Ha(o.geometry(),p,y,b);if(!Rs(p,y))return!1;for(var ee=0,se=W;ee<se.length;ee+=1)if(!be(se[ee],V))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Pi(u.coordinates,y,b),I=Ko(o.geometry(),p,y,b);if(!Rs(p,y))return!1;for(var D=0,N=I;D<N.length;D+=1)if(!Rr(N[D],S))return!1}if(u.type==="MultiPolygon"){var V=so(u.coordinates,y,b),W=Ko(o.geometry(),p,y,b);if(!Rs(p,y))return!1;for(var ee=0,se=W;ee<se.length;ee+=1)if(!In(se[ee],V))return!1}return!0}(t,this.geometries)}return!1},xs.prototype.eachChild=function(){},xs.prototype.outputDefined=function(){return!0},xs.prototype.serialize=function(){return["within",this.geojson]};var Ls=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};Ls.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new Ls(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},Ls.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ls.prototype.eachChild=function(){},Ls.prototype.outputDefined=function(){return!1},Ls.prototype.serialize=function(){return["var",this.name]};var Zs=function(t,o,u,p,y){o===void 0&&(o=[]),p===void 0&&(p=new En),y===void 0&&(y=[]),this.registry=t,this.path=o,this.key=o.map(function(b){return"["+b+"]"}).join(""),this.scope=p,this.errors=y,this.expectedType=u};function au(t,o){for(var u,p=t.length-1,y=0,b=p,S=0;y<=b;)if((u=t[S=Math.floor((y+b)/2)])<=o){if(S===p||o<t[S+1])return S;y=S+1}else{if(!(u>o))throw new Pa("Input is not a number.");b=S-1}return 0}Zs.prototype.parse=function(t,o,u,p,y){return y===void 0&&(y={}),o?this.concat(o,u,p)._parse(t,y):this._parse(t,y)},Zs.prototype._parse=function(t,o){function u(N,V,W){return W==="assert"?new oa(V,[N]):W==="coerce"?new yo(V,[N]):N}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=t[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[p];if(y){var b=y.parse(t,this);if(!b)return null;if(this.expectedType){var S=this.expectedType,I=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||I.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string"){if(this.checkSubtype(S,I))return null}else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"assert")}if(!(b instanceof Ga)&&b.type.kind!=="resolvedImage"&&function N(V){if(V instanceof Ls)return N(V.boundExpression);if(V instanceof to&&V.name==="error"||V instanceof Vo||V instanceof xs)return!1;var W=V instanceof yo||V instanceof oa,ee=!0;return V.eachChild(function(se){ee=W?ee&&N(se):ee&&se instanceof Ga}),!!ee&&co(V)&&bs(V,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var D=new sa;try{b=new Ga(b.type,b.evaluate(D))}catch(N){return this.error(N.message),null}}return b}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Zs.prototype.concat=function(t,o,u){var p=typeof t=="number"?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new Zs(this.registry,p,o||null,y,this.errors)},Zs.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var p=""+this.key+o.map(function(y){return"["+y+"]"}).join("");this.errors.push(new vr(p,t))},Zs.prototype.checkSubtype=function(t,o){var u=Pt(t,o);return u&&this.error(u),u};var Es=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var p=0,y=u;p<y.length;p+=1){var b=y[p],S=b[1];this.labels.push(b[0]),this.outputs.push(S)}};function ba(t,o,u){return t*(1-u)+o*u}Es.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,Ot);if(!u)return null;var p=[],y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(var b=1;b<t.length;b+=2){var S=b===1?-1/0:t[b],I=t[b+1],D=b,N=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(p.length&&p[p.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var V=o.parse(I,N,y);if(!V)return null;y=y||V.type,p.push([S,V])}return new Es(y,u,p)},Es.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var y=o.length;return p>=o[y-1]?u[y-1].evaluate(t):u[au(o,p)].evaluate(t)},Es.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},Es.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},Es.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var Ca=Object.freeze({__proto__:null,number:ba,color:function(t,o,u){return new ji(ba(t.r,o.r,u),ba(t.g,o.g,u),ba(t.b,o.b,u),ba(t.a,o.a,u))},array:function(t,o,u){return t.map(function(p,y){return ba(p,o[y],u)})}}),fs=6/29*3*(6/29),of=Math.PI/180,Il=180/Math.PI;function qs(t){return t>.008856451679035631?Math.pow(t,1/3):t/fs+4/29}function ac(t){return t>6/29?t*t*t:fs*(t-4/29)}function Ju(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ks(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function pl(t){var o=Ks(t.r),u=Ks(t.g),p=Ks(t.b),y=qs((.4124564*o+.3575761*u+.1804375*p)/.95047),b=qs((.2126729*o+.7151522*u+.072175*p)/1);return{l:116*b-16,a:500*(y-b),b:200*(b-qs((.0193339*o+.119192*u+.9503041*p)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,p=isNaN(t.b)?o:o-t.b/200;return o=1*ac(o),u=.95047*ac(u),p=1.08883*ac(p),new ji(Ju(3.2404542*u-1.5371385*o-.4985314*p),Ju(-.969266*u+1.8760108*o+.041556*p),Ju(.0556434*u-.2040259*o+1.0572252*p),t.alpha)}function P(t,o,u){var p=o-t;return t+u*(p>180||p<-180?p-360*Math.round(p/360):p)}var F={forward:pl,reverse:_,interpolate:function(t,o,u){return{l:ba(t.l,o.l,u),a:ba(t.a,o.a,u),b:ba(t.b,o.b,u),alpha:ba(t.alpha,o.alpha,u)}}},R={forward:function(t){var o=pl(t),u=o.l,p=o.a,y=o.b,b=Math.atan2(y,p)*Il;return{h:b<0?b+360:b,c:Math.sqrt(p*p+y*y),l:u,alpha:t.a}},reverse:function(t){var o=t.h*of,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:P(t.h,o.h,u),c:ba(t.c,o.c,u),l:ba(t.l,o.l,u),alpha:ba(t.alpha,o.alpha,u)}}},K=Object.freeze({__proto__:null,lab:F,hcl:R}),xe=function(t,o,u,p,y){this.type=t,this.operator=o,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(var b=0,S=y;b<S.length;b+=1){var I=S[b],D=I[1];this.labels.push(I[0]),this.outputs.push(D)}};function We(t,o,u,p){var y=p-u,b=t-u;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}xe.interpolationFactor=function(t,o,u,p){var y=0;if(t.name==="exponential")y=We(o,t.base,u,p);else if(t.name==="linear")y=We(o,1,u,p);else if(t.name==="cubic-bezier"){var b=t.controlPoints;y=new Z(b[0],b[1],b[2],b[3]).solve(We(o,1,u,p))}return y},xe.parse=function(t,o){var u=t[0],p=t[1],y=t[2],b=t.slice(3);if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var S=p[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:S}}else{if(p[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(p[0]),1,0);var I=p.slice(1);if(I.length!==4||I.some(function(qe){return typeof qe!="number"||qe<0||qe>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:I}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(y=o.parse(y,2,Ot)))return null;var D=[],N=null;u==="interpolate-hcl"||u==="interpolate-lab"?N=Hr:o.expectedType&&o.expectedType.kind!=="value"&&(N=o.expectedType);for(var V=0;V<b.length;V+=2){var W=b[V],ee=b[V+1],se=V+3,Me=V+4;if(typeof W!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',se);if(D.length&&D[D.length-1][0]>=W)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',se);var Oe=o.parse(ee,Me,N);if(!Oe)return null;N=N||Oe.type,D.push([W,Oe])}return N.kind==="number"||N.kind==="color"||N.kind==="array"&&N.itemType.kind==="number"&&typeof N.N=="number"?new xe(N,u,p,y,D):o.error("Type "+_i(N)+" is not interpolatable.")},xe.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var y=o.length;if(p>=o[y-1])return u[y-1].evaluate(t);var b=au(o,p),S=xe.interpolationFactor(this.interpolation,p,o[b],o[b+1]),I=u[b].evaluate(t),D=u[b+1].evaluate(t);return this.operator==="interpolate"?Ca[this.type.kind.toLowerCase()](I,D,S):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(I),R.forward(D),S)):F.reverse(F.interpolate(F.forward(I),F.forward(D),S))},xe.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},xe.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},xe.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var pt=function(t,o){this.type=t,this.args=o};pt.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,p=o.expectedType;p&&p.kind!=="value"&&(u=p);for(var y=[],b=0,S=t.slice(1);b<S.length;b+=1){var I=o.parse(S[b],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!I)return null;u=u||I.type,y.push(I)}var D=p&&y.some(function(N){return Pt(p,N.type)});return new pt(D?rn:u,y)},pt.prototype.evaluate=function(t){for(var o,u=null,p=0,y=0,b=this.args;y<b.length&&(p++,(u=b[y].evaluate(t))&&u instanceof aa&&!u.available&&(o||(o=u.name),u=null,p===this.args.length&&(u=o)),u===null);y+=1);return u},pt.prototype.eachChild=function(t){this.args.forEach(t)},pt.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},pt.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var dt=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};dt.prototype.evaluate=function(t){return this.result.evaluate(t)},dt.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},dt.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],p=1;p<t.length-1;p+=2){var y=t[p];if(typeof y!="string")return o.error("Expected string, but found "+typeof y+" instead.",p);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);var b=o.parse(t[p+1],p+1);if(!b)return null;u.push([y,b])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new dt(u,S):null},dt.prototype.outputDefined=function(){return this.result.outputDefined()},dt.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var p=u[o];t.push(p[0],p[1].serialize())}return t.push(this.result.serialize()),t};var sr=function(t,o,u){this.type=t,this.index=o,this.input=u};sr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Ot),p=o.parse(t[2],2,Ti(o.expectedType||rn));return u&&p?new sr(p.type.itemType,u,p):null},sr.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new Pa("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new Pa("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new Pa("Array index must be an integer, but found "+o+" instead.");return u[o]},sr.prototype.eachChild=function(t){t(this.index),t(this.input)},sr.prototype.outputDefined=function(){return!1},sr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var cr=function(t,o){this.type=Zr,this.needle=t,this.haystack=o};cr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,rn),p=o.parse(t[2],2,rn);return u&&p?Ma(u.type,[Zr,tn,Ot,pn,rn])?new cr(u,p):o.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(u.type)+" instead"):null},cr.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!Ai(o,["boolean","string","number","null"]))throw new Pa("Expected first argument to be of type boolean, string, number or null, but found "+_i(ta(o))+" instead.");if(!Ai(u,["string","array"]))throw new Pa("Expected second argument to be of type array or string, but found "+_i(ta(u))+" instead.");return u.indexOf(o)>=0},cr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},cr.prototype.outputDefined=function(){return!0},cr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Pn=function(t,o,u){this.type=Ot,this.needle=t,this.haystack=o,this.fromIndex=u};Pn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,rn),p=o.parse(t[2],2,rn);if(!u||!p)return null;if(!Ma(u.type,[Zr,tn,Ot,pn,rn]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Ot);return y?new Pn(u,p,y):null}return new Pn(u,p)},Pn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Ai(o,["boolean","string","number","null"]))throw new Pa("Expected first argument to be of type boolean, string, number or null, but found "+_i(ta(o))+" instead.");if(!Ai(u,["string","array"]))throw new Pa("Expected second argument to be of type array or string, but found "+_i(ta(u))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(t);return u.indexOf(o,p)}return u.indexOf(o)},Pn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Pn.prototype.outputDefined=function(){return!1},Pn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ai=function(t,o,u,p,y,b){this.inputType=t,this.type=o,this.input=u,this.cases=p,this.outputs=y,this.otherwise=b};ai.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(var y={},b=[],S=2;S<t.length-1;S+=2){var I=t[S],D=t[S+1];Array.isArray(I)||(I=[I]);var N=o.concat(S);if(I.length===0)return N.error("Expected at least one branch label.");for(var V=0,W=I;V<W.length;V+=1){var ee=W[V];if(typeof ee!="number"&&typeof ee!="string")return N.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return N.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ee=="number"&&Math.floor(ee)!==ee)return N.error("Numeric branch labels must be integer values.");if(u){if(N.checkSubtype(u,ta(ee)))return null}else u=ta(ee);if(y[String(ee)]!==void 0)return N.error("Branch labels must be unique.");y[String(ee)]=b.length}var se=o.parse(D,S,p);if(!se)return null;p=p||se.type,b.push(se)}var Me=o.parse(t[1],1,rn);if(!Me)return null;var Oe=o.parse(t[t.length-1],t.length-1,p);return Oe?Me.type.kind!=="value"&&o.concat(1).checkSubtype(u,Me.type)?null:new ai(u,p,Me,y,b,Oe):null},ai.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(ta(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ai.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ai.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ai.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],p={},y=0,b=Object.keys(this.cases).sort();y<b.length;y+=1){var S=b[y];(W=p[this.cases[S]])===void 0?(p[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[W][1].push(S)}for(var I=function(se){return t.inputType.kind==="number"?Number(se):se},D=0,N=u;D<N.length;D+=1){var V=N[D],W=V[0],ee=V[1];o.push(ee.length===1?I(ee[0]):ee.map(I)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var kn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};kn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var p=[],y=1;y<t.length-1;y+=2){var b=o.parse(t[y],y,Zr);if(!b)return null;var S=o.parse(t[y+1],y+1,u);if(!S)return null;p.push([b,S]),u=u||S.type}var I=o.parse(t[t.length-1],t.length-1,u);return I?new kn(u,p,I):null},kn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],y=p[1];if(p[0].evaluate(t))return y.evaluate(t)}return this.otherwise.evaluate(t)},kn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],y=p[1];t(p[0]),t(y)}t(this.otherwise)},kn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},kn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Xi=function(t,o,u,p){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=p};function ga(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function wa(t,o,u,p){return p.compare(o,u)===0}function Hi(t,o,u){var p=t!=="=="&&t!=="!=";return function(){function y(b,S,I){this.type=Zr,this.lhs=b,this.rhs=S,this.collator=I,this.hasUntypedArgument=b.type.kind==="value"||S.type.kind==="value"}return y.parse=function(b,S){if(b.length!==3&&b.length!==4)return S.error("Expected two or three arguments.");var I=b[0],D=S.parse(b[1],1,rn);if(!D)return null;if(!ga(I,D.type))return S.concat(1).error('"'+I+`" comparisons are not supported for type '`+_i(D.type)+"'.");var N=S.parse(b[2],2,rn);if(!N)return null;if(!ga(I,N.type))return S.concat(2).error('"'+I+`" comparisons are not supported for type '`+_i(N.type)+"'.");if(D.type.kind!==N.type.kind&&D.type.kind!=="value"&&N.type.kind!=="value")return S.error("Cannot compare types '"+_i(D.type)+"' and '"+_i(N.type)+"'.");p&&(D.type.kind==="value"&&N.type.kind!=="value"?D=new oa(N.type,[D]):D.type.kind!=="value"&&N.type.kind==="value"&&(N=new oa(D.type,[N])));var V=null;if(b.length===4){if(D.type.kind!=="string"&&N.type.kind!=="string"&&D.type.kind!=="value"&&N.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(V=S.parse(b[3],3,nn)))return null}return new y(D,N,V)},y.prototype.evaluate=function(b){var S=this.lhs.evaluate(b),I=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){var D=ta(S),N=ta(I);if(D.kind!==N.kind||D.kind!=="string"&&D.kind!=="number")throw new Pa('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+D.kind+", "+N.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var V=ta(S),W=ta(I);if(V.kind!=="string"||W.kind!=="string")return o(b,S,I)}return this.collator?u(b,S,I,this.collator.evaluate(b)):o(b,S,I)},y.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var b=[t];return this.eachChild(function(S){b.push(S.serialize())}),b},y}()}Xi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,rn),p=o.parse(t[2],2,Ot);if(!u||!p)return null;if(!Ma(u.type,[Ti(rn),tn,rn]))return o.error("Expected first argument to be of type array or string, but found "+_i(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Ot);return y?new Xi(u.type,u,p,y):null}return new Xi(u.type,u,p)},Xi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!Ai(o,["string","array"]))throw new Pa("Expected first argument to be of type array or string, but found "+_i(ta(o))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(t);return o.slice(u,p)}return o.slice(u)},Xi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Xi.prototype.outputDefined=function(){return!1},Xi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Ss=Hi("==",function(t,o,u){return o===u},wa),ou=Hi("!=",function(t,o,u){return o!==u},function(t,o,u,p){return!wa(0,o,u,p)}),el=Hi("<",function(t,o,u){return o<u},function(t,o,u,p){return p.compare(o,u)<0}),sf=Hi(">",function(t,o,u){return o>u},function(t,o,u,p){return p.compare(o,u)>0}),dl=Hi("<=",function(t,o,u){return o<=u},function(t,o,u,p){return p.compare(o,u)<=0}),Dc=Hi(">=",function(t,o,u){return o>=u},function(t,o,u,p){return p.compare(o,u)>=0}),Fu=function(t,o,u,p,y){this.type=tn,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=y};Fu.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Ot);if(!u)return null;var p=t[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");var y=null;if(p.locale&&!(y=o.parse(p.locale,1,tn)))return null;var b=null;if(p.currency&&!(b=o.parse(p.currency,1,tn)))return null;var S=null;if(p["min-fraction-digits"]&&!(S=o.parse(p["min-fraction-digits"],1,Ot)))return null;var I=null;return p["max-fraction-digits"]&&!(I=o.parse(p["max-fraction-digits"],1,Ot))?null:new Fu(u,y,b,S,I)},Fu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Fu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Fu.prototype.outputDefined=function(){return!1},Fu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Bu=function(t){this.type=Ot,this.input=t};Bu.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+_i(u.type)+" instead."):new Bu(u):null},Bu.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Pa("Expected value to be of type string or array, but found "+_i(ta(o))+" instead.")},Bu.prototype.eachChild=function(t){t(this.input)},Bu.prototype.outputDefined=function(){return!1},Bu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Nu={"==":Ss,"!=":ou,">":sf,"<":el,">=":Dc,"<=":dl,array:oa,at:sr,boolean:oa,case:kn,coalesce:pt,collator:Vo,format:Io,image:qo,in:cr,"index-of":Pn,interpolate:xe,"interpolate-hcl":xe,"interpolate-lab":xe,length:Bu,let:dt,literal:Ga,match:ai,number:oa,"number-format":Fu,object:oa,slice:Xi,step:Es,string:oa,"to-boolean":yo,"to-color":yo,"to-number":yo,"to-string":yo,var:Ls,within:xs};function fo(t,o){var u=o[0],p=o[1],y=o[2],b=o[3];u=u.evaluate(t),p=p.evaluate(t),y=y.evaluate(t);var S=b?b.evaluate(t):1,I=ue(u,p,y,S);if(I)throw new Pa(I);return new ji(u/255*S,p/255*S,y/255*S,S)}function zf(t,o){return t in o}function Uf(t,o){var u=o[t];return u===void 0?null:u}function is(t){return{type:t}}function Fc(t){return{result:"success",value:t}}function zu(t){return{result:"error",value:t}}function su(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function uf(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ol(t){return!!t.expression&&t.expression.interpolated}function Di(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Rl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function bh(t){return t}function vl(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function Bc(t,o,u,p,y){return vl(typeof u===y?p[u]:void 0,t.default,o.default)}function Zf(t,o,u){if(Di(u)!=="number")return vl(t.default,o.default);var p=t.stops.length;if(p===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[p-1][0])return t.stops[p-1][1];var y=au(t.stops.map(function(b){return b[0]}),u);return t.stops[y][1]}function Eh(t,o,u){var p=t.base!==void 0?t.base:1;if(Di(u)!=="number")return vl(t.default,o.default);var y=t.stops.length;if(y===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[y-1][0])return t.stops[y-1][1];var b=au(t.stops.map(function(W){return W[0]}),u),S=function(W,ee,se,Me){var Oe=Me-se,qe=W-se;return Oe===0?0:ee===1?qe/Oe:(Math.pow(ee,qe)-1)/(Math.pow(ee,Oe)-1)}(u,p,t.stops[b][0],t.stops[b+1][0]),I=t.stops[b][1],D=t.stops[b+1][1],N=Ca[o.type]||bh;if(t.colorSpace&&t.colorSpace!=="rgb"){var V=K[t.colorSpace];N=function(W,ee){return V.reverse(V.interpolate(V.forward(W),V.forward(ee),S))}}return typeof I.evaluate=="function"?{evaluate:function(){for(var W=[],ee=arguments.length;ee--;)W[ee]=arguments[ee];var se=I.evaluate.apply(void 0,W),Me=D.evaluate.apply(void 0,W);if(se!==void 0&&Me!==void 0)return N(se,Me,S)}}:N(I,D,S)}function jf(t,o,u){return o.type==="color"?u=ji.parse(u):o.type==="formatted"?u=mt.fromString(u.toString()):o.type==="resolvedImage"?u=aa.fromString(u.toString()):Di(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),vl(u,t.default,o.default)}to.register(Nu,{error:[{kind:"error"},[tn],function(t,o){throw new Pa(o[0].evaluate(t))}],typeof:[tn,[rn],function(t,o){return _i(ta(o[0].evaluate(t)))}],"to-rgba":[Ti(Ot,4),[Hr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Hr,[Ot,Ot,Ot],fo],rgba:[Hr,[Ot,Ot,Ot,Ot],fo],has:{type:Zr,overloads:[[[tn],function(t,o){return zf(o[0].evaluate(t),t.properties())}],[[tn,gi],function(t,o){var u=o[1];return zf(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:rn,overloads:[[[tn],function(t,o){return Uf(o[0].evaluate(t),t.properties())}],[[tn,gi],function(t,o){var u=o[1];return Uf(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[rn,[tn],function(t,o){return Uf(o[0].evaluate(t),t.featureState||{})}],properties:[gi,[],function(t){return t.properties()}],"geometry-type":[tn,[],function(t){return t.geometryType()}],id:[rn,[],function(t){return t.id()}],zoom:[Ot,[],function(t){return t.globals.zoom}],"heatmap-density":[Ot,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Ot,[],function(t){return t.globals.lineProgress||0}],accumulated:[rn,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Ot,is(Ot),function(t,o){for(var u=0,p=0,y=o;p<y.length;p+=1)u+=y[p].evaluate(t);return u}],"*":[Ot,is(Ot),function(t,o){for(var u=1,p=0,y=o;p<y.length;p+=1)u*=y[p].evaluate(t);return u}],"-":{type:Ot,overloads:[[[Ot,Ot],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[Ot],function(t,o){return-o[0].evaluate(t)}]]},"/":[Ot,[Ot,Ot],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[Ot,[Ot,Ot],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[Ot,[],function(){return Math.LN2}],pi:[Ot,[],function(){return Math.PI}],e:[Ot,[],function(){return Math.E}],"^":[Ot,[Ot,Ot],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[Ot,[Ot],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[Ot,[Ot],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[Ot,[Ot],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[Ot,[Ot],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[Ot,[Ot],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[Ot,[Ot],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[Ot,[Ot],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[Ot,[Ot],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[Ot,[Ot],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[Ot,[Ot],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[Ot,is(Ot),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[Ot,is(Ot),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[Ot,[Ot],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[Ot,[Ot],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Ot,[Ot],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[Ot,[Ot],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Zr,[tn,rn],function(t,o){var u=o[0],p=o[1];return t.properties()[u.value]===p.value}],"filter-id-==":[Zr,[rn],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Zr,[tn],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Zr,[tn,rn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y<b}],"filter-id-<":[Zr,[rn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p<y}],"filter->":[Zr,[tn,rn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y>b}],"filter-id->":[Zr,[rn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p>y}],"filter-<=":[Zr,[tn,rn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[Zr,[rn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p<=y}],"filter->=":[Zr,[tn,rn],function(t,o){var u=o[0],p=o[1],y=t.properties()[u.value],b=p.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[Zr,[rn],function(t,o){var u=o[0],p=t.id(),y=u.value;return typeof p==typeof y&&p>=y}],"filter-has":[Zr,[rn],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Zr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Zr,[Ti(tn)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Zr,[Ti(rn)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Zr,[tn,Ti(rn)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Zr,[tn,Ti(rn)],function(t,o){var u=o[0],p=o[1];return function(y,b,S,I){for(;S<=I;){var D=S+I>>1;if(b[D]===y)return!0;b[D]>y?I=D-1:S=D+1}return!1}(t.properties()[u.value],p.value,0,p.value.length-1)}],all:{type:Zr,overloads:[[[Zr,Zr],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[is(Zr),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(!p[u].evaluate(t))return!1;return!0}]]},any:{type:Zr,overloads:[[[Zr,Zr],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[is(Zr),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(p[u].evaluate(t))return!0;return!1}]]},"!":[Zr,[Zr],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Zr,[tn],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[tn,[tn],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[tn,[tn],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[tn,is(rn),function(t,o){return o.map(function(u){return bu(u.evaluate(t))}).join("")}],"resolved-locale":[tn,[nn],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var Nc=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new sa,this._defaultValue=o?function(u){return u.type==="color"&&Rl(u.default)?new ji(0,0,0,0):u.type==="color"?ji.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function oc(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Nu}function sc(t,o){var u=new Zs(Nu,[],o?function(y){var b={color:Hr,string:tn,number:Ot,enum:tn,boolean:Zr,formatted:Wi,resolvedImage:vi};return y.type==="array"?Ti(b[y.value]||rn,y.length):b[y.type]}(o):void 0),p=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Fc(new Nc(p,o)):zu(u.errors)}Nc.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},Nc.prototype.evaluate=function(t,o,u,p,y,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Pa("Expected value to be one of "+Object.keys(this._enumValues).map(function(I){return JSON.stringify(I)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console!="undefined"&&console.warn(I.message)),this._defaultValue}};var Ll=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!Oo(o.expression)};Ll.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,y,b)},Ll.prototype.evaluate=function(t,o,u,p,y,b){return this._styleExpression.evaluate(t,o,u,p,y,b)};var ml=function(t,o,u,p){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!Oo(o.expression),this.interpolationType=p};function kl(t,o){if((t=sc(t,o)).result==="error")return t;var u=t.value.expression,p=co(u);if(!p&&!su(o))return zu([new vr("","data expressions not supported")]);var y=bs(u,["zoom"]);if(!y&&!uf(o))return zu([new vr("","zoom expressions not supported")]);var b=function S(I){var D=null;if(I instanceof dt)D=S(I.result);else if(I instanceof pt)for(var N=0,V=I.args;N<V.length&&!(D=S(V[N]));N+=1);else(I instanceof Es||I instanceof xe)&&I.input instanceof to&&I.input.name==="zoom"&&(D=I);return D instanceof vr||I.eachChild(function(W){var ee=S(W);ee instanceof vr?D=ee:!D&&ee?D=new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&ee&&D!==ee&&(D=new vr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(u);return b||y?b instanceof vr?zu([b]):b instanceof xe&&!Ol(o)?zu([new vr("",'"interpolate" expressions cannot be used with this property')]):Fc(b?new ml(p?"camera":"composite",t.value,b.labels,b instanceof xe?b.interpolation:void 0):new Ll(p?"constant":"source",t.value)):zu([new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ml.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,y,b)},ml.prototype.evaluate=function(t,o,u,p,y,b){return this._styleExpression.evaluate(t,o,u,p,y,b)},ml.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?xe.interpolationFactor(this.interpolationType,t,o,u):0};var tl=function(t,o){this._parameters=t,this._specification=o,dr(this,function u(p,y){var b,S,I,D=y.type==="color",N=p.stops&&typeof p.stops[0][0]=="object",V=N||!(N||p.property!==void 0),W=p.type||(Ol(y)?"exponential":"interval");if(D&&((p=dr({},p)).stops&&(p.stops=p.stops.map(function(hn){return[hn[0],ji.parse(hn[1])]})),p.default=ji.parse(p.default?p.default:y.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!K[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(W==="exponential")b=Eh;else if(W==="interval")b=Zf;else if(W==="categorical"){b=Bc,S=Object.create(null);for(var ee=0,se=p.stops;ee<se.length;ee+=1){var Me=se[ee];S[Me[0]]=Me[1]}I=typeof p.stops[0][0]}else{if(W!=="identity")throw new Error('Unknown function type "'+W+'"');b=jf}if(N){for(var Oe={},qe=[],Ue=0;Ue<p.stops.length;Ue++){var ut=p.stops[Ue],Mt=ut[0].zoom;Oe[Mt]===void 0&&(Oe[Mt]={zoom:Mt,type:p.type,property:p.property,default:p.default,stops:[]},qe.push(Mt)),Oe[Mt].stops.push([ut[0].value,ut[1]])}for(var Gt=[],Wt=0,lr=qe;Wt<lr.length;Wt+=1){var Or=lr[Wt];Gt.push([Oe[Or].zoom,u(Oe[Or],y)])}var Kr={name:"linear"};return{kind:"composite",interpolationType:Kr,interpolationFactor:xe.interpolationFactor.bind(void 0,Kr),zoomStops:Gt.map(function(hn){return hn[0]}),evaluate:function(hn,Vn){var dn=hn.zoom;return Eh({stops:Gt,base:p.base},y,dn).evaluate(dn,Vn)}}}if(V){var Un=W==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:Un,interpolationFactor:xe.interpolationFactor.bind(void 0,Un),zoomStops:p.stops.map(function(hn){return hn[0]}),evaluate:function(hn){return b(p,y,hn.zoom,S,I)}}}return{kind:"source",evaluate:function(hn,Vn){var dn=Vn&&Vn.properties?Vn.properties[p.property]:void 0;return dn===void 0?vl(p.default,y.default):b(p,y,dn,S,I)}}}(this._parameters,this._specification))};function $s(t){var o=t.key,u=t.value,p=t.valueSpec||{},y=t.objectElementValidators||{},b=t.style,S=t.styleSpec,I=[],D=Di(u);if(D!=="object")return[new ke(o,u,"object expected, "+D+" found")];for(var N in u){var V=N.split(".")[0],W=p[V]||p["*"],ee=void 0;if(y[V])ee=y[V];else if(p[V])ee=Yi;else if(y["*"])ee=y["*"];else{if(!p["*"]){I.push(new ke(o,u[N],'unknown property "'+N+'"'));continue}ee=Yi}I=I.concat(ee({key:(o&&o+".")+N,value:u[N],valueSpec:W,style:b,styleSpec:S,object:u,objectKey:N},u))}for(var se in p)y[se]||p[se].required&&p[se].default===void 0&&u[se]===void 0&&I.push(new ke(o,u,'missing required property "'+se+'"'));return I}function lf(t){var o=t.value,u=t.valueSpec,p=t.style,y=t.styleSpec,b=t.key,S=t.arrayElementValidator||Yi;if(Di(o)!=="array")return[new ke(b,o,"array expected, "+Di(o)+" found")];if(u.length&&o.length!==u.length)return[new ke(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new ke(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var I={type:u.value,values:u.values};y.$version<7&&(I.function=u.function),Di(u.value)==="object"&&(I=u.value);for(var D=[],N=0;N<o.length;N++)D=D.concat(S({array:o,arrayIndex:N,value:o[N],valueSpec:I,style:p,styleSpec:y,key:b+"["+N+"]"}));return D}function cf(t){var o=t.key,u=t.value,p=t.valueSpec,y=Di(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new ke(o,u,"number expected, "+y+" found")]:"minimum"in p&&u<p.minimum?[new ke(o,u,u+" is less than the minimum value "+p.minimum)]:"maximum"in p&&u>p.maximum?[new ke(o,u,u+" is greater than the maximum value "+p.maximum)]:[]}function Vf(t){var o,u,p,y=t.valueSpec,b=Ft(t.value.type),S={},I=b!=="categorical"&&t.value.property===void 0,D=!I,N=Di(t.value.stops)==="array"&&Di(t.value.stops[0])==="array"&&Di(t.value.stops[0][0])==="object",V=$s({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(se){if(b==="identity")return[new ke(se.key,se.value,'identity function may not have a "stops" property')];var Me=[],Oe=se.value;return Me=Me.concat(lf({key:se.key,value:Oe,valueSpec:se.valueSpec,style:se.style,styleSpec:se.styleSpec,arrayElementValidator:W})),Di(Oe)==="array"&&Oe.length===0&&Me.push(new ke(se.key,Oe,"array must have at least one stop")),Me},default:function(se){return Yi({key:se.key,value:se.value,valueSpec:y,style:se.style,styleSpec:se.styleSpec})}}});return b==="identity"&&I&&V.push(new ke(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||V.push(new ke(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!Ol(t.valueSpec)&&V.push(new ke(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(D&&!su(t.valueSpec)?V.push(new ke(t.key,t.value,"property functions not supported")):I&&!uf(t.valueSpec)&&V.push(new ke(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!N||t.value.property!==void 0||V.push(new ke(t.key,t.value,'"property" property is required')),V;function W(se){var Me=[],Oe=se.value,qe=se.key;if(Di(Oe)!=="array")return[new ke(qe,Oe,"array expected, "+Di(Oe)+" found")];if(Oe.length!==2)return[new ke(qe,Oe,"array length 2 expected, length "+Oe.length+" found")];if(N){if(Di(Oe[0])!=="object")return[new ke(qe,Oe,"object expected, "+Di(Oe[0])+" found")];if(Oe[0].zoom===void 0)return[new ke(qe,Oe,"object stop key must have zoom")];if(Oe[0].value===void 0)return[new ke(qe,Oe,"object stop key must have value")];if(p&&p>Ft(Oe[0].zoom))return[new ke(qe,Oe[0].zoom,"stop zoom values must appear in ascending order")];Ft(Oe[0].zoom)!==p&&(p=Ft(Oe[0].zoom),u=void 0,S={}),Me=Me.concat($s({key:qe+"[0]",value:Oe[0],valueSpec:{zoom:{}},style:se.style,styleSpec:se.styleSpec,objectElementValidators:{zoom:cf,value:ee}}))}else Me=Me.concat(ee({key:qe+"[0]",value:Oe[0],valueSpec:{},style:se.style,styleSpec:se.styleSpec},Oe));return oc(zt(Oe[1]))?Me.concat([new ke(qe+"[1]",Oe[1],"expressions are not allowed in function stops.")]):Me.concat(Yi({key:qe+"[1]",value:Oe[1],valueSpec:y,style:se.style,styleSpec:se.styleSpec}))}function ee(se,Me){var Oe=Di(se.value),qe=Ft(se.value),Ue=se.value!==null?se.value:Me;if(o){if(Oe!==o)return[new ke(se.key,Ue,Oe+" stop domain type must match previous stop domain type "+o)]}else o=Oe;if(Oe!=="number"&&Oe!=="string"&&Oe!=="boolean")return[new ke(se.key,Ue,"stop domain value must be a number, string, or boolean")];if(Oe!=="number"&&b!=="categorical"){var ut="number expected, "+Oe+" found";return su(y)&&b===void 0&&(ut+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ke(se.key,Ue,ut)]}return b!=="categorical"||Oe!=="number"||isFinite(qe)&&Math.floor(qe)===qe?b!=="categorical"&&Oe==="number"&&u!==void 0&&qe<u?[new ke(se.key,Ue,"stop domain values must appear in ascending order")]:(u=qe,b==="categorical"&&qe in S?[new ke(se.key,Ue,"stop domain values must be unique")]:(S[qe]=!0,[])):[new ke(se.key,Ue,"integer expected, found "+qe)]}}function uu(t){var o=(t.expressionContext==="property"?kl:sc)(zt(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(p){return new ke(""+t.key+p.key,t.value,p.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new ke(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Oo(u))return[new ke(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Oo(u))return[new ke(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!bs(u,["zoom","feature-state"]))return[new ke(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!co(u))return[new ke(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function uc(t){var o=t.key,u=t.value,p=t.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(Ft(u))===-1&&y.push(new ke(o,u,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(p.values).indexOf(Ft(u))===-1&&y.push(new ke(o,u,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function zc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var p=u[o];if(!zc(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}tl.deserialize=function(t){return new tl(t._parameters,t._specification)},tl.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var ff={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Dl(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};zc(t)||(t=hf(t));var o=sc(t,ff);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,p,y){return o.value.evaluate(u,p,{},y)},needGeometry:function u(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var y=1;y<p.length;y++)if(u(p[y]))return!0;return!1}(t)}}function np(t,o){return t<o?-1:t>o?1:0}function hf(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?Fl(t[1],t[2],"=="):u==="!="?Bl(Fl(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Fl(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(hf))):u==="all"?["all"].concat(t.slice(1).map(hf)):u==="none"?["all"].concat(t.slice(1).map(hf).map(Bl)):u==="in"?pf(t[1],t.slice(2)):u==="!in"?Bl(pf(t[1],t.slice(2))):u==="has"?df(t[1]):u==="!has"?Bl(df(t[1])):u!=="within"||t}function Fl(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function pf(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(np)]]:["filter-in-small",t,["literal",o]]}}function df(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Bl(t){return["!",t]}function Uc(t){return zc(zt(t.value))?uu(dr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var p=u.value,y=u.key;if(Di(p)!=="array")return[new ke(y,p,"array expected, "+Di(p)+" found")];var b,S=u.styleSpec,I=[];if(p.length<1)return[new ke(y,p,"filter array must have at least 1 element")];switch(I=I.concat(uc({key:y+"[0]",value:p[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),Ft(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&Ft(p[1])==="$type"&&I.push(new ke(y,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&I.push(new ke(y,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(b=Di(p[1]))!=="string"&&I.push(new ke(y+"[1]",p[1],"string expected, "+b+" found"));for(var D=2;D<p.length;D++)b=Di(p[D]),Ft(p[1])==="$type"?I=I.concat(uc({key:y+"["+D+"]",value:p[D],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&I.push(new ke(y+"["+D+"]",p[D],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var N=1;N<p.length;N++)I=I.concat(o({key:y+"["+N+"]",value:p[N],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=Di(p[1]),p.length!==2?I.push(new ke(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):b!=="string"&&I.push(new ke(y+"[1]",p[1],"string expected, "+b+" found"));break;case"within":b=Di(p[1]),p.length!==2?I.push(new ke(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):b!=="object"&&I.push(new ke(y+"[1]",p[1],"object expected, "+b+" found"))}return I}(t)}function Sh(t,o){var u=t.key,p=t.style,y=t.styleSpec,b=t.value,S=t.objectKey,I=y[o+"_"+t.layerType];if(!I)return[];var D=S.match(/^(.*)-transition$/);if(o==="paint"&&D&&I[D[1]]&&I[D[1]].transition)return Yi({key:u,value:b,valueSpec:y.transition,style:p,styleSpec:y});var N,V=t.valueSpec||I[S];if(!V)return[new ke(u,b,'unknown property "'+S+'"')];if(Di(b)==="string"&&su(V)&&!V.tokens&&(N=/^{([^}]+)}$/.exec(b)))return[new ke(u,b,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(N[1])+" }`.")];var W=[];return t.layerType==="symbol"&&(S==="text-field"&&p&&!p.glyphs&&W.push(new ke(u,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Rl(zt(b))&&Ft(b.type)==="identity"&&W.push(new ke(u,b,'"text-font" does not support identity functions'))),W.concat(Yi({key:t.key,value:b,valueSpec:V,style:p,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:S}))}function Ch(t){return Sh(t,"paint")}function lc(t){return Sh(t,"layout")}function Ah(t){var o=[],u=t.value,p=t.key,y=t.style,b=t.styleSpec;u.type||u.ref||o.push(new ke(p,u,'either "type" or "ref" is required'));var S,I=Ft(u.type),D=Ft(u.ref);if(u.id)for(var N=Ft(u.id),V=0;V<t.arrayIndex;V++){var W=y.layers[V];Ft(W.id)===N&&o.push(new ke(p,u.id,'duplicate layer id "'+u.id+'", previously used at line '+W.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Me){Me in u&&o.push(new ke(p,u[Me],'"'+Me+'" is prohibited for ref layers'))}),y.layers.forEach(function(Me){Ft(Me.id)===D&&(S=Me)}),S?S.ref?o.push(new ke(p,u.ref,"ref cannot reference another ref layer")):I=Ft(S.type):o.push(new ke(p,u.ref,'ref layer "'+D+'" not found'));else if(I!=="background")if(u.source){var ee=y.sources&&y.sources[u.source],se=ee&&Ft(ee.type);ee?se==="vector"&&I==="raster"?o.push(new ke(p,u.source,'layer "'+u.id+'" requires a raster source')):se==="raster"&&I!=="raster"?o.push(new ke(p,u.source,'layer "'+u.id+'" requires a vector source')):se!=="vector"||u["source-layer"]?se==="raster-dem"&&I!=="hillshade"?o.push(new ke(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="line"||!u.paint||!u.paint["line-gradient"]||se==="geojson"&&ee.lineMetrics||o.push(new ke(p,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new ke(p,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new ke(p,u.source,'source "'+u.source+'" not found'))}else o.push(new ke(p,u,'missing required property "source"'));return o=o.concat($s({key:p,value:u,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Yi({key:p+".type",value:u.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:Uc,layout:function(Me){return $s({layer:u,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Oe){return lc(dr({layerType:I},Oe))}}})},paint:function(Me){return $s({layer:u,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Oe){return Ch(dr({layerType:I},Oe))}}})}}}))}function Nl(t){var o=t.value,u=t.key,p=Di(o);return p!=="string"?[new ke(u,o,"string expected, "+p+" found")]:[]}var Ji={promoteId:function(t){var o=t.key,u=t.value;if(Di(u)==="string")return Nl({key:o,value:u});var p=[];for(var y in u)p.push.apply(p,Nl({key:o+"."+y,value:u[y]}));return p}};function cc(t){var o=t.value,u=t.key,p=t.styleSpec,y=t.style;if(!o.type)return[new ke(u,o,'"type" is required')];var b,S=Ft(o.type);switch(S){case"vector":case"raster":case"raster-dem":return $s({key:u,value:o,valueSpec:p["source_"+S.replace("-","_")],style:t.style,styleSpec:p,objectElementValidators:Ji});case"geojson":if(b=$s({key:u,value:o,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:Ji}),o.cluster)for(var I in o.clusterProperties){var D=o.clusterProperties[I],N=D[0],V=typeof N=="string"?[N,["accumulated"],["get",I]]:N;b.push.apply(b,uu({key:u+"."+I+".map",value:D[1],expressionContext:"cluster-map"})),b.push.apply(b,uu({key:u+"."+I+".reduce",value:V,expressionContext:"cluster-reduce"}))}return b;case"video":return $s({key:u,value:o,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return $s({key:u,value:o,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new ke(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return uc({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:p})}}function fa(t){var o=t.value,u=t.styleSpec,p=u.light,y=t.style,b=[],S=Di(o);if(o===void 0)return b;if(S!=="object")return b.concat([new ke("light",o,"object expected, "+S+" found")]);for(var I in o){var D=I.match(/^(.*)-transition$/);b=b.concat(D&&p[D[1]]&&p[D[1]].transition?Yi({key:I,value:o[I],valueSpec:u.transition,style:y,styleSpec:u}):p[I]?Yi({key:I,value:o[I],valueSpec:p[I],style:y,styleSpec:u}):[new ke(I,o[I],'unknown property "'+I+'"')])}return b}var Uu={"*":function(){return[]},array:lf,boolean:function(t){var o=t.value,u=t.key,p=Di(o);return p!=="boolean"?[new ke(u,o,"boolean expected, "+p+" found")]:[]},number:cf,color:function(t){var o=t.key,u=t.value,p=Di(u);return p!=="string"?[new ke(o,u,"color expected, "+p+" found")]:Mi(u)===null?[new ke(o,u,'color expected, "'+u+'" found')]:[]},constants:vt,enum:uc,filter:Uc,function:Vf,layer:Ah,object:$s,source:cc,light:fa,string:Nl,formatted:function(t){return Nl(t).length===0?[]:uu(t)},resolvedImage:function(t){return Nl(t).length===0?[]:uu(t)}};function Yi(t){var o=t.value,u=t.valueSpec,p=t.styleSpec;return u.expression&&Rl(Ft(o))?Vf(t):u.expression&&oc(zt(o))?uu(t):u.type&&Uu[u.type]?Uu[u.type](t):$s(dr({},t,{valueSpec:u.type?p[u.type]:u}))}function Ia(t){var o=t.value,u=t.key,p=Nl(t);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new ke(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new ke(u,o,'"glyphs" url must include a "{range}" token'))),p}function Cs(t,o){o===void 0&&(o=he);var u=[];return u=u.concat(Yi({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Ia,"*":function(){return[]}}})),t.constants&&(u=u.concat(vt({key:"constants",value:t.constants,style:t,styleSpec:o}))),Zc(u)}function Zc(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function rl(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return Zc(t.apply(this,o))}}Cs.source=rl(cc),Cs.light=rl(fa),Cs.layer=rl(Ah),Cs.filter=rl(Uc),Cs.paintProperty=rl(Ch),Cs.layoutProperty=rl(lc);var Wa=Cs,fc=Wa.light,zl=Wa.paintProperty,nl=Wa.layoutProperty;function jc(t,o){var u=!1;if(o&&o.length)for(var p=0,y=o;p<y.length;p+=1)t.fire(new He(new Error(y[p].message))),u=!0;return u}var Zu=_o;function _o(t,o,u){var p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var b=0;b<this.d*this.d;b++){var S=y[3+b],I=y[3+b+1];p.push(S===I?null:y.subarray(S,I))}var D=y[3+p.length+1];this.keys=y.subarray(y[3+p.length],D),this.bboxes=y.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var N=0;N<this.d*this.d;N++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var V=u/o*t;this.min=-V,this.max=t+V}_o.prototype.insert=function(t,o,u,p,y){this._forEachCell(o,u,p,y,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y)},_o.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},_o.prototype._insertCell=function(t,o,u,p,y,b){this.cells[y].push(b)},_o.prototype.query=function(t,o,u,p,y){var b=this.min,S=this.max;if(t<=b&&o<=b&&S<=u&&S<=p&&!y)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(t,o,u,p,this._queryCell,I,{},y),I},_o.prototype._queryCell=function(t,o,u,p,y,b,S,I){var D=this.cells[y];if(D!==null)for(var N=this.keys,V=this.bboxes,W=0;W<D.length;W++){var ee=D[W];if(S[ee]===void 0){var se=4*ee;(I?I(V[se+0],V[se+1],V[se+2],V[se+3]):t<=V[se+2]&&o<=V[se+3]&&u>=V[se+0]&&p>=V[se+1])?(S[ee]=!0,b.push(N[ee])):S[ee]=!1}}},_o.prototype._forEachCell=function(t,o,u,p,y,b,S,I){for(var D=this._convertToCellCoord(t),N=this._convertToCellCoord(o),V=this._convertToCellCoord(u),W=this._convertToCellCoord(p),ee=D;ee<=V;ee++)for(var se=N;se<=W;se++){var Me=this.d*se+ee;if((!I||I(this._convertFromCellCoord(ee),this._convertFromCellCoord(se),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(se+1)))&&y.call(this,t,o,u,p,Me,b,S,I))return}},_o.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},_o.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},_o.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=o,S=0;S<t.length;S++){var I=t[S];y[3+S]=b,y.set(I,b),b+=I.length}return y[3+t.length]=b,y.set(this.keys,b),y[3+t.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer};var Ul=J.ImageData,hc=J.ImageBitmap,xo={};function yn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),xo[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var ho in yn("Object",Object),Zu.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},Zu.deserialize=function(t){return new Zu(t.buffer)},yn("Grid",Zu),yn("Color",ji),yn("Error",Error),yn("ResolvedImage",aa),yn("StylePropertyFunction",tl),yn("StyleExpression",Nc,{omit:["_evaluator"]}),yn("ZoomDependentExpression",ml),yn("ZoomConstantExpression",Ll),yn("CompoundExpression",to,{omit:["_evaluate"]}),Nu)Nu[ho]._classRegistryKey||yn("Expression_"+ho,Nu[ho]);function il(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Fa(t){return hc&&t instanceof hc}function lu(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(il(t)||Fa(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof Ul)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var p=[],y=0,b=t;y<b.length;y+=1)p.push(lu(b[y],o));return p}if(typeof t=="object"){var S=t.constructor,I=S._classRegistryKey;if(!I)throw new Error("can't serialize object of unregistered class");var D=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var N in t)if(t.hasOwnProperty(N)&&!(xo[I].omit.indexOf(N)>=0)){var V=t[N];D[N]=xo[I].shallow.indexOf(N)>=0?V:lu(V,o)}t instanceof Error&&(D.message=t.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return I!=="Object"&&(D.$name=I),D}throw new Error("can't serialize object of type "+typeof t)}function ks(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||il(t)||Fa(t)||ArrayBuffer.isView(t)||t instanceof Ul)return t;if(Array.isArray(t))return t.map(ks);if(typeof t=="object"){var o=t.$name||"Object",u=xo[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var p=Object.create(u.prototype),y=0,b=Object.keys(t);y<b.length;y+=1){var S=b[y];if(S!=="$name"){var I=t[S];p[S]=xo[o].shallow.indexOf(S)>=0?I:ks(I)}}return p}throw new Error("can't deserialize object of type "+typeof t)}var Vc=function(){this.first=!0};Vc.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var Yr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function vf(t){for(var o=0,u=t;o<u.length;o+=1)if(pc(u[o].charCodeAt(0)))return!0;return!1}function pc(t){return!(t!==746&&t!==747&&(t<4352||!(Yr["Bopomofo Extended"](t)||Yr.Bopomofo(t)||Yr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Yr["CJK Compatibility Ideographs"](t)||Yr["CJK Compatibility"](t)||Yr["CJK Radicals Supplement"](t)||Yr["CJK Strokes"](t)||!(!Yr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Yr["CJK Unified Ideographs Extension A"](t)||Yr["CJK Unified Ideographs"](t)||Yr["Enclosed CJK Letters and Months"](t)||Yr["Hangul Compatibility Jamo"](t)||Yr["Hangul Jamo Extended-A"](t)||Yr["Hangul Jamo Extended-B"](t)||Yr["Hangul Jamo"](t)||Yr["Hangul Syllables"](t)||Yr.Hiragana(t)||Yr["Ideographic Description Characters"](t)||Yr.Kanbun(t)||Yr["Kangxi Radicals"](t)||Yr["Katakana Phonetic Extensions"](t)||Yr.Katakana(t)&&t!==12540||!(!Yr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Yr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Yr["Unified Canadian Aboriginal Syllabics"](t)||Yr["Unified Canadian Aboriginal Syllabics Extended"](t)||Yr["Vertical Forms"](t)||Yr["Yijing Hexagram Symbols"](t)||Yr["Yi Syllables"](t)||Yr["Yi Radicals"](t))))}function ju(t){return!(pc(t)||function(o){return!!(Yr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Yr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Yr["Letterlike Symbols"](o)||Yr["Number Forms"](o)||Yr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Yr["Control Pictures"](o)&&o!==9251||Yr["Optical Character Recognition"](o)||Yr["Enclosed Alphanumerics"](o)||Yr["Geometric Shapes"](o)||Yr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Yr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Yr["CJK Symbols and Punctuation"](o)||Yr.Katakana(o)||Yr["Private Use Area"](o)||Yr["CJK Compatibility Forms"](o)||Yr["Small Form Variants"](o)||Yr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Ba(t){return t>=1424&&t<=2303||Yr["Arabic Presentation Forms-A"](t)||Yr["Arabic Presentation Forms-B"](t)}function As(t,o){return!(!o&&Ba(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Yr.Khmer(t))}function Gc(t){for(var o=0,u=t;o<u.length;o+=1)if(Ba(u[o].charCodeAt(0)))return!0;return!1}var Vu=null,as="unavailable",cu=null,wh=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(as="error"),Vu&&Vu(t)};function Hc(){Wc.fire(new Pe("pluginStateChange",{pluginStatus:as,pluginURL:cu}))}var Wc=new rt,mf=function(){return as},fu=function(){if(as!=="deferred"||!cu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");as="loading",Hc(),cu&&Va({url:cu},function(t){t?wh(t):(as="loaded",Hc())})},js={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return as==="loaded"||js.applyArabicShaping!=null},isLoading:function(){return as==="loading"},setState:function(t){as=t.pluginStatus,cu=t.pluginURL},isParsed:function(){return js.applyArabicShaping!=null&&js.processBidirectionalText!=null&&js.processStyledBidirectionalText!=null},getPluginURL:function(){return cu}},ki=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Vc,this.transition={})};ki.prototype.isSupportedScript=function(t){return function(o,u){for(var p=0,y=o;p<y.length;p+=1)if(!As(y[p].charCodeAt(0),u))return!1;return!0}(t,js.isLoaded())},ki.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ki.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var Eu=function(t,o){this.property=t,this.value=o,this.expression=function(u,p){if(Rl(u))return new tl(u,p);if(oc(u)){var y=kl(u,p);if(y.result==="error")throw new Error(y.value.map(function(S){return S.key+": "+S.message}).join(", "));return y.value}var b=u;return typeof u=="string"&&p.type==="color"&&(b=ji.parse(u)),{kind:"constant",evaluate:function(){return b}}}(o===void 0?t.specification.default:o,t.specification)};Eu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Eu.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var Vs=function(t){this.property=t,this.value=new Eu(t,void 0)};Vs.prototype.transitioned=function(t,o){return new gl(this.property,this.value,o,bt({},t.transition,this.transition),t.now)},Vs.prototype.untransitioned=function(){return new gl(this.property,this.value,null,{},0)};var So=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};So.prototype.getValue=function(t){return Je(this._values[t].value.value)},So.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new Vs(this._values[t].property)),this._values[t].value=new Eu(this._values[t].property,o===null?void 0:Je(o))},So.prototype.getTransition=function(t){return Je(this._values[t].transition)},So.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new Vs(this._values[t].property)),this._values[t].transition=Je(o)||void 0},So.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],y=this.getValue(p);y!==void 0&&(t[p]=y);var b=this.getTransition(p);b!==void 0&&(t[p+"-transition"]=b)}return t},So.prototype.transitioned=function(t,o){for(var u=new al(this._properties),p=0,y=Object.keys(this._values);p<y.length;p+=1){var b=y[p];u._values[b]=this._values[b].transitioned(t,o._values[b])}return u},So.prototype.untransitioned=function(){for(var t=new al(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o];t._values[p]=this._values[p].untransitioned()}return t};var gl=function(t,o,u,p,y){this.property=t,this.value=o,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=u)};gl.prototype.possiblyEvaluate=function(t,o,u){var p=t.now||0,y=this.value.possiblyEvaluate(t,o,u),b=this.prior;if(b){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return b.possiblyEvaluate(t,o,u);var S=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o,u),y,function(I){if(I<=0)return 0;if(I>=1)return 1;var D=I*I,N=D*I;return 4*(I<.5?N:3*(I-D)+N-.75)}(S))}return y};var al=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};al.prototype.possiblyEvaluate=function(t,o,u){for(var p=new Gs(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];p._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return p},al.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var Qs=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Qs.prototype.getValue=function(t){return Je(this._values[t].value)},Qs.prototype.setValue=function(t,o){this._values[t]=new Eu(this._values[t].property,o===null?void 0:Je(o))},Qs.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],y=this.getValue(p);y!==void 0&&(t[p]=y)}return t},Qs.prototype.possiblyEvaluate=function(t,o,u){for(var p=new Gs(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];p._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return p};var hs=function(t,o,u){this.property=t,this.value=o,this.parameters=u};hs.prototype.isConstant=function(){return this.value.kind==="constant"},hs.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},hs.prototype.evaluate=function(t,o,u,p){return this.property.evaluate(this.value,this.parameters,t,o,u,p)};var Gs=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Gs.prototype.get=function(t){return this._values[t]};var Fn=function(t){this.specification=t};Fn.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},Fn.prototype.interpolate=function(t,o,u){var p=Ca[this.specification.type];return p?p(t,o,u):t};var Tn=function(t,o){this.specification=t,this.overrides=o};Tn.prototype.possiblyEvaluate=function(t,o,u,p){return new hs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,p)}:t.expression,o)},Tn.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new hs(this,{kind:"constant",value:void 0},t.parameters);var p=Ca[this.specification.type];return p?new hs(this,{kind:"constant",value:p(t.value.value,o.value.value,u)},t.parameters):t},Tn.prototype.evaluate=function(t,o,u,p,y,b){return t.kind==="constant"?t.value:t.evaluate(o,u,p,y,b)};var Xc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p,y,b){if(u.value===void 0)return new hs(this,{kind:"constant",value:void 0},p);if(u.expression.kind==="constant"){var S=u.expression.evaluate(p,null,{},y,b),I=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,D=this._calculate(I,I,I,p);return new hs(this,{kind:"constant",value:D},p)}if(u.expression.kind==="camera"){var N=this._calculate(u.expression.evaluate({zoom:p.zoom-1}),u.expression.evaluate({zoom:p.zoom}),u.expression.evaluate({zoom:p.zoom+1}),p);return new hs(this,{kind:"constant",value:N},p)}return new hs(this,u.expression,p)},o.prototype.evaluate=function(u,p,y,b,S,I){if(u.kind==="source"){var D=u.evaluate(p,y,b,S,I);return this._calculate(D,D,D,p)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(p.zoom)-1},y,b),u.evaluate({zoom:Math.floor(p.zoom)},y,b),u.evaluate({zoom:Math.floor(p.zoom)+1},y,b),p):u.value},o.prototype._calculate=function(u,p,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:p}:{from:y,to:p}},o.prototype.interpolate=function(u){return u},o}(Tn),ps=function(t){this.specification=t};ps.prototype.possiblyEvaluate=function(t,o,u,p){if(t.value!==void 0){if(t.expression.kind==="constant"){var y=t.expression.evaluate(o,null,{},u,p);return this._calculate(y,y,y,o)}return this._calculate(t.expression.evaluate(new ki(Math.floor(o.zoom-1),o)),t.expression.evaluate(new ki(Math.floor(o.zoom),o)),t.expression.evaluate(new ki(Math.floor(o.zoom+1),o)),o)}},ps.prototype._calculate=function(t,o,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},ps.prototype.interpolate=function(t){return t};var Ro=function(t){this.specification=t};Ro.prototype.possiblyEvaluate=function(t,o,u,p){return!!t.expression.evaluate(o,null,{},u,p)},Ro.prototype.interpolate=function(){return!1};var os=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var p=this.defaultPropertyValues[o]=new Eu(u,void 0),y=this.defaultTransitionablePropertyValues[o]=new Vs(u);this.defaultTransitioningPropertyValues[o]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}};yn("DataDrivenProperty",Tn),yn("DataConstantProperty",Fn),yn("CrossFadedDataDrivenProperty",Xc),yn("CrossFadedProperty",ps),yn("ColorRampProperty",Ro);var Gu=function(t){function o(u,p){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),p.layout&&(this._unevaluatedLayout=new Qs(p.layout)),p.paint)){for(var y in this._transitionablePaint=new So(p.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Gs(p.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,p,y){y===void 0&&(y={}),p!=null&&this._validate(nl,"layers."+this.id+".layout."+u,u,p,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,p):this.visibility=p)},o.prototype.getPaintProperty=function(u){return q(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,p,y){if(y===void 0&&(y={}),p!=null&&this._validate(zl,"layers."+this.id+".paint."+u,u,p,y))return!1;if(q(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),p||void 0),!1;var b=this._transitionablePaint._values[u],S=b.property.specification["property-type"]==="cross-faded-data-driven",I=b.value.isDataDriven(),D=b.value;this._transitionablePaint.setValue(u,p),this._handleSpecialPaintPropertyUpdate(u);var N=this._transitionablePaint._values[u].value;return N.isDataDriven()||I||S||this._handleOverridablePaintPropertyUpdate(u,D,N)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,p){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,p)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),ft(u,function(p,y){return!(p===void 0||y==="layout"&&!Object.keys(p).length||y==="paint"&&!Object.keys(p).length)})},o.prototype._validate=function(u,p,y,b,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&jc(this,u.call(Wa,{key:p,layerType:this.type,objectKey:y,value:b,styleSpec:he,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var p=this.paint.get(u);if(p instanceof hs&&su(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},o}(rt),gf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},yf=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ra=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Oa(t,o){o===void 0&&(o=1);var u=0,p=0;return{members:t.map(function(y){var b=gf[y.type].BYTES_PER_ELEMENT,S=u=Gf(u,Math.max(o,b)),I=y.components||1;return p=Math.max(p,b),u+=b*I,{name:y.name,type:y.type,components:I,offset:S}}),size:Gf(u,Math.max(p,o)),alignment:o}}function Gf(t,o){return Math.ceil(t/o)*o}ra.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},ra.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},ra.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ra.prototype.clear=function(){this.length=0},ra.prototype.resize=function(t){this.reserve(t),this.length=t},ra.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},ra.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var yl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.int16[b+0]=p,this.int16[b+1]=y,u},o}(ra);yl.prototype.bytesPerElement=4,yn("StructArrayLayout2i4",yl);var hu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var I=4*u;return this.int16[I+0]=p,this.int16[I+1]=y,this.int16[I+2]=b,this.int16[I+3]=S,u},o}(ra);hu.prototype.bytesPerElement=8,yn("StructArrayLayout4i8",hu);var Su=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,S,I)},o.prototype.emplace=function(u,p,y,b,S,I,D){var N=6*u;return this.int16[N+0]=p,this.int16[N+1]=y,this.int16[N+2]=b,this.int16[N+3]=S,this.int16[N+4]=I,this.int16[N+5]=D,u},o}(ra);Su.prototype.bytesPerElement=12,yn("StructArrayLayout2i4i12",Su);var Lo=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,S,I)},o.prototype.emplace=function(u,p,y,b,S,I,D){var N=4*u,V=8*u;return this.int16[N+0]=p,this.int16[N+1]=y,this.uint8[V+4]=b,this.uint8[V+5]=S,this.uint8[V+6]=I,this.uint8[V+7]=D,u},o}(ra);Lo.prototype.bytesPerElement=8,yn("StructArrayLayout2i4ub8",Lo);var _l=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.float32[b+0]=p,this.float32[b+1]=y,u},o}(ra);_l.prototype.bytesPerElement=8,yn("StructArrayLayout2f8",_l);var Cu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I,D,N,V,W){var ee=this.length;return this.resize(ee+1),this.emplace(ee,u,p,y,b,S,I,D,N,V,W)},o.prototype.emplace=function(u,p,y,b,S,I,D,N,V,W,ee){var se=10*u;return this.uint16[se+0]=p,this.uint16[se+1]=y,this.uint16[se+2]=b,this.uint16[se+3]=S,this.uint16[se+4]=I,this.uint16[se+5]=D,this.uint16[se+6]=N,this.uint16[se+7]=V,this.uint16[se+8]=W,this.uint16[se+9]=ee,u},o}(ra);Cu.prototype.bytesPerElement=20,yn("StructArrayLayout10ui20",Cu);var _f=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I,D,N,V,W,ee,se){var Me=this.length;return this.resize(Me+1),this.emplace(Me,u,p,y,b,S,I,D,N,V,W,ee,se)},o.prototype.emplace=function(u,p,y,b,S,I,D,N,V,W,ee,se,Me){var Oe=12*u;return this.int16[Oe+0]=p,this.int16[Oe+1]=y,this.int16[Oe+2]=b,this.int16[Oe+3]=S,this.uint16[Oe+4]=I,this.uint16[Oe+5]=D,this.uint16[Oe+6]=N,this.uint16[Oe+7]=V,this.int16[Oe+8]=W,this.int16[Oe+9]=ee,this.int16[Oe+10]=se,this.int16[Oe+11]=Me,u},o}(ra);_f.prototype.bytesPerElement=24,yn("StructArrayLayout4i4ui4i24",_f);var Zl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.float32[S+0]=p,this.float32[S+1]=y,this.float32[S+2]=b,u},o}(ra);Zl.prototype.bytesPerElement=12,yn("StructArrayLayout3f12",Zl);var Au=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint32[1*u+0]=p,u},o}(ra);Au.prototype.bytesPerElement=4,yn("StructArrayLayout1ul4",Au);var Hf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I,D,N,V){var W=this.length;return this.resize(W+1),this.emplace(W,u,p,y,b,S,I,D,N,V)},o.prototype.emplace=function(u,p,y,b,S,I,D,N,V,W){var ee=10*u,se=5*u;return this.int16[ee+0]=p,this.int16[ee+1]=y,this.int16[ee+2]=b,this.int16[ee+3]=S,this.int16[ee+4]=I,this.int16[ee+5]=D,this.uint32[se+3]=N,this.uint16[ee+8]=V,this.uint16[ee+9]=W,u},o}(ra);Hf.prototype.bytesPerElement=20,yn("StructArrayLayout6i1ul2ui20",Hf);var xl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,S,I)},o.prototype.emplace=function(u,p,y,b,S,I,D){var N=6*u;return this.int16[N+0]=p,this.int16[N+1]=y,this.int16[N+2]=b,this.int16[N+3]=S,this.int16[N+4]=I,this.int16[N+5]=D,u},o}(ra);xl.prototype.bytesPerElement=12,yn("StructArrayLayout2i2i2i12",xl);var bl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S){var I=this.length;return this.resize(I+1),this.emplace(I,u,p,y,b,S)},o.prototype.emplace=function(u,p,y,b,S,I){var D=4*u,N=8*u;return this.float32[D+0]=p,this.float32[D+1]=y,this.float32[D+2]=b,this.int16[N+6]=S,this.int16[N+7]=I,u},o}(ra);bl.prototype.bytesPerElement=16,yn("StructArrayLayout2f1f2i16",bl);var Ea=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var I=12*u,D=3*u;return this.uint8[I+0]=p,this.uint8[I+1]=y,this.float32[D+1]=b,this.float32[D+2]=S,u},o}(ra);Ea.prototype.bytesPerElement=12,yn("StructArrayLayout2ub2f12",Ea);var Js=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.uint16[S+0]=p,this.uint16[S+1]=y,this.uint16[S+2]=b,u},o}(ra);Js.prototype.bytesPerElement=6,yn("StructArrayLayout3ui6",Js);var pu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I,D,N,V,W,ee,se,Me,Oe,qe,Ue,ut){var Mt=this.length;return this.resize(Mt+1),this.emplace(Mt,u,p,y,b,S,I,D,N,V,W,ee,se,Me,Oe,qe,Ue,ut)},o.prototype.emplace=function(u,p,y,b,S,I,D,N,V,W,ee,se,Me,Oe,qe,Ue,ut,Mt){var Gt=24*u,Wt=12*u,lr=48*u;return this.int16[Gt+0]=p,this.int16[Gt+1]=y,this.uint16[Gt+2]=b,this.uint16[Gt+3]=S,this.uint32[Wt+2]=I,this.uint32[Wt+3]=D,this.uint32[Wt+4]=N,this.uint16[Gt+10]=V,this.uint16[Gt+11]=W,this.uint16[Gt+12]=ee,this.float32[Wt+7]=se,this.float32[Wt+8]=Me,this.uint8[lr+36]=Oe,this.uint8[lr+37]=qe,this.uint8[lr+38]=Ue,this.uint32[Wt+10]=ut,this.int16[Gt+22]=Mt,u},o}(ra);pu.prototype.bytesPerElement=48,yn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",pu);var jl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,I,D,N,V,W,ee,se,Me,Oe,qe,Ue,ut,Mt,Gt,Wt,lr,Or,Kr,Un,hn,Vn,dn,Ii){var Hn=this.length;return this.resize(Hn+1),this.emplace(Hn,u,p,y,b,S,I,D,N,V,W,ee,se,Me,Oe,qe,Ue,ut,Mt,Gt,Wt,lr,Or,Kr,Un,hn,Vn,dn,Ii)},o.prototype.emplace=function(u,p,y,b,S,I,D,N,V,W,ee,se,Me,Oe,qe,Ue,ut,Mt,Gt,Wt,lr,Or,Kr,Un,hn,Vn,dn,Ii,Hn){var An=34*u,Ui=17*u;return this.int16[An+0]=p,this.int16[An+1]=y,this.int16[An+2]=b,this.int16[An+3]=S,this.int16[An+4]=I,this.int16[An+5]=D,this.int16[An+6]=N,this.int16[An+7]=V,this.uint16[An+8]=W,this.uint16[An+9]=ee,this.uint16[An+10]=se,this.uint16[An+11]=Me,this.uint16[An+12]=Oe,this.uint16[An+13]=qe,this.uint16[An+14]=Ue,this.uint16[An+15]=ut,this.uint16[An+16]=Mt,this.uint16[An+17]=Gt,this.uint16[An+18]=Wt,this.uint16[An+19]=lr,this.uint16[An+20]=Or,this.uint16[An+21]=Kr,this.uint16[An+22]=Un,this.uint32[Ui+12]=hn,this.float32[Ui+13]=Vn,this.float32[Ui+14]=dn,this.float32[Ui+15]=Ii,this.float32[Ui+16]=Hn,u},o}(ra);jl.prototype.bytesPerElement=68,yn("StructArrayLayout8i15ui1ul4f68",jl);var wu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.float32[1*u+0]=p,u},o}(ra);wu.prototype.bytesPerElement=4,yn("StructArrayLayout1f4",wu);var ws=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.int16[S+0]=p,this.int16[S+1]=y,this.int16[S+2]=b,u},o}(ra);ws.prototype.bytesPerElement=6,yn("StructArrayLayout3i6",ws);var Yc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=4*u;return this.uint32[2*u+0]=p,this.uint16[S+2]=y,this.uint16[S+3]=b,u},o}(ra);Yc.prototype.bytesPerElement=8,yn("StructArrayLayout1ul2ui8",Yc);var Na=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.uint16[b+0]=p,this.uint16[b+1]=y,u},o}(ra);Na.prototype.bytesPerElement=4,yn("StructArrayLayout2ui4",Na);var ol=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint16[1*u+0]=p,u},o}(ra);ol.prototype.bytesPerElement=2,yn("StructArrayLayout1ui2",ol);var Hu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var I=4*u;return this.float32[I+0]=p,this.float32[I+1]=y,this.float32[I+2]=b,this.float32[I+3]=S,u},o}(ra);Hu.prototype.bytesPerElement=16,yn("StructArrayLayout4f16",Hu);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new fe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(yf);l.prototype.size=20;var h=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(Hf);yn("CollisionBoxArray",h);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(yf);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(pu);yn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(yf);E.prototype.size=68;var w=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(jl);yn("SymbolInstanceArray",w);var M=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(wu);yn("GlyphOffsetArray",M);var L=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(ws);yn("SymbolLineVertexArray",L);var U=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(yf);U.prototype.size=8;var Y=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new U(this,u)},o}(Yc);yn("FeatureIndexArray",Y);var le=Oa([{name:"a_pos",components:2,type:"Int16"}],4).members,pe=function(t){t===void 0&&(t=[]),this.segments=t};function ve(t,o){return 256*(t=yt(Math.floor(t),0,255))+yt(Math.floor(o),0,255)}pe.prototype.prepareSegment=function(t,o,u,p){var y=this.segments[this.segments.length-1];return t>pe.MAX_VERTEX_ARRAY_LENGTH&&Qe("Max vertices per segment is "+pe.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!y||y.vertexLength+t>pe.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y},pe.prototype.get=function(){return this.segments},pe.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var p in u.vaos)u.vaos[p].destroy()}},pe.simpleSegment=function(t,o,u,p){return new pe([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])},pe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yn("SegmentVector",pe);var Re=Oa([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ie=de(function(t){t.exports=function(o,u){var p,y,b,S,I,D,N,V;for(y=o.length-(p=3&o.length),b=u,I=3432918353,D=461845907,V=0;V<y;)N=255&o.charCodeAt(V)|(255&o.charCodeAt(++V))<<8|(255&o.charCodeAt(++V))<<16|(255&o.charCodeAt(++V))<<24,++V,b=27492+(65535&(S=5*(65535&(b=(b^=N=(65535&(N=(N=(65535&N)*I+(((N>>>16)*I&65535)<<16)&4294967295)<<15|N>>>17))*D+(((N>>>16)*D&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(N=0,p){case 3:N^=(255&o.charCodeAt(V+2))<<16;case 2:N^=(255&o.charCodeAt(V+1))<<8;case 1:b^=N=(65535&(N=(N=(65535&(N^=255&o.charCodeAt(V)))*I+(((N>>>16)*I&65535)<<16)&4294967295)<<15|N>>>17))*D+(((N>>>16)*D&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),je=de(function(t){t.exports=function(o,u){for(var p,y=o.length,b=u^y,S=0;y>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:b^=(255&o.charCodeAt(S+2))<<16;case 2:b^=(255&o.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),we=Ie,Ge=je;we.murmur3=Ie,we.murmur2=Ge;var tt=function(){this.ids=[],this.positions=[],this.indexed=!1};tt.prototype.add=function(t,o,u,p){this.ids.push(Ht(t)),this.positions.push(o,u,p)},tt.prototype.getPositions=function(t){for(var o=Ht(t),u=0,p=this.ids.length-1;u<p;){var y=u+p>>1;this.ids[y]>=o?p=y:u=y+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},tt.serialize=function(t,o){var u=new Float64Array(t.ids),p=new Uint32Array(t.positions);return function y(b,S,I,D){for(;I<D;){for(var N=b[I+D>>1],V=I-1,W=D+1;;){do V++;while(b[V]<N);do W--;while(b[W]>N);if(V>=W)break;Zt(b,V,W),Zt(S,3*V,3*W),Zt(S,3*V+1,3*W+1),Zt(S,3*V+2,3*W+2)}W-I<D-W?(y(b,S,I,W),I=W+1):(y(b,S,W+1,D),D=W)}}(u,p,0,u.length-1),o&&o.push(u.buffer,p.buffer),{ids:u,positions:p}},tt.deserialize=function(t){var o=new tt;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var xt=Math.pow(2,53)-1;function Ht(t){var o=+t;return!isNaN(o)&&o<=xt?o:we(String(t))}function Zt(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}yn("FeaturePositionMap",tt);var Jt=function(t,o){this.gl=t.gl,this.location=o},mr=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(Jt),Br=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(Jt),kr=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(Jt),un=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(Jt),Mn=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(Jt),Nn=function(t){function o(u,p){t.call(this,u,p),this.current=ji.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(Jt),Rn=new Float32Array(16),Fi=function(t){function o(u,p){t.call(this,u,p),this.current=Rn}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var p=1;p<16;p++)if(u[p]!==this.current[p]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(Jt);function ln(t){return[ve(255*t.r,255*t.g),ve(255*t.b,255*t.a)]}var oi=function(t,o,u){this.value=t,this.uniformNames=o.map(function(p){return"u_"+p}),this.type=u};oi.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},oi.prototype.getBinding=function(t,o,u){return this.type==="color"?new Nn(t,o):new Br(t,o)};var si=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};si.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},si.prototype.setUniform=function(t,o,u,p){var y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)},si.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Mn(t,o):new Br(t,o)};var ni=function(t,o,u,p){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new p};ni.prototype.populatePaintArray=function(t,o,u,p,y){var b=this.paintVertexArray.length,S=this.expression.evaluate(new ki(0),o,{},p,[],y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)},ni.prototype.updatePaintArray=function(t,o,u,p){var y=this.expression.evaluate({zoom:0},u,p);this._setPaintValue(t,o,y)},ni.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var p=ln(u),y=t;y<o;y++)this.paintVertexArray.emplace(y,p[0],p[1]);else{for(var b=t;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},ni.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ni.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Xn=function(t,o,u,p,y,b){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Xn.prototype.populatePaintArray=function(t,o,u,p,y){var b=this.expression.evaluate(new ki(this.zoom),o,{},p,[],y),S=this.expression.evaluate(new ki(this.zoom+1),o,{},p,[],y),I=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(I,t,b,S)},Xn.prototype.updatePaintArray=function(t,o,u,p){var y=this.expression.evaluate({zoom:this.zoom},u,p),b=this.expression.evaluate({zoom:this.zoom+1},u,p);this._setPaintValue(t,o,y,b)},Xn.prototype._setPaintValue=function(t,o,u,p){if(this.type==="color")for(var y=ln(u),b=ln(p),S=t;S<o;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1]);else{for(var I=t;I<o;I++)this.paintVertexArray.emplace(I,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}},Xn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Xn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Xn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=yt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(p)},Xn.prototype.getBinding=function(t,o,u){return new Br(t,o)};var yi=function(t,o,u,p,y,b){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=p,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};yi.prototype.populatePaintArray=function(t,o,u){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,o.patterns&&o.patterns[this.layerId],u)},yi.prototype.updatePaintArray=function(t,o,u,p,y){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],y)},yi.prototype._setPaintValues=function(t,o,u,p){if(p&&u){var y=p[u.min],b=p[u.mid],S=p[u.max];if(y&&b&&S)for(var I=t;I<o;I++)this.zoomInPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],b.pixelRatio,S.pixelRatio)}},yi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Re.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Re.members,this.expression.isStateDependent))},yi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Kn=function(t,o,u){this.binders={},this._buffers=[];var p=[];for(var y in t.paint._values)if(u(y)){var b=t.paint.get(y);if(b instanceof hs&&su(b.property.specification)){var S=Co(y,t.type),I=b.value,D=b.property.specification.type,N=b.property.useIntegerZoom,V=b.property.specification["property-type"],W=V==="cross-faded"||V==="cross-faded-data-driven";if(I.kind==="constant")this.binders[y]=W?new si(I.value,S):new oi(I.value,S,D),p.push("/u_"+y);else if(I.kind==="source"||W){var ee=Ya(y,D,"source");this.binders[y]=W?new yi(I,D,N,o,ee,t.id):new ni(I,S,D,ee),p.push("/a_"+y)}else{var se=Ya(y,D,"composite");this.binders[y]=new Xn(I,S,D,N,o,se),p.push("/z_"+y)}}}this.cacheKey=p.sort().join("")};Kn.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof ni||o instanceof Xn?o.maxValue:0},Kn.prototype.populatePaintArrays=function(t,o,u,p,y){for(var b in this.binders){var S=this.binders[b];(S instanceof ni||S instanceof Xn||S instanceof yi)&&S.populatePaintArray(t,o,u,p,y)}},Kn.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var p=this.binders[u];p instanceof si&&p.setConstantPatternPositions(t,o)}},Kn.prototype.updatePaintArrays=function(t,o,u,p,y){var b=!1;for(var S in t)for(var I=0,D=o.getPositions(S);I<D.length;I+=1){var N=D[I],V=u.feature(N.index);for(var W in this.binders){var ee=this.binders[W];if((ee instanceof ni||ee instanceof Xn||ee instanceof yi)&&ee.expression.isStateDependent===!0){var se=p.paint.get(W);ee.expression=se.value,ee.updatePaintArray(N.start,N.end,V,t[S],y),b=!0}}}return b},Kn.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof oi||u instanceof si)&&t.push.apply(t,u.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return t},Kn.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ni||u instanceof Xn)for(var p=0;p<u.paintVertexAttributes.length;p++)t.push(u.paintVertexAttributes[p].name);else if(u instanceof yi)for(var y=0;y<Re.members.length;y++)t.push(Re.members[y].name)}return t},Kn.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof oi||u instanceof si||u instanceof Xn)for(var p=0,y=u.uniformNames;p<y.length;p+=1)t.push(y[p])}return t},Kn.prototype.getPaintVertexBuffers=function(){return this._buffers},Kn.prototype.getUniforms=function(t,o){var u=[];for(var p in this.binders){var y=this.binders[p];if(y instanceof oi||y instanceof si||y instanceof Xn)for(var b=0,S=y.uniformNames;b<S.length;b+=1){var I=S[b];if(o[I]){var D=y.getBinding(t,o[I],I);u.push({name:I,property:p,binding:D})}}}return u},Kn.prototype.setUniforms=function(t,o,u,p){for(var y=0,b=o;y<b.length;y+=1){var S=b[y],I=S.name,D=S.property;this.binders[D].setUniform(S.binding,p,u.get(D),I)}},Kn.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof yi){var p=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof ni||u instanceof Xn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},Kn.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof ni||u instanceof Xn||u instanceof yi)&&u.upload(t)}this.updatePaintBuffers()},Kn.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof ni||o instanceof Xn||o instanceof yi)&&o.destroy()}};var Yn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var p=0,y=t;p<y.length;p+=1){var b=y[p];this.programConfigurations[b.id]=new Kn(b,o,u)}this.needsUpload=!1,this._featureMap=new tt,this._bufferOffset=0};function Co(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function Ya(t,o,u){var p={color:{source:_l,composite:Hu},number:{source:wu,composite:_l}},y=function(b){return{"line-pattern":{source:Cu,composite:Cu},"fill-pattern":{source:Cu,composite:Cu},"fill-extrusion-pattern":{source:Cu,composite:Cu}}[b]}(t);return y&&y[u]||p[o][u]}Yn.prototype.populatePaintArrays=function(t,o,u,p,y,b){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,p,y,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Yn.prototype.updatePaintArrays=function(t,o,u,p){for(var y=0,b=u;y<b.length;y+=1){var S=b[y];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,p)||this.needsUpload}},Yn.prototype.get=function(t){return this.programConfigurations[t]},Yn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},Yn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},yn("ConstantBinder",oi),yn("CrossFadedConstantBinder",si),yn("SourceExpressionBinder",ni),yn("CrossFadedCompositeBinder",yi),yn("CompositeExpressionBinder",Xn),yn("ProgramConfiguration",Kn,{omit:["_buffers"]}),yn("ProgramConfigurationSet",Yn);var Ao=Math.pow(2,14)-1,Go=-Ao-1;function no(t){for(var o=8192/t.extent,u=t.loadGeometry(),p=0;p<u.length;p++)for(var y=u[p],b=0;b<y.length;b++){var S=y[b],I=Math.round(S.x*o),D=Math.round(S.y*o);S.x=yt(I,Go,Ao),S.y=yt(D,Go,Ao),(I<S.x||I>S.x+1||D<S.y||D>S.y+1)&&Qe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function po(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?no(t):[]}}function Ds(t,o,u,p,y){t.emplaceBack(2*o+(p+1)/2,2*u+(y+1)/2)}var ds=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new yl,this.indexArray=new Js,this.segments=new pe,this.programConfigurations=new Yn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Wu(t,o){for(var u=0;u<t.length;u++)if(gu(o,t[u]))return!0;for(var p=0;p<o.length;p++)if(gu(t,o[p]))return!0;return!!dc(t,o)}function qa(t,o,u){return!!gu(t,o)||!!mu(o,t,u)}function du(t,o){if(t.length===1)return vc(o,t[0]);for(var u=0;u<o.length;u++)for(var p=o[u],y=0;y<p.length;y++)if(gu(t,p[y]))return!0;for(var b=0;b<t.length;b++)if(vc(o,t[b]))return!0;for(var S=0;S<o.length;S++)if(dc(t,o[S]))return!0;return!1}function $o(t,o,u){if(t.length>1){if(dc(t,o))return!0;for(var p=0;p<o.length;p++)if(mu(o[p],t,u))return!0}for(var y=0;y<t.length;y++)if(mu(t[y],o,u))return!0;return!1}function dc(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var p=t[u],y=t[u+1],b=0;b<o.length-1;b++)if(vu(p,y,o[b],o[b+1]))return!0;return!1}function vu(t,o,u,p){return Qt(t,u,p)!==Qt(o,u,p)&&Qt(t,o,u)!==Qt(t,o,p)}function mu(t,o,u){var p=u*u;if(o.length===1)return t.distSqr(o[0])<p;for(var y=1;y<o.length;y++)if(Vl(t,o[y-1],o[y])<p)return!0;return!1}function Vl(t,o,u){var p=o.distSqr(u);if(p===0)return t.distSqr(o);var y=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/p;return t.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function vc(t,o){for(var u,p,y,b=!1,S=0;S<t.length;S++)for(var I=0,D=(u=t[S]).length-1;I<u.length;D=I++)(p=u[I]).y>o.y!=(y=u[D]).y>o.y&&o.x<(y.x-p.x)*(o.y-p.y)/(y.y-p.y)+p.x&&(b=!b);return b}function gu(t,o){for(var u=!1,p=0,y=t.length-1;p<t.length;y=p++){var b=t[p],S=t[y];b.y>o.y!=S.y>o.y&&o.x<(S.x-b.x)*(o.y-b.y)/(S.y-b.y)+b.x&&(u=!u)}return u}function Gl(t,o,u){var p=u[0],y=u[2];if(t.x<p.x&&o.x<p.x||t.x>y.x&&o.x>y.x||t.y<p.y&&o.y<p.y||t.y>y.y&&o.y>y.y)return!1;var b=Qt(t,o,u[0]);return b!==Qt(t,o,u[1])||b!==Qt(t,o,u[2])||b!==Qt(t,o,u[3])}function Ra(t,o,u){var p=o.paint.get(t).value;return p.kind==="constant"?p.value:u.programConfigurations.get(o.id).getMaxValue(t)}function qi(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function eu(t,o,u,p,y){if(!o[0]&&!o[1])return t;var b=fe.convert(o)._mult(y);u==="viewport"&&b._rotate(-p);for(var S=[],I=0;I<t.length;I++)S.push(t[I].sub(b));return S}ds.prototype.populate=function(t,o,u){var p=this.layers[0],y=[],b=null;p.type==="circle"&&(b=p.layout.get("circle-sort-key"));for(var S=0,I=t;S<I.length;S+=1){var D=I[S],N=D.feature,V=D.id,W=D.index,ee=D.sourceLayerIndex,se=this.layers[0]._featureFilter.needGeometry,Me=po(N,se);if(this.layers[0]._featureFilter.filter(new ki(this.zoom),Me,u)){var Oe=b?b.evaluate(Me,{},u):void 0,qe={id:V,properties:N.properties,type:N.type,sourceLayerIndex:ee,index:W,geometry:se?Me.geometry:no(N),patterns:{},sortKey:Oe};y.push(qe)}}b&&y.sort(function(Kr,Un){return Kr.sortKey-Un.sortKey});for(var Ue=0,ut=y;Ue<ut.length;Ue+=1){var Mt=ut[Ue],Gt=Mt.geometry,Wt=Mt.index,lr=Mt.sourceLayerIndex,Or=t[Wt].feature;this.addFeature(Mt,Gt,Wt,u),o.featureIndex.insert(Or,Gt,Wt,lr,this.index)}},ds.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},ds.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ds.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ds.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,le),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ds.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ds.prototype.addFeature=function(t,o,u,p){for(var y=0,b=o;y<b.length;y+=1)for(var S=0,I=b[y];S<I.length;S+=1){var D=I[S],N=D.x,V=D.y;if(!(N<0||N>=8192||V<0||V>=8192)){var W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),ee=W.vertexLength;Ds(this.layoutVertexArray,N,V,-1,-1),Ds(this.layoutVertexArray,N,V,1,-1),Ds(this.layoutVertexArray,N,V,1,1),Ds(this.layoutVertexArray,N,V,-1,1),this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+3,ee+2),W.vertexLength+=4,W.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},p)},yn("CircleBucket",ds,{omit:["layers"]});var Xu=new os({"circle-sort-key":new Tn(he.layout_circle["circle-sort-key"])}),Hs={paint:new os({"circle-radius":new Tn(he.paint_circle["circle-radius"]),"circle-color":new Tn(he.paint_circle["circle-color"]),"circle-blur":new Tn(he.paint_circle["circle-blur"]),"circle-opacity":new Tn(he.paint_circle["circle-opacity"]),"circle-translate":new Fn(he.paint_circle["circle-translate"]),"circle-translate-anchor":new Fn(he.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Fn(he.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Fn(he.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Tn(he.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Tn(he.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Tn(he.paint_circle["circle-stroke-opacity"])}),layout:Xu},ha=typeof Float32Array!="undefined"?Float32Array:Array;function tu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ts(t,o,u){var p=o[0],y=o[1],b=o[2],S=o[3],I=o[4],D=o[5],N=o[6],V=o[7],W=o[8],ee=o[9],se=o[10],Me=o[11],Oe=o[12],qe=o[13],Ue=o[14],ut=o[15],Mt=u[0],Gt=u[1],Wt=u[2],lr=u[3];return t[0]=Mt*p+Gt*I+Wt*W+lr*Oe,t[1]=Mt*y+Gt*D+Wt*ee+lr*qe,t[2]=Mt*b+Gt*N+Wt*se+lr*Ue,t[3]=Mt*S+Gt*V+Wt*Me+lr*ut,t[4]=(Mt=u[4])*p+(Gt=u[5])*I+(Wt=u[6])*W+(lr=u[7])*Oe,t[5]=Mt*y+Gt*D+Wt*ee+lr*qe,t[6]=Mt*b+Gt*N+Wt*se+lr*Ue,t[7]=Mt*S+Gt*V+Wt*Me+lr*ut,t[8]=(Mt=u[8])*p+(Gt=u[9])*I+(Wt=u[10])*W+(lr=u[11])*Oe,t[9]=Mt*y+Gt*D+Wt*ee+lr*qe,t[10]=Mt*b+Gt*N+Wt*se+lr*Ue,t[11]=Mt*S+Gt*V+Wt*Me+lr*ut,t[12]=(Mt=u[12])*p+(Gt=u[13])*I+(Wt=u[14])*W+(lr=u[15])*Oe,t[13]=Mt*y+Gt*D+Wt*ee+lr*qe,t[14]=Mt*b+Gt*N+Wt*se+lr*Ue,t[15]=Mt*S+Gt*V+Wt*Me+lr*ut,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var El,mc=Ts;function Fs(t,o,u){var p=o[0],y=o[1],b=o[2],S=o[3];return t[0]=u[0]*p+u[4]*y+u[8]*b+u[12]*S,t[1]=u[1]*p+u[5]*y+u[9]*b+u[13]*S,t[2]=u[2]*p+u[6]*y+u[10]*b+u[14]*S,t[3]=u[3]*p+u[7]*y+u[11]*b+u[15]*S,t}El=new ha(3),ha!=Float32Array&&(El[0]=0,El[1]=0,El[2]=0),function(){var t=new ha(4);ha!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Wf=(function(){var t=new ha(2);ha!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,Hs)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new ds(u)},o.prototype.queryRadius=function(u){var p=u;return Ra("circle-radius",this,p)+Ra("circle-stroke-width",this,p)+qi(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,I,D,N){for(var V=eu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),I.angle,D),W=this.paint.get("circle-radius").evaluate(p,y)+this.paint.get("circle-stroke-width").evaluate(p,y),ee=this.paint.get("circle-pitch-alignment")==="map",se=ee?V:function(Or,Kr){return Or.map(function(Un){return yu(Un,Kr)})}(V,N),Me=ee?W*D:W,Oe=0,qe=b;Oe<qe.length;Oe+=1)for(var Ue=0,ut=qe[Oe];Ue<ut.length;Ue+=1){var Mt=ut[Ue],Gt=ee?Mt:yu(Mt,N),Wt=Me,lr=Fs([],[Mt.x,Mt.y,0,1],N);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Wt*=lr[3]/I.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Wt*=I.cameraToCenterDistance/lr[3]),qa(se,Gt,Wt))return!0}return!1},o}(Gu));function yu(t,o){var u=Fs([],[t.x,t.y,0,1],o);return new fe(u[0]/u[3],u[1]/u[3])}var qc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(ds);function vs(t,o,u,p){var y=o.width,b=o.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==y*b*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(y*b*u);return t.width=y,t.height=b,t.data=p,t}function Yu(t,o,u){var p=o.width,y=o.height;if(p!==t.width||y!==t.height){var b=vs({},{width:p,height:y},u);Sl(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,p),height:Math.min(t.height,y)},u),t.width=p,t.height=y,t.data=b.data}}function Sl(t,o,u,p,y,b){if(y.width===0||y.height===0)return o;if(y.width>t.width||y.height>t.height||u.x>t.width-y.width||u.y>t.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||p.x>o.width-y.width||p.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,I=o.data,D=0;D<y.height;D++)for(var N=((u.y+D)*t.width+u.x)*b,V=((p.y+D)*o.width+p.x)*b,W=0;W<y.width*b;W++)I[V+W]=S[N+W];return o}yn("HeatmapBucket",qc,{omit:["layers"]});var _u=function(t,o){vs(this,t,1,o)};_u.prototype.resize=function(t){Yu(this,t,1)},_u.prototype.clone=function(){return new _u({width:this.width,height:this.height},new Uint8Array(this.data))},_u.copy=function(t,o,u,p,y){Sl(t,o,u,p,y,1)};var ko=function(t,o){vs(this,t,4,o)};ko.prototype.resize=function(t){Yu(this,t,4)},ko.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},ko.prototype.clone=function(){return new ko({width:this.width,height:this.height},new Uint8Array(this.data))},ko.copy=function(t,o,u,p,y){Sl(t,o,u,p,y,4)},yn("AlphaImage",_u),yn("RGBAImage",ko);var Cl={paint:new os({"heatmap-radius":new Tn(he.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Tn(he.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Fn(he.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ro(he.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Fn(he.paint_heatmap["heatmap-opacity"])})};function gc(t){var o={},u=t.resolution||256,p=t.clips?t.clips.length:1,y=t.image||new ko({width:u,height:p}),b=function(Me,Oe,qe){o[t.evaluationKey]=qe;var Ue=t.expression.evaluate(o);y.data[Me+Oe+0]=Math.floor(255*Ue.r/Ue.a),y.data[Me+Oe+1]=Math.floor(255*Ue.g/Ue.a),y.data[Me+Oe+2]=Math.floor(255*Ue.b/Ue.a),y.data[Me+Oe+3]=Math.floor(255*Ue.a)};if(t.clips)for(var S=0,I=0;S<p;++S,I+=4*u)for(var D=0,N=0;D<u;D++,N+=4){var V=D/(u-1),W=t.clips[S];b(I,N,W.start*(1-V)+W.end*V)}else for(var ee=0,se=0;ee<u;ee++,se+=4)b(0,se,ee/(u-1));return y}var Xf=function(t){function o(u){t.call(this,u,Cl),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new qc(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=gc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(Gu),xf={paint:new os({"hillshade-illumination-direction":new Fn(he.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Fn(he.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Fn(he.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Fn(he.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Fn(he.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Fn(he.paint_hillshade["hillshade-accent-color"])})},Yf=function(t){function o(u){t.call(this,u,xf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(Gu),Th=Oa([{name:"a_pos",components:2,type:"Int16"}],4).members,yc=Tu,Kc=Tu;function Tu(t,o,u){u=u||2;var p,y,b,S,I,D,N,V=o&&o.length,W=V?o[0]*u:t.length,ee=ip(t,0,W,u,!0),se=[];if(!ee||ee.next===ee.prev)return se;if(V&&(ee=function(Oe,qe,Ue,ut){var Mt,Gt,Wt,lr=[];for(Mt=0,Gt=qe.length;Mt<Gt;Mt++)(Wt=ip(Oe,qe[Mt]*ut,Mt<Gt-1?qe[Mt+1]*ut:Oe.length,ut,!1))===Wt.next&&(Wt.steiner=!0),lr.push(Hp(Wt));for(lr.sort(op),Mt=0;Mt<lr.length;Mt++)wd(lr[Mt],Ue),Ue=Hl(Ue,Ue.next);return Ue}(t,o,ee,u)),t.length>80*u){p=b=t[0],y=S=t[1];for(var Me=u;Me<W;Me+=u)(I=t[Me])<p&&(p=I),(D=t[Me+1])<y&&(y=D),I>b&&(b=I),D>S&&(S=D);N=(N=Math.max(b-p,S-y))!==0?1/N:0}return bf(ee,se,u,p,y,N),se}function ip(t,o,u,p,y){var b,S;if(y===$f(t,o,u,p)>0)for(b=o;b<u;b+=p)S=Wl(b,t[b],t[b+1],S);else for(b=u-p;b>=o;b-=p)S=Wl(b,t[b],t[b+1],S);return S&&Ph(S,S.next)&&(_c(S),S=S.next),S}function Hl(t,o){if(!t)return t;o||(o=t);var u,p=t;do if(u=!1,p.steiner||!Ph(p,p.next)&&Do(p.prev,p,p.next)!==0)p=p.next;else{if(_c(p),(p=o=p.prev)===p.next)break;u=!0}while(u||p!==o);return o}function bf(t,o,u,p,y,b,S){if(t){!S&&b&&function(V,W,ee,se){var Me=V;do Me.z===null&&(Me.z=Mh(Me.x,Me.y,W,ee,se)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==V);Me.prevZ.nextZ=null,Me.prevZ=null,function(Oe){var qe,Ue,ut,Mt,Gt,Wt,lr,Or,Kr=1;do{for(Ue=Oe,Oe=null,Gt=null,Wt=0;Ue;){for(Wt++,ut=Ue,lr=0,qe=0;qe<Kr&&(lr++,ut=ut.nextZ);qe++);for(Or=Kr;lr>0||Or>0&&ut;)lr!==0&&(Or===0||!ut||Ue.z<=ut.z)?(Mt=Ue,Ue=Ue.nextZ,lr--):(Mt=ut,ut=ut.nextZ,Or--),Gt?Gt.nextZ=Mt:Oe=Mt,Mt.prevZ=Gt,Gt=Mt;Ue=ut}Gt.nextZ=null,Kr*=2}while(Wt>1)}(Me)}(t,p,y,b);for(var I,D,N=t;t.prev!==t.next;)if(I=t.prev,D=t.next,b?Ad(t,p,y,b):Gp(t))o.push(I.i/u),o.push(t.i/u),o.push(D.i/u),_c(t),t=D.next,N=D.next;else if((t=D)===N){S?S===1?bf(t=Ef(Hl(t),o,u),o,u,p,y,b,2):S===2&&ap(t,o,u,p,y,b):bf(Hl(t),o,u,p,y,b,1);break}}}function Gp(t){var o=t.prev,u=t,p=t.next;if(Do(o,u,p)>=0)return!1;for(var y=t.next.next;y!==t.prev;){if($c(o.x,o.y,u.x,u.y,p.x,p.y,y.x,y.y)&&Do(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function Ad(t,o,u,p){var y=t.prev,b=t,S=t.next;if(Do(y,b,S)>=0)return!1;for(var I=y.x>b.x?y.x>S.x?y.x:S.x:b.x>S.x?b.x:S.x,D=y.y>b.y?y.y>S.y?y.y:S.y:b.y>S.y?b.y:S.y,N=Mh(y.x<b.x?y.x<S.x?y.x:S.x:b.x<S.x?b.x:S.x,y.y<b.y?y.y<S.y?y.y:S.y:b.y<S.y?b.y:S.y,o,u,p),V=Mh(I,D,o,u,p),W=t.prevZ,ee=t.nextZ;W&&W.z>=N&&ee&&ee.z<=V;){if(W!==t.prev&&W!==t.next&&$c(y.x,y.y,b.x,b.y,S.x,S.y,W.x,W.y)&&Do(W.prev,W,W.next)>=0||(W=W.prevZ,ee!==t.prev&&ee!==t.next&&$c(y.x,y.y,b.x,b.y,S.x,S.y,ee.x,ee.y)&&Do(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;W&&W.z>=N;){if(W!==t.prev&&W!==t.next&&$c(y.x,y.y,b.x,b.y,S.x,S.y,W.x,W.y)&&Do(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;ee&&ee.z<=V;){if(ee!==t.prev&&ee!==t.next&&$c(y.x,y.y,b.x,b.y,S.x,S.y,ee.x,ee.y)&&Do(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function Ef(t,o,u){var p=t;do{var y=p.prev,b=p.next.next;!Ph(y,b)&&up(y,p,p.next,b)&&qf(y,b)&&qf(b,y)&&(o.push(y.i/u),o.push(p.i/u),o.push(b.i/u),_c(p),_c(p.next),p=t=b),p=p.next}while(p!==t);return Hl(p)}function ap(t,o,u,p,y,b){var S=t;do{for(var I=S.next.next;I!==S.prev;){if(S.i!==I.i&&Td(S,I)){var D=Kf(S,I);return S=Hl(S,S.next),D=Hl(D,D.next),bf(S,o,u,p,y,b),void bf(D,o,u,p,y,b)}I=I.next}S=S.next}while(S!==t)}function op(t,o){return t.x-o.x}function wd(t,o){if(o=function(p,y){var b,S=y,I=p.x,D=p.y,N=-1/0;do{if(D<=S.y&&D>=S.next.y&&S.next.y!==S.y){var V=S.x+(D-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(V<=I&&V>N){if(N=V,V===I){if(D===S.y)return S;if(D===S.next.y)return S.next}b=S.x<S.next.x?S:S.next}}S=S.next}while(S!==y);if(!b)return null;if(I===N)return b;var W,ee=b,se=b.x,Me=b.y,Oe=1/0;S=b;do I>=S.x&&S.x>=se&&I!==S.x&&$c(D<Me?I:N,D,se,Me,D<Me?N:I,D,S.x,S.y)&&(W=Math.abs(D-S.y)/(I-S.x),qf(S,p)&&(W<Oe||W===Oe&&(S.x>b.x||S.x===b.x&&sp(b,S)))&&(b=S,Oe=W)),S=S.next;while(S!==ee);return b}(t,o)){var u=Kf(o,t);Hl(o,o.next),Hl(u,u.next)}}function sp(t,o){return Do(t.prev,t,o.prev)<0&&Do(o.next,t,t.next)<0}function Mh(t,o,u,p,y){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*y)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-p)*y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Hp(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function $c(t,o,u,p,y,b,S,I){return(y-S)*(o-I)-(t-S)*(b-I)>=0&&(t-S)*(p-I)-(u-S)*(o-I)>=0&&(u-S)*(b-I)-(y-S)*(p-I)>=0}function Td(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,p){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==p.i&&y.next.i!==p.i&&up(y,y.next,u,p))return!0;y=y.next}while(y!==u);return!1}(t,o)&&(qf(t,o)&&qf(o,t)&&function(u,p){var y=u,b=!1,S=(u.x+p.x)/2,I=(u.y+p.y)/2;do y.y>I!=y.next.y>I&&y.next.y!==y.y&&S<(y.next.x-y.x)*(I-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==u);return b}(t,o)&&(Do(t.prev,t,o.prev)||Do(t,o.prev,o))||Ph(t,o)&&Do(t.prev,t,t.next)>0&&Do(o.prev,o,o.next)>0)}function Do(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function Ph(t,o){return t.x===o.x&&t.y===o.y}function up(t,o,u,p){var y=Oh(Do(t,o,u)),b=Oh(Do(t,o,p)),S=Oh(Do(u,p,t)),I=Oh(Do(u,p,o));return y!==b&&S!==I||!(y!==0||!Ih(t,u,o))||!(b!==0||!Ih(t,p,o))||!(S!==0||!Ih(u,t,p))||!(I!==0||!Ih(u,o,p))}function Ih(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function Oh(t){return t>0?1:t<0?-1:0}function qf(t,o){return Do(t.prev,t,t.next)<0?Do(t,o,t.next)>=0&&Do(t,t.prev,o)>=0:Do(t,o,t.prev)<0||Do(t,t.next,o)<0}function Kf(t,o){var u=new Sf(t.i,t.x,t.y),p=new Sf(o.i,o.x,o.y),y=t.next,b=o.prev;return t.next=o,o.prev=t,u.next=y,y.prev=u,p.next=u,u.prev=p,b.next=p,p.prev=b,p}function Wl(t,o,u,p){var y=new Sf(t,o,u);return p?(y.next=p.next,y.prev=p,p.next.prev=y,p.next=y):(y.prev=y,y.next=y),y}function _c(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Sf(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $f(t,o,u,p){for(var y=0,b=o,S=u-p;b<u;b+=p)y+=(t[S]-t[b])*(t[b+1]+t[S+1]),S=b;return y}function Rh(t,o,u,p,y){(function b(S,I,D,N,V){for(;N>D;){if(N-D>600){var W=N-D+1,ee=I-D+1,se=Math.log(W),Me=.5*Math.exp(2*se/3),Oe=.5*Math.sqrt(se*Me*(W-Me)/W)*(ee-W/2<0?-1:1);b(S,I,Math.max(D,Math.floor(I-ee*Me/W+Oe)),Math.min(N,Math.floor(I+(W-ee)*Me/W+Oe)),V)}var qe=S[I],Ue=D,ut=N;for(xc(S,D,I),V(S[N],qe)>0&&xc(S,D,N);Ue<ut;){for(xc(S,Ue,ut),Ue++,ut--;V(S[Ue],qe)<0;)Ue++;for(;V(S[ut],qe)>0;)ut--}V(S[D],qe)===0?xc(S,D,ut):xc(S,++ut,N),ut<=I&&(D=ut+1),I<=ut&&(N=ut-1)}})(t,o,u||0,p||t.length-1,y||Qf)}function xc(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}function Qf(t,o){return t<o?-1:t>o?1:0}function Jf(t,o){var u=t.length;if(u<=1)return[t];for(var p,y,b=[],S=0;S<u;S++){var I=Er(t[S]);I!==0&&(t[S].area=Math.abs(I),y===void 0&&(y=I<0),y===I<0?(p&&b.push(p),p=[t[S]]):p.push(t[S]))}if(p&&b.push(p),o>1)for(var D=0;D<b.length;D++)b[D].length<=o||(Rh(b[D],o,1,b[D].length-1,eh),b[D]=b[D].slice(0,o));return b}function eh(t,o){return o.area-t.area}function bc(t,o,u){for(var p=u.patternDependencies,y=!1,b=0,S=o;b<S.length;b+=1){var I=S[b].paint.get(t+"-pattern");I.isConstant()||(y=!0);var D=I.constantOr(null);D&&(y=!0,p[D.to]=!0,p[D.from]=!0)}return y}function Cf(t,o,u,p,y){for(var b=y.patternDependencies,S=0,I=o;S<I.length;S+=1){var D=I[S],N=D.paint.get(t+"-pattern").value;if(N.kind!=="constant"){var V=N.evaluate({zoom:p-1},u,{},y.availableImages),W=N.evaluate({zoom:p},u,{},y.availableImages),ee=N.evaluate({zoom:p+1},u,{},y.availableImages);W=W&&W.name?W.name:W,ee=ee&&ee.name?ee.name:ee,b[V=V&&V.name?V.name:V]=!0,b[W]=!0,b[ee]=!0,u.patterns[D.id]={min:V,mid:W,max:ee}}}return u}Tu.deviation=function(t,o,u,p){var y=o&&o.length,b=Math.abs($f(t,0,y?o[0]*u:t.length,u));if(y)for(var S=0,I=o.length;S<I;S++)b-=Math.abs($f(t,o[S]*u,S<I-1?o[S+1]*u:t.length,u));var D=0;for(S=0;S<p.length;S+=3){var N=p[S]*u,V=p[S+1]*u,W=p[S+2]*u;D+=Math.abs((t[N]-t[W])*(t[V+1]-t[N+1])-(t[N]-t[V])*(t[W+1]-t[N+1]))}return b===0&&D===0?0:Math.abs((D-b)/b)},Tu.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},p=0,y=0;y<t.length;y++){for(var b=0;b<t[y].length;b++)for(var S=0;S<o;S++)u.vertices.push(t[y][b][S]);y>0&&u.holes.push(p+=t[y-1].length)}return u},yc.default=Kc;var ru=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new yl,this.indexArray=new Js,this.indexArray2=new Na,this.programConfigurations=new Yn(t.layers,t.zoom),this.segments=new pe,this.segments2=new pe,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};ru.prototype.populate=function(t,o,u){this.hasPattern=bc("fill",this.layers,o);for(var p=this.layers[0].layout.get("fill-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var I=S[b],D=I.feature,N=I.id,V=I.index,W=I.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,se=po(D,ee);if(this.layers[0]._featureFilter.filter(new ki(this.zoom),se,u)){var Me=p?p.evaluate(se,{},u,o.availableImages):void 0,Oe={id:N,properties:D.properties,type:D.type,sourceLayerIndex:W,index:V,geometry:ee?se.geometry:no(D),patterns:{},sortKey:Me};y.push(Oe)}}p&&y.sort(function(Or,Kr){return Or.sortKey-Kr.sortKey});for(var qe=0,Ue=y;qe<Ue.length;qe+=1){var ut=Ue[qe],Mt=ut.geometry,Gt=ut.index,Wt=ut.sourceLayerIndex;if(this.hasPattern){var lr=Cf("fill",this.layers,ut,this.zoom,o);this.patternFeatures.push(lr)}else this.addFeature(ut,Mt,Gt,u,{});o.featureIndex.insert(t[Gt].feature,Mt,Gt,Wt,this.index)}},ru.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},ru.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},ru.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ru.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ru.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Th),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},ru.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ru.prototype.addFeature=function(t,o,u,p,y){for(var b=0,S=Jf(o,500);b<S.length;b+=1){for(var I=S[b],D=0,N=0,V=I;N<V.length;N+=1)D+=V[N].length;for(var W=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),ee=W.vertexLength,se=[],Me=[],Oe=0,qe=I;Oe<qe.length;Oe+=1){var Ue=qe[Oe];if(Ue.length!==0){Ue!==I[0]&&Me.push(se.length/2);var ut=this.segments2.prepareSegment(Ue.length,this.layoutVertexArray,this.indexArray2),Mt=ut.vertexLength;this.layoutVertexArray.emplaceBack(Ue[0].x,Ue[0].y),this.indexArray2.emplaceBack(Mt+Ue.length-1,Mt),se.push(Ue[0].x),se.push(Ue[0].y);for(var Gt=1;Gt<Ue.length;Gt++)this.layoutVertexArray.emplaceBack(Ue[Gt].x,Ue[Gt].y),this.indexArray2.emplaceBack(Mt+Gt-1,Mt+Gt),se.push(Ue[Gt].x),se.push(Ue[Gt].y);ut.vertexLength+=Ue.length,ut.primitiveLength+=Ue.length}}for(var Wt=yc(se,Me),lr=0;lr<Wt.length;lr+=3)this.indexArray.emplaceBack(ee+Wt[lr],ee+Wt[lr+1],ee+Wt[lr+2]);W.vertexLength+=D,W.primitiveLength+=Wt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},yn("FillBucket",ru,{omit:["layers","patternFeatures"]});var th=new os({"fill-sort-key":new Tn(he.layout_fill["fill-sort-key"])}),rh={paint:new os({"fill-antialias":new Fn(he.paint_fill["fill-antialias"]),"fill-opacity":new Tn(he.paint_fill["fill-opacity"]),"fill-color":new Tn(he.paint_fill["fill-color"]),"fill-outline-color":new Tn(he.paint_fill["fill-outline-color"]),"fill-translate":new Fn(he.paint_fill["fill-translate"]),"fill-translate-anchor":new Fn(he.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xc(he.paint_fill["fill-pattern"])}),layout:th},nh=function(t){function o(u){t.call(this,u,rh)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new ru(u)},o.prototype.queryRadius=function(){return qi(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,I,D){return du(eu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),I.angle,D),b)},o.prototype.isTileClipped=function(){return!0},o}(Gu),ih=Oa([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Xl=Al;function Al(t,o,u,p,y){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=p,this._values=y,t.readFields(Qc,this,o)}function Qc(t,o,u){t==1?o.id=u.readVarint():t==2?function(p,y){for(var b=p.readVarint()+p.pos;p.pos<b;){var S=y._keys[p.readVarint()],I=y._values[p.readVarint()];y.properties[S]=I}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function Wp(t){for(var o,u,p=0,y=0,b=t.length,S=b-1;y<b;S=y++)p+=((u=t[S]).x-(o=t[y]).x)*(o.y+u.y);return p}Al.types=["Unknown","Point","LineString","Polygon"],Al.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,p=1,y=0,b=0,S=0,I=[];t.pos<u;){if(y<=0){var D=t.readVarint();p=7&D,y=D>>3}if(y--,p===1||p===2)b+=t.readSVarint(),S+=t.readSVarint(),p===1&&(o&&I.push(o),o=[]),o.push(new fe(b,S));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&I.push(o),I},Al.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,p=0,y=0,b=0,S=1/0,I=-1/0,D=1/0,N=-1/0;t.pos<o;){if(p<=0){var V=t.readVarint();u=7&V,p=V>>3}if(p--,u===1||u===2)(y+=t.readSVarint())<S&&(S=y),y>I&&(I=y),(b+=t.readSVarint())<D&&(D=b),b>N&&(N=b);else if(u!==7)throw new Error("unknown command "+u)}return[S,D,I,N]},Al.prototype.toGeoJSON=function(t,o,u){var p,y,b=this.extent*Math.pow(2,u),S=this.extent*t,I=this.extent*o,D=this.loadGeometry(),N=Al.types[this.type];function V(se){for(var Me=0;Me<se.length;Me++){var Oe=se[Me];se[Me]=[360*(Oe.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Oe.y+I)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(p=0;p<D.length;p++)W[p]=D[p][0];V(D=W);break;case 2:for(p=0;p<D.length;p++)V(D[p]);break;case 3:for(D=function(se){var Me=se.length;if(Me<=1)return[se];for(var Oe,qe,Ue=[],ut=0;ut<Me;ut++){var Mt=Wp(se[ut]);Mt!==0&&(qe===void 0&&(qe=Mt<0),qe===Mt<0?(Oe&&Ue.push(Oe),Oe=[se[ut]]):Oe.push(se[ut]))}return Oe&&Ue.push(Oe),Ue}(D),p=0;p<D.length;p++)for(y=0;y<D[p].length;y++)V(D[p][y])}D.length===1?D=D[0]:N="Multi"+N;var ee={type:"Feature",geometry:{type:N,coordinates:D},properties:this.properties};return"id"in this&&(ee.id=this.id),ee};var Lh=lp;function lp(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Xp,this,o),this.length=this._features.length}function Xp(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(p){for(var y=null,b=p.readVarint()+p.pos;p.pos<b;){var S=p.readVarint()>>3;y=S===1?p.readString():S===2?p.readFloat():S===3?p.readDouble():S===4?p.readVarint64():S===5?p.readVarint():S===6?p.readSVarint():S===7?p.readBoolean():null}return y}(u))}function Md(t,o,u){if(t===3){var p=new Lh(u,u.readVarint()+u.pos);p.length&&(o[p.name]=p)}}lp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new Xl(this._pbf,o,this.extent,this._keys,this._values)};var Mu={VectorTile:function(t,o){this.layers=t.readFields(Md,{},o)},VectorTileFeature:Xl,VectorTileLayer:Lh},cp=Mu.VectorTileFeature.types,ah=Math.pow(2,13);function Af(t,o,u,p,y,b,S,I){t.emplaceBack(o,u,2*Math.floor(p*ah)+S,y*ah*2,b*ah*2,Math.round(I))}var sl=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Su,this.indexArray=new Js,this.programConfigurations=new Yn(t.layers,t.zoom),this.segments=new pe,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Yp(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}sl.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=bc("fill-extrusion",this.layers,o);for(var p=0,y=t;p<y.length;p+=1){var b=y[p],S=b.feature,I=b.id,D=b.index,N=b.sourceLayerIndex,V=this.layers[0]._featureFilter.needGeometry,W=po(S,V);if(this.layers[0]._featureFilter.filter(new ki(this.zoom),W,u)){var ee={id:I,sourceLayerIndex:N,index:D,geometry:V?W.geometry:no(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Cf("fill-extrusion",this.layers,ee,this.zoom,o)):this.addFeature(ee,ee.geometry,D,u,{}),o.featureIndex.insert(S,ee.geometry,D,N,this.index,!0)}}},sl.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.features;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},sl.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},sl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},sl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},sl.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ih),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},sl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},sl.prototype.addFeature=function(t,o,u,p,y){for(var b=0,S=Jf(o,500);b<S.length;b+=1){for(var I=S[b],D=0,N=0,V=I;N<V.length;N+=1)D+=V[N].length;for(var W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ee=0,se=I;ee<se.length;ee+=1){var Me=se[ee];if(Me.length!==0&&!((Ui=Me).every(function(Si){return Si.x<0})||Ui.every(function(Si){return Si.x>8192})||Ui.every(function(Si){return Si.y<0})||Ui.every(function(Si){return Si.y>8192})))for(var Oe=0,qe=0;qe<Me.length;qe++){var Ue=Me[qe];if(qe>=1){var ut=Me[qe-1];if(!Yp(Ue,ut)){W.vertexLength+4>pe.MAX_VERTEX_ARRAY_LENGTH&&(W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Mt=Ue.sub(ut)._perp()._unit(),Gt=ut.dist(Ue);Oe+Gt>32768&&(Oe=0),Af(this.layoutVertexArray,Ue.x,Ue.y,Mt.x,Mt.y,0,0,Oe),Af(this.layoutVertexArray,Ue.x,Ue.y,Mt.x,Mt.y,0,1,Oe),Af(this.layoutVertexArray,ut.x,ut.y,Mt.x,Mt.y,0,0,Oe+=Gt),Af(this.layoutVertexArray,ut.x,ut.y,Mt.x,Mt.y,0,1,Oe);var Wt=W.vertexLength;this.indexArray.emplaceBack(Wt,Wt+2,Wt+1),this.indexArray.emplaceBack(Wt+1,Wt+2,Wt+3),W.vertexLength+=4,W.primitiveLength+=2}}}}if(W.vertexLength+D>pe.MAX_VERTEX_ARRAY_LENGTH&&(W=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),cp[t.type]==="Polygon"){for(var lr=[],Or=[],Kr=W.vertexLength,Un=0,hn=I;Un<hn.length;Un+=1){var Vn=hn[Un];if(Vn.length!==0){Vn!==I[0]&&Or.push(lr.length/2);for(var dn=0;dn<Vn.length;dn++){var Ii=Vn[dn];Af(this.layoutVertexArray,Ii.x,Ii.y,0,0,1,1,0),lr.push(Ii.x),lr.push(Ii.y)}}}for(var Hn=yc(lr,Or),An=0;An<Hn.length;An+=3)this.indexArray.emplaceBack(Kr+Hn[An],Kr+Hn[An+2],Kr+Hn[An+1]);W.primitiveLength+=Hn.length/3,W.vertexLength+=D}}var Ui;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},yn("FillExtrusionBucket",sl,{omit:["layers","features"]});var Pd={paint:new os({"fill-extrusion-opacity":new Fn(he["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Tn(he["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Fn(he["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Fn(he["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xc(he["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Tn(he["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Tn(he["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Fn(he["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},qu=function(t){function o(u){t.call(this,u,Pd)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new sl(u)},o.prototype.queryRadius=function(){return qi(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,I,D,N){var V=eu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),I.angle,D),W=this.paint.get("fill-extrusion-height").evaluate(p,y),ee=this.paint.get("fill-extrusion-base").evaluate(p,y),se=function(Oe,qe,Ue,ut){for(var Mt=[],Gt=0,Wt=Oe;Gt<Wt.length;Gt+=1){var lr=Wt[Gt],Or=[lr.x,lr.y,0,1];Fs(Or,Or,qe),Mt.push(new fe(Or[0]/Or[3],Or[1]/Or[3]))}return Mt}(V,N),Me=function(Oe,qe,Ue,ut){for(var Mt=[],Gt=[],Wt=ut[8]*qe,lr=ut[9]*qe,Or=ut[10]*qe,Kr=ut[11]*qe,Un=ut[8]*Ue,hn=ut[9]*Ue,Vn=ut[10]*Ue,dn=ut[11]*Ue,Ii=0,Hn=Oe;Ii<Hn.length;Ii+=1){for(var An=[],Ui=[],Si=0,ea=Hn[Ii];Si<ea.length;Si+=1){var Zn=ea[Si],da=Zn.x,lo=Zn.y,To=ut[0]*da+ut[4]*lo+ut[12],Eo=ut[1]*da+ut[5]*lo+ut[13],Ua=ut[2]*da+ut[6]*lo+ut[14],ia=ut[3]*da+ut[7]*lo+ut[15],es=Ua+Or,ts=ia+Kr,Bs=To+Un,rs=Eo+hn,Ns=Ua+Vn,No=ia+dn,gs=new fe((To+Wt)/ts,(Eo+lr)/ts);gs.z=es/ts,An.push(gs);var Ki=new fe(Bs/No,rs/No);Ki.z=Ns/No,Ui.push(Ki)}Mt.push(An),Gt.push(Ui)}return[Mt,Gt]}(b,ee,W,N);return function(Oe,qe,Ue){var ut=1/0;du(Ue,qe)&&(ut=zr(Ue,qe[0]));for(var Mt=0;Mt<qe.length;Mt++)for(var Gt=qe[Mt],Wt=Oe[Mt],lr=0;lr<Gt.length-1;lr++){var Or=Gt[lr],Kr=[Or,Gt[lr+1],Wt[lr+1],Wt[lr],Or];Wu(Ue,Kr)&&(ut=Math.min(ut,zr(Ue,Kr)))}return ut!==1/0&&ut}(Me[0],Me[1],se)},o}(Gu);function oh(t,o){return t.x*o.x+t.y*o.y}function zr(t,o){if(t.length===1){for(var u,p=0,y=o[p++];!u||y.equals(u);)if(!(u=o[p++]))return 1/0;for(;p<o.length;p++){var b=o[p],S=t[0],I=u.sub(y),D=b.sub(y),N=S.sub(y),V=oh(I,I),W=oh(I,D),ee=oh(D,D),se=oh(N,I),Me=oh(N,D),Oe=V*ee-W*W,qe=(ee*se-W*Me)/Oe,Ue=(V*Me-W*se)/Oe,ut=y.z*(1-qe-Ue)+u.z*qe+b.z*Ue;if(isFinite(ut))return ut}return 1/0}for(var Mt=1/0,Gt=0,Wt=o;Gt<Wt.length;Gt+=1)Mt=Math.min(Mt,Wt[Gt].z);return Mt}var Ec=Oa([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Yt=Oa([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,fp=Mu.VectorTileFeature.types,kh=Math.cos(Math.PI/180*37.5),Dh=Math.pow(2,14)/.5,ya=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new Lo,this.layoutVertexArray2=new _l,this.indexArray=new Js,this.programConfigurations=new Yn(t.layers,t.zoom),this.segments=new pe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};ya.prototype.populate=function(t,o,u){this.hasPattern=bc("line",this.layers,o);for(var p=this.layers[0].layout.get("line-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var I=S[b],D=I.feature,N=I.id,V=I.index,W=I.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,se=po(D,ee);if(this.layers[0]._featureFilter.filter(new ki(this.zoom),se,u)){var Me=p?p.evaluate(se,{},u):void 0,Oe={id:N,properties:D.properties,type:D.type,sourceLayerIndex:W,index:V,geometry:ee?se.geometry:no(D),patterns:{},sortKey:Me};y.push(Oe)}}p&&y.sort(function(Or,Kr){return Or.sortKey-Kr.sortKey});for(var qe=0,Ue=y;qe<Ue.length;qe+=1){var ut=Ue[qe],Mt=ut.geometry,Gt=ut.index,Wt=ut.sourceLayerIndex;if(this.hasPattern){var lr=Cf("line",this.layers,ut,this.zoom,o);this.patternFeatures.push(lr)}else this.addFeature(ut,Mt,Gt,u,{});o.featureIndex.insert(t[Gt].feature,Mt,Gt,Wt,this.index)}},ya.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},ya.prototype.addFeatures=function(t,o,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},ya.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ya.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ya.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Yt)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ec),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ya.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ya.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},ya.prototype.addFeature=function(t,o,u,p,y){var b=this.layers[0].layout,S=b.get("line-join").evaluate(t,{}),I=b.get("line-cap"),D=b.get("line-miter-limit"),N=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var V=0,W=o;V<W.length;V+=1)this.addLine(W[V],t,S,I,D,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,p)},ya.prototype.addLine=function(t,o,u,p,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var I=fp[o.type]==="Polygon",D=t.length;D>=2&&t[D-1].equals(t[D-2]);)D--;for(var N=0;N<D-1&&t[N].equals(t[N+1]);)N++;if(!(D<(I?3:2))){u==="bevel"&&(y=1.05);var V,W=this.overscaling<=16?122880/(512*this.overscaling):0,ee=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),se=void 0,Me=void 0,Oe=void 0,qe=void 0;this.e1=this.e2=-1,I&&(qe=t[N].sub(V=t[D-2])._unit()._perp());for(var Ue=N;Ue<D;Ue++)if(!(Me=Ue===D-1?I?t[N+1]:void 0:t[Ue+1])||!t[Ue].equals(Me)){qe&&(Oe=qe),V&&(se=V),V=t[Ue],qe=Me?Me.sub(V)._unit()._perp():Oe;var ut=(Oe=Oe||qe).add(qe);ut.x===0&&ut.y===0||ut._unit();var Mt=Oe.x*qe.x+Oe.y*qe.y,Gt=ut.x*qe.x+ut.y*qe.y,Wt=Gt!==0?1/Gt:1/0,lr=2*Math.sqrt(2-2*Gt),Or=Gt<kh&&se&&Me,Kr=Oe.x*qe.y-Oe.y*qe.x>0;if(Or&&Ue>N){var Un=V.dist(se);if(Un>2*W){var hn=V.sub(V.sub(se)._mult(W/Un)._round());this.updateDistance(se,hn),this.addCurrentVertex(hn,Oe,0,0,ee),se=hn}}var Vn=se&&Me,dn=Vn?u:I?"butt":p;if(Vn&&dn==="round"&&(Wt<b?dn="miter":Wt<=2&&(dn="fakeround")),dn==="miter"&&Wt>y&&(dn="bevel"),dn==="bevel"&&(Wt>2&&(dn="flipbevel"),Wt<y&&(dn="miter")),se&&this.updateDistance(se,V),dn==="miter")ut._mult(Wt),this.addCurrentVertex(V,ut,0,0,ee);else if(dn==="flipbevel"){if(Wt>100)ut=qe.mult(-1);else{var Ii=Wt*Oe.add(qe).mag()/Oe.sub(qe).mag();ut._perp()._mult(Ii*(Kr?-1:1))}this.addCurrentVertex(V,ut,0,0,ee),this.addCurrentVertex(V,ut.mult(-1),0,0,ee)}else if(dn==="bevel"||dn==="fakeround"){var Hn=-Math.sqrt(Wt*Wt-1),An=Kr?Hn:0,Ui=Kr?0:Hn;if(se&&this.addCurrentVertex(V,Oe,An,Ui,ee),dn==="fakeround")for(var Si=Math.round(180*lr/Math.PI/20),ea=1;ea<Si;ea++){var Zn=ea/Si;if(Zn!==.5){var da=Zn-.5;Zn+=Zn*da*(Zn-1)*((1.0904+Mt*(Mt*(3.55645-1.43519*Mt)-3.2452))*da*da+(.848013+Mt*(.215638*Mt-1.06021)))}var lo=qe.sub(Oe)._mult(Zn)._add(Oe)._unit()._mult(Kr?-1:1);this.addHalfVertex(V,lo.x,lo.y,!1,Kr,0,ee)}Me&&this.addCurrentVertex(V,qe,-An,-Ui,ee)}else if(dn==="butt")this.addCurrentVertex(V,ut,0,0,ee);else if(dn==="square"){var To=se?1:-1;this.addCurrentVertex(V,ut,To,To,ee)}else dn==="round"&&(se&&(this.addCurrentVertex(V,Oe,0,0,ee),this.addCurrentVertex(V,Oe,1,1,ee,!0)),Me&&(this.addCurrentVertex(V,qe,-1,-1,ee,!0),this.addCurrentVertex(V,qe,0,0,ee)));if(Or&&Ue<D-1){var Eo=V.dist(Me);if(Eo>2*W){var Ua=V.add(Me.sub(V)._mult(W/Eo)._round());this.updateDistance(V,Ua),this.addCurrentVertex(Ua,qe,0,0,ee),V=Ua}}}}},ya.prototype.addCurrentVertex=function(t,o,u,p,y,b){b===void 0&&(b=!1);var S=o.y*p-o.x,I=-o.y-o.x*p;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,b,!1,u,y),this.addHalfVertex(t,S,I,b,!0,-p,y),this.distance>Dh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,p,y,b))},ya.prototype.addHalfVertex=function(t,o,u,p,y,b,S){var I=.5*(this.lineClips?this.scaledDistance*(Dh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(p?1:0),(t.y<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),y?this.e2=D:this.e1=D},ya.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ya.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},yn("LineBucket",ya,{omit:["layers","patternFeatures"]});var Yl=new os({"line-cap":new Fn(he.layout_line["line-cap"]),"line-join":new Tn(he.layout_line["line-join"]),"line-miter-limit":new Fn(he.layout_line["line-miter-limit"]),"line-round-limit":new Fn(he.layout_line["line-round-limit"]),"line-sort-key":new Tn(he.layout_line["line-sort-key"])}),Fo={paint:new os({"line-opacity":new Tn(he.paint_line["line-opacity"]),"line-color":new Tn(he.paint_line["line-color"]),"line-translate":new Fn(he.paint_line["line-translate"]),"line-translate-anchor":new Fn(he.paint_line["line-translate-anchor"]),"line-width":new Tn(he.paint_line["line-width"]),"line-gap-width":new Tn(he.paint_line["line-gap-width"]),"line-offset":new Tn(he.paint_line["line-offset"]),"line-blur":new Tn(he.paint_line["line-blur"]),"line-dasharray":new ps(he.paint_line["line-dasharray"]),"line-pattern":new Xc(he.paint_line["line-pattern"]),"line-gradient":new Ro(he.paint_line["line-gradient"])}),layout:Yl},Ws=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p){return p=new ki(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),t.prototype.possiblyEvaluate.call(this,u,p)},o.prototype.evaluate=function(u,p,y,b){return p=bt({},p,{zoom:Math.floor(p.zoom)}),t.prototype.evaluate.call(this,u,p,y,b)},o}(Tn))(Fo.paint.properties["line-width"].specification);Ws.useIntegerZoom=!0;var wf=function(t){function o(u){t.call(this,u,Fo),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Es,this.gradientVersion=(this.gradientVersion+1)%Xe)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p),this.paint._values["line-floorwidth"]=Ws.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new ya(u)},o.prototype.queryRadius=function(u){var p=u,y=qp(Ra("line-width",this,p),Ra("line-gap-width",this,p)),b=Ra("line-offset",this,p);return y/2+Math.abs(b)+qi(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,I,D){var N=eu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),I.angle,D),V=D/2*qp(this.paint.get("line-width").evaluate(p,y),this.paint.get("line-gap-width").evaluate(p,y)),W=this.paint.get("line-offset").evaluate(p,y);return W&&(b=function(ee,se){for(var Me=[],Oe=new fe(0,0),qe=0;qe<ee.length;qe++){for(var Ue=ee[qe],ut=[],Mt=0;Mt<Ue.length;Mt++){var Gt=Ue[Mt],Wt=Ue[Mt+1],lr=Mt===0?Oe:Gt.sub(Ue[Mt-1])._unit()._perp(),Or=Mt===Ue.length-1?Oe:Wt.sub(Gt)._unit()._perp(),Kr=lr._add(Or)._unit();Kr._mult(1/(Kr.x*Or.x+Kr.y*Or.y)),ut.push(Kr._mult(se)._add(Gt))}Me.push(ut)}return Me}(b,W*D)),function(ee,se,Me){for(var Oe=0;Oe<se.length;Oe++){var qe=se[Oe];if(ee.length>=3){for(var Ue=0;Ue<qe.length;Ue++)if(gu(ee,qe[Ue]))return!0}if($o(ee,qe,Me))return!0}return!1}(N,b,V)},o.prototype.isTileClipped=function(){return!0},o}(Gu);function qp(t,o){return o>0?o+2*t:t}var Id=Oa([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Kp=Oa([{name:"a_projected_pos",components:3,type:"Float32"}],4),$p=(Oa([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Oa([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Fh=(Oa([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Oa([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Qp=Oa([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Jp(t,o,u){return t.sections.forEach(function(p){p.text=function(y,b,S){var I=b.layout.get("text-transform").evaluate(S,{});return I==="uppercase"?y=y.toLocaleUpperCase():I==="lowercase"&&(y=y.toLocaleLowerCase()),js.applyArabicShaping&&(y=js.applyArabicShaping(y)),y}(p.text,o,u)}),t}Oa([{name:"triangle",components:3,type:"Uint16"}]),Oa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Oa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Oa([{type:"Float32",name:"offsetX"}]),Oa([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var sh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},hp=function(t,o,u,p,y){var b,S,I=8*y-p-1,D=(1<<I)-1,N=D>>1,V=-7,W=u?y-1:0,ee=u?-1:1,se=t[o+W];for(W+=ee,b=se&(1<<-V)-1,se>>=-V,V+=I;V>0;b=256*b+t[o+W],W+=ee,V-=8);for(S=b&(1<<-V)-1,b>>=-V,V+=p;V>0;S=256*S+t[o+W],W+=ee,V-=8);if(b===0)b=1-N;else{if(b===D)return S?NaN:1/0*(se?-1:1);S+=Math.pow(2,p),b-=N}return(se?-1:1)*S*Math.pow(2,b-p)},pp=function(t,o,u,p,y,b){var S,I,D,N=8*b-y-1,V=(1<<N)-1,W=V>>1,ee=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,se=p?0:b-1,Me=p?1:-1,Oe=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,S=V):(S=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-S))<1&&(S--,D*=2),(o+=S+W>=1?ee/D:ee*Math.pow(2,1-W))*D>=2&&(S++,D/=2),S+W>=V?(I=0,S=V):S+W>=1?(I=(o*D-1)*Math.pow(2,y),S+=W):(I=o*Math.pow(2,W-1)*Math.pow(2,y),S=0));y>=8;t[u+se]=255&I,se+=Me,I/=256,y-=8);for(S=S<<y|I,N+=y;N>0;t[u+se]=255&S,se+=Me,S/=256,N-=8);t[u+se-Me]|=128*Oe},Jc=La;function La(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}La.Varint=0,La.Fixed64=1,La.Bytes=2,La.Fixed32=5;var dp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function ql(t){return t.type===La.Bytes?t.readVarint()+t.pos:t.pos+1}function Tf(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function vp(t,o,u){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(p);for(var y=u.pos-1;y>=t;y--)u.buf[y+p]=u.buf[y]}function Od(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function B(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function ge(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function Be(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function kt(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function ur(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function Dt(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function er(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function hr(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function gr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function xr(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function wr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function Ir(t,o,u){t===1&&u.readMessage(Gr,o)}function Gr(t,o,u){if(t===3){var p=u.readMessage(_r,{}),y=p.width,b=p.height,S=p.left,I=p.top,D=p.advance;o.push({id:p.id,bitmap:new _u({width:y+6,height:b+6},p.bitmap),metrics:{width:y,height:b,left:S,top:I,advance:D}})}}function _r(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function Tr(t){for(var o=0,u=0,p=0,y=t;p<y.length;p+=1){var b=y[p];o+=b.w*b.h,u=Math.max(u,b.w)}t.sort(function(Oe,qe){return qe.h-Oe.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],I=0,D=0,N=0,V=t;N<V.length;N+=1)for(var W=V[N],ee=S.length-1;ee>=0;ee--){var se=S[ee];if(!(W.w>se.w||W.h>se.h)){if(W.x=se.x,W.y=se.y,D=Math.max(D,W.y+W.h),I=Math.max(I,W.x+W.w),W.w===se.w&&W.h===se.h){var Me=S.pop();ee<S.length&&(S[ee]=Me)}else W.h===se.h?(se.x+=W.w,se.w-=W.w):W.w===se.w?(se.y+=W.h,se.h-=W.h):(S.push({x:se.x+W.w,y:se.y,w:se.w-W.w,h:W.h}),se.y+=W.h,se.h-=W.h);break}}return{w:I,h:D,fill:o/(I*D)||0}}La.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var p=this.readVarint(),y=p>>3,b=this.pos;this.type=7&p,t(y,o,this),this.pos===b&&this.skip(p)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=gr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=wr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=gr(this.buf,this.pos)+4294967296*gr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=gr(this.buf,this.pos)+4294967296*wr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=hp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=hp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,p=this.buf;return o=127&(u=p[this.pos++]),u<128?o:(o|=(127&(u=p[this.pos++]))<<7,u<128?o:(o|=(127&(u=p[this.pos++]))<<14,u<128?o:(o|=(127&(u=p[this.pos++]))<<21,u<128?o:function(y,b,S){var I,D,N=S.buf;if(I=(112&(D=N[S.pos++]))>>4,D<128||(I|=(127&(D=N[S.pos++]))<<3,D<128)||(I|=(127&(D=N[S.pos++]))<<10,D<128)||(I|=(127&(D=N[S.pos++]))<<17,D<128)||(I|=(127&(D=N[S.pos++]))<<24,D<128)||(I|=(1&(D=N[S.pos++]))<<31,D<128))return Tf(y,I,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=p[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&dp?function(u,p,y){return dp.decode(u.subarray(p,y))}(this.buf,o,t):function(u,p,y){for(var b="",S=p;S<y;){var I,D,N,V=u[S],W=null,ee=V>239?4:V>223?3:V>191?2:1;if(S+ee>y)break;ee===1?V<128&&(W=V):ee===2?(192&(I=u[S+1]))==128&&(W=(31&V)<<6|63&I)<=127&&(W=null):ee===3?(D=u[S+2],(192&(I=u[S+1]))==128&&(192&D)==128&&((W=(15&V)<<12|(63&I)<<6|63&D)<=2047||W>=55296&&W<=57343)&&(W=null)):ee===4&&(D=u[S+2],N=u[S+3],(192&(I=u[S+1]))==128&&(192&D)==128&&(192&N)==128&&((W=(15&V)<<18|(63&I)<<12|(63&D)<<6|63&N)<=65535||W>=1114112)&&(W=null)),W===null?(W=65533,ee=1):W>65535&&(W-=65536,b+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),b+=String.fromCharCode(W),S+=ee}return b}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==La.Bytes)return t.push(this.readVarint(o));var u=ql(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==La.Bytes)return t.push(this.readSVarint());var o=ql(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==La.Bytes)return t.push(this.readBoolean());var o=ql(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==La.Bytes)return t.push(this.readFloat());var o=ql(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==La.Bytes)return t.push(this.readDouble());var o=ql(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==La.Bytes)return t.push(this.readFixed32());var o=ql(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==La.Bytes)return t.push(this.readSFixed32());var o=ql(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==La.Bytes)return t.push(this.readFixed64());var o=ql(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==La.Bytes)return t.push(this.readSFixed64());var o=ql(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===La.Varint)for(;this.buf[this.pos++]>127;);else if(o===La.Bytes)this.pos=this.readVarint()+this.pos;else if(o===La.Fixed32)this.pos+=4;else{if(o!==La.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),xr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),xr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),xr(this.buf,-1&t,this.pos),xr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),xr(this.buf,-1&t,this.pos),xr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var p,y;if(o>=0?(p=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,y=y+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,S,I){I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,I.buf[I.pos]=127&(b>>>=7)}(p,0,u),function(b,S){var I=(7&b)<<4;S.buf[S.pos++]|=I|((b>>>=3)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b)))))}(y,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(p,y,b){for(var S,I,D=0;D<y.length;D++){if((S=y.charCodeAt(D))>55295&&S<57344){if(!I){S>56319||D+1===y.length?(p[b++]=239,p[b++]=191,p[b++]=189):I=S;continue}if(S<56320){p[b++]=239,p[b++]=191,p[b++]=189,I=S;continue}S=I-55296<<10|S-56320|65536,I=null}else I&&(p[b++]=239,p[b++]=191,p[b++]=189,I=null);S<128?p[b++]=S:(S<2048?p[b++]=S>>6|192:(S<65536?p[b++]=S>>12|224:(p[b++]=S>>18|240,p[b++]=S>>12&63|128),p[b++]=S>>6&63|128),p[b++]=63&S|128)}return b}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&vp(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),pp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),pp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var p=this.pos-u;p>=128&&vp(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeMessage:function(t,o,u){this.writeTag(t,La.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,Od,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,B,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,kt,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,ge,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,Be,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,ur,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,Dt,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,er,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,hr,o)},writeBytesField:function(t,o){this.writeTag(t,La.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,La.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,La.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,La.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,La.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,La.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,La.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,La.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,La.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,La.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var st=function(t,o){var u=o.pixelRatio,p=o.version,y=o.stretchX,b=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=y,this.stretchY=b,this.content=S,this.version=p},jt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};jt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},jt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},jt.tlbr.get=function(){return this.tl.concat(this.br)},jt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(st.prototype,jt);var br=function(t,o){var u={},p={};this.haveRenderCallbacks=[];var y=[];this.addImages(t,u,y),this.addImages(o,p,y);var b=Tr(y),S=new ko({width:b.w||1,height:b.h||1});for(var I in t){var D=t[I],N=u[I].paddedRect;ko.copy(D.data,S,{x:0,y:0},{x:N.x+1,y:N.y+1},D.data)}for(var V in o){var W=o[V],ee=p[V].paddedRect,se=ee.x+1,Me=ee.y+1,Oe=W.data.width,qe=W.data.height;ko.copy(W.data,S,{x:0,y:0},{x:se,y:Me},W.data),ko.copy(W.data,S,{x:0,y:qe-1},{x:se,y:Me-1},{width:Oe,height:1}),ko.copy(W.data,S,{x:0,y:0},{x:se,y:Me+qe},{width:Oe,height:1}),ko.copy(W.data,S,{x:Oe-1,y:0},{x:se-1,y:Me},{width:1,height:qe}),ko.copy(W.data,S,{x:0,y:0},{x:se+Oe,y:Me},{width:1,height:qe})}this.image=S,this.iconPositions=u,this.patternPositions=p};br.prototype.addImages=function(t,o,u){for(var p in t){var y=t[p],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),o[p]=new st(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},br.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},br.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var p=t.tl;u.update(o.data,void 0,{x:p[0],y:p[1]})}},yn("ImagePosition",st),yn("ImageAtlas",br);var fr={horizontal:1,vertical:2,horizontalOnly:3},ar=function(){this.scale=1,this.fontStack="",this.imageName=null};ar.forText=function(t,o){var u=new ar;return u.scale=t||1,u.fontStack=o,u},ar.forImage=function(t){var o=new ar;return o.imageName=t,o};var Lr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function $r(t,o,u,p,y,b,S,I,D,N,V,W,ee,se,Me,Oe){var qe,Ue=Lr.fromFeature(t,y);W===fr.vertical&&Ue.verticalizePunctuation();var ut=js.processBidirectionalText,Mt=js.processStyledBidirectionalText;if(ut&&Ue.sections.length===1){qe=[];for(var Gt=0,Wt=ut(Ue.toString(),qr(Ue,N,b,o,p,se,Me));Gt<Wt.length;Gt+=1){var lr=Wt[Gt],Or=new Lr;Or.text=lr,Or.sections=Ue.sections;for(var Kr=0;Kr<lr.length;Kr++)Or.sectionIndex.push(0);qe.push(Or)}}else if(Mt){qe=[];for(var Un=0,hn=Mt(Ue.text,Ue.sectionIndex,qr(Ue,N,b,o,p,se,Me));Un<hn.length;Un+=1){var Vn=hn[Un],dn=new Lr;dn.text=Vn[0],dn.sectionIndex=Vn[1],dn.sections=Ue.sections,qe.push(dn)}}else qe=function(An,Ui){for(var Si=[],ea=An.text,Zn=0,da=0,lo=Ui;da<lo.length;da+=1){var To=lo[da];Si.push(An.substring(Zn,To)),Zn=To}return Zn<ea.length&&Si.push(An.substring(Zn,ea.length)),Si}(Ue,qr(Ue,N,b,o,p,se,Me));var Ii=[],Hn={positionedLines:Ii,text:Ue.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:W,iconsInText:!1,verticalizable:!1};return function(An,Ui,Si,ea,Zn,da,lo,To,Eo,Ua,ia,es){for(var ts=0,Bs=-17,rs=0,Ns=0,No=To==="right"?1:To==="left"?0:.5,gs=0,Ki=0,Za=Zn;Ki<Za.length;Ki+=1){var Ta=Za[Ki];Ta.trim();var ua=Ta.getMaxScale(),nu=24*(ua-1),G={positionedGlyphs:[],lineOffset:0};An.positionedLines[gs]=G;var $a=G.positionedGlyphs,zo=0;if(Ta.length()){for(var Is=0;Is<Ta.length();Is++){var va=Ta.getSection(Is),Kl=Ta.getSectionIndex(Is),Ru=Ta.getCharCode(Is),$l=0,Qa=null,Ql=null,ll=null,lh=24,If=!(Eo===fr.horizontal||!ia&&!pc(Ru)||ia&&(zn[Ru]||(Cc=Ru,Yr.Arabic(Cc)||Yr["Arabic Supplement"](Cc)||Yr["Arabic Extended-A"](Cc)||Yr["Arabic Presentation Forms-A"](Cc)||Yr["Arabic Presentation Forms-B"](Cc))));if(va.imageName){var ch=ea[va.imageName];if(!ch)continue;ll=va.imageName,An.iconsInText=An.iconsInText||!0,Ql=ch.paddedRect;var Sc=ch.displaySize;va.scale=24*va.scale/es,$l=nu+(24-Sc[1]*va.scale),lh=(Qa={width:Sc[0],height:Sc[1],left:1,top:-3,advance:If?Sc[1]:Sc[0]}).advance;var ef=If?Sc[0]*va.scale-24*ua:Sc[1]*va.scale-24*ua;ef>0&&ef>zo&&(zo=ef)}else{var ed=Si[va.fontStack],Bh=ed&&ed[Ru];if(Bh&&Bh.rect)Ql=Bh.rect,Qa=Bh.metrics;else{var Nh=Ui[va.fontStack],_p=Nh&&Nh[Ru];if(!_p)continue;Qa=_p.metrics}$l=24*(ua-va.scale)}If?(An.verticalizable=!0,$a.push({glyph:Ru,imageName:ll,x:ts,y:Bs+$l,vertical:If,scale:va.scale,fontStack:va.fontStack,sectionIndex:Kl,metrics:Qa,rect:Ql}),ts+=lh*va.scale+Ua):($a.push({glyph:Ru,imageName:ll,x:ts,y:Bs+$l,vertical:If,scale:va.scale,fontStack:va.fontStack,sectionIndex:Kl,metrics:Qa,rect:Ql}),ts+=Qa.advance*va.scale+Ua)}$a.length!==0&&(rs=Math.max(ts-Ua,rs),ci($a,0,$a.length-1,No,zo)),ts=0;var xp=da*ua+zo;G.lineOffset=Math.max(zo,nu),Bs+=xp,Ns=Math.max(xp,Ns),++gs}else Bs+=da,++gs}var Cc,zh=Bs- -17,Ac=Nr(lo),tf=Ac.horizontalAlign,fh=Ac.verticalAlign;(function(bp,td,Ep,Uh,rd,wc,Sp,cl,nd){var Zh,id=(td-Ep)*rd;Zh=wc!==Sp?-cl*Uh- -17:(-Uh*nd+.5)*Sp;for(var Tc=0,jh=bp;Tc<jh.length;Tc+=1)for(var Of=0,Vh=jh[Tc].positionedGlyphs;Of<Vh.length;Of+=1){var Rf=Vh[Of];Rf.x+=id,Rf.y+=Zh}})(An.positionedLines,No,tf,fh,rs,Ns,da,zh,Zn.length),An.top+=-fh*zh,An.bottom=An.top+zh,An.left+=-tf*rs,An.right=An.left+rs}(Hn,o,u,p,qe,S,I,D,W,N,ee,Oe),!function(An){for(var Ui=0,Si=An;Ui<Si.length;Ui+=1)if(Si[Ui].positionedGlyphs.length!==0)return!1;return!0}(Ii)&&Hn}Lr.fromFeature=function(t,o){for(var u=new Lr,p=0;p<t.sections.length;p++){var y=t.sections[p];y.image?u.addImageSection(y):u.addTextSection(y,o)}return u},Lr.prototype.length=function(){return this.text.length},Lr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Lr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Lr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Lr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var p=t.charCodeAt(u+1)||null,y=t.charCodeAt(u-1)||null;o+=p&&ju(p)&&!sh[t[u+1]]||y&&ju(y)&&!sh[t[u-1]]||!sh[t[u]]?t[u]:sh[t[u]]}return o}(this.text)},Lr.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&zn[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,p=this.text.length-1;p>=0&&p>=t&&zn[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Lr.prototype.substring=function(t,o){var u=new Lr;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Lr.prototype.toString=function(){return this.text},Lr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Lr.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(ar.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,p=0;p<t.text.length;++p)this.sectionIndex.push(u)},Lr.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(ar.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Qe("Reached maximum number of images 6401")}else Qe("Can't add FormattedSection with an empty image.")},Lr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var zn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},tr={};function ir(t,o,u,p,y,b){if(o.imageName){var S=p[o.imageName];return S?S.displaySize[0]*o.scale*24/b+y:0}var I=u[o.fontStack],D=I&&I[t];return D?D.metrics.advance*o.scale+y:0}function Sn(t,o,u,p){var y=Math.pow(t-o,2);return p?t<o?y/2:2*y:y+Math.abs(u)*u}function Vr(t,o,u){var p=0;return t===10&&(p-=1e4),u&&(p+=150),t!==40&&t!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function Sr(t,o,u,p,y,b){for(var S=null,I=Sn(o,u,y,b),D=0,N=p;D<N.length;D+=1){var V=N[D],W=Sn(o-V.x,u,y,b)+V.badness;W<=I&&(S=V,I=W)}return{index:t,x:o,priorBreak:S,badness:I}}function qr(t,o,u,p,y,b,S){if(b!=="point")return[];if(!t)return[];for(var I,D=[],N=function(qe,Ue,ut,Mt,Gt,Wt){for(var lr=0,Or=0;Or<qe.length();Or++){var Kr=qe.getSection(Or);lr+=ir(qe.getCharCode(Or),Kr,Mt,Gt,Ue,Wt)}return lr/Math.max(1,Math.ceil(lr/ut))}(t,o,u,p,y,S),V=t.text.indexOf("\u200B")>=0,W=0,ee=0;ee<t.length();ee++){var se=t.getSection(ee),Me=t.getCharCode(ee);if(zn[Me]||(W+=ir(Me,se,p,y,o,S)),ee<t.length()-1){var Oe=!((I=Me)<11904||!(Yr["Bopomofo Extended"](I)||Yr.Bopomofo(I)||Yr["CJK Compatibility Forms"](I)||Yr["CJK Compatibility Ideographs"](I)||Yr["CJK Compatibility"](I)||Yr["CJK Radicals Supplement"](I)||Yr["CJK Strokes"](I)||Yr["CJK Symbols and Punctuation"](I)||Yr["CJK Unified Ideographs Extension A"](I)||Yr["CJK Unified Ideographs"](I)||Yr["Enclosed CJK Letters and Months"](I)||Yr["Halfwidth and Fullwidth Forms"](I)||Yr.Hiragana(I)||Yr["Ideographic Description Characters"](I)||Yr["Kangxi Radicals"](I)||Yr["Katakana Phonetic Extensions"](I)||Yr.Katakana(I)||Yr["Vertical Forms"](I)||Yr["Yi Radicals"](I)||Yr["Yi Syllables"](I)));(tr[Me]||Oe||se.imageName)&&D.push(Sr(ee+1,W,N,D,Vr(Me,t.getCharCode(ee+1),Oe&&V),!1))}}return function qe(Ue){return Ue?qe(Ue.priorBreak).concat(Ue.index):[]}(Sr(t.length(),W,N,D,0,!0))}function Nr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function ci(t,o,u,p,y){if(p||y)for(var b=t[u],S=(t[u].x+b.metrics.advance*b.scale)*p,I=o;I<=u;I++)t[I].x-=S,t[I].y+=y}function ei(t,o,u,p,y,b){var S,I=t.image;if(I.content){var D=I.content,N=I.pixelRatio||1;S=[D[0]/N,D[1]/N,I.displaySize[0]-D[2]/N,I.displaySize[1]-D[3]/N]}var V,W,ee,se,Me=o.left*b,Oe=o.right*b;u==="width"||u==="both"?(se=y[0]+Me-p[3],W=y[0]+Oe+p[1]):W=(se=y[0]+(Me+Oe-I.displaySize[0])/2)+I.displaySize[0];var qe=o.top*b,Ue=o.bottom*b;return u==="height"||u==="both"?(V=y[1]+qe-p[0],ee=y[1]+Ue+p[2]):ee=(V=y[1]+(qe+Ue-I.displaySize[1])/2)+I.displaySize[1],{image:I,top:V,right:W,bottom:ee,left:se,collisionPadding:S}}tr[10]=!0,tr[32]=!0,tr[38]=!0,tr[40]=!0,tr[41]=!0,tr[43]=!0,tr[45]=!0,tr[47]=!0,tr[173]=!0,tr[183]=!0,tr[8203]=!0,tr[8208]=!0,tr[8211]=!0,tr[8231]=!0;var Wr=function(t){function o(u,p,y,b){t.call(this,u,p),this.angle=y,b!==void 0&&(this.segment=b)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(fe);function Qr(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new ki(t+1))};if(u.kind==="source")return{kind:"source"};for(var p=u.zoomStops,y=u.interpolationType,b=0;b<p.length&&p[b]<=t;)b++;for(var S=b=Math.max(0,b-1);S<p.length&&p[S]<t+1;)S++;S=Math.min(p.length-1,S);var I=p[b],D=p[S];return u.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:D,interpolationType:y}:{kind:"camera",minZoom:I,maxZoom:D,minSize:u.evaluate(new ki(I)),maxSize:u.evaluate(new ki(D)),interpolationType:y}}function $n(t,o,u){var p=o.uSize,y=u.lowerSize;return t.kind==="source"?y/128:t.kind==="composite"?ba(y/128,u.upperSize/128,o.uSizeT):p}function ui(t,o){var u=0,p=0;if(t.kind==="constant")p=t.layoutSize;else if(t.kind!=="source"){var y=t.interpolationType,b=y?yt(xe.interpolationFactor(y,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?p=ba(t.minSize,t.maxSize,b):u=b}return{uSizeT:u,uSize:p}}yn("Anchor",Wr);var Bi=Object.freeze({__proto__:null,getSizeData:Qr,evaluateSizeForFeature:$n,evaluateSizeForZoom:ui,SIZE_PACK_FACTOR:128});function uo(t,o,u,p,y){if(o.segment===void 0)return!0;for(var b=o,S=o.segment+1,I=0;I>-u/2;){if(--S<0)return!1;I-=t[S].dist(b),b=t[S]}I+=t[S].dist(t[S+1]),S++;for(var D=[],N=0;I<u/2;){var V=t[S],W=t[S+1];if(!W)return!1;var ee=t[S-1].angleTo(V)-V.angleTo(W);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:I,angleDelta:ee}),N+=ee;I-D[0].distance>p;)N-=D.shift().angleDelta;if(N>y)return!1;S++,I+=V.dist(W)}return!0}function vo(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function Ni(t,o,u){return t?.6*o*u:0}function ss(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function Ka(t,o,u,p,y,b){for(var S=Ni(u,y,b),I=ss(u,p)*b,D=0,N=vo(t)/2,V=0;V<t.length-1;V++){var W=t[V],ee=t[V+1],se=W.dist(ee);if(D+se>N){var Me=(N-D)/se,Oe=ba(W.x,ee.x,Me),qe=ba(W.y,ee.y,Me),Ue=new Wr(Oe,qe,ee.angleTo(W),V);return Ue._round(),!S||uo(t,Ue,I,S,o)?Ue:void 0}D+=se}}function Ho(t,o,u,p,y,b,S,I,D){var N=Ni(p,b,S),V=ss(p,y),W=V*S,ee=t[0].x===0||t[0].x===D||t[0].y===0||t[0].y===D;return o-W<o/4&&(o=W+o/4),function se(Me,Oe,qe,Ue,ut,Mt,Gt,Wt,lr){for(var Or=Mt/2,Kr=vo(Me),Un=0,hn=Oe-qe,Vn=[],dn=0;dn<Me.length-1;dn++){for(var Ii=Me[dn],Hn=Me[dn+1],An=Ii.dist(Hn),Ui=Hn.angleTo(Ii);hn+qe<Un+An;){var Si=((hn+=qe)-Un)/An,ea=ba(Ii.x,Hn.x,Si),Zn=ba(Ii.y,Hn.y,Si);if(ea>=0&&ea<lr&&Zn>=0&&Zn<lr&&hn-Or>=0&&hn+Or<=Kr){var da=new Wr(ea,Zn,Ui,dn);da._round(),Ue&&!uo(Me,da,Mt,Ue,ut)||Vn.push(da)}}Un+=An}return Wt||Vn.length||Gt||(Vn=se(Me,Un/2,qe,Ue,ut,Mt,Gt,!0,lr)),Vn}(t,ee?o/2*I%o:(V/2+2*b)*S*I%o,o,N,u,W,ee,!1,D)}function wo(t,o,u,p,y){for(var b=[],S=0;S<t.length;S++)for(var I=t[S],D=void 0,N=0;N<I.length-1;N++){var V=I[N],W=I[N+1];V.x<o&&W.x<o||(V.x<o?V=new fe(o,V.y+(o-V.x)/(W.x-V.x)*(W.y-V.y))._round():W.x<o&&(W=new fe(o,V.y+(o-V.x)/(W.x-V.x)*(W.y-V.y))._round()),V.y<u&&W.y<u||(V.y<u?V=new fe(V.x+(u-V.y)/(W.y-V.y)*(W.x-V.x),u)._round():W.y<u&&(W=new fe(V.x+(u-V.y)/(W.y-V.y)*(W.x-V.x),u)._round()),V.x>=p&&W.x>=p||(V.x>=p?V=new fe(p,V.y+(p-V.x)/(W.x-V.x)*(W.y-V.y))._round():W.x>=p&&(W=new fe(p,V.y+(p-V.x)/(W.x-V.x)*(W.y-V.y))._round()),V.y>=y&&W.y>=y||(V.y>=y?V=new fe(V.x+(y-V.y)/(W.y-V.y)*(W.x-V.x),y)._round():W.y>=y&&(W=new fe(V.x+(y-V.y)/(W.y-V.y)*(W.x-V.x),y)._round()),D&&V.equals(D[D.length-1])||b.push(D=[V]),D.push(W)))))}return b}function Qo(t,o,u,p){var y=[],b=t.image,S=b.pixelRatio,I=b.paddedRect.w-2,D=b.paddedRect.h-2,N=t.right-t.left,V=t.bottom-t.top,W=b.stretchX||[[0,I]],ee=b.stretchY||[[0,D]],se=function(ea,Zn){return ea+Zn[1]-Zn[0]},Me=W.reduce(se,0),Oe=ee.reduce(se,0),qe=I-Me,Ue=D-Oe,ut=0,Mt=Me,Gt=0,Wt=Oe,lr=0,Or=qe,Kr=0,Un=Ue;if(b.content&&p){var hn=b.content;ut=Bo(W,0,hn[0]),Gt=Bo(ee,0,hn[1]),Mt=Bo(W,hn[0],hn[2]),Wt=Bo(ee,hn[1],hn[3]),lr=hn[0]-ut,Kr=hn[1]-Gt,Or=hn[2]-hn[0]-Mt,Un=hn[3]-hn[1]-Wt}var Vn=function(ea,Zn,da,lo){var To=mo(ea.stretch-ut,Mt,N,t.left),Eo=xi(ea.fixed-lr,Or,ea.stretch,Me),Ua=mo(Zn.stretch-Gt,Wt,V,t.top),ia=xi(Zn.fixed-Kr,Un,Zn.stretch,Oe),es=mo(da.stretch-ut,Mt,N,t.left),ts=xi(da.fixed-lr,Or,da.stretch,Me),Bs=mo(lo.stretch-Gt,Wt,V,t.top),rs=xi(lo.fixed-Kr,Un,lo.stretch,Oe),Ns=new fe(To,Ua),No=new fe(es,Ua),gs=new fe(es,Bs),Ki=new fe(To,Bs),Za=new fe(Eo/S,ia/S),Ta=new fe(ts/S,rs/S),ua=o*Math.PI/180;if(ua){var nu=Math.sin(ua),G=Math.cos(ua),$a=[G,-nu,nu,G];Ns._matMult($a),No._matMult($a),Ki._matMult($a),gs._matMult($a)}var zo=ea.stretch+ea.fixed,Is=Zn.stretch+Zn.fixed;return{tl:Ns,tr:No,bl:Ki,br:gs,tex:{x:b.paddedRect.x+1+zo,y:b.paddedRect.y+1+Is,w:da.stretch+da.fixed-zo,h:lo.stretch+lo.fixed-Is},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Za,pixelOffsetBR:Ta,minFontScaleX:Or/S/N,minFontScaleY:Un/S/V,isSDF:u}};if(p&&(b.stretchX||b.stretchY))for(var dn=ms(W,qe,Me),Ii=ms(ee,Ue,Oe),Hn=0;Hn<dn.length-1;Hn++)for(var An=dn[Hn],Ui=dn[Hn+1],Si=0;Si<Ii.length-1;Si++)y.push(Vn(An,Ii[Si],Ui,Ii[Si+1]));else y.push(Vn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:D+1}));return y}function Bo(t,o,u){for(var p=0,y=0,b=t;y<b.length;y+=1){var S=b[y];p+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return p}function ms(t,o,u){for(var p=[{fixed:-1,stretch:0}],y=0,b=t;y<b.length;y+=1){var S=b[y],I=S[0],D=S[1],N=p[p.length-1];p.push({fixed:I-N.stretch,stretch:N.stretch}),p.push({fixed:I-N.stretch,stretch:N.stretch+(D-I)})}return p.push({fixed:o+1,stretch:u}),p}function mo(t,o,u,p){return t/o*u+p}function xi(t,o,u,p){return t-o*u/p}var Wo=function(t,o,u,p,y,b,S,I,D,N){if(this.boxStartIndex=t.length,D){var V=b.top,W=b.bottom,ee=b.collisionPadding;ee&&(V-=ee[1],W+=ee[3]);var se=W-V;se>0&&(se=Math.max(10,se),this.circleDiameter=se)}else{var Me=b.top*S-I,Oe=b.bottom*S+I,qe=b.left*S-I,Ue=b.right*S+I,ut=b.collisionPadding;if(ut&&(qe-=ut[0]*S,Me-=ut[1]*S,Ue+=ut[2]*S,Oe+=ut[3]*S),N){var Mt=new fe(qe,Me),Gt=new fe(Ue,Me),Wt=new fe(qe,Oe),lr=new fe(Ue,Oe),Or=N*Math.PI/180;Mt._rotate(Or),Gt._rotate(Or),Wt._rotate(Or),lr._rotate(Or),qe=Math.min(Mt.x,Gt.x,Wt.x,lr.x),Ue=Math.max(Mt.x,Gt.x,Wt.x,lr.x),Me=Math.min(Mt.y,Gt.y,Wt.y,lr.y),Oe=Math.max(Mt.y,Gt.y,Wt.y,lr.y)}t.emplaceBack(o.x,o.y,qe,Me,Ue,Oe,u,p,y)}this.boxEndIndex=t.length},na=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=Jo),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function Jo(t,o){return t<o?-1:t>o?1:0}function ri(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var p=1/0,y=1/0,b=-1/0,S=-1/0,I=t[0],D=0;D<I.length;D++){var N=I[D];(!D||N.x<p)&&(p=N.x),(!D||N.y<y)&&(y=N.y),(!D||N.x>b)&&(b=N.x),(!D||N.y>S)&&(S=N.y)}var V=Math.min(b-p,S-y),W=V/2,ee=new na([],zi);if(V===0)return new fe(p,y);for(var se=p;se<b;se+=V)for(var Me=y;Me<S;Me+=V)ee.push(new _a(se+W,Me+W,W,t));for(var Oe=function(ut){for(var Mt=0,Gt=0,Wt=0,lr=ut[0],Or=0,Kr=lr.length,Un=Kr-1;Or<Kr;Un=Or++){var hn=lr[Or],Vn=lr[Un],dn=hn.x*Vn.y-Vn.x*hn.y;Gt+=(hn.x+Vn.x)*dn,Wt+=(hn.y+Vn.y)*dn,Mt+=3*dn}return new _a(Gt/Mt,Wt/Mt,0,ut)}(t),qe=ee.length;ee.length;){var Ue=ee.pop();(Ue.d>Oe.d||!Oe.d)&&(Oe=Ue,u&&console.log("found best %d after %d probes",Math.round(1e4*Ue.d)/1e4,qe)),Ue.max-Oe.d<=o||(ee.push(new _a(Ue.p.x-(W=Ue.h/2),Ue.p.y-W,W,t)),ee.push(new _a(Ue.p.x+W,Ue.p.y-W,W,t)),ee.push(new _a(Ue.p.x-W,Ue.p.y+W,W,t)),ee.push(new _a(Ue.p.x+W,Ue.p.y+W,W,t)),qe+=4)}return u&&(console.log("num probes: "+qe),console.log("best distance: "+Oe.d)),Oe.p}function zi(t,o){return o.max-t.max}function _a(t,o,u,p){this.p=new fe(t,o),this.h=u,this.d=function(y,b){for(var S=!1,I=1/0,D=0;D<b.length;D++)for(var N=b[D],V=0,W=N.length,ee=W-1;V<W;ee=V++){var se=N[V],Me=N[ee];se.y>y.y!=Me.y>y.y&&y.x<(Me.x-se.x)*(y.y-se.y)/(Me.y-se.y)+se.x&&(S=!S),I=Math.min(I,Vl(y,se,Me))}return(S?1:-1)*Math.sqrt(I)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}na.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},na.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},na.prototype.peek=function(){return this.data[0]},na.prototype._up=function(t){for(var o=this.data,u=this.compare,p=o[t];t>0;){var y=t-1>>1,b=o[y];if(u(p,b)>=0)break;o[t]=b,t=y}o[t]=p},na.prototype._down=function(t){for(var o=this.data,u=this.compare,p=this.length>>1,y=o[t];t<p;){var b=1+(t<<1),S=o[b],I=b+1;if(I<this.length&&u(o[I],S)<0&&(b=I,S=o[I]),u(S,y)>=0)break;o[t]=S,t=b}o[t]=y};var bo=Number.POSITIVE_INFINITY;function wl(t,o){return o[1]!==bo?function(u,p,y){var b=0,S=0;switch(p=Math.abs(p),y=Math.abs(y),u){case"top-right":case"top-left":case"top":S=y-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-y}switch(u){case"top-right":case"bottom-right":case"right":b=-p;break;case"top-left":case"bottom-left":case"left":b=p}return[b,S]}(t,o[0],o[1]):function(u,p){var y=0,b=0;p<0&&(p=0);var S=p/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=S-7;break;case"bottom-right":case"bottom-left":b=7-S;break;case"bottom":b=7-p;break;case"top":b=p-7}switch(u){case"top-right":case"bottom-right":y=-S;break;case"top-left":case"bottom-left":y=S;break;case"left":y=p;break;case"right":y=-p}return[y,b]}(t,o[0])}function Te(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ut(t,o,u,p,y,b,S,I,D,N,V,W,ee,se,Me){var Oe=function(Gt,Wt,lr,Or,Kr,Un,hn,Vn){for(var dn=Or.layout.get("text-rotate").evaluate(Un,{})*Math.PI/180,Ii=[],Hn=0,An=Wt.positionedLines;Hn<An.length;Hn+=1)for(var Ui=An[Hn],Si=0,ea=Ui.positionedGlyphs;Si<ea.length;Si+=1){var Zn=ea[Si];if(Zn.rect){var da=Zn.rect||{},lo=4,To=!0,Eo=1,Ua=0,ia=(Kr||Vn)&&Zn.vertical,es=Zn.metrics.advance*Zn.scale/2;if(Vn&&Wt.verticalizable&&(Ua=Ui.lineOffset/2-(Zn.imageName?-(24-Zn.metrics.width*Zn.scale)/2:24*(Zn.scale-1))),Zn.imageName){var ts=hn[Zn.imageName];To=ts.sdf,lo=1/(Eo=ts.pixelRatio)}var Bs=Kr?[Zn.x+es,Zn.y]:[0,0],rs=Kr?[0,0]:[Zn.x+es+lr[0],Zn.y+lr[1]-Ua],Ns=[0,0];ia&&(Ns=rs,rs=[0,0]);var No=(Zn.metrics.left-lo)*Zn.scale-es+rs[0],gs=(-Zn.metrics.top-lo)*Zn.scale+rs[1],Ki=No+da.w*Zn.scale/Eo,Za=gs+da.h*Zn.scale/Eo,Ta=new fe(No,gs),ua=new fe(Ki,gs),nu=new fe(No,Za),G=new fe(Ki,Za);if(ia){var $a=new fe(-es,es- -17),zo=-Math.PI/2,Is=12-es,va=new fe(22-Is,-(Zn.imageName?Is:0)),Kl=new(Function.prototype.bind.apply(fe,[null].concat(Ns)));Ta._rotateAround(zo,$a)._add(va)._add(Kl),ua._rotateAround(zo,$a)._add(va)._add(Kl),nu._rotateAround(zo,$a)._add(va)._add(Kl),G._rotateAround(zo,$a)._add(va)._add(Kl)}if(dn){var Ru=Math.sin(dn),$l=Math.cos(dn),Qa=[$l,-Ru,Ru,$l];Ta._matMult(Qa),ua._matMult(Qa),nu._matMult(Qa),G._matMult(Qa)}var Ql=new fe(0,0),ll=new fe(0,0);Ii.push({tl:Ta,tr:ua,bl:nu,br:G,tex:da,writingMode:Wt.writingMode,glyphOffset:Bs,sectionIndex:Zn.sectionIndex,isSDF:To,pixelOffsetTL:Ql,pixelOffsetBR:ll,minFontScaleX:0,minFontScaleY:0})}}return Ii}(0,u,I,y,b,S,p,t.allowVerticalPlacement),qe=t.textSizeData,Ue=null;qe.kind==="source"?(Ue=[128*y.layout.get("text-size").evaluate(S,{})])[0]>32640&&Qe(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):qe.kind==="composite"&&((Ue=[128*se.compositeTextSizes[0].evaluate(S,{},Me),128*se.compositeTextSizes[1].evaluate(S,{},Me)])[0]>32640||Ue[1]>32640)&&Qe(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Oe,Ue,I,b,S,N,o,D.lineStartIndex,D.lineLength,ee,Me);for(var ut=0,Mt=V;ut<Mt.length;ut+=1)W[Mt[ut]]=t.text.placedSymbolArray.length-1;return 4*Oe.length}function At(t){for(var o in t)return t[o];return null}function mn(t,o,u,p){var y=t.compareText;if(o in y){for(var b=y[o],S=b.length-1;S>=0;S--)if(p.dist(b[S])<u)return!0}else y[o]=[];return y[o].push(p),!1}var Vi=Mu.VectorTileFeature.types,Se=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function oe(t,o,u,p,y,b,S,I,D,N,V,W,ee){var se=I?Math.min(32640,Math.round(I[0])):0,Me=I?Math.min(32640,Math.round(I[1])):0;t.emplaceBack(o,u,Math.round(32*p),Math.round(32*y),b,S,(se<<1)+(D?1:0),Me,16*N,16*V,256*W,256*ee)}function Ve(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function ct(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(Gc(u[o].text))return!0;return!1}var Rt=function(t){this.layoutVertexArray=new _f,this.indexArray=new Js,this.programConfigurations=t,this.segments=new pe,this.dynamicLayoutVertexArray=new Zl,this.opacityVertexArray=new Au,this.placedSymbolArray=new d};Rt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Rt.prototype.upload=function(t,o,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Id.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Kp.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Se,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(t))},Rt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},yn("SymbolBuffers",Rt);var Ye=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new pe,this.collisionVertexArray=new Ea};Ye.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,$p.members,!0)},Ye.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},yn("CollisionBuffers",Ye);var Fe=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=tu([]),this.placementViewportMatrix=tu([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qr(this.zoom,o["text-size"]),this.iconSizeData=Qr(this.zoom,o["icon-size"]);var u=this.layers[0].layout,p=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(b){return fr[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};Fe.prototype.createArrays=function(){this.text=new Rt(new Yn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Rt(new Yn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new M,this.lineVertexArray=new L,this.symbolInstances=new w},Fe.prototype.calculateGlyphDependencies=function(t,o,u,p,y){for(var b=0;b<t.length;b++)if(o[t.charCodeAt(b)]=!0,(u||p)&&y){var S=sh[t.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}},Fe.prototype.populate=function(t,o,u){var p=this.layers[0],y=p.layout,b=y.get("text-font"),S=y.get("text-field"),I=y.get("icon-image"),D=(S.value.kind!=="constant"||S.value.value instanceof mt&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),N=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,V=y.get("symbol-sort-key");if(this.features=[],D||N){for(var W=o.iconDependencies,ee=o.glyphDependencies,se=o.availableImages,Me=new ki(this.zoom),Oe=0,qe=t;Oe<qe.length;Oe+=1){var Ue=qe[Oe],ut=Ue.feature,Mt=Ue.id,Gt=Ue.index,Wt=Ue.sourceLayerIndex,lr=p._featureFilter.needGeometry,Or=po(ut,lr);if(p._featureFilter.filter(Me,Or,u)){lr||(Or.geometry=no(ut));var Kr=void 0;if(D){var Un=p.getValueAndResolveTokens("text-field",Or,u,se),hn=mt.factory(Un);ct(hn)&&(this.hasRTLText=!0),(!this.hasRTLText||mf()==="unavailable"||this.hasRTLText&&js.isParsed())&&(Kr=Jp(hn,p,Or))}var Vn=void 0;if(N){var dn=p.getValueAndResolveTokens("icon-image",Or,u,se);Vn=dn instanceof aa?dn:aa.fromString(dn)}if(Kr||Vn){var Ii=this.sortFeaturesByKey?V.evaluate(Or,{},u):void 0;if(this.features.push({id:Mt,text:Kr,icon:Vn,index:Gt,sourceLayerIndex:Wt,geometry:Or.geometry,properties:ut.properties,type:Vi[ut.type],sortKey:Ii}),Vn&&(W[Vn.name]=!0),Kr){var Hn=b.evaluate(Or,{},u).join(","),An=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(fr.vertical)>=0;for(var Ui=0,Si=Kr.sections;Ui<Si.length;Ui+=1){var ea=Si[Ui];if(ea.image)W[ea.image.name]=!0;else{var Zn=vf(Kr.toString()),da=ea.fontStack||Hn,lo=ee[da]=ee[da]||{};this.calculateGlyphDependencies(ea.text,lo,An,this.allowVerticalPlacement,Zn)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(To){var Eo={},Ua={},ia=[],es=0;function ts($a){ia.push(To[$a]),es++}function Bs($a,zo,Is){var va=Ua[$a];return delete Ua[$a],Ua[zo]=va,ia[va].geometry[0].pop(),ia[va].geometry[0]=ia[va].geometry[0].concat(Is[0]),va}function rs($a,zo,Is){var va=Eo[zo];return delete Eo[zo],Eo[$a]=va,ia[va].geometry[0].shift(),ia[va].geometry[0]=Is[0].concat(ia[va].geometry[0]),va}function Ns($a,zo,Is){var va=Is?zo[0][zo[0].length-1]:zo[0][0];return $a+":"+va.x+":"+va.y}for(var No=0;No<To.length;No++){var gs=To[No],Ki=gs.geometry,Za=gs.text?gs.text.toString():null;if(Za){var Ta=Ns(Za,Ki),ua=Ns(Za,Ki,!0);if(Ta in Ua&&ua in Eo&&Ua[Ta]!==Eo[ua]){var nu=rs(Ta,ua,Ki),G=Bs(Ta,ua,ia[nu].geometry);delete Eo[Ta],delete Ua[ua],Ua[Ns(Za,ia[G].geometry,!0)]=G,ia[nu].geometry=null}else Ta in Ua?Bs(Ta,ua,Ki):ua in Eo?rs(Ta,ua,Ki):(ts(No),Eo[Ta]=es-1,Ua[ua]=es-1)}else ts(No)}return ia.filter(function($a){return $a.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(To,Eo){return To.sortKey-Eo.sortKey})}},Fe.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},Fe.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Fe.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Fe.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Fe.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Fe.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Fe.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var p=t.dist(o[t.segment+1]),y=t.dist(o[t.segment]),b={},S=t.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:p},S<o.length-1&&(p+=o[S+1].dist(o[S]));for(var I=t.segment||0;I>=0;I--)b[I]={x:o[I].x,y:o[I].y,tileUnitDistanceFromAnchor:y},I>0&&(y+=o[I-1].dist(o[I]));for(var D=0;D<o.length;D++){var N=b[D];this.lineVertexArray.emplaceBack(N.x,N.y,N.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},Fe.prototype.addSymbols=function(t,o,u,p,y,b,S,I,D,N,V,W){for(var ee=t.indexArray,se=t.layoutVertexArray,Me=t.segments.prepareSegment(4*o.length,se,ee,this.canOverlap?b.sortKey:void 0),Oe=this.glyphOffsetArray.length,qe=Me.vertexLength,Ue=this.allowVerticalPlacement&&S===fr.vertical?Math.PI/2:0,ut=b.text&&b.text.sections,Mt=0;Mt<o.length;Mt++){var Gt=o[Mt],Wt=Gt.tl,lr=Gt.tr,Or=Gt.bl,Kr=Gt.br,Un=Gt.tex,hn=Gt.pixelOffsetTL,Vn=Gt.pixelOffsetBR,dn=Gt.minFontScaleX,Ii=Gt.minFontScaleY,Hn=Gt.glyphOffset,An=Gt.isSDF,Ui=Gt.sectionIndex,Si=Me.vertexLength,ea=Hn[1];oe(se,I.x,I.y,Wt.x,ea+Wt.y,Un.x,Un.y,u,An,hn.x,hn.y,dn,Ii),oe(se,I.x,I.y,lr.x,ea+lr.y,Un.x+Un.w,Un.y,u,An,Vn.x,hn.y,dn,Ii),oe(se,I.x,I.y,Or.x,ea+Or.y,Un.x,Un.y+Un.h,u,An,hn.x,Vn.y,dn,Ii),oe(se,I.x,I.y,Kr.x,ea+Kr.y,Un.x+Un.w,Un.y+Un.h,u,An,Vn.x,Vn.y,dn,Ii),Ve(t.dynamicLayoutVertexArray,I,Ue),ee.emplaceBack(Si,Si+1,Si+2),ee.emplaceBack(Si+1,Si+2,Si+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Hn[0]),Mt!==o.length-1&&Ui===o[Mt+1].sectionIndex||t.programConfigurations.populatePaintArrays(se.length,b,b.index,{},W,ut&&ut[Ui])}t.placedSymbolArray.emplaceBack(I.x,I.y,Oe,this.glyphOffsetArray.length-Oe,qe,D,N,I.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],S,0,!1,0,V)},Fe.prototype._addCollisionDebugVertex=function(t,o,u,p,y,b){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,p,y,Math.round(b.x),Math.round(b.y))},Fe.prototype.addCollisionDebugVertices=function(t,o,u,p,y,b,S){var I=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),D=I.vertexLength,N=y.layoutVertexArray,V=y.collisionVertexArray,W=S.anchorX,ee=S.anchorY;this._addCollisionDebugVertex(N,V,b,W,ee,new fe(t,o)),this._addCollisionDebugVertex(N,V,b,W,ee,new fe(u,o)),this._addCollisionDebugVertex(N,V,b,W,ee,new fe(u,p)),this._addCollisionDebugVertex(N,V,b,W,ee,new fe(t,p)),I.vertexLength+=4;var se=y.indexArray;se.emplaceBack(D,D+1),se.emplaceBack(D+1,D+2),se.emplaceBack(D+2,D+3),se.emplaceBack(D+3,D),I.primitiveLength+=4},Fe.prototype.addDebugCollisionBoxes=function(t,o,u,p){for(var y=t;y<o;y++){var b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},Fe.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ye(xl,Fh.members,Na),this.iconCollisionBox=new Ye(xl,Fh.members,Na);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Fe.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,p,y,b,S,I,D){for(var N={},V=o;V<u;V++){var W=t.get(V);N.textBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},N.textFeatureIndex=W.featureIndex;break}for(var ee=p;ee<y;ee++){var se=t.get(ee);N.verticalTextBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},N.verticalTextFeatureIndex=se.featureIndex;break}for(var Me=b;Me<S;Me++){var Oe=t.get(Me);N.iconBox={x1:Oe.x1,y1:Oe.y1,x2:Oe.x2,y2:Oe.y2,anchorPointX:Oe.anchorPointX,anchorPointY:Oe.anchorPointY},N.iconFeatureIndex=Oe.featureIndex;break}for(var qe=I;qe<D;qe++){var Ue=t.get(qe);N.verticalIconBox={x1:Ue.x1,y1:Ue.y1,x2:Ue.x2,y2:Ue.y2,anchorPointX:Ue.anchorPointX,anchorPointY:Ue.anchorPointY},N.verticalIconFeatureIndex=Ue.featureIndex;break}return N},Fe.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},Fe.prototype.hasTextData=function(){return this.text.segments.get().length>0},Fe.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Fe.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Fe.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Fe.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Fe.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),p=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<p;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)},Fe.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),p=[],y=[],b=[],S=0;S<this.symbolInstances.length;++S){b.push(S);var I=this.symbolInstances.get(S);p.push(0|Math.round(o*I.anchorX+u*I.anchorY)),y.push(I.featureIndex)}return b.sort(function(D,N){return p[D]-p[N]||y[N]-y[D]}),b},Fe.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Fe.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,p=this.symbolInstanceIndexes;u<p.length;u+=1){var y=this.symbolInstances.get(p[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(b,S,I){b>=0&&I.indexOf(b)===S&&o.addIndicesForPlacedSymbol(o.text,b)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},yn("SymbolBucket",Fe,{omit:["layers","collisionBoxArray","features","compareText"]}),Fe.MAX_GLYPHS=65535,Fe.addDynamicAttributes=Ve;var nt=new os({"symbol-placement":new Fn(he.layout_symbol["symbol-placement"]),"symbol-spacing":new Fn(he.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Fn(he.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Tn(he.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Fn(he.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Fn(he.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Fn(he.layout_symbol["icon-ignore-placement"]),"icon-optional":new Fn(he.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Fn(he.layout_symbol["icon-rotation-alignment"]),"icon-size":new Tn(he.layout_symbol["icon-size"]),"icon-text-fit":new Fn(he.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Fn(he.layout_symbol["icon-text-fit-padding"]),"icon-image":new Tn(he.layout_symbol["icon-image"]),"icon-rotate":new Tn(he.layout_symbol["icon-rotate"]),"icon-padding":new Fn(he.layout_symbol["icon-padding"]),"icon-keep-upright":new Fn(he.layout_symbol["icon-keep-upright"]),"icon-offset":new Tn(he.layout_symbol["icon-offset"]),"icon-anchor":new Tn(he.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Fn(he.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Fn(he.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Fn(he.layout_symbol["text-rotation-alignment"]),"text-field":new Tn(he.layout_symbol["text-field"]),"text-font":new Tn(he.layout_symbol["text-font"]),"text-size":new Tn(he.layout_symbol["text-size"]),"text-max-width":new Tn(he.layout_symbol["text-max-width"]),"text-line-height":new Fn(he.layout_symbol["text-line-height"]),"text-letter-spacing":new Tn(he.layout_symbol["text-letter-spacing"]),"text-justify":new Tn(he.layout_symbol["text-justify"]),"text-radial-offset":new Tn(he.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Fn(he.layout_symbol["text-variable-anchor"]),"text-anchor":new Tn(he.layout_symbol["text-anchor"]),"text-max-angle":new Fn(he.layout_symbol["text-max-angle"]),"text-writing-mode":new Fn(he.layout_symbol["text-writing-mode"]),"text-rotate":new Tn(he.layout_symbol["text-rotate"]),"text-padding":new Fn(he.layout_symbol["text-padding"]),"text-keep-upright":new Fn(he.layout_symbol["text-keep-upright"]),"text-transform":new Tn(he.layout_symbol["text-transform"]),"text-offset":new Tn(he.layout_symbol["text-offset"]),"text-allow-overlap":new Fn(he.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Fn(he.layout_symbol["text-ignore-placement"]),"text-optional":new Fn(he.layout_symbol["text-optional"])}),_e={paint:new os({"icon-opacity":new Tn(he.paint_symbol["icon-opacity"]),"icon-color":new Tn(he.paint_symbol["icon-color"]),"icon-halo-color":new Tn(he.paint_symbol["icon-halo-color"]),"icon-halo-width":new Tn(he.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Tn(he.paint_symbol["icon-halo-blur"]),"icon-translate":new Fn(he.paint_symbol["icon-translate"]),"icon-translate-anchor":new Fn(he.paint_symbol["icon-translate-anchor"]),"text-opacity":new Tn(he.paint_symbol["text-opacity"]),"text-color":new Tn(he.paint_symbol["text-color"],{runtimeType:Hr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Tn(he.paint_symbol["text-halo-color"]),"text-halo-width":new Tn(he.paint_symbol["text-halo-width"]),"text-halo-blur":new Tn(he.paint_symbol["text-halo-blur"]),"text-translate":new Fn(he.paint_symbol["text-translate"]),"text-translate-anchor":new Fn(he.paint_symbol["text-translate-anchor"])}),layout:nt},ze=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:pn,this.defaultValue=t};ze.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},ze.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},ze.prototype.outputDefined=function(){return!1},ze.prototype.serialize=function(){return null},yn("FormatSectionOverride",ze,{omit:["defaultValue"]});var Ae=function(t){function o(u){t.call(this,u,_e)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){if(t.prototype.recalculate.call(this,u,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var b=[],S=0,I=y;S<I.length;S+=1){var D=I[S];b.indexOf(D)<0&&b.push(D)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,p,y,b){var S=this.layout.get(u).evaluate(p,{},y,b),I=this._unevaluatedLayout._values[u];return I.isDataDriven()||oc(I.value)||!S?S:function(D,N){return N.replace(/{([^{}]+)}/g,function(V,W){return W in D?String(D[W]):""})}(p.properties,S)},o.prototype.createBucket=function(u){return new Fe(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,p=_e.paint.overridableProperties;u<p.length;u+=1){var y=p[u];if(o.hasPaintOverride(this.layout,y)){var b,S=this.paint.get(y),I=new ze(S),D=new Nc(I,S.property.specification);b=S.value.kind==="constant"||S.value.kind==="source"?new Ll("source",D):new ml("composite",D,S.value.zoomStops,S.value._interpolationType),this.paint._values[y]=new hs(S.property,b,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!(!this.layout||p.isDataDriven()||y.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,p){var y=u.get("text-field"),b=_e.paint.properties[p],S=!1,I=function(V){for(var W=0,ee=V;W<ee.length;W+=1)if(b.overrides&&b.overrides.hasOverride(ee[W]))return void(S=!0)};if(y.value.kind==="constant"&&y.value.value instanceof mt)I(y.value.value.sections);else if(y.value.kind==="source"){var D=function(V){S||(V instanceof Ga&&ta(V.value)===Wi?I(V.value.sections):V instanceof Io?I(V.sections):V.eachChild(D))},N=y.value;N._styleExpression&&D(N._styleExpression.expression)}return S},o}(Gu),lt={paint:new os({"background-color":new Fn(he.paint_background["background-color"]),"background-pattern":new ps(he.paint_background["background-pattern"]),"background-opacity":new Fn(he.paint_background["background-opacity"])})},St=function(t){function o(u){t.call(this,u,lt)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Gu),pr={paint:new os({"raster-opacity":new Fn(he.paint_raster["raster-opacity"]),"raster-hue-rotate":new Fn(he.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Fn(he.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Fn(he.paint_raster["raster-brightness-max"]),"raster-saturation":new Fn(he.paint_raster["raster-saturation"]),"raster-contrast":new Fn(he.paint_raster["raster-contrast"]),"raster-resampling":new Fn(he.paint_raster["raster-resampling"]),"raster-fade-duration":new Fn(he.paint_raster["raster-fade-duration"])})},jr=function(t){function o(u){t.call(this,u,pr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Gu),Ur=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(Gu),on={circle:Wf,heatmap:Xf,hillshade:Yf,fill:nh,"fill-extrusion":qu,line:wf,symbol:Ae,background:St,raster:jr},Dr=J.HTMLImageElement,Cn=J.HTMLCanvasElement,fn=J.HTMLVideoElement,bn=J.ImageData,_n=J.ImageBitmap,gn=function(t,o,u,p){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,p)};gn.prototype.update=function(t,o,u){var p=t.width,y=t.height,b=!(this.size&&this.size[0]===p&&this.size[1]===y||u),S=this.context,I=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[p,y],t instanceof Dr||t instanceof Cn||t instanceof fn||t instanceof bn||_n&&t instanceof _n?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,t):I.texImage2D(I.TEXTURE_2D,0,this.format,p,y,0,this.format,I.UNSIGNED_BYTE,t.data);else{var D=u||{x:0,y:0},N=D.x,V=D.y;t instanceof Dr||t instanceof Cn||t instanceof fn||t instanceof bn||_n&&t instanceof _n?I.texSubImage2D(I.TEXTURE_2D,0,N,V,I.RGBA,I.UNSIGNED_BYTE,t):I.texSubImage2D(I.TEXTURE_2D,0,N,V,p,y,I.RGBA,I.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)},gn.prototype.bind=function(t,o,u){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),u!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)},gn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},gn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var ti=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};ti.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},ti.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Sa=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Vt(["receive","process"],this),this.invoker=new ti(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Fr()?t:J};function us(t,o,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[t*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}Sa.prototype.send=function(t,o,u,p,y){var b=this;y===void 0&&(y=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var I=Ce(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:p,mustQueue:y,sourceMapId:this.mapId,data:lu(o,I)},I),{cancel:function(){u&&delete b.callbacks[S],b.target.postMessage({id:S,type:"<cancel>",targetMapId:p,sourceMapId:b.mapId})}}},Sa.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var p=this.cancelCallbacks[u];delete this.cancelCallbacks[u],p&&p()}else Fr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},Sa.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},Sa.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var p=this.callbacks[t];delete this.callbacks[t],p&&(o.error?p(ks(o.error)):p(null,ks(o.data)))}else{var y=!1,b=Ce(this.globalScope)?void 0:[],S=o.hasCallback?function(V,W){y=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:V?lu(V):null,data:lu(W,b)},b)}:function(V){y=!0},I=null,D=ks(o.data);if(this.parent[o.type])I=this.parent[o.type](o.sourceMapId,D,S);else if(this.parent.getWorkerSource){var N=o.type.split(".");I=this.parent.getWorkerSource(o.sourceMapId,N[0],D.source)[N[1]](D,S)}else S(new Error("Could not find function "+o.type));!y&&I&&I.cancel&&(this.cancelCallbacks[t]=I.cancel)}},Sa.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var za=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};za.prototype.setNorthEast=function(t){return this._ne=t instanceof pa?new pa(t.lng,t.lat):pa.convert(t),this},za.prototype.setSouthWest=function(t){return this._sw=t instanceof pa?new pa(t.lng,t.lat):pa.convert(t),this},za.prototype.extend=function(t){var o,u,p=this._sw,y=this._ne;if(t instanceof pa)o=t,u=t;else{if(!(t instanceof za))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(za.convert(t)):this.extend(pa.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return p||y?(p.lng=Math.min(o.lng,p.lng),p.lat=Math.min(o.lat,p.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new pa(o.lng,o.lat),this._ne=new pa(u.lng,u.lat)),this},za.prototype.getCenter=function(){return new pa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},za.prototype.getSouthWest=function(){return this._sw},za.prototype.getNorthEast=function(){return this._ne},za.prototype.getNorthWest=function(){return new pa(this.getWest(),this.getNorth())},za.prototype.getSouthEast=function(){return new pa(this.getEast(),this.getSouth())},za.prototype.getWest=function(){return this._sw.lng},za.prototype.getSouth=function(){return this._sw.lat},za.prototype.getEast=function(){return this._ne.lng},za.prototype.getNorth=function(){return this._ne.lat},za.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},za.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},za.prototype.isEmpty=function(){return!(this._sw&&this._ne)},za.prototype.contains=function(t){var o=pa.convert(t),u=o.lng,p=o.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&y},za.convert=function(t){return!t||t instanceof za?t:new za(t)};var pa=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};pa.prototype.wrap=function(){return new pa(rr(this.lng,-180,180),this.lat)},pa.prototype.toArray=function(){return[this.lng,this.lat]},pa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},pa.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,p=t.lat*o,y=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(y,1))},pa.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new za(new pa(this.lng-u,this.lat-o),new pa(this.lng+u,this.lat+o))},pa.convert=function(t){if(t instanceof pa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new pa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new pa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var ul=2*Math.PI*63710088e-1;function Ms(t){return ul*Math.cos(t*Math.PI/180)}function Pu(t){return(180+t)/360}function Iu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function mp(t,o){return t/Ms(o)}function Ou(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var mi=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};mi.fromLngLat=function(t,o){o===void 0&&(o=0);var u=pa.convert(t);return new mi(Pu(u.lng),Iu(u.lat),mp(o,u.lat))},mi.prototype.toLngLat=function(){return new pa(360*this.x-180,Ou(this.y))},mi.prototype.toAltitude=function(){return this.z*Ms(Ou(this.y))},mi.prototype.meterInMercatorCoordinateUnits=function(){return 1/ul*(t=Ou(this.y),1/Math.cos(t*Math.PI/180));var t};var bi=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=gp(0,t,t,o,u)};bi.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},bi.prototype.url=function(t,o){var u,p,y,b,S,I=(p=this.y,y=this.z,b=us(256*(u=this.x),256*(p=Math.pow(2,y)-p-1),y),S=us(256*(u+1),256*(p+1),y),b[0]+","+b[1]+","+S[0]+","+S[1]),D=function(N,V,W){for(var ee,se="",Me=N;Me>0;Me--)se+=(V&(ee=1<<Me-1)?1:0)+(W&ee?2:0);return se}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",I)},bi.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new fe(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},bi.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Rd=function(t,o){this.wrap=t,this.canonical=o,this.key=gp(t,o.z,o.z,o.x,o.y)},ls=function(t,o,u,p,y){this.overscaledZ=t,this.wrap=o,this.canonical=new bi(u,+p,+y),this.key=gp(o,t,u,p,y)};function gp(t,o,u,p,y){(t*=2)<0&&(t=-1*t-1);var b=1<<u;return(b*b*t+b*y+p).toString(36)+u.toString(36)+o.toString(36)}ls.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},ls.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new ls(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ls(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},ls.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?gp(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):gp(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},ls.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},ls.prototype.children=function(t){if(this.overscaledZ>=t)return[new ls(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new ls(o,this.wrap,o,u,p),new ls(o,this.wrap,o,u+1,p),new ls(o,this.wrap,o,u,p+1),new ls(o,this.wrap,o,u+1,p+1)]},ls.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},ls.prototype.wrapped=function(){return new ls(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ls.prototype.unwrapTo=function(t){return new ls(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},ls.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ls.prototype.toUnwrapped=function(){return new Rd(this.wrap,this.canonical)},ls.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ls.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new mi(t.x-this.wrap,t.y))},yn("CanonicalTileID",bi),yn("OverscaledTileID",ls,{omit:["posMatrix"]});var Mf=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return Qe('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var p=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<p;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(p,y)]=this.data[this._idx(p-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,p)]=this.data[this._idx(y,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};Mf.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),p=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])},Mf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Mf.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},Mf.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},Mf.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},Mf.prototype.getPixels=function(){return new ko({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Mf.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var p=o*this.dim,y=o*this.dim+this.dim,b=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:p=y-1;break;case 1:y=p+1}switch(u){case-1:b=S-1;break;case 1:S=b+1}for(var I=-o*this.dim,D=-u*this.dim,N=b;N<S;N++)for(var V=p;V<y;V++)this.data[this._idx(V,N)]=t.data[this._idx(V+I,N+D)]},yn("DEMData",Mf);var Ld=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};Ld.prototype.encode=function(t){return this._stringToNumber[t]},Ld.prototype.decode=function(t){return this._numberToString[t]};var kd=function(t,o,u,p,y){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=p,this.properties=t.properties,this.id=y},wv={geometry:{configurable:!0}};wv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},wv.geometry.set=function(t){this._geometry=t},kd.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(kd.prototype,wv);var yp=function(){this.state={},this.stateChanges={},this.deletedStates={}};yp.prototype.updateState=function(t,o,u){var p=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},bt(this.stateChanges[t][p],u),this.deletedStates[t]===null)for(var y in this.deletedStates[t]={},this.state[t])y!==p&&(this.deletedStates[t][y]=null);else if(this.deletedStates[t]&&this.deletedStates[t][p]===null)for(var b in this.deletedStates[t][p]={},this.state[t][p])u[b]||(this.deletedStates[t][p][b]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][S]===null&&delete this.deletedStates[t][p][S]},yp.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var p=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}},yp.prototype.getState=function(t,o){var u=String(o),p=bt({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var y=this.deletedStates[t][o];if(y===null)return{};for(var b in y)delete p[b]}return p},yp.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},yp.prototype.coalesceChanges=function(t,o){var u={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var y={};for(var b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),bt(this.state[p][b],this.stateChanges[p][b]),y[b]=this.state[p][b];u[p]=y}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var I={};if(this.deletedStates[S]===null)for(var D in this.state[S])I[D]={},this.state[S][D]={};else for(var N in this.deletedStates[S]){if(this.deletedStates[S][N]===null)this.state[S][N]={};else for(var V=0,W=Object.keys(this.deletedStates[S][N]);V<W.length;V+=1)delete this.state[S][N][W[V]];I[N]=this.state[S][N]}u[S]=u[S]||{},bt(u[S],I)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var ee in t)t[ee].setFeatureState(u,o)};var Pf=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Zu(8192,16,0),this.grid3D=new Zu(8192,16,0),this.featureIndexArray=new Y,this.promoteId=o};function y0(t,o,u,p,y){return $t(t,function(b,S){var I=o instanceof Gs?o.get(S):null;return I&&I.evaluate?I.evaluate(u,p,y):I})}function _0(t){for(var o=1/0,u=1/0,p=-1/0,y=-1/0,b=0,S=t;b<S.length;b+=1){var I=S[b];o=Math.min(o,I.x),u=Math.min(u,I.y),p=Math.max(p,I.x),y=Math.max(y,I.y)}return{minX:o,minY:u,maxX:p,maxY:y}}function ym(t,o){return o-t}Pf.prototype.insert=function(t,o,u,p,y,b){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,y);for(var I=b?this.grid3D:this.grid,D=0;D<o.length;D++){for(var N=o[D],V=[1/0,1/0,-1/0,-1/0],W=0;W<N.length;W++){var ee=N[W];V[0]=Math.min(V[0],ee.x),V[1]=Math.min(V[1],ee.y),V[2]=Math.max(V[2],ee.x),V[3]=Math.max(V[3],ee.y)}V[0]<8192&&V[1]<8192&&V[2]>=0&&V[3]>=0&&I.insert(S,V[0],V[1],V[2],V[3])}},Pf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Mu.VectorTile(new Jc(this.rawTileData)).layers,this.sourceLayerCoder=new Ld(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Pf.prototype.query=function(t,o,u,p){var y=this;this.loadVTLayers();for(var b=t.params||{},S=8192/t.tileSize/t.scale,I=Dl(b.filter),D=t.queryGeometry,N=t.queryPadding*S,V=_0(D),W=this.grid.query(V.minX-N,V.minY-N,V.maxX+N,V.maxY+N),ee=_0(t.cameraQueryGeometry),se=this.grid3D.query(ee.minX-N,ee.minY-N,ee.maxX+N,ee.maxY+N,function(Gt,Wt,lr,Or){return function(Kr,Un,hn,Vn,dn){for(var Ii=0,Hn=Kr;Ii<Hn.length;Ii+=1){var An=Hn[Ii];if(Un<=An.x&&hn<=An.y&&Vn>=An.x&&dn>=An.y)return!0}var Ui=[new fe(Un,hn),new fe(Un,dn),new fe(Vn,dn),new fe(Vn,hn)];if(Kr.length>2){for(var Si=0,ea=Ui;Si<ea.length;Si+=1)if(gu(Kr,ea[Si]))return!0}for(var Zn=0;Zn<Kr.length-1;Zn++)if(Gl(Kr[Zn],Kr[Zn+1],Ui))return!0;return!1}(t.cameraQueryGeometry,Gt-N,Wt-N,lr+N,Or+N)}),Me=0,Oe=se;Me<Oe.length;Me+=1)W.push(Oe[Me]);W.sort(ym);for(var qe,Ue={},ut=function(Gt){var Wt=W[Gt];if(Wt!==qe){qe=Wt;var lr=y.featureIndexArray.get(Wt),Or=null;y.loadMatchingFeature(Ue,lr.bucketIndex,lr.sourceLayerIndex,lr.featureIndex,I,b.layers,b.availableImages,o,u,p,function(Kr,Un,hn){return Or||(Or=no(Kr)),Un.queryIntersectsFeature(D,Kr,hn,Or,y.z,t.transform,S,t.pixelPosMatrix)})}},Mt=0;Mt<W.length;Mt++)ut(Mt);return Ue},Pf.prototype.loadMatchingFeature=function(t,o,u,p,y,b,S,I,D,N,V){var W=this.bucketLayerIDs[o];if(!b||function(Kr,Un){for(var hn=0;hn<Kr.length;hn++)if(Un.indexOf(Kr[hn])>=0)return!0;return!1}(b,W)){var ee=this.sourceLayerCoder.decode(u),se=this.vtLayers[ee].feature(p);if(y.needGeometry){var Me=po(se,!0);if(!y.filter(new ki(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!y.filter(new ki(this.tileID.overscaledZ),se))return;for(var Oe=this.getId(se,ee),qe=0;qe<W.length;qe++){var Ue=W[qe];if(!(b&&b.indexOf(Ue)<0)){var ut=I[Ue];if(ut){var Mt={};Oe!==void 0&&N&&(Mt=N.getState(ut.sourceLayer||"_geojsonTileLayer",Oe));var Gt=bt({},D[Ue]);Gt.paint=y0(Gt.paint,ut.paint,se,Mt,S),Gt.layout=y0(Gt.layout,ut.layout,se,Mt,S);var Wt=!V||V(se,ut,Mt);if(Wt){var lr=new kd(se,this.z,this.x,this.y,Oe);lr.layer=Gt;var Or=t[Ue];Or===void 0&&(Or=t[Ue]=[]),Or.push({featureIndex:p,feature:lr,intersectionZ:Wt})}}}}}},Pf.prototype.lookupSymbolFeatures=function(t,o,u,p,y,b,S,I){var D={};this.loadVTLayers();for(var N=Dl(y),V=0,W=t;V<W.length;V+=1)this.loadMatchingFeature(D,u,p,W[V],N,b,S,I,o);return D},Pf.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var p=0,y=u[o];p<y.length;p+=1)if(t===y[p])return!0;return!1},Pf.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},yn("FeatureIndex",Pf,{omit:["rawTileData","sourceLayerCoder"]});var Ps=function(t,o){this.tileID=t,this.uid=Ct(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Ps.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<fi.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},Ps.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Ps.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var p in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(N,V){var W={};if(!V)return W;for(var ee=function(){var Oe=Me[se],qe=Oe.layerIds.map(function(Mt){return V.getLayer(Mt)}).filter(Boolean);if(qe.length!==0){Oe.layers=qe,Oe.stateDependentLayerIds&&(Oe.stateDependentLayers=Oe.stateDependentLayerIds.map(function(Mt){return qe.filter(function(Gt){return Gt.id===Mt})[0]}));for(var Ue=0,ut=qe;Ue<ut.length;Ue+=1)W[ut[Ue].id]=Oe}},se=0,Me=N;se<Me.length;se+=1)ee();return W}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[p];if(y instanceof Fe){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var S=this.buckets[b];if(S instanceof Fe&&S.hasRTLText){this.hasRTLText=!0,js.isLoading()||js.isLoaded()||mf()!=="deferred"||fu();break}}for(var I in this.queryPadding=0,this.buckets){var D=this.buckets[I];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(I).queryRadius(D))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new h},Ps.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Ps.prototype.getBucket=function(t){return this.buckets[t.id]},Ps.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var p=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new gn(t,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new gn(t,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},Ps.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Ps.prototype.queryRenderedFeatures=function(t,o,u,p,y,b,S,I,D,N){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:N,transform:I,params:S,queryPadding:this.queryPadding*D},t,o,u):{}},Ps.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var p=u.loadVTLayers(),y=o?o.sourceLayer:"",b=p._geojsonTileLayer||p[y];if(b)for(var S=Dl(o&&o.filter),I=this.tileID.canonical,D=I.z,N=I.x,V=I.y,W={z:D,x:N,y:V},ee=0;ee<b.length;ee++){var se=b.feature(ee);if(S.needGeometry){var Me=po(se,!0);if(!S.filter(new ki(this.tileID.overscaledZ),Me,this.tileID.canonical))continue}else if(!S.filter(new ki(this.tileID.overscaledZ),se))continue;var Oe=u.getId(se,y),qe=new kd(se,D,N,V,Oe);qe.tile=W,t.push(qe)}}},Ps.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Ps.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Ps.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=Jr(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var p=Date.now(),y=!1;if(this.expirationTime>p)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{var b=this.expirationTime-o;b?this.expirationTime=p+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Ps.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Ps.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(o.style.hasLayer(p)){var y=this.buckets[p],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[b],I=t[b];if(S&&I&&Object.keys(I).length!==0){y.update(I,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=o&&o.style&&o.style.getLayer(p);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(y)))}}}},Ps.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Ps.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<fi.now()},Ps.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Ps.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=fi.now()+t},Ps.prototype.setDependencies=function(t,o){for(var u={},p=0,y=o;p<y.length;p+=1)u[y[p]]=!0;this.dependencies[t]=u},Ps.prototype.hasDependency=function(t,o){for(var u=0,p=t;u<p.length;u+=1){var y=this.dependencies[p[u]];if(y){for(var b=0,S=o;b<S.length;b+=1)if(y[S[b]])return!0}}return!1};var uh=J.performance,Tv=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},uh.mark(this._marks.start)};Tv.prototype.finish=function(){uh.mark(this._marks.end);var t=uh.getEntriesByName(this._marks.measure);return t.length===0&&(uh.measure(this._marks.measure,this._marks.start,this._marks.end),t=uh.getEntriesByName(this._marks.measure),uh.clearMarks(this._marks.start),uh.clearMarks(this._marks.end),uh.clearMeasures(this._marks.measure)),t},m.Actor=Sa,m.AlphaImage=_u,m.CanonicalTileID=bi,m.CollisionBoxArray=h,m.Color=ji,m.DEMData=Mf,m.DataConstantProperty=Fn,m.DictionaryCoder=Ld,m.EXTENT=8192,m.ErrorEvent=He,m.EvaluationParameters=ki,m.Event=Pe,m.Evented=rt,m.FeatureIndex=Pf,m.FillBucket=ru,m.FillExtrusionBucket=sl,m.ImageAtlas=br,m.ImagePosition=st,m.LineBucket=ya,m.LngLat=pa,m.LngLatBounds=za,m.MercatorCoordinate=mi,m.ONE_EM=24,m.OverscaledTileID=ls,m.Point=fe,m.Point$1=fe,m.Properties=os,m.Protobuf=Jc,m.RGBAImage=ko,m.RequestManager=Gi,m.RequestPerformance=Tv,m.ResourceType=cn,m.SegmentVector=pe,m.SourceFeatureState=yp,m.StructArrayLayout1ui2=ol,m.StructArrayLayout2f1f2i16=bl,m.StructArrayLayout2i4=yl,m.StructArrayLayout3ui6=Js,m.StructArrayLayout4i8=hu,m.SymbolBucket=Fe,m.Texture=gn,m.Tile=Ps,m.Transitionable=So,m.Uniform1f=Br,m.Uniform1i=mr,m.Uniform2f=kr,m.Uniform3f=un,m.Uniform4f=Mn,m.UniformColor=Nn,m.UniformMatrix4f=Fi,m.UnwrappedTileID=Rd,m.ValidationError=ke,m.WritingMode=fr,m.ZoomHistory=Vc,m.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},m.addDynamicAttributes=Ve,m.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var p=t.length,y=new Array(t.length),b=null;t.forEach(function(S,I){o(S,function(D,N){D&&(b=D),y[I]=N,--p==0&&u(b,y)})})},m.bezier=et,m.bindAll=Vt,m.browser=fi,m.cacheEntryPossiblyAdded=function(t){++di>Ar&&(t.getActor().send("enforceCacheSizeLimit",nr),di=0)},m.clamp=yt,m.clearTileCache=function(t){var o=J.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},m.clipLine=wo,m.clone=function(t){var o=new ha(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},m.clone$1=Je,m.clone$2=function(t){var o=new ha(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},m.collisionCircleLayout=Qp,m.config=Gn,m.create=function(){var t=new ha(16);return ha!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},m.create$1=function(){var t=new ha(9);return ha!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},m.create$2=function(){var t=new ha(4);return ha!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},m.createCommonjsModule=de,m.createExpression=sc,m.createLayout=Oa,m.createStyleLayer=function(t){return t.type==="custom"?new Ur(t):new on[t.type](t)},m.cross=function(t,o,u){var p=o[0],y=o[1],b=o[2],S=u[0],I=u[1],D=u[2];return t[0]=y*D-b*I,t[1]=b*S-p*D,t[2]=p*I-y*S,t},m.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var p=0;p<o.length;p++)if(!t(o[p],u[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var y in o)if(!t(o[y],u[y]))return!1;return!0}return o===u},m.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},m.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},m.ease=Ze,m.emitValidationErrors=jc,m.endsWith=q,m.enforceCacheSizeLimit=function(t){en(),Qi&&Qi.then(function(o){o.keys().then(function(u){for(var p=0;p<u.length-t;p++)o.delete(u[p])})})},m.evaluateSizeForFeature=$n,m.evaluateSizeForZoom=ui,m.evaluateVariableOffset=wl,m.evented=Wc,m.extend=bt,m.featureFilter=Dl,m.filterObject=ft,m.fromRotation=function(t,o){var u=Math.sin(o),p=Math.cos(o);return t[0]=p,t[1]=u,t[2]=0,t[3]=-u,t[4]=p,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},m.getAnchorAlignment=Nr,m.getAnchorJustification=Te,m.getArrayBuffer=Va,m.getImage=Q,m.getJSON=function(t,o){return Yo(bt(t,{type:"json"}),o)},m.getRTLTextPluginStatus=mf,m.getReferrer=Ri,m.getVideo=function(t,o){var u,p,y=J.document.createElement("video");y.muted=!0,y.onloadstart=function(){o(null,y)};for(var b=0;b<t.length;b++){var S=J.document.createElement("source");u=t[b],p=void 0,(p=J.document.createElement("a")).href=u,(p.protocol!==J.document.location.protocol||p.host!==J.document.location.host)&&(y.crossOrigin="Anonymous"),S.src=t[b],y.appendChild(S)}return{cancel:function(){}}},m.identity=tu,m.invert=function(t,o){var u=o[0],p=o[1],y=o[2],b=o[3],S=o[4],I=o[5],D=o[6],N=o[7],V=o[8],W=o[9],ee=o[10],se=o[11],Me=o[12],Oe=o[13],qe=o[14],Ue=o[15],ut=u*I-p*S,Mt=u*D-y*S,Gt=u*N-b*S,Wt=p*D-y*I,lr=p*N-b*I,Or=y*N-b*D,Kr=V*Oe-W*Me,Un=V*qe-ee*Me,hn=V*Ue-se*Me,Vn=W*qe-ee*Oe,dn=W*Ue-se*Oe,Ii=ee*Ue-se*qe,Hn=ut*Ii-Mt*dn+Gt*Vn+Wt*hn-lr*Un+Or*Kr;return Hn?(t[0]=(I*Ii-D*dn+N*Vn)*(Hn=1/Hn),t[1]=(y*dn-p*Ii-b*Vn)*Hn,t[2]=(Oe*Or-qe*lr+Ue*Wt)*Hn,t[3]=(ee*lr-W*Or-se*Wt)*Hn,t[4]=(D*hn-S*Ii-N*Un)*Hn,t[5]=(u*Ii-y*hn+b*Un)*Hn,t[6]=(qe*Gt-Me*Or-Ue*Mt)*Hn,t[7]=(V*Or-ee*Gt+se*Mt)*Hn,t[8]=(S*dn-I*hn+N*Kr)*Hn,t[9]=(p*hn-u*dn-b*Kr)*Hn,t[10]=(Me*lr-Oe*Gt+Ue*ut)*Hn,t[11]=(W*Gt-V*lr-se*ut)*Hn,t[12]=(I*Un-S*Vn-D*Kr)*Hn,t[13]=(u*Vn-p*Un+y*Kr)*Hn,t[14]=(Oe*Mt-Me*Wt-qe*ut)*Hn,t[15]=(V*Wt-W*Mt+ee*ut)*Hn,t):null},m.isChar=Yr,m.isMapboxURL=Oi,m.keysDifference=function(t,o){var u=[];for(var p in t)p in o||u.push(p);return u},m.makeRequest=Yo,m.mapObject=$t,m.mercatorXfromLng=Pu,m.mercatorYfromLat=Iu,m.mercatorZfromAltitude=mp,m.mul=mc,m.multiply=Ts,m.mvt=Mu,m.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},m.normalize=function(t,o){var u=o[0],p=o[1],y=o[2],b=u*u+p*p+y*y;return b>0&&(b=1/Math.sqrt(b)),t[0]=o[0]*b,t[1]=o[1]*b,t[2]=o[2]*b,t},m.number=ba,m.offscreenCanvasSupported=Jn,m.ortho=function(t,o,u,p,y,b,S){var I=1/(o-u),D=1/(p-y),N=1/(b-S);return t[0]=-2*I,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*D,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*N,t[11]=0,t[12]=(o+u)*I,t[13]=(y+p)*D,t[14]=(S+b)*N,t[15]=1,t},m.parseGlyphPBF=function(t){return new Jc(t).readFields(Ir,[])},m.pbf=Jc,m.performSymbolLayout=function(t,o,u,p,y,b,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var I=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,N={};if(t.textSizeData.kind==="composite"){var V=t.textSizeData,W=V.maxZoom;N.compositeTextSizes=[D["text-size"].possiblyEvaluate(new ki(V.minZoom),S),D["text-size"].possiblyEvaluate(new ki(W),S)]}if(t.iconSizeData.kind==="composite"){var ee=t.iconSizeData,se=ee.maxZoom;N.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new ki(ee.minZoom),S),D["icon-size"].possiblyEvaluate(new ki(se),S)]}N.layoutTextSize=D["text-size"].possiblyEvaluate(new ki(t.zoom+1),S),N.layoutIconSize=D["icon-size"].possiblyEvaluate(new ki(t.zoom+1),S),N.textMaxSize=D["text-size"].possiblyEvaluate(new ki(18));for(var Me=24*I.get("text-line-height"),Oe=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",qe=I.get("text-keep-upright"),Ue=I.get("text-size"),ut=function(){var Wt=Gt[Mt],lr=I.get("text-font").evaluate(Wt,{},S).join(","),Or=Ue.evaluate(Wt,{},S),Kr=N.layoutTextSize.evaluate(Wt,{},S),Un=N.layoutIconSize.evaluate(Wt,{},S),hn={horizontal:{},vertical:void 0},Vn=Wt.text,dn=[0,0];if(Vn){var Ii=Vn.toString(),Hn=24*I.get("text-letter-spacing").evaluate(Wt,{},S),An=function(Ki){for(var Za=0,Ta=Ki;Za<Ta.length;Za+=1)if(ua=Ta[Za].charCodeAt(0),Yr.Arabic(ua)||Yr["Arabic Supplement"](ua)||Yr["Arabic Extended-A"](ua)||Yr["Arabic Presentation Forms-A"](ua)||Yr["Arabic Presentation Forms-B"](ua))return!1;var ua;return!0}(Ii)?Hn:0,Ui=I.get("text-anchor").evaluate(Wt,{},S),Si=I.get("text-variable-anchor");if(!Si){var ea=I.get("text-radial-offset").evaluate(Wt,{},S);dn=ea?wl(Ui,[24*ea,bo]):I.get("text-offset").evaluate(Wt,{},S).map(function(Ki){return 24*Ki})}var Zn=Oe?"center":I.get("text-justify").evaluate(Wt,{},S),da=I.get("symbol-placement"),lo=da==="point"?24*I.get("text-max-width").evaluate(Wt,{},S):0,To=function(){t.allowVerticalPlacement&&vf(Ii)&&(hn.vertical=$r(Vn,o,u,y,lr,lo,Me,Ui,"left",An,dn,fr.vertical,!0,da,Kr,Or))};if(!Oe&&Si){for(var Eo=Zn==="auto"?Si.map(function(Ki){return Te(Ki)}):[Zn],Ua=!1,ia=0;ia<Eo.length;ia++){var es=Eo[ia];if(!hn.horizontal[es])if(Ua)hn.horizontal[es]=hn.horizontal[0];else{var ts=$r(Vn,o,u,y,lr,lo,Me,"center",es,An,dn,fr.horizontal,!1,da,Kr,Or);ts&&(hn.horizontal[es]=ts,Ua=ts.positionedLines.length===1)}}To()}else{Zn==="auto"&&(Zn=Te(Ui));var Bs=$r(Vn,o,u,y,lr,lo,Me,Ui,Zn,An,dn,fr.horizontal,!1,da,Kr,Or);Bs&&(hn.horizontal[Zn]=Bs),To(),vf(Ii)&&Oe&&qe&&(hn.vertical=$r(Vn,o,u,y,lr,lo,Me,Ui,Zn,An,dn,fr.vertical,!1,da,Kr,Or))}}var rs=void 0,Ns=!1;if(Wt.icon&&Wt.icon.name){var No=p[Wt.icon.name];No&&(rs=function(Ki,Za,Ta){var ua=Nr(Ta),nu=Za[0]-Ki.displaySize[0]*ua.horizontalAlign,G=Za[1]-Ki.displaySize[1]*ua.verticalAlign;return{image:Ki,top:G,bottom:G+Ki.displaySize[1],left:nu,right:nu+Ki.displaySize[0]}}(y[Wt.icon.name],I.get("icon-offset").evaluate(Wt,{},S),I.get("icon-anchor").evaluate(Wt,{},S)),Ns=No.sdf,t.sdfIcons===void 0?t.sdfIcons=No.sdf:t.sdfIcons!==No.sdf&&Qe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(No.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var gs=At(hn.horizontal)||hn.vertical;t.iconsInText=!!gs&&gs.iconsInText,(gs||rs)&&function(Ki,Za,Ta,ua,nu,G,$a,zo,Is,va,Kl){var Ru=G.textMaxSize.evaluate(Za,{});Ru===void 0&&(Ru=$a);var $l,Qa=Ki.layers[0].layout,Ql=Qa.get("icon-offset").evaluate(Za,{},Kl),ll=At(Ta.horizontal),lh=$a/24,If=Ki.tilePixelRatio*lh,ch=Ki.tilePixelRatio*Ru/24,Sc=Ki.tilePixelRatio*zo,ef=Ki.tilePixelRatio*Qa.get("symbol-spacing"),ed=Qa.get("text-padding")*Ki.tilePixelRatio,Bh=Qa.get("icon-padding")*Ki.tilePixelRatio,Nh=Qa.get("text-max-angle")/180*Math.PI,_p=Qa.get("text-rotation-alignment")==="map"&&Qa.get("symbol-placement")!=="point",xp=Qa.get("icon-rotation-alignment")==="map"&&Qa.get("symbol-placement")!=="point",Cc=Qa.get("symbol-placement"),zh=ef/2,Ac=Qa.get("icon-text-fit");ua&&Ac!=="none"&&(Ki.allowVerticalPlacement&&Ta.vertical&&($l=ei(ua,Ta.vertical,Ac,Qa.get("icon-text-fit-padding"),Ql,lh)),ll&&(ua=ei(ua,ll,Ac,Qa.get("icon-text-fit-padding"),Ql,lh)));var tf=function(b0,Hh){Hh.x<0||Hh.x>=8192||Hh.y<0||Hh.y>=8192||function(Uo,Tl,Mv,rf,od,Bd,Cp,Jl,Ap,Wh,wp,Tp,sd,Nd,Xh,zd,Ud,Zd,Xs,jd,Lu,Mp,Vd,ec,Pv){var Gd,Lf,hh,ph,dh,vh=Uo.addToLineVertexArray(Tl,Mv),Hd=0,Wd=0,Xd=0,Iv=0,Yd=-1,qd=-1,nf={},Kd=we(""),$d=0,Qd=0;if(Jl._unevaluatedLayout.getValue("text-radial-offset")===void 0?($d=(Gd=Jl.layout.get("text-offset").evaluate(Lu,{},ec).map(function(Ip){return 24*Ip}))[0],Qd=Gd[1]):($d=24*Jl.layout.get("text-radial-offset").evaluate(Lu,{},ec),Qd=bo),Uo.allowVerticalPlacement&&rf.vertical){var Jd=Jl.layout.get("text-rotate").evaluate(Lu,{},ec)+90;ph=new Wo(Ap,Tl,Wh,wp,Tp,rf.vertical,sd,Nd,Xh,Jd),Cp&&(dh=new Wo(Ap,Tl,Wh,wp,Tp,Cp,Ud,Zd,Xh,Jd))}if(od){var ud=Jl.layout.get("icon-rotate").evaluate(Lu,{}),ev=Jl.layout.get("icon-text-fit")!=="none",tv=Qo(od,ud,Vd,ev),mh=Cp?Qo(Cp,ud,Vd,ev):void 0;hh=new Wo(Ap,Tl,Wh,wp,Tp,od,Ud,Zd,!1,ud),Hd=4*tv.length;var rv=Uo.iconSizeData,Pp=null;rv.kind==="source"?(Pp=[128*Jl.layout.get("icon-size").evaluate(Lu,{})])[0]>32640&&Qe(Uo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):rv.kind==="composite"&&((Pp=[128*Mp.compositeIconSizes[0].evaluate(Lu,{},ec),128*Mp.compositeIconSizes[1].evaluate(Lu,{},ec)])[0]>32640||Pp[1]>32640)&&Qe(Uo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Uo.addSymbols(Uo.icon,tv,Pp,jd,Xs,Lu,!1,Tl,vh.lineStartIndex,vh.lineLength,-1,ec),Yd=Uo.icon.placedSymbolArray.length-1,mh&&(Wd=4*mh.length,Uo.addSymbols(Uo.icon,mh,Pp,jd,Xs,Lu,fr.vertical,Tl,vh.lineStartIndex,vh.lineLength,-1,ec),qd=Uo.icon.placedSymbolArray.length-1)}for(var Ov in rf.horizontal){var ld=rf.horizontal[Ov];if(!Lf){Kd=we(ld.text);var E0=Jl.layout.get("text-rotate").evaluate(Lu,{},ec);Lf=new Wo(Ap,Tl,Wh,wp,Tp,ld,sd,Nd,Xh,E0)}var Rv=ld.positionedLines.length===1;if(Xd+=Ut(Uo,Tl,ld,Bd,Jl,Xh,Lu,zd,vh,rf.vertical?fr.horizontal:fr.horizontalOnly,Rv?Object.keys(rf.horizontal):[Ov],nf,Yd,Mp,ec),Rv)break}rf.vertical&&(Iv+=Ut(Uo,Tl,rf.vertical,Bd,Jl,Xh,Lu,zd,vh,fr.vertical,["vertical"],nf,qd,Mp,ec));var S0=Lf?Lf.boxStartIndex:Uo.collisionBoxArray.length,C0=Lf?Lf.boxEndIndex:Uo.collisionBoxArray.length,A0=ph?ph.boxStartIndex:Uo.collisionBoxArray.length,w0=ph?ph.boxEndIndex:Uo.collisionBoxArray.length,T0=hh?hh.boxStartIndex:Uo.collisionBoxArray.length,M0=hh?hh.boxEndIndex:Uo.collisionBoxArray.length,P0=dh?dh.boxStartIndex:Uo.collisionBoxArray.length,I0=dh?dh.boxEndIndex:Uo.collisionBoxArray.length,Mc=-1,cd=function(Ip,Op){return Ip&&Ip.circleDiameter?Math.max(Ip.circleDiameter,Op):Op};Mc=cd(Lf,Mc),Mc=cd(ph,Mc),Mc=cd(hh,Mc);var Lv=(Mc=cd(dh,Mc))>-1?1:0;Lv&&(Mc*=Pv/24),Uo.glyphOffsetArray.length>=Fe.MAX_GLYPHS&&Qe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Lu.sortKey!==void 0&&Uo.addToSortKeyRanges(Uo.symbolInstances.length,Lu.sortKey),Uo.symbolInstances.emplaceBack(Tl.x,Tl.y,nf.right>=0?nf.right:-1,nf.center>=0?nf.center:-1,nf.left>=0?nf.left:-1,nf.vertical||-1,Yd,qd,Kd,S0,C0,A0,w0,T0,M0,P0,I0,Wh,Xd,Iv,Hd,Wd,Lv,0,sd,$d,Qd,Mc)}(Ki,Hh,b0,Ta,ua,nu,$l,Ki.layers[0],Ki.collisionBoxArray,Za.index,Za.sourceLayerIndex,Ki.index,If,ed,_p,Is,Sc,Bh,xp,Ql,Za,G,va,Kl,$a)};if(Cc==="line")for(var fh=0,bp=wo(Za.geometry,0,0,8192,8192);fh<bp.length;fh+=1)for(var td=bp[fh],Ep=0,Uh=Ho(td,ef,Nh,Ta.vertical||ll,ua,24,ch,Ki.overscaling,8192);Ep<Uh.length;Ep+=1){var rd=Uh[Ep];ll&&mn(Ki,ll.text,zh,rd)||tf(td,rd)}else if(Cc==="line-center")for(var wc=0,Sp=Za.geometry;wc<Sp.length;wc+=1){var cl=Sp[wc];if(cl.length>1){var nd=Ka(cl,Nh,Ta.vertical||ll,ua,24,ch);nd&&tf(cl,nd)}}else if(Za.type==="Polygon")for(var Zh=0,id=Jf(Za.geometry,0);Zh<id.length;Zh+=1){var Tc=id[Zh],jh=ri(Tc,16);tf(Tc[0],new Wr(jh.x,jh.y,0))}else if(Za.type==="LineString")for(var Of=0,Vh=Za.geometry;Of<Vh.length;Of+=1){var Rf=Vh[Of];tf(Rf,new Wr(Rf[0].x,Rf[0].y,0))}else if(Za.type==="Point")for(var ad=0,Dd=Za.geometry;ad<Dd.length;ad+=1)for(var Gh=0,x0=Dd[ad];Gh<x0.length;Gh+=1){var Fd=x0[Gh];tf([Fd],new Wr(Fd.x,Fd.y,0))}}(t,Wt,hn,rs,p,N,Kr,Un,dn,Ns,S)},Mt=0,Gt=t.features;Mt<Gt.length;Mt+=1)ut();b&&t.generateCollisionDebugBuffers()},m.perspective=function(t,o,u,p,y){var b,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,y!=null&&y!==1/0?(t[10]=(y+p)*(b=1/(p-y)),t[14]=2*y*p*b):(t[10]=-1,t[14]=-2*p),t},m.pick=function(t,o){for(var u={},p=0;p<o.length;p++){var y=o[p];y in t&&(u[y]=t[y])}return u},m.plugin=js,m.polygonIntersectsPolygon=Wu,m.postMapLoadEvent=Nt,m.postTurnstileEvent=Xa,m.potpack=Tr,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=yn,m.registerForPluginStateChange=function(t){return t({pluginStatus:as,pluginURL:cu}),Wc.on("pluginStateChange",t),t},m.renderColorRamp=gc,m.rotate=function(t,o,u){var p=o[0],y=o[1],b=o[2],S=o[3],I=Math.sin(u),D=Math.cos(u);return t[0]=p*D+b*I,t[1]=y*D+S*I,t[2]=p*-I+b*D,t[3]=y*-I+S*D,t},m.rotateX=function(t,o,u){var p=Math.sin(u),y=Math.cos(u),b=o[4],S=o[5],I=o[6],D=o[7],N=o[8],V=o[9],W=o[10],ee=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=b*y+N*p,t[5]=S*y+V*p,t[6]=I*y+W*p,t[7]=D*y+ee*p,t[8]=N*y-b*p,t[9]=V*y-S*p,t[10]=W*y-I*p,t[11]=ee*y-D*p,t},m.rotateZ=function(t,o,u){var p=Math.sin(u),y=Math.cos(u),b=o[0],S=o[1],I=o[2],D=o[3],N=o[4],V=o[5],W=o[6],ee=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=b*y+N*p,t[1]=S*y+V*p,t[2]=I*y+W*p,t[3]=D*y+ee*p,t[4]=N*y-b*p,t[5]=V*y-S*p,t[6]=W*y-I*p,t[7]=ee*y-D*p,t},m.scale=function(t,o,u){var p=u[0],y=u[1],b=u[2];return t[0]=o[0]*p,t[1]=o[1]*p,t[2]=o[2]*p,t[3]=o[3]*p,t[4]=o[4]*y,t[5]=o[5]*y,t[6]=o[6]*y,t[7]=o[7]*y,t[8]=o[8]*b,t[9]=o[9]*b,t[10]=o[10]*b,t[11]=o[11]*b,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},m.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},m.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},m.setCacheLimits=function(t,o){nr=t,Ar=o},m.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),as==="deferred"||as==="loading"||as==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");cu=fi.resolveURL(t),as="deferred",Vu=o,Hc(),u||fu()},m.sphericalToCartesian=function(t){var o=t[0],u=t[1],p=t[2];return u+=90,u*=Math.PI/180,p*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(p),y:o*Math.sin(u)*Math.sin(p),z:o*Math.cos(p)}},m.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},m.styleSpec=he,m.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},m.symbolSize=Bi,m.transformMat3=function(t,o,u){var p=o[0],y=o[1],b=o[2];return t[0]=p*u[0]+y*u[3]+b*u[6],t[1]=p*u[1]+y*u[4]+b*u[7],t[2]=p*u[2]+y*u[5]+b*u[8],t},m.transformMat4=Fs,m.translate=function(t,o,u){var p,y,b,S,I,D,N,V,W,ee,se,Me,Oe=u[0],qe=u[1],Ue=u[2];return o===t?(t[12]=o[0]*Oe+o[4]*qe+o[8]*Ue+o[12],t[13]=o[1]*Oe+o[5]*qe+o[9]*Ue+o[13],t[14]=o[2]*Oe+o[6]*qe+o[10]*Ue+o[14],t[15]=o[3]*Oe+o[7]*qe+o[11]*Ue+o[15]):(y=o[1],b=o[2],S=o[3],I=o[4],D=o[5],N=o[6],V=o[7],W=o[8],ee=o[9],se=o[10],Me=o[11],t[0]=p=o[0],t[1]=y,t[2]=b,t[3]=S,t[4]=I,t[5]=D,t[6]=N,t[7]=V,t[8]=W,t[9]=ee,t[10]=se,t[11]=Me,t[12]=p*Oe+I*qe+W*Ue+o[12],t[13]=y*Oe+D*qe+ee*Ue+o[13],t[14]=b*Oe+N*qe+se*Ue+o[14],t[15]=S*Oe+V*qe+Me*Ue+o[15]),t},m.triggerPluginCompletionEvent=wh,m.uniqueId=Ct,m.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},m.validateLight=fc,m.validateStyle=Wa,m.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},m.vectorTile=Mu,m.version="1.13.2",m.warnOnce=Qe,m.webpSupported=ii,m.window=J,m.wrap=rr}),re(["./shared"],function(m){"use strict";function de(H){var Q=typeof H;if(Q==="number"||Q==="boolean"||Q==="string"||H==null)return JSON.stringify(H);if(Array.isArray(H)){for(var ae="[",ye=0,Pe=H;ye<Pe.length;ye+=1)ae+=de(Pe[ye])+",";return ae+"]"}for(var He=Object.keys(H).sort(),rt="{",he=0;he<He.length;he++)rt+=JSON.stringify(He[he])+":"+de(H[He[he]])+",";return rt+"}"}function Z(H){for(var Q="",ae=0,ye=m.refProperties;ae<ye.length;ae+=1)Q+="/"+de(H[ye[ae]]);return Q}var ce=function(H){this.keyCache={},H&&this.replace(H)};ce.prototype.replace=function(H){this._layerConfigs={},this._layers={},this.update(H,[])},ce.prototype.update=function(H,Q){for(var ae=this,ye=0,Pe=H;ye<Pe.length;ye+=1){var He=Pe[ye];this._layerConfigs[He.id]=He;var rt=this._layers[He.id]=m.createStyleLayer(He);rt._featureFilter=m.featureFilter(rt.filter),this.keyCache[He.id]&&delete this.keyCache[He.id]}for(var he=0,ke=Q;he<ke.length;he+=1){var vt=ke[he];delete this.keyCache[vt],delete this._layerConfigs[vt],delete this._layers[vt]}this.familiesBySource={};for(var dr=0,Ft=function(Zr,Hr){for(var gi={},rn=0;rn<Zr.length;rn++){var nn=Hr&&Hr[Zr[rn].id]||Z(Zr[rn]);Hr&&(Hr[Zr[rn].id]=nn);var Wi=gi[nn];Wi||(Wi=gi[nn]=[]),Wi.push(Zr[rn])}var vi=[];for(var Ti in gi)vi.push(gi[Ti]);return vi}(m.values(this._layerConfigs),this.keyCache);dr<Ft.length;dr+=1){var zt=Ft[dr].map(function(Zr){return ae._layers[Zr.id]}),vr=zt[0];if(vr.visibility!=="none"){var En=vr.source||"",pn=this.familiesBySource[En];pn||(pn=this.familiesBySource[En]={});var Ot=vr.sourceLayer||"_geojsonTileLayer",tn=pn[Ot];tn||(tn=pn[Ot]=[]),tn.push(zt)}}};var fe=function(H){var Q={},ae=[];for(var ye in H){var Pe=H[ye],He=Q[ye]={};for(var rt in Pe){var he=Pe[+rt];if(he&&he.bitmap.width!==0&&he.bitmap.height!==0){var ke={x:0,y:0,w:he.bitmap.width+2,h:he.bitmap.height+2};ae.push(ke),He[rt]={rect:ke,metrics:he.metrics}}}}var vt=m.potpack(ae),dr=new m.AlphaImage({width:vt.w||1,height:vt.h||1});for(var Ft in H){var zt=H[Ft];for(var vr in zt){var En=zt[+vr];if(En&&En.bitmap.width!==0&&En.bitmap.height!==0){var pn=Q[Ft][vr].rect;m.AlphaImage.copy(En.bitmap,dr,{x:0,y:0},{x:pn.x+1,y:pn.y+1},En.bitmap)}}}this.image=dr,this.positions=Q};m.register("GlyphAtlas",fe);var Le=function(H){this.tileID=new m.OverscaledTileID(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId};function J(H,Q,ae){for(var ye=new m.EvaluationParameters(Q),Pe=0,He=H;Pe<He.length;Pe+=1)He[Pe].recalculate(ye,ae)}function Xe(H,Q){var ae=m.getArrayBuffer(H.request,function(ye,Pe,He,rt){ye?Q(ye):Pe&&Q(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(Pe)),rawData:Pe,cacheControl:He,expires:rt})});return function(){ae.cancel(),Q()}}Le.prototype.parse=function(H,Q,ae,ye,Pe){var He=this;this.status="parsing",this.data=H,this.collisionBoxArray=new m.CollisionBoxArray;var rt=new m.DictionaryCoder(Object.keys(H.layers).sort()),he=new m.FeatureIndex(this.tileID,this.promoteId);he.bucketLayerIDs=[];var ke,vt,dr,Ft,zt={},vr={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ae},En=Q.familiesBySource[this.source];for(var pn in En){var Ot=H.layers[pn];if(Ot){Ot.version===1&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+pn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var tn=rt.encode(pn),Zr=[],Hr=0;Hr<Ot.length;Hr++){var gi=Ot.feature(Hr),rn=he.getId(gi,pn);Zr.push({feature:gi,id:rn,index:Hr,sourceLayerIndex:tn})}for(var nn=0,Wi=En[pn];nn<Wi.length;nn+=1){var vi=Wi[nn],Ti=vi[0];Ti.minzoom&&this.zoom<Math.floor(Ti.minzoom)||Ti.maxzoom&&this.zoom>=Ti.maxzoom||Ti.visibility!=="none"&&(J(vi,this.zoom,ae),(zt[Ti.id]=Ti.createBucket({index:he.bucketLayerIDs.length,layers:vi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:tn,sourceID:this.source})).populate(Zr,vr,this.tileID.canonical),he.bucketLayerIDs.push(vi.map(function(Ai){return Ai.id})))}}}var _i=m.mapObject(vr.glyphDependencies,function(Ai){return Object.keys(Ai).map(Number)});Object.keys(_i).length?ye.send("getGlyphs",{uid:this.uid,stacks:_i},function(Ai,Mi){ke||(ke=Ai,vt=Mi,Ma.call(He))}):vt={};var ht=Object.keys(vr.iconDependencies);ht.length?ye.send("getImages",{icons:ht,source:this.source,tileID:this.tileID,type:"icons"},function(Ai,Mi){ke||(ke=Ai,dr=Mi,Ma.call(He))}):dr={};var Pt=Object.keys(vr.patternDependencies);function Ma(){if(ke)return Pe(ke);if(vt&&dr&&Ft){var Ai=new fe(vt),Mi=new m.ImageAtlas(dr,Ft);for(var ji in zt){var Pr=zt[ji];Pr instanceof m.SymbolBucket?(J(Pr.layers,this.zoom,ae),m.performSymbolLayout(Pr,vt,Ai.positions,dr,Mi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Pr.hasPattern&&(Pr instanceof m.LineBucket||Pr instanceof m.FillBucket||Pr instanceof m.FillExtrusionBucket)&&(J(Pr.layers,this.zoom,ae),Pr.addFeatures(vr,this.tileID.canonical,Mi.patternPositions))}this.status="done",Pe(null,{buckets:m.values(zt).filter(function(an){return!an.isEmpty()}),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ai.image,imageAtlas:Mi,glyphMap:this.returnDependencies?vt:null,iconMap:this.returnDependencies?dr:null,glyphPositions:this.returnDependencies?Ai.positions:null})}}Pt.length?ye.send("getImages",{icons:Pt,source:this.source,tileID:this.tileID,type:"patterns"},function(Ai,Mi){ke||(ke=Ai,Ft=Mi,Ma.call(He))}):Ft={},Ma.call(this)};var et=function(H,Q,ae,ye){this.actor=H,this.layerIndex=Q,this.availableImages=ae,this.loadVectorData=ye||Xe,this.loading={},this.loaded={}};et.prototype.loadTile=function(H,Q){var ae=this,ye=H.uid;this.loading||(this.loading={});var Pe=!!(H&&H.request&&H.request.collectResourceTiming)&&new m.RequestPerformance(H.request),He=this.loading[ye]=new Le(H);He.abort=this.loadVectorData(H,function(rt,he){if(delete ae.loading[ye],rt||!he)return He.status="done",ae.loaded[ye]=He,Q(rt);var ke=he.rawData,vt={};he.expires&&(vt.expires=he.expires),he.cacheControl&&(vt.cacheControl=he.cacheControl);var dr={};if(Pe){var Ft=Pe.finish();Ft&&(dr.resourceTiming=JSON.parse(JSON.stringify(Ft)))}He.vectorTile=he.vectorTile,He.parse(he.vectorTile,ae.layerIndex,ae.availableImages,ae.actor,function(zt,vr){if(zt||!vr)return Q(zt);Q(null,m.extend({rawTileData:ke.slice(0)},vr,vt,dr))}),ae.loaded=ae.loaded||{},ae.loaded[ye]=He})},et.prototype.reloadTile=function(H,Q){var ae=this,ye=this.loaded,Pe=H.uid,He=this;if(ye&&ye[Pe]){var rt=ye[Pe];rt.showCollisionBoxes=H.showCollisionBoxes;var he=function(ke,vt){var dr=rt.reloadCallback;dr&&(delete rt.reloadCallback,rt.parse(rt.vectorTile,He.layerIndex,ae.availableImages,He.actor,dr)),Q(ke,vt)};rt.status==="parsing"?rt.reloadCallback=he:rt.status==="done"&&(rt.vectorTile?rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor,he):he())}},et.prototype.abortTile=function(H,Q){var ae=this.loading,ye=H.uid;ae&&ae[ye]&&ae[ye].abort&&(ae[ye].abort(),delete ae[ye]),Q()},et.prototype.removeTile=function(H,Q){var ae=this.loaded,ye=H.uid;ae&&ae[ye]&&delete ae[ye],Q()};var Ze=m.window.ImageBitmap,yt=function(){this.loaded={}};function rr(H,Q){if(H.length!==0){bt(H[0],Q);for(var ae=1;ae<H.length;ae++)bt(H[ae],!Q)}}function bt(H,Q){for(var ae=0,ye=0,Pe=H.length,He=Pe-1;ye<Pe;He=ye++)ae+=(H[ye][0]-H[He][0])*(H[He][1]+H[ye][1]);ae>=0!=!!Q&&H.reverse()}yt.prototype.loadTile=function(H,Q){var ae=H.uid,ye=H.encoding,Pe=H.rawImageData,He=Ze&&Pe instanceof Ze?this.getImageData(Pe):Pe,rt=new m.DEMData(ae,He,ye);this.loaded=this.loaded||{},this.loaded[ae]=rt,Q(null,rt)},yt.prototype.getImageData=function(H){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);var Q=this.offscreenCanvasContext.getImageData(-1,-1,H.width+2,H.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:Q.width,height:Q.height},Q.data)},yt.prototype.removeTile=function(H){var Q=this.loaded,ae=H.uid;Q&&Q[ae]&&delete Q[ae]};var Xt=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,Ct=function(H){this._feature=H,this.extent=m.EXTENT,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))};Ct.prototype.loadGeometry=function(){if(this._feature.type===1){for(var H=[],Q=0,ae=this._feature.geometry;Q<ae.length;Q+=1){var ye=ae[Q];H.push([new m.Point$1(ye[0],ye[1])])}return H}for(var Pe=[],He=0,rt=this._feature.geometry;He<rt.length;He+=1){for(var he=[],ke=0,vt=rt[He];ke<vt.length;ke+=1){var dr=vt[ke];he.push(new m.Point$1(dr[0],dr[1]))}Pe.push(he)}return Pe},Ct.prototype.toGeoJSON=function(H,Q,ae){return Xt.call(this,H,Q,ae)};var at=function(H){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=H.length,this._features=H};at.prototype.feature=function(H){return new Ct(this._features[H])};var it=m.vectorTile.VectorTileFeature,Vt=q;function q(H,Q){this.options=Q||{},this.features=H,this.length=H.length}function $t(H,Q){this.id=typeof H.id=="number"?H.id:void 0,this.type=H.type,this.rawGeometry=H.type===1?[H.geometry]:H.geometry,this.properties=H.tags,this.extent=Q||4096}q.prototype.feature=function(H){return new $t(this.features[H],this.options.extent)},$t.prototype.loadGeometry=function(){var H=this.rawGeometry;this.geometry=[];for(var Q=0;Q<H.length;Q++){for(var ae=H[Q],ye=[],Pe=0;Pe<ae.length;Pe++)ye.push(new m.Point$1(ae[Pe][0],ae[Pe][1]));this.geometry.push(ye)}return this.geometry},$t.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var H=this.geometry,Q=1/0,ae=-1/0,ye=1/0,Pe=-1/0,He=0;He<H.length;He++)for(var rt=H[He],he=0;he<rt.length;he++){var ke=rt[he];Q=Math.min(Q,ke.x),ae=Math.max(ae,ke.x),ye=Math.min(ye,ke.y),Pe=Math.max(Pe,ke.y)}return[Q,ye,ae,Pe]},$t.prototype.toGeoJSON=it.prototype.toGeoJSON;var ft=wt,Je=Vt;function wt(H){var Q=new m.pbf;return function(ae,ye){for(var Pe in ae.layers)ye.writeMessage(3,Qe,ae.layers[Pe])}(H,Q),Q.finish()}function Qe(H,Q){var ae;Q.writeVarintField(15,H.version||1),Q.writeStringField(1,H.name||""),Q.writeVarintField(5,H.extent||4096);var ye={keys:[],values:[],keycache:{},valuecache:{}};for(ae=0;ae<H.length;ae++)ye.feature=H.feature(ae),Q.writeMessage(2,Qt,ye);var Pe=ye.keys;for(ae=0;ae<Pe.length;ae++)Q.writeStringField(3,Pe[ae]);var He=ye.values;for(ae=0;ae<He.length;ae++)Q.writeMessage(4,Ce,He[ae])}function Qt(H,Q){var ae=H.feature;ae.id!==void 0&&Q.writeVarintField(1,ae.id),Q.writeMessage(2,Er,H),Q.writeVarintField(3,ae.type),Q.writeMessage(4,A,ae)}function Er(H,Q){var ae=H.feature,ye=H.keys,Pe=H.values,He=H.keycache,rt=H.valuecache;for(var he in ae.properties){var ke=He[he];ke===void 0&&(ye.push(he),He[he]=ke=ye.length-1),Q.writeVarint(ke);var vt=ae.properties[he],dr=typeof vt;dr!=="string"&&dr!=="boolean"&&dr!=="number"&&(vt=JSON.stringify(vt));var Ft=dr+":"+vt,zt=rt[Ft];zt===void 0&&(Pe.push(vt),rt[Ft]=zt=Pe.length-1),Q.writeVarint(zt)}}function Fr(H,Q){return(Q<<3)+(7&H)}function Jr(H){return H<<1^H>>31}function A(H,Q){for(var ae=H.loadGeometry(),ye=H.type,Pe=0,He=0,rt=ae.length,he=0;he<rt;he++){var ke=ae[he],vt=1;ye===1&&(vt=ke.length),Q.writeVarint(Fr(1,vt));for(var dr=ye===3?ke.length-1:ke.length,Ft=0;Ft<dr;Ft++){Ft===1&&ye!==1&&Q.writeVarint(Fr(2,dr-1));var zt=ke[Ft].x-Pe,vr=ke[Ft].y-He;Q.writeVarint(Jr(zt)),Q.writeVarint(Jr(vr)),Pe+=zt,He+=vr}ye===3&&Q.writeVarint(Fr(7,1))}}function Ce(H,Q){var ae=typeof H;ae==="string"?Q.writeStringField(1,H):ae==="boolean"?Q.writeBooleanField(7,H):ae==="number"&&(H%1!=0?Q.writeDoubleField(3,H):H<0?Q.writeSVarintField(6,H):Q.writeVarintField(5,H))}function De(H,Q,ae,ye){Tt(H,ae,ye),Tt(Q,2*ae,2*ye),Tt(Q,2*ae+1,2*ye+1)}function Tt(H,Q,ae){var ye=H[Q];H[Q]=H[ae],H[ae]=ye}function gt(H,Q,ae,ye){var Pe=H-ae,He=Q-ye;return Pe*Pe+He*He}ft.fromVectorTileJs=wt,ft.fromGeojsonVt=function(H,Q){Q=Q||{};var ae={};for(var ye in H)ae[ye]=new Vt(H[ye].features,Q),ae[ye].name=ye,ae[ye].version=Q.version,ae[ye].extent=Q.extent;return wt({layers:ae})},ft.GeoJSONWrapper=Je;var Bt=function(H){return H[0]},Kt=function(H){return H[1]},Cr=function(H,Q,ae,ye,Pe){Q===void 0&&(Q=Bt),ae===void 0&&(ae=Kt),ye===void 0&&(ye=64),Pe===void 0&&(Pe=Float64Array),this.nodeSize=ye,this.points=H;for(var He=H.length<65536?Uint16Array:Uint32Array,rt=this.ids=new He(H.length),he=this.coords=new Pe(2*H.length),ke=0;ke<H.length;ke++)rt[ke]=ke,he[2*ke]=Q(H[ke]),he[2*ke+1]=ae(H[ke]);(function vt(dr,Ft,zt,vr,En,pn){if(!(En-vr<=zt)){var Ot=vr+En>>1;(function tn(Zr,Hr,gi,rn,nn,Wi){for(;nn>rn;){if(nn-rn>600){var vi=nn-rn+1,Ti=gi-rn+1,_i=Math.log(vi),ht=.5*Math.exp(2*_i/3),Pt=.5*Math.sqrt(_i*ht*(vi-ht)/vi)*(Ti-vi/2<0?-1:1);tn(Zr,Hr,gi,Math.max(rn,Math.floor(gi-Ti*ht/vi+Pt)),Math.min(nn,Math.floor(gi+(vi-Ti)*ht/vi+Pt)),Wi)}var Ma=Hr[2*gi+Wi],Ai=rn,Mi=nn;for(De(Zr,Hr,rn,gi),Hr[2*nn+Wi]>Ma&&De(Zr,Hr,rn,nn);Ai<Mi;){for(De(Zr,Hr,Ai,Mi),Ai++,Mi--;Hr[2*Ai+Wi]<Ma;)Ai++;for(;Hr[2*Mi+Wi]>Ma;)Mi--}Hr[2*rn+Wi]===Ma?De(Zr,Hr,rn,Mi):De(Zr,Hr,++Mi,nn),Mi<=gi&&(rn=Mi+1),gi<=Mi&&(nn=Mi-1)}})(dr,Ft,Ot,vr,En,pn%2),vt(dr,Ft,zt,vr,Ot-1,pn+1),vt(dr,Ft,zt,Ot+1,En,pn+1)}})(rt,he,ye,0,rt.length-1,0)};Cr.prototype.range=function(H,Q,ae,ye){return function(Pe,He,rt,he,ke,vt,dr){for(var Ft,zt,vr=[0,Pe.length-1,0],En=[];vr.length;){var pn=vr.pop(),Ot=vr.pop(),tn=vr.pop();if(Ot-tn<=dr)for(var Zr=tn;Zr<=Ot;Zr++)zt=He[2*Zr+1],(Ft=He[2*Zr])>=rt&&Ft<=ke&&zt>=he&&zt<=vt&&En.push(Pe[Zr]);else{var Hr=Math.floor((tn+Ot)/2);zt=He[2*Hr+1],(Ft=He[2*Hr])>=rt&&Ft<=ke&&zt>=he&&zt<=vt&&En.push(Pe[Hr]);var gi=(pn+1)%2;(pn===0?rt<=Ft:he<=zt)&&(vr.push(tn),vr.push(Hr-1),vr.push(gi)),(pn===0?ke>=Ft:vt>=zt)&&(vr.push(Hr+1),vr.push(Ot),vr.push(gi))}}return En}(this.ids,this.coords,H,Q,ae,ye,this.nodeSize)},Cr.prototype.within=function(H,Q,ae){return function(ye,Pe,He,rt,he,ke){for(var vt=[0,ye.length-1,0],dr=[],Ft=he*he;vt.length;){var zt=vt.pop(),vr=vt.pop(),En=vt.pop();if(vr-En<=ke)for(var pn=En;pn<=vr;pn++)gt(Pe[2*pn],Pe[2*pn+1],He,rt)<=Ft&&dr.push(ye[pn]);else{var Ot=Math.floor((En+vr)/2),tn=Pe[2*Ot],Zr=Pe[2*Ot+1];gt(tn,Zr,He,rt)<=Ft&&dr.push(ye[Ot]);var Hr=(zt+1)%2;(zt===0?He-he<=tn:rt-he<=Zr)&&(vt.push(En),vt.push(Ot-1),vt.push(Hr)),(zt===0?He+he>=tn:rt+he>=Zr)&&(vt.push(Ot+1),vt.push(vr),vt.push(Hr))}}return dr}(this.ids,this.coords,H,Q,ae,this.nodeSize)};var Qn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(H){return H}},vn=function(H){this.options=la(Object.create(Qn),H),this.trees=new Array(this.options.maxZoom+1)};function fi(H,Q,ae,ye,Pe){return{x:H,y:Q,zoom:1/0,id:ae,parentId:-1,numPoints:ye,properties:Pe}}function Gn(H,Q){var ae=H.geometry.coordinates,ye=ae[1];return{x:Wn(ae[0]),y:pi(ye),zoom:1/0,index:Q,parentId:-1}}function ii(H){return{type:"Feature",id:H.id,properties:hi(H),geometry:{type:"Point",coordinates:[(ye=H.x,360*(ye-.5)),(Q=H.y,ae=(180-360*Q)*Math.PI/180,360*Math.atan(Math.exp(ae))/Math.PI-90)]}};var Q,ae,ye}function hi(H){var Q=H.numPoints,ae=Q>=1e4?Math.round(Q/1e3)+"k":Q>=1e3?Math.round(Q/100)/10+"k":Q;return la(la({},H.properties),{cluster:!0,cluster_id:H.id,point_count:Q,point_count_abbreviated:ae})}function Wn(H){return H/360+.5}function pi(H){var Q=Math.sin(H*Math.PI/180),ae=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ae<0?0:ae>1?1:ae}function la(H,Q){for(var ae in Q)H[ae]=Q[ae];return H}function Gi(H){return H.x}function Oi(H){return H.y}function $i(H,Q,ae,ye,Pe,He){var rt=Pe-ae,he=He-ye;if(rt!==0||he!==0){var ke=((H-ae)*rt+(Q-ye)*he)/(rt*rt+he*he);ke>1?(ae=Pe,ye=He):ke>0&&(ae+=rt*ke,ye+=he*ke)}return(rt=H-ae)*rt+(he=Q-ye)*he}function ca(H,Q,ae,ye){var Pe={id:H===void 0?null:H,type:Q,geometry:ae,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(He){var rt=He.geometry,he=He.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")wi(He,rt);else if(he==="Polygon"||he==="MultiLineString")for(var ke=0;ke<rt.length;ke++)wi(He,rt[ke]);else if(he==="MultiPolygon")for(ke=0;ke<rt.length;ke++)for(var vt=0;vt<rt[ke].length;vt++)wi(He,rt[ke][vt])}(Pe),Pe}function wi(H,Q){for(var ae=0;ae<Q.length;ae+=3)H.minX=Math.min(H.minX,Q[ae]),H.minY=Math.min(H.minY,Q[ae+1]),H.maxX=Math.max(H.maxX,Q[ae]),H.maxY=Math.max(H.maxY,Q[ae+1])}function xa(H,Q,ae,ye){if(Q.geometry){var Pe=Q.geometry.coordinates,He=Q.geometry.type,rt=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2),he=[],ke=Q.id;if(ae.promoteId?ke=Q.properties[ae.promoteId]:ae.generateId&&(ke=ye||0),He==="Point")qn(Pe,he);else if(He==="MultiPoint")for(var vt=0;vt<Pe.length;vt++)qn(Pe[vt],he);else if(He==="LineString")Ci(Pe,he,rt,!1);else if(He==="MultiLineString"){if(ae.lineMetrics){for(vt=0;vt<Pe.length;vt++)Ci(Pe[vt],he=[],rt,!1),H.push(ca(ke,"LineString",he,Q.properties));return}Zi(Pe,he,rt,!1)}else if(He==="Polygon")Zi(Pe,he,rt,!0);else{if(He!=="MultiPolygon"){if(He==="GeometryCollection"){for(vt=0;vt<Q.geometry.geometries.length;vt++)xa(H,{id:ke,geometry:Q.geometry.geometries[vt],properties:Q.properties},ae,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(vt=0;vt<Pe.length;vt++){var dr=[];Zi(Pe[vt],dr,rt,!0),he.push(dr)}}H.push(ca(ke,He,he,Q.properties))}}function qn(H,Q){Q.push(Qi(H[0])),Q.push(Zo(H[1])),Q.push(0)}function Ci(H,Q,ae,ye){for(var Pe,He,rt=0,he=0;he<H.length;he++){var ke=Qi(H[he][0]),vt=Zo(H[he][1]);Q.push(ke),Q.push(vt),Q.push(0),he>0&&(rt+=ye?(Pe*vt-ke*He)/2:Math.sqrt(Math.pow(ke-Pe,2)+Math.pow(vt-He,2))),Pe=ke,He=vt}var dr=Q.length-3;Q[2]=1,function Ft(zt,vr,En,pn){for(var Ot,tn=pn,Zr=En-vr>>1,Hr=En-vr,gi=zt[vr],rn=zt[vr+1],nn=zt[En],Wi=zt[En+1],vi=vr+3;vi<En;vi+=3){var Ti=$i(zt[vi],zt[vi+1],gi,rn,nn,Wi);if(Ti>tn)Ot=vi,tn=Ti;else if(Ti===tn){var _i=Math.abs(vi-Zr);_i<Hr&&(Ot=vi,Hr=_i)}}tn>pn&&(Ot-vr>3&&Ft(zt,vr,Ot,pn),zt[Ot+2]=tn,En-Ot>3&&Ft(zt,Ot,En,pn))}(Q,0,dr,ae),Q[dr+2]=1,Q.size=Math.abs(rt),Q.start=0,Q.end=Q.size}function Zi(H,Q,ae,ye){for(var Pe=0;Pe<H.length;Pe++){var He=[];Ci(H[Pe],He,ae,ye),Q.push(He)}}function Qi(H){return H/360+.5}function Zo(H){var Q=Math.sin(H*Math.PI/180),ae=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ae<0?0:ae>1?1:ae}function me(H,Q,ae,ye,Pe,He,rt,he){if(ye/=Q,He>=(ae/=Q)&&rt<ye)return H;if(rt<ae||He>=ye)return null;for(var ke=[],vt=0;vt<H.length;vt++){var dr=H[vt],Ft=dr.geometry,zt=dr.type,vr=Pe===0?dr.minX:dr.minY,En=Pe===0?dr.maxX:dr.maxY;if(vr>=ae&&En<ye)ke.push(dr);else if(!(En<ae||vr>=ye)){var pn=[];if(zt==="Point"||zt==="MultiPoint")Dn(Ft,pn,ae,ye,Pe);else if(zt==="LineString")Xa(Ft,pn,ae,ye,Pe,!1,he.lineMetrics);else if(zt==="MultiLineString")Nt(Ft,pn,ae,ye,Pe,!1);else if(zt==="Polygon")Nt(Ft,pn,ae,ye,Pe,!0);else if(zt==="MultiPolygon")for(var Ot=0;Ot<Ft.length;Ot++){var tn=[];Nt(Ft[Ot],tn,ae,ye,Pe,!0),tn.length&&pn.push(tn)}if(pn.length){if(he.lineMetrics&&zt==="LineString"){for(Ot=0;Ot<pn.length;Ot++)ke.push(ca(dr.id,zt,pn[Ot],dr.tags));continue}zt!=="LineString"&&zt!=="MultiLineString"||(pn.length===1?(zt="LineString",pn=pn[0]):zt="MultiLineString"),zt!=="Point"&&zt!=="MultiPoint"||(zt=pn.length===3?"Point":"MultiPoint"),ke.push(ca(dr.id,zt,pn,dr.tags))}}}return ke.length?ke:null}function Dn(H,Q,ae,ye,Pe){for(var He=0;He<H.length;He+=3){var rt=H[He+Pe];rt>=ae&&rt<=ye&&(Q.push(H[He]),Q.push(H[He+1]),Q.push(H[He+2]))}}function Xa(H,Q,ae,ye,Pe,He,rt){for(var he,ke,vt=cs(H),dr=Pe===0?Ar:en,Ft=H.start,zt=0;zt<H.length-3;zt+=3){var vr=H[zt],En=H[zt+1],pn=H[zt+2],Ot=H[zt+3],tn=H[zt+4],Zr=Pe===0?vr:En,Hr=Pe===0?Ot:tn,gi=!1;rt&&(he=Math.sqrt(Math.pow(vr-Ot,2)+Math.pow(En-tn,2))),Zr<ae?Hr>ae&&(ke=dr(vt,vr,En,Ot,tn,ae),rt&&(vt.start=Ft+he*ke)):Zr>ye?Hr<ye&&(ke=dr(vt,vr,En,Ot,tn,ye),rt&&(vt.start=Ft+he*ke)):nr(vt,vr,En,pn),Hr<ae&&Zr>=ae&&(ke=dr(vt,vr,En,Ot,tn,ae),gi=!0),Hr>ye&&Zr<=ye&&(ke=dr(vt,vr,En,Ot,tn,ye),gi=!0),!He&&gi&&(rt&&(vt.end=Ft+he*ke),Q.push(vt),vt=cs(H)),rt&&(Ft+=he)}var rn=H.length-3;vr=H[rn],En=H[rn+1],pn=H[rn+2],(Zr=Pe===0?vr:En)>=ae&&Zr<=ye&&nr(vt,vr,En,pn),rn=vt.length-3,He&&rn>=3&&(vt[rn]!==vt[0]||vt[rn+1]!==vt[1])&&nr(vt,vt[0],vt[1],vt[2]),vt.length&&Q.push(vt)}function cs(H){var Q=[];return Q.size=H.size,Q.start=H.start,Q.end=H.end,Q}function Nt(H,Q,ae,ye,Pe,He){for(var rt=0;rt<H.length;rt++)Xa(H[rt],Q,ae,ye,Pe,He,!1)}function nr(H,Q,ae,ye){H.push(Q),H.push(ae),H.push(ye)}function Ar(H,Q,ae,ye,Pe,He){var rt=(He-Q)/(ye-Q);return H.push(He),H.push(ae+(Pe-ae)*rt),H.push(1),rt}function en(H,Q,ae,ye,Pe,He){var rt=(He-ae)/(Pe-ae);return H.push(Q+(ye-Q)*rt),H.push(He),H.push(1),rt}function wn(H,Q){for(var ae=[],ye=0;ye<H.length;ye++){var Pe,He=H[ye],rt=He.type;if(rt==="Point"||rt==="MultiPoint"||rt==="LineString")Pe=Bn(He.geometry,Q);else if(rt==="MultiLineString"||rt==="Polygon"){Pe=[];for(var he=0;he<He.geometry.length;he++)Pe.push(Bn(He.geometry[he],Q))}else if(rt==="MultiPolygon")for(Pe=[],he=0;he<He.geometry.length;he++){for(var ke=[],vt=0;vt<He.geometry[he].length;vt++)ke.push(Bn(He.geometry[he][vt],Q));Pe.push(ke)}ae.push(ca(He.id,rt,Pe,He.tags))}return ae}function Bn(H,Q){var ae=[];ae.size=H.size,H.start!==void 0&&(ae.start=H.start,ae.end=H.end);for(var ye=0;ye<H.length;ye+=3)ae.push(H[ye]+Q,H[ye+1],H[ye+2]);return ae}function di(H,Q){if(H.transformed)return H;var ae,ye,Pe,He=1<<H.z,rt=H.x,he=H.y;for(ae=0;ae<H.features.length;ae++){var ke=H.features[ae],vt=ke.geometry,dr=ke.type;if(ke.geometry=[],dr===1)for(ye=0;ye<vt.length;ye+=2)ke.geometry.push(Jn(vt[ye],vt[ye+1],Q,He,rt,he));else for(ye=0;ye<vt.length;ye++){var Ft=[];for(Pe=0;Pe<vt[ye].length;Pe+=2)Ft.push(Jn(vt[ye][Pe],vt[ye][Pe+1],Q,He,rt,he));ke.geometry.push(Ft)}}return H.transformed=!0,H}function Jn(H,Q,ae,ye,Pe,He){return[Math.round(ae*(H*ye-Pe)),Math.round(ae*(Q*ye-He))]}function cn(H,Q,ae,ye,Pe){for(var He=Q===Pe.maxZoom?0:Pe.tolerance/((1<<Q)*Pe.extent),rt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ae,y:ye,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},he=0;he<H.length;he++){rt.numFeatures++,Li(rt,H[he],He,Pe);var ke=H[he].minX,vt=H[he].minY,dr=H[he].maxX,Ft=H[he].maxY;ke<rt.minX&&(rt.minX=ke),vt<rt.minY&&(rt.minY=vt),dr>rt.maxX&&(rt.maxX=dr),Ft>rt.maxY&&(rt.maxY=Ft)}return rt}function Li(H,Q,ae,ye){var Pe=Q.geometry,He=Q.type,rt=[];if(He==="Point"||He==="MultiPoint")for(var he=0;he<Pe.length;he+=3)rt.push(Pe[he]),rt.push(Pe[he+1]),H.numPoints++,H.numSimplified++;else if(He==="LineString")Ri(rt,Pe,H,ae,!1,!1);else if(He==="MultiLineString"||He==="Polygon")for(he=0;he<Pe.length;he++)Ri(rt,Pe[he],H,ae,He==="Polygon",he===0);else if(He==="MultiPolygon")for(var ke=0;ke<Pe.length;ke++){var vt=Pe[ke];for(he=0;he<vt.length;he++)Ri(rt,vt[he],H,ae,!0,he===0)}if(rt.length){var dr=Q.tags||null;if(He==="LineString"&&ye.lineMetrics){for(var Ft in dr={},Q.tags)dr[Ft]=Q.tags[Ft];dr.mapbox_clip_start=Pe.start/Pe.size,dr.mapbox_clip_end=Pe.end/Pe.size}var zt={geometry:rt,type:He==="Polygon"||He==="MultiPolygon"?3:He==="LineString"||He==="MultiLineString"?2:1,tags:dr};Q.id!==null&&(zt.id=Q.id),H.features.push(zt)}}function Ri(H,Q,ae,ye,Pe,He){var rt=ye*ye;if(ye>0&&Q.size<(Pe?rt:ye))ae.numPoints+=Q.length/3;else{for(var he=[],ke=0;ke<Q.length;ke+=3)(ye===0||Q[ke+2]>rt)&&(ae.numSimplified++,he.push(Q[ke]),he.push(Q[ke+1])),ae.numPoints++;Pe&&function(vt,dr){for(var Ft=0,zt=0,vr=vt.length,En=vr-2;zt<vr;En=zt,zt+=2)Ft+=(vt[zt]-vt[En])*(vt[zt+1]+vt[En+1]);if(Ft>0===dr)for(zt=0,vr=vt.length;zt<vr/2;zt+=2){var pn=vt[zt],Ot=vt[zt+1];vt[zt]=vt[vr-2-zt],vt[zt+1]=vt[vr-1-zt],vt[vr-2-zt]=pn,vt[vr-1-zt]=Ot}}(he,He),H.push(he)}}function oo(H,Q){var ae=(Q=this.options=function(Pe,He){for(var rt in He)Pe[rt]=He[rt];return Pe}(Object.create(this.options),Q)).debug;if(ae&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");var ye=function(Pe,He){var rt=[];if(Pe.type==="FeatureCollection")for(var he=0;he<Pe.features.length;he++)xa(rt,Pe.features[he],He,he);else xa(rt,Pe.type==="Feature"?Pe:{geometry:Pe},He);return rt}(H,Q);this.tiles={},this.tileCoords=[],ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ye=function(Pe,He){var rt=He.buffer/He.extent,he=Pe,ke=me(Pe,1,-1-rt,rt,0,-1,2,He),vt=me(Pe,1,1-rt,2+rt,0,-1,2,He);return(ke||vt)&&(he=me(Pe,1,-rt,1+rt,0,-1,2,He)||[],ke&&(he=wn(ke,1).concat(he)),vt&&(he=he.concat(wn(vt,-1)))),he}(ye,Q)).length&&this.splitTile(ye,0,0,0),ae&&(ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ys(H,Q,ae){return 32*((1<<H)*ae+Q)+H}function Yo(H,Q){var ae=H.tileID.canonical;if(!this._geoJSONIndex)return Q(null,null);var ye=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!ye)return Q(null,null);var Pe=new at(ye.features),He=ft(Pe);He.byteOffset===0&&He.byteLength===He.buffer.byteLength||(He=new Uint8Array(He)),Q(null,{vectorTile:Pe,rawData:He.buffer})}vn.prototype.load=function(H){var Q=this.options,ae=Q.log,ye=Q.minZoom,Pe=Q.maxZoom,He=Q.nodeSize;ae&&console.time("total time");var rt="prepare "+H.length+" points";ae&&console.time(rt),this.points=H;for(var he=[],ke=0;ke<H.length;ke++)H[ke].geometry&&he.push(Gn(H[ke],ke));this.trees[Pe+1]=new Cr(he,Gi,Oi,He,Float32Array),ae&&console.timeEnd(rt);for(var vt=Pe;vt>=ye;vt--){var dr=+Date.now();he=this._cluster(he,vt),this.trees[vt]=new Cr(he,Gi,Oi,He,Float32Array),ae&&console.log("z%d: %d clusters in %dms",vt,he.length,+Date.now()-dr)}return ae&&console.timeEnd("total time"),this},vn.prototype.getClusters=function(H,Q){var ae=((H[0]+180)%360+360)%360-180,ye=Math.max(-90,Math.min(90,H[1])),Pe=H[2]===180?180:((H[2]+180)%360+360)%360-180,He=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)ae=-180,Pe=180;else if(ae>Pe){var rt=this.getClusters([ae,ye,180,He],Q),he=this.getClusters([-180,ye,Pe,He],Q);return rt.concat(he)}for(var ke=this.trees[this._limitZoom(Q)],vt=[],dr=0,Ft=ke.range(Wn(ae),pi(He),Wn(Pe),pi(ye));dr<Ft.length;dr+=1){var zt=ke.points[Ft[dr]];vt.push(zt.numPoints?ii(zt):this.points[zt.index])}return vt},vn.prototype.getChildren=function(H){var Q=this._getOriginId(H),ae=this._getOriginZoom(H),ye="No cluster with the specified id.",Pe=this.trees[ae];if(!Pe)throw new Error(ye);var He=Pe.points[Q];if(!He)throw new Error(ye);for(var rt=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),he=[],ke=0,vt=Pe.within(He.x,He.y,rt);ke<vt.length;ke+=1){var dr=Pe.points[vt[ke]];dr.parentId===H&&he.push(dr.numPoints?ii(dr):this.points[dr.index])}if(he.length===0)throw new Error(ye);return he},vn.prototype.getLeaves=function(H,Q,ae){var ye=[];return this._appendLeaves(ye,H,Q=Q||10,ae=ae||0,0),ye},vn.prototype.getTile=function(H,Q,ae){var ye=this.trees[this._limitZoom(H)],Pe=Math.pow(2,H),He=this.options,rt=He.radius/He.extent,he=(ae-rt)/Pe,ke=(ae+1+rt)/Pe,vt={features:[]};return this._addTileFeatures(ye.range((Q-rt)/Pe,he,(Q+1+rt)/Pe,ke),ye.points,Q,ae,Pe,vt),Q===0&&this._addTileFeatures(ye.range(1-rt/Pe,he,1,ke),ye.points,Pe,ae,Pe,vt),Q===Pe-1&&this._addTileFeatures(ye.range(0,he,rt/Pe,ke),ye.points,-1,ae,Pe,vt),vt.features.length?vt:null},vn.prototype.getClusterExpansionZoom=function(H){for(var Q=this._getOriginZoom(H)-1;Q<=this.options.maxZoom;){var ae=this.getChildren(H);if(Q++,ae.length!==1)break;H=ae[0].properties.cluster_id}return Q},vn.prototype._appendLeaves=function(H,Q,ae,ye,Pe){for(var He=0,rt=this.getChildren(Q);He<rt.length;He+=1){var he=rt[He],ke=he.properties;if(ke&&ke.cluster?Pe+ke.point_count<=ye?Pe+=ke.point_count:Pe=this._appendLeaves(H,ke.cluster_id,ae,ye,Pe):Pe<ye?Pe++:H.push(he),H.length===ae)break}return Pe},vn.prototype._addTileFeatures=function(H,Q,ae,ye,Pe,He){for(var rt=0,he=H;rt<he.length;rt+=1){var ke=Q[he[rt]],vt=ke.numPoints,dr={type:1,geometry:[[Math.round(this.options.extent*(ke.x*Pe-ae)),Math.round(this.options.extent*(ke.y*Pe-ye))]],tags:vt?hi(ke):this.points[ke.index].properties},Ft=void 0;vt?Ft=ke.id:this.options.generateId?Ft=ke.index:this.points[ke.index].id&&(Ft=this.points[ke.index].id),Ft!==void 0&&(dr.id=Ft),He.features.push(dr)}},vn.prototype._limitZoom=function(H){return Math.max(this.options.minZoom,Math.min(+H,this.options.maxZoom+1))},vn.prototype._cluster=function(H,Q){for(var ae=[],ye=this.options,Pe=ye.reduce,He=ye.minPoints,rt=ye.radius/(ye.extent*Math.pow(2,Q)),he=0;he<H.length;he++){var ke=H[he];if(!(ke.zoom<=Q)){ke.zoom=Q;for(var vt=this.trees[Q+1],dr=vt.within(ke.x,ke.y,rt),Ft=ke.numPoints||1,zt=Ft,vr=0,En=dr;vr<En.length;vr+=1){var pn=vt.points[En[vr]];pn.zoom>Q&&(zt+=pn.numPoints||1)}if(zt>=He){for(var Ot=ke.x*Ft,tn=ke.y*Ft,Zr=Pe&&Ft>1?this._map(ke,!0):null,Hr=(he<<5)+(Q+1)+this.points.length,gi=0,rn=dr;gi<rn.length;gi+=1){var nn=vt.points[rn[gi]];if(!(nn.zoom<=Q)){nn.zoom=Q;var Wi=nn.numPoints||1;Ot+=nn.x*Wi,tn+=nn.y*Wi,nn.parentId=Hr,Pe&&(Zr||(Zr=this._map(ke,!0)),Pe(Zr,this._map(nn)))}}ke.parentId=Hr,ae.push(fi(Ot/zt,tn/zt,Hr,zt,Zr))}else if(ae.push(ke),zt>1)for(var vi=0,Ti=dr;vi<Ti.length;vi+=1){var _i=vt.points[Ti[vi]];_i.zoom<=Q||(_i.zoom=Q,ae.push(_i))}}}return ae},vn.prototype._getOriginId=function(H){return H-this.points.length>>5},vn.prototype._getOriginZoom=function(H){return(H-this.points.length)%32},vn.prototype._map=function(H,Q){if(H.numPoints)return Q?la({},H.properties):H.properties;var ae=this.points[H.index].properties,ye=this.options.map(ae);return Q&&ye===ae?la({},ye):ye},oo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},oo.prototype.splitTile=function(H,Q,ae,ye,Pe,He,rt){for(var he=[H,Q,ae,ye],ke=this.options,vt=ke.debug;he.length;){ye=he.pop(),ae=he.pop(),Q=he.pop(),H=he.pop();var dr=1<<Q,Ft=ys(Q,ae,ye),zt=this.tiles[Ft];if(!zt&&(vt>1&&console.time("creation"),zt=this.tiles[Ft]=cn(H,Q,ae,ye,ke),this.tileCoords.push({z:Q,x:ae,y:ye}),vt)){vt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,ae,ye,zt.numFeatures,zt.numPoints,zt.numSimplified),console.timeEnd("creation"));var vr="z"+Q;this.stats[vr]=(this.stats[vr]||0)+1,this.total++}if(zt.source=H,Pe){if(Q===ke.maxZoom||Q===Pe)continue;var En=1<<Pe-Q;if(ae!==Math.floor(He/En)||ye!==Math.floor(rt/En))continue}else if(Q===ke.indexMaxZoom||zt.numPoints<=ke.indexMaxPoints)continue;if(zt.source=null,H.length!==0){vt>1&&console.time("clipping");var pn,Ot,tn,Zr,Hr,gi,rn=.5*ke.buffer/ke.extent,nn=.5-rn,Wi=.5+rn,vi=1+rn;pn=Ot=tn=Zr=null,Hr=me(H,dr,ae-rn,ae+Wi,0,zt.minX,zt.maxX,ke),gi=me(H,dr,ae+nn,ae+vi,0,zt.minX,zt.maxX,ke),H=null,Hr&&(pn=me(Hr,dr,ye-rn,ye+Wi,1,zt.minY,zt.maxY,ke),Ot=me(Hr,dr,ye+nn,ye+vi,1,zt.minY,zt.maxY,ke),Hr=null),gi&&(tn=me(gi,dr,ye-rn,ye+Wi,1,zt.minY,zt.maxY,ke),Zr=me(gi,dr,ye+nn,ye+vi,1,zt.minY,zt.maxY,ke),gi=null),vt>1&&console.timeEnd("clipping"),he.push(pn||[],Q+1,2*ae,2*ye),he.push(Ot||[],Q+1,2*ae,2*ye+1),he.push(tn||[],Q+1,2*ae+1,2*ye),he.push(Zr||[],Q+1,2*ae+1,2*ye+1)}}},oo.prototype.getTile=function(H,Q,ae){var ye=this.options,Pe=ye.extent,He=ye.debug;if(H<0||H>24)return null;var rt=1<<H,he=ys(H,Q=(Q%rt+rt)%rt,ae);if(this.tiles[he])return di(this.tiles[he],Pe);He>1&&console.log("drilling down to z%d-%d-%d",H,Q,ae);for(var ke,vt=H,dr=Q,Ft=ae;!ke&&vt>0;)vt--,dr=Math.floor(dr/2),Ft=Math.floor(Ft/2),ke=this.tiles[ys(vt,dr,Ft)];return ke&&ke.source?(He>1&&console.log("found parent tile z%d-%d-%d",vt,dr,Ft),He>1&&console.time("drilling down"),this.splitTile(ke.source,vt,dr,Ft,H,Q,ae),He>1&&console.timeEnd("drilling down"),this.tiles[he]?di(this.tiles[he],Pe):null):null};var Va=function(H){function Q(ae,ye,Pe,He){H.call(this,ae,ye,Pe,Yo),He&&(this.loadGeoJSON=He)}return H&&(Q.__proto__=H),(Q.prototype=Object.create(H&&H.prototype)).constructor=Q,Q.prototype.loadData=function(ae,ye){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ye,this._pendingLoadDataParams=ae,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},Q.prototype._loadData=function(){var ae=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ye=this._pendingCallback,Pe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var He=!!(Pe&&Pe.request&&Pe.request.collectResourceTiming)&&new m.RequestPerformance(Pe.request);this.loadGeoJSON(Pe,function(rt,he){if(rt||!he)return ye(rt);if(typeof he!="object")return ye(new Error("Input data given to '"+Pe.source+"' is not a valid GeoJSON object."));(function zt(vr,En){var pn,Ot=vr&&vr.type;if(Ot==="FeatureCollection")for(pn=0;pn<vr.features.length;pn++)zt(vr.features[pn],En);else if(Ot==="GeometryCollection")for(pn=0;pn<vr.geometries.length;pn++)zt(vr.geometries[pn],En);else if(Ot==="Feature")zt(vr.geometry,En);else if(Ot==="Polygon")rr(vr.coordinates,En);else if(Ot==="MultiPolygon")for(pn=0;pn<vr.coordinates.length;pn++)rr(vr.coordinates[pn],En);return vr})(he,!0);try{if(Pe.filter){var ke=m.createExpression(Pe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ke.result==="error")throw new Error(ke.value.map(function(zt){return zt.key+": "+zt.message}).join(", "));var vt=he.features.filter(function(zt){return ke.value.evaluate({zoom:0},zt)});he={type:"FeatureCollection",features:vt}}ae._geoJSONIndex=Pe.cluster?new vn(function(zt){var vr=zt.superclusterOptions,En=zt.clusterProperties;if(!En||!vr)return vr;for(var pn={},Ot={},tn={accumulated:null,zoom:0},Zr={properties:null},Hr=Object.keys(En),gi=0,rn=Hr;gi<rn.length;gi+=1){var nn=rn[gi],Wi=En[nn],vi=Wi[0],Ti=m.createExpression(Wi[1]),_i=m.createExpression(typeof vi=="string"?[vi,["accumulated"],["get",nn]]:vi);pn[nn]=Ti.value,Ot[nn]=_i.value}return vr.map=function(ht){Zr.properties=ht;for(var Pt={},Ma=0,Ai=Hr;Ma<Ai.length;Ma+=1){var Mi=Ai[Ma];Pt[Mi]=pn[Mi].evaluate(tn,Zr)}return Pt},vr.reduce=function(ht,Pt){Zr.properties=Pt;for(var Ma=0,Ai=Hr;Ma<Ai.length;Ma+=1){var Mi=Ai[Ma];tn.accumulated=ht[Mi],ht[Mi]=Ot[Mi].evaluate(tn,Zr)}},vr}(Pe)).load(he.features):function(zt,vr){return new oo(zt,vr)}(he,Pe.geojsonVtOptions)}catch(zt){return ye(zt)}ae.loaded={};var dr={};if(He){var Ft=He.finish();Ft&&(dr.resourceTiming={},dr.resourceTiming[Pe.source]=JSON.parse(JSON.stringify(Ft)))}ye(null,dr)})}},Q.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},Q.prototype.reloadTile=function(ae,ye){var Pe=this.loaded;return Pe&&Pe[ae.uid]?H.prototype.reloadTile.call(this,ae,ye):this.loadTile(ae,ye)},Q.prototype.loadGeoJSON=function(ae,ye){if(ae.request)m.getJSON(ae.request,ye);else{if(typeof ae.data!="string")return ye(new Error("Input data given to '"+ae.source+"' is not a valid GeoJSON object."));try{return ye(null,JSON.parse(ae.data))}catch(Pe){return ye(new Error("Input data given to '"+ae.source+"' is not a valid GeoJSON object."))}}},Q.prototype.removeSource=function(ae,ye){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ye()},Q.prototype.getClusterExpansionZoom=function(ae,ye){try{ye(null,this._geoJSONIndex.getClusterExpansionZoom(ae.clusterId))}catch(Pe){ye(Pe)}},Q.prototype.getClusterChildren=function(ae,ye){try{ye(null,this._geoJSONIndex.getChildren(ae.clusterId))}catch(Pe){ye(Pe)}},Q.prototype.getClusterLeaves=function(ae,ye){try{ye(null,this._geoJSONIndex.getLeaves(ae.clusterId,ae.limit,ae.offset))}catch(Pe){ye(Pe)}},Q}(et),Aa=function(H){var Q=this;this.self=H,this.actor=new m.Actor(H,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:et,geojson:Va},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ae,ye){if(Q.workerSourceTypes[ae])throw new Error('Worker source with name "'+ae+'" already registered.');Q.workerSourceTypes[ae]=ye},this.self.registerRTLTextPlugin=function(ae){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=ae.applyArabicShaping,m.plugin.processBidirectionalText=ae.processBidirectionalText,m.plugin.processStyledBidirectionalText=ae.processStyledBidirectionalText}};return Aa.prototype.setReferrer=function(H,Q){this.referrer=Q},Aa.prototype.setImages=function(H,Q,ae){for(var ye in this.availableImages[H]=Q,this.workerSources[H]){var Pe=this.workerSources[H][ye];for(var He in Pe)Pe[He].availableImages=Q}ae()},Aa.prototype.setLayers=function(H,Q,ae){this.getLayerIndex(H).replace(Q),ae()},Aa.prototype.updateLayers=function(H,Q,ae){this.getLayerIndex(H).update(Q.layers,Q.removedIds),ae()},Aa.prototype.loadTile=function(H,Q,ae){this.getWorkerSource(H,Q.type,Q.source).loadTile(Q,ae)},Aa.prototype.loadDEMTile=function(H,Q,ae){this.getDEMWorkerSource(H,Q.source).loadTile(Q,ae)},Aa.prototype.reloadTile=function(H,Q,ae){this.getWorkerSource(H,Q.type,Q.source).reloadTile(Q,ae)},Aa.prototype.abortTile=function(H,Q,ae){this.getWorkerSource(H,Q.type,Q.source).abortTile(Q,ae)},Aa.prototype.removeTile=function(H,Q,ae){this.getWorkerSource(H,Q.type,Q.source).removeTile(Q,ae)},Aa.prototype.removeDEMTile=function(H,Q){this.getDEMWorkerSource(H,Q.source).removeTile(Q)},Aa.prototype.removeSource=function(H,Q,ae){if(this.workerSources[H]&&this.workerSources[H][Q.type]&&this.workerSources[H][Q.type][Q.source]){var ye=this.workerSources[H][Q.type][Q.source];delete this.workerSources[H][Q.type][Q.source],ye.removeSource!==void 0?ye.removeSource(Q,ae):ae()}},Aa.prototype.loadWorkerSource=function(H,Q,ae){try{this.self.importScripts(Q.url),ae()}catch(ye){ae(ye.toString())}},Aa.prototype.syncRTLPluginState=function(H,Q,ae){try{m.plugin.setState(Q);var ye=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&ye!=null){this.self.importScripts(ye);var Pe=m.plugin.isParsed();ae(Pe?void 0:new Error("RTL Text Plugin failed to import scripts from "+ye),Pe)}}catch(He){ae(He.toString())}},Aa.prototype.getAvailableImages=function(H){var Q=this.availableImages[H];return Q||(Q=[]),Q},Aa.prototype.getLayerIndex=function(H){var Q=this.layerIndexes[H];return Q||(Q=this.layerIndexes[H]=new ce),Q},Aa.prototype.getWorkerSource=function(H,Q,ae){var ye=this;return this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][Q]||(this.workerSources[H][Q]={}),this.workerSources[H][Q][ae]||(this.workerSources[H][Q][ae]=new this.workerSourceTypes[Q]({send:function(Pe,He,rt){ye.actor.send(Pe,He,rt,H)}},this.getLayerIndex(H),this.getAvailableImages(H))),this.workerSources[H][Q][ae]},Aa.prototype.getDEMWorkerSource=function(H,Q){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][Q]||(this.demWorkerSources[H][Q]=new yt),this.demWorkerSources[H][Q]},Aa.prototype.enforceCacheSizeLimit=function(H,Q){m.enforceCacheSizeLimit(Q)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Aa(self)),Aa}),re(["./shared"],function(m){"use strict";var de=m.createCommonjsModule(function(l){function h(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,L,U=new Blob([""],{type:"text/javascript"}),Y=URL.createObjectURL(U);try{L=new Worker(Y),M=!0}catch(le){M=!1}return L&&L.terminate(),URL.revokeObjectURL(Y),M}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var M=document.createElement("canvas");M.width=M.height=1;var L=M.getContext("2d");if(!L)return!1;var U=L.getImageData(0,0,1,1);return U&&U.width===M.width}()?(d[w=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[w]=function(M){var L=function(Y){var le=document.createElement("canvas"),pe=Object.create(h.webGLContextAttributes);return pe.failIfMajorPerformanceCaveat=Y,le.probablySupportsContext?le.probablySupportsContext("webgl",pe)||le.probablySupportsContext("experimental-webgl",pe):le.supportsContext?le.supportsContext("webgl",pe)||le.supportsContext("experimental-webgl",pe):le.getContext("webgl",pe)||le.getContext("experimental-webgl",pe)}(M);if(!L)return!1;var U=L.createShader(L.VERTEX_SHADER);return!(!U||L.isContextLost())&&(L.shaderSource(U,"void main() {}"),L.compileShader(U),L.getShaderParameter(U,L.COMPILE_STATUS)===!0)}(w)),d[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=h:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=h,window.mapboxgl.notSupportedReason=c);var d={};h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Z={create:function(l,h,c){var d=m.window.document.createElement(l);return h!==void 0&&(d.className=h),c&&c.appendChild(d),d},createNS:function(l,h){return m.window.document.createElementNS(l,h)}},ce=m.window.document&&m.window.document.documentElement.style;function fe(l){if(!ce)return l[0];for(var h=0;h<l.length;h++)if(l[h]in ce)return l[h];return l[0]}var Le,J=fe(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Z.disableDrag=function(){ce&&J&&(Le=ce[J],ce[J]="none")},Z.enableDrag=function(){ce&&J&&(ce[J]=Le)};var Xe=fe(["transform","WebkitTransform"]);Z.setTransform=function(l,h){l.style[Xe]=h};var et=!1;try{var Ze=Object.defineProperty({},"passive",{get:function(){et=!0}});m.window.addEventListener("test",Ze,Ze),m.window.removeEventListener("test",Ze,Ze)}catch(l){et=!1}Z.addEventListener=function(l,h,c,d){d===void 0&&(d={}),l.addEventListener(h,c,"passive"in d&&et?d:d.capture)},Z.removeEventListener=function(l,h,c,d){d===void 0&&(d={}),l.removeEventListener(h,c,"passive"in d&&et?d:d.capture)};var yt=function(l){l.preventDefault(),l.stopPropagation(),m.window.removeEventListener("click",yt,!0)};function rr(l){var h=l.userImage;return!!(h&&h.render&&h.render())&&(l.data.replace(new Uint8Array(h.data.buffer)),!0)}Z.suppressClick=function(){m.window.addEventListener("click",yt,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",yt,!0)},0)},Z.mousePos=function(l,h){var c=l.getBoundingClientRect();return new m.Point(h.clientX-c.left-l.clientLeft,h.clientY-c.top-l.clientTop)},Z.touchPos=function(l,h){for(var c=l.getBoundingClientRect(),d=[],E=0;E<h.length;E++)d.push(new m.Point(h[E].clientX-c.left-l.clientLeft,h[E].clientY-c.top-l.clientTop));return d},Z.mouseButton=function(l){return m.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},Z.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var bt=function(l){function h(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.isLoaded=function(){return this.loaded},h.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var w=E[d];this._notify(w.ids,w.callback)}this.requestors=[]}},h.prototype.getImage=function(c){return this.images[c]},h.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},h.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},h.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,w=0,M=c;w<M.length;w+=1){var L=M[w];if(L[0]<E||L[1]<L[0]||d<L[1])return!1;E=L[1]}return!0},h.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},h.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},h.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},h.prototype.listImages=function(){return Object.keys(this.images)},h.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var w=0,M=c;w<M.length;w+=1)this.images[M[w]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},h.prototype._notify=function(c,d){for(var E={},w=0,M=c;w<M.length;w+=1){var L=M[w];this.images[L]||this.fire(new m.Event("styleimagemissing",{id:L}));var U=this.images[L];U?E[L]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:m.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},h.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},h.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var w={w:E.data.width+2,h:E.data.height+2,x:0,y:0},M=new m.ImagePosition(w,E);this.patterns[c]={bin:w,position:M}}return this._updatePatternAtlas(),this.patterns[c].position},h.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},h.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=m.potpack(c),w=E.w,M=E.h,L=this.atlasImage;for(var U in L.resize({width:w||1,height:M||1}),this.patterns){var Y=this.patterns[U].bin,le=Y.x+1,pe=Y.y+1,ve=this.images[U].data,Re=ve.width,Ie=ve.height;m.RGBAImage.copy(ve,L,{x:0,y:0},{x:le,y:pe},{width:Re,height:Ie}),m.RGBAImage.copy(ve,L,{x:0,y:Ie-1},{x:le,y:pe-1},{width:Re,height:1}),m.RGBAImage.copy(ve,L,{x:0,y:0},{x:le,y:pe+Ie},{width:Re,height:1}),m.RGBAImage.copy(ve,L,{x:Re-1,y:0},{x:le-1,y:pe},{width:1,height:Ie}),m.RGBAImage.copy(ve,L,{x:0,y:0},{x:le+Re,y:pe},{width:1,height:Ie})}this.dirty=!0},h.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},h.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var w=E[d];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var M=this.images[w];rr(M)&&this.updateImage(w,M)}}},h}(m.Evented),Xt=it,Ct=it,at=1e20;function it(l,h,c,d,E,w){this.fontSize=l||24,this.buffer=h===void 0?3:h,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var M=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=M,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.d=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Int16Array(M),this.middle=Math.round(M/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Vt(l,h,c,d,E,w,M){for(var L=0;L<h;L++){for(var U=0;U<c;U++)d[U]=l[U*h+L];for(q(d,E,w,M,c),U=0;U<c;U++)l[U*h+L]=E[U]}for(U=0;U<c;U++){for(L=0;L<h;L++)d[L]=l[U*h+L];for(q(d,E,w,M,h),L=0;L<h;L++)l[U*h+L]=Math.sqrt(E[L])}}function q(l,h,c,d,E){c[0]=0,d[0]=-at,d[1]=+at;for(var w=1,M=0;w<E;w++){for(var L=(l[w]+w*w-(l[c[M]]+c[M]*c[M]))/(2*w-2*c[M]);L<=d[M];)M--,L=(l[w]+w*w-(l[c[M]]+c[M]*c[M]))/(2*w-2*c[M]);c[++M]=w,d[M]=L,d[M+1]=+at}for(w=0,M=0;w<E;w++){for(;d[M+1]<w;)M++;h[w]=(w-c[M])*(w-c[M])+l[c[M]]}}it.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var h=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=h.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?at:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?at:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(Vt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Vt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},Xt.default=Ct;var $t=function(l,h){this.requestManager=l,this.localIdeographFontFamily=h,this.entries={}};$t.prototype.setURL=function(l){this.url=l},$t.prototype.getGlyphs=function(l,h){var c=this,d=[];for(var E in l)for(var w=0,M=l[E];w<M.length;w+=1)d.push({stack:E,id:M[w]});m.asyncAll(d,function(L,U){var Y=L.stack,le=L.id,pe=c.entries[Y];pe||(pe=c.entries[Y]={glyphs:{},requests:{},ranges:{}});var ve=pe.glyphs[le];if(ve===void 0){if(ve=c._tinySDF(pe,Y,le))return pe.glyphs[le]=ve,void U(null,{stack:Y,id:le,glyph:ve});var Re=Math.floor(le/256);if(256*Re>65535)U(new Error("glyphs > 65535 not supported"));else if(pe.ranges[Re])U(null,{stack:Y,id:le,glyph:ve});else{var Ie=pe.requests[Re];Ie||(Ie=pe.requests[Re]=[],$t.loadGlyphRange(Y,Re,c.url,c.requestManager,function(je,we){if(we){for(var Ge in we)c._doesCharSupportLocalGlyph(+Ge)||(pe.glyphs[+Ge]=we[+Ge]);pe.ranges[Re]=!0}for(var tt=0,xt=Ie;tt<xt.length;tt+=1)(0,xt[tt])(je,we);delete pe.requests[Re]})),Ie.push(function(je,we){je?U(je):we&&U(null,{stack:Y,id:le,glyph:we[le]||null})})}}else U(null,{stack:Y,id:le,glyph:ve})},function(L,U){if(L)h(L);else if(U){for(var Y={},le=0,pe=U;le<pe.length;le+=1){var ve=pe[le],Re=ve.stack,Ie=ve.id,je=ve.glyph;(Y[Re]||(Y[Re]={}))[Ie]=je&&{id:je.id,bitmap:je.bitmap.clone(),metrics:je.metrics}}h(null,Y)}})},$t.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](l)||m.isChar["Hangul Syllables"](l)||m.isChar.Hiragana(l)||m.isChar.Katakana(l))},$t.prototype._tinySDF=function(l,h,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var w="400";/bold/i.test(h)?w="900":/medium/i.test(h)?w="500":/light/i.test(h)&&(w="200"),E=l.tinySDF=new $t.TinySDF(24,3,8,.25,d,w)}return{id:c,bitmap:new m.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},$t.loadGlyphRange=function(l,h,c,d,E){var w=256*h,M=w+255,L=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+M),m.ResourceType.Glyphs);m.getArrayBuffer(L,function(U,Y){if(U)E(U);else if(Y){for(var le={},pe=0,ve=m.parseGlyphPBF(Y);pe<ve.length;pe+=1){var Re=ve[pe];le[Re.id]=Re}E(null,le)}})},$t.TinySDF=Xt;var ft=function(){this.specification=m.styleSpec.light.position};ft.prototype.possiblyEvaluate=function(l,h){return m.sphericalToCartesian(l.expression.evaluate(h))},ft.prototype.interpolate=function(l,h,c){return{x:m.number(l.x,h.x,c),y:m.number(l.y,h.y,c),z:m.number(l.z,h.z,c)}};var Je=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new ft,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),wt=function(l){function h(c){l.call(this),this._transitionable=new m.Transitionable(Je),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getLight=function(){return this._transitionable.serialize()},h.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(m.validateLight,c,d))for(var E in c){var w=c[E];m.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),w):this._transitionable.setValue(E,w)}},h.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},h.prototype.hasTransition=function(){return this._transitioning.hasTransition()},h.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},h.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},h}(m.Evented),Qe=function(l,h){this.width=l,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Qe.prototype.getDash=function(l,h){var c=l.join(",")+String(h);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,h)),this.dashEntry[c]},Qe.prototype.getDashRanges=function(l,h,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,M=!0;d.push({left:E,right:w,isDash:M,zeroLength:l[0]===0});for(var L=l[0],U=1;U<l.length;U++){var Y=l[U];d.push({left:E=L*c,right:w=(L+=Y)*c,isDash:M=!M,zeroLength:Y===0})}return d},Qe.prototype.addRoundDash=function(l,h,c){for(var d=h/2,E=-c;E<=c;E++)for(var w=this.width*(this.nextRow+c+E),M=0,L=l[M],U=0;U<this.width;U++){U/L.right>1&&(L=l[++M]);var Y=Math.abs(U-L.left),le=Math.abs(U-L.right),pe=Math.min(Y,le),ve=void 0,Re=E/c*(d+1);if(L.isDash){var Ie=d-Math.abs(Re);ve=Math.sqrt(pe*pe+Ie*Ie)}else ve=d-Math.sqrt(pe*pe+Re*Re);this.data[w+U]=Math.max(0,Math.min(255,ve+128))}},Qe.prototype.addRegularDash=function(l){for(var h=l.length-1;h>=0;--h){var c=l[h],d=l[h+1];c.zeroLength?l.splice(h,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(h,1))}var E=l[0],w=l[l.length-1];E.isDash===w.isDash&&(E.left=w.left-this.width,w.right=E.right+this.width);for(var M=this.width*this.nextRow,L=0,U=l[L],Y=0;Y<this.width;Y++){Y/U.right>1&&(U=l[++L]);var le=Math.abs(Y-U.left),pe=Math.abs(Y-U.right),ve=Math.min(le,pe);this.data[M+Y]=Math.max(0,Math.min(255,(U.isDash?ve:-ve)+128))}},Qe.prototype.addDash=function(l,h){var c=h?7:0,d=2*c+1;if(this.nextRow+d>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var E=0,w=0;w<l.length;w++)E+=l[w];if(E!==0){var M=this.width/E,L=this.getDashRanges(l,this.width,M);h?this.addRoundDash(L,M,c):this.addRegularDash(L)}var U={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,U},Qe.prototype.bind=function(l){var h=l.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))};var Qt=function l(h,c){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var w=new l.Actor(d[E],c,this.id);w.name="Worker "+E,this.actors.push(w)}};function Er(l,h,c){var d=function(E,w){if(E)return c(E);if(w){var M=m.pick(m.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(M.vectorLayers=w.vector_layers,M.vectorLayerIds=M.vectorLayers.map(function(L){return L.id})),M.tiles=h.canonicalizeTileset(M,l.url),c(null,M)}};return l.url?m.getJSON(h.transformRequest(h.normalizeSourceURL(l.url),m.ResourceType.Source),d):m.browser.frame(function(){return d(null,l)})}Qt.prototype.broadcast=function(l,h,c){m.asyncAll(this.actors,function(d,E){d.send(l,h,E)},c=c||function(){})},Qt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Qt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Qt.Actor=m.Actor;var Fr=function(l,h,c){this.bounds=m.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=c||24};Fr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Fr.prototype.contains=function(l){var h=Math.pow(2,l.z),c=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*h),d=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*h),E=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*h),w=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*h);return l.x>=c&&l.x<E&&l.y>=d&&l.y<w};var Jr=function(l){function h(c,d,E,w){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(d,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Er(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Fr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},h.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},h.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return m.extend({},this._options)},h.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(E,m.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function M(L,U){return delete c.request,c.aborted?d(null):L&&L.status!==404?d(L):(U&&U.resourceTiming&&(c.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&c.setExpiryData(U),c.loadVectorData(U,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",w,M.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,M.bind(this)))},h.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},h.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},h.prototype.hasTransition=function(){return!1},h}(m.Evented),A=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},d),m.extend(this,m.pick(d,["url","scheme","tileSize"]))}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Er(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Fr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return m.extend({},this._options)},h.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},h.prototype.loadTile=function(c,d){var E=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(w,m.ResourceType.Tile),function(M,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(M)c.state="errored",d(M);else if(L){E.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=E.map.painter.context,Y=U.gl;c.texture=E.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new m.Texture(U,L,Y.RGBA,{useMipmap:!0}),c.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&Y.texParameterf(Y.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),c.state="loaded",m.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},h.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},h.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},h.prototype.hasTransition=function(){return!1},h}(m.Evented),Ce=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},h.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(M,L){M&&(c.state="errored",d(M)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=m.getImage(this.map._requestManager.transformRequest(E,m.ResourceType.Tile),function(M,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(M)c.state="errored",d(M);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=m.window.ImageBitmap&&L instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?L:m.browser.getImageData(L,1),Y={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:U,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",Y,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},h.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),w=(d.x-1+E)%E,M=d.x===0?c.wrap-1:c.wrap,L=(d.x+1+E)%E,U=d.x+1===E?c.wrap+1:c.wrap,Y={};return Y[new m.OverscaledTileID(c.overscaledZ,M,d.z,w,d.y).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y).key]={backfilled:!1},d.y>0&&(Y[new m.OverscaledTileID(c.overscaledZ,M,d.z,w,d.y-1).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y-1).key]={backfilled:!1}),d.y+1<E&&(Y[new m.OverscaledTileID(c.overscaledZ,M,d.z,w,d.y+1).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y+1).key]={backfilled:!1}),Y},h.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},h}(A),De=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(w),this._data=d.data,this._options=m.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var M=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*M,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*M,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:m.EXTENT,radius:(d.clusterRadius||50)*M,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new m.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new m.Event("data",E))}})},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new m.ErrorEvent(E));else{var w={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(w.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new m.Event("data",w))}}),this},h.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},h.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},h.prototype.getClusterLeaves=function(c,d,E,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},w),this},h.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=m.extend({},this.workerOptions),w=this._data;typeof w=="string"?(E.request=this.map._requestManager.transformRequest(m.browser.resolveURL(w),m.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(w),this.actor.send(this.type+".loadData",E,function(M,L){d._removed||L&&L.abandoned||(d._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[d.id]&&(d._resourceTiming=L.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(M))})},h.prototype.loaded=function(){return this._loaded},h.prototype.loadTile=function(c,d){var E=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(M,L){return delete c.request,c.unloadVectorData(),c.aborted?d(null):M?d(M):(c.loadVectorData(L,E.map.painter,w==="reloadTile"),d(null))})},h.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},h.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},h.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},h.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},h.prototype.hasTransition=function(){return!1},h}(m.Evented),Tt=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),gt=function(l){function h(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(w,M){E._loaded=!0,w?E.fire(new m.ErrorEvent(w)):M&&(E.image=M,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},h.prototype.loaded=function(){return this._loaded},h.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},h.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(M){for(var L=1/0,U=1/0,Y=-1/0,le=-1/0,pe=0,ve=M;pe<ve.length;pe+=1){var Re=ve[pe];L=Math.min(L,Re.x),U=Math.min(U,Re.y),Y=Math.max(Y,Re.x),le=Math.max(le,Re.y)}var Ie=Math.max(Y-L,le-U),je=Math.max(0,Math.floor(-Math.log(Ie)/Math.LN2)),we=Math.pow(2,je);return new m.CanonicalTileID(je,Math.floor((L+Y)/2*we),Math.floor((U+le)/2*we))}(E),this.minzoom=this.maxzoom=this.tileID.z;var w=E.map(function(M){return d.tileID.getTilePoint(M)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},h.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Tt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},h.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},h.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return!1},h}(m.Evented),Bt=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),this.roundZoom=!0,this.type="video",this.options=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,w=d.urls;E<w.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(w[E],m.ResourceType.Source).url);m.getVideo(this.urls,function(M,L){c._loaded=!0,M?c.fire(new m.ErrorEvent(M)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},h.prototype.pause=function(){this.video&&this.video.pause()},h.prototype.play=function(){this.video&&this.video.play()},h.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},h.prototype.getVideo=function(){return this.video},h.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},h.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Tt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this.video&&!this.video.paused},h}(gt),Kt=function(l){function h(c,d,E,w){l.call(this,c,d,E,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(M){return!Array.isArray(M)||M.length!==2||M.some(function(L){return typeof L!="number"})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},h.prototype.getCanvas=function(){return this.canvas},h.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},h.prototype.onRemove=function(){this.pause()},h.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Tt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var M=this.tiles[w];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this._playing},h.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},h}(gt),Cr={vector:Jr,raster:A,"raster-dem":Ce,geojson:De,video:Bt,image:gt,canvas:Kt};function Qn(l,h){var c=m.identity([]);return m.translate(c,c,[1,1,0]),m.scale(c,c,[.5*l.width,.5*l.height,1]),m.multiply(c,c,l.calculatePosMatrix(h.toUnwrapped()))}function vn(l,h,c,d,E,w){var M=function(je,we,Ge){if(je)for(var tt=0,xt=je;tt<xt.length;tt+=1){var Ht=we[xt[tt]];if(Ht&&Ht.source===Ge&&Ht.type==="fill-extrusion")return!0}else for(var Zt in we){var Jt=we[Zt];if(Jt.source===Ge&&Jt.type==="fill-extrusion")return!0}return!1}(E&&E.layers,h,l.id),L=w.maxPitchScaleFactor(),U=l.tilesIn(d,L,M);U.sort(fi);for(var Y=[],le=0,pe=U;le<pe.length;le+=1){var ve=pe[le];Y.push({wrappedTileID:ve.tileID.wrapped().key,queryResults:ve.tile.queryRenderedFeatures(h,c,l._state,ve.queryGeometry,ve.cameraQueryGeometry,ve.scale,E,w,L,Qn(l.transform,ve.tileID))})}var Re=function(je){for(var we={},Ge={},tt=0,xt=je;tt<xt.length;tt+=1){var Ht=xt[tt],Zt=Ht.queryResults,Jt=Ht.wrappedTileID,mr=Ge[Jt]=Ge[Jt]||{};for(var Br in Zt)for(var kr=Zt[Br],un=mr[Br]=mr[Br]||{},Mn=we[Br]=we[Br]||[],Nn=0,Rn=kr;Nn<Rn.length;Nn+=1){var Fi=Rn[Nn];un[Fi.featureIndex]||(un[Fi.featureIndex]=!0,Mn.push(Fi))}}return we}(Y);for(var Ie in Re)Re[Ie].forEach(function(je){var we=je.feature,Ge=l.getFeatureState(we.layer["source-layer"],we.id);we.source=we.layer.source,we.layer["source-layer"]&&(we.sourceLayer=we.layer["source-layer"]),we.state=Ge});return Re}function fi(l,h){var c=l.tileID,d=h.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Gn=function(l,h){this.max=l,this.onRemove=h,this.reset()};Gn.prototype.reset=function(){for(var l in this.data)for(var h=0,c=this.data[l];h<c.length;h+=1){var d=c[h];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Gn.prototype.add=function(l,h,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var w={value:h,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){d.remove(l,w)},c)),this.data[E].push(w),this.order.push(E),this.order.length>this.max){var M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this},Gn.prototype.has=function(l){return l.wrapped().key in this.data},Gn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Gn.prototype._getAndRemoveByKey=function(l){var h=this.data[l].shift();return h.timeout&&clearTimeout(h.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),h.value},Gn.prototype.getByKey=function(l){var h=this.data[l];return h?h[0].value:null},Gn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Gn.prototype.remove=function(l,h){if(!this.has(l))return this;var c=l.wrapped().key,d=h===void 0?0:this.data[c].indexOf(h),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},Gn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this},Gn.prototype.filter=function(l){var h=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var w=E[d];l(w.value)||h.push(w)}for(var M=0,L=h;M<L.length;M+=1){var U=L[M];this.remove(U.value.tileID,U)}};var ii=function(l,h,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};ii.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ii.prototype.updateData=function(l){var h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},ii.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var hi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Wn=function(l,h,c,d){this.length=h.length,this.attributes=c,this.itemSize=h.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};Wn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Wn.prototype.updateData=function(l){var h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)},Wn.prototype.enableAttributes=function(l,h){for(var c=0;c<this.attributes.length;c++){var d=h.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},Wn.prototype.setVertexAttribPointers=function(l,h,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],w=h.attributes[E.name];w!==void 0&&l.vertexAttribPointer(w,E.components,l[hi[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},Wn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var pi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};pi.prototype.get=function(){return this.current},pi.prototype.set=function(l){},pi.prototype.getDefault=function(){return this.default},pi.prototype.setDefault=function(){this.set(this.default)};var la=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return m.Color.transparent},h.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},h}(pi),Gi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 1},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},h}(pi),Oi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},h}(pi),$i=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return[!0,!0,!0,!0]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},h}(pi),ca=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},h}(pi),wi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 255},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},h}(pi),xa=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},h.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},h}(pi),qn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},h}(pi),Ci=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},h}(pi),Zi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return[0,1]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},h}(pi),Qi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},h}(pi),Zo=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.LESS},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},h}(pi),me=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},h}(pi),Dn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},h}(pi),Xa=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return m.Color.transparent},h.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},h}(pi),cs=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.FUNC_ADD},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},h}(pi),Nt=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},h}(pi),nr=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.BACK},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},h}(pi),Ar=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.CCW},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},h}(pi),en=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},h}(pi),wn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.TEXTURE0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},h}(pi),Bn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},h}(pi),di=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},h}(pi),Jn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},h}(pi),cn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},h}(pi),Li=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},h}(pi),Ri=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},h}(pi),oo=function(l){function h(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},h}(pi),ys=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 4},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},h}(pi),Yo=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},h}(pi),Va=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},h}(pi),Aa=function(l){function h(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h}(pi),H=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.setDirty=function(){this.dirty=!0},h.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},h}(Aa),Q=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},h}(Aa),ae=function(l,h,c,d){this.context=l,this.width=h,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new H(l,E),d&&(this.depthAttachment=new Q(l,E))};ae.prototype.destroy=function(){var l=this.context.gl,h=this.colorAttachment.get();if(h&&l.deleteTexture(h),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var ye=function(l,h,c){this.func=l,this.mask=h,this.range=c};ye.ReadOnly=!1,ye.ReadWrite=!0,ye.disabled=new ye(519,ye.ReadOnly,[0,1]);var Pe=function(l,h,c,d,E,w){this.test=l,this.ref=h,this.mask=c,this.fail=d,this.depthFail=E,this.pass=w};Pe.disabled=new Pe({func:519,mask:0},0,0,7680,7680,7680);var He=function(l,h,c){this.blendFunction=l,this.blendColor=h,this.mask=c};He.disabled=new He(He.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),He.unblended=new He(He.Replace,m.Color.transparent,[!0,!0,!0,!0]),He.alphaBlended=new He([1,771],m.Color.transparent,[!0,!0,!0,!0]);var rt=function(l,h,c){this.enable=l,this.mode=h,this.frontFace=c};rt.disabled=new rt(!1,1029,2305),rt.backCCW=new rt(!0,1029,2305);var he=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new la(this),this.clearDepth=new Gi(this),this.clearStencil=new Oi(this),this.colorMask=new $i(this),this.depthMask=new ca(this),this.stencilMask=new wi(this),this.stencilFunc=new xa(this),this.stencilOp=new qn(this),this.stencilTest=new Ci(this),this.depthRange=new Zi(this),this.depthTest=new Qi(this),this.depthFunc=new Zo(this),this.blend=new me(this),this.blendFunc=new Dn(this),this.blendColor=new Xa(this),this.blendEquation=new cs(this),this.cullFace=new Nt(this),this.cullFaceSide=new nr(this),this.frontFace=new Ar(this),this.program=new en(this),this.activeTexture=new wn(this),this.viewport=new Bn(this),this.bindFramebuffer=new di(this),this.bindRenderbuffer=new Jn(this),this.bindTexture=new cn(this),this.bindVertexBuffer=new Li(this),this.bindElementBuffer=new Ri(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new oo(this),this.pixelStoreUnpack=new ys(this),this.pixelStoreUnpackPremultiplyAlpha=new Yo(this),this.pixelStoreUnpackFlipY=new Va(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};he.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},he.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},he.prototype.createIndexBuffer=function(l,h){return new ii(this,l,h)},he.prototype.createVertexBuffer=function(l,h,c){return new Wn(this,l,h,c)},he.prototype.createRenderbuffer=function(l,h,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,h,c),this.bindRenderbuffer.set(null),E},he.prototype.createFramebuffer=function(l,h,c){return new ae(this,l,h,c)},he.prototype.clear=function(l){var h=l.color,c=l.depth,d=this.gl,E=0;h&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},he.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},he.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},he.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},he.prototype.setColorMode=function(l){m.deepEqual(l.blendFunction,He.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},he.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var ke=function(l){function h(c,d,E){var w=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(M){M.dataType==="source"&&M.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&M.dataType==="source"&&M.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(M,L,U,Y){var le=new Cr[L.type](M,L,U,Y);if(le.id!==M)throw new Error("Expected Source id to be "+M+" instead of "+le.id);return m.bindAll(["load","abort","unload","serialize","prepare"],le),le}(c,d,E,this),this._tiles={},this._cache=new Gn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},h.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},h.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},h.prototype.getSource=function(){return this._source},h.prototype.pause=function(){this._paused=!0},h.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},h.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},h.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},h.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},h.prototype.serialize=function(){return this._source.serialize()},h.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},h.prototype.getIds=function(){return m.values(this._tiles).map(function(c){return c.tileID}).sort(vt).map(function(c){return c.key})},h.prototype.getRenderableIds=function(c){var d=this,E=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&E.push(this._tiles[w]);return c?E.sort(function(M,L){var U=M.tileID,Y=L.tileID,le=new m.Point(U.canonical.x,U.canonical.y)._rotate(d.transform.angle),pe=new m.Point(Y.canonical.x,Y.canonical.y)._rotate(d.transform.angle);return U.overscaledZ-Y.overscaledZ||pe.y-le.y||pe.x-le.x}).map(function(M){return M.tileID.key}):E.map(function(M){return M.tileID}).sort(vt).map(function(M){return M.key})},h.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},h.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},h.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},h.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},h.prototype._tileLoaded=function(c,d,E,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new m.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=m.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},h.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var w=d[E];if(c.neighboringTiles&&c.neighboringTiles[w]){var M=this.getTileByID(w);L(c,M),L(M,c)}}function L(U,Y){U.needsHillshadePrepare=!0;var le=Y.tileID.canonical.x-U.tileID.canonical.x,pe=Y.tileID.canonical.y-U.tileID.canonical.y,ve=Math.pow(2,U.tileID.canonical.z),Re=Y.tileID.key;le===0&&pe===0||Math.abs(pe)>1||(Math.abs(le)>1&&(Math.abs(le+ve)===1?le+=ve:Math.abs(le-ve)===1&&(le-=ve)),Y.dem&&U.dem&&(U.dem.backfillBorder(Y.dem,le,pe),U.neighboringTiles&&U.neighboringTiles[Re]&&(U.neighboringTiles[Re].backfilled=!0)))}},h.prototype.getTile=function(c){return this.getTileByID(c.key)},h.prototype.getTileByID=function(c){return this._tiles[c]},h.prototype._retainLoadedChildren=function(c,d,E,w){for(var M in this._tiles){var L=this._tiles[M];if(!(w[M]||!L.hasData()||L.tileID.overscaledZ<=d||L.tileID.overscaledZ>E)){for(var U=L.tileID;L&&L.tileID.overscaledZ>d+1;){var Y=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[Y.key])&&L.hasData()&&(U=Y)}for(var le=U;le.overscaledZ>d;)if(c[(le=le.scaledTo(le.overscaledZ-1)).key]){w[U.key]=U;break}}}},h.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var w=c.overscaledZ-1;w>=d;w--){var M=c.scaledTo(w),L=this._getLoadedTile(M);if(L)return L}},h.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},h.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(d*E*5),M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(M)},h.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var w in this._tiles){var M=this._tiles[w];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+d),E[M.tileID.key]=M}for(var L in this._tiles=E,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},h.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(mr){return new m.OverscaledTileID(mr.canonical.z,mr.wrap,mr.canonical.z,mr.canonical.x,mr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(mr){return d._source.hasTile(mr)}))):E=[];var w=c.coveringZoomLevel(this._source),M=Math.max(w-h.maxOverzooming,this._source.minzoom),L=Math.max(w+h.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(E,w);if(dr(this._source.type)){for(var Y={},le={},pe=0,ve=Object.keys(U);pe<ve.length;pe+=1){var Re=ve[pe],Ie=U[Re],je=this._tiles[Re];if(je&&!(je.fadeEndTime&&je.fadeEndTime<=m.browser.now())){var we=this.findLoadedParent(Ie,M);we&&(this._addTile(we.tileID),Y[we.tileID.key]=we.tileID),le[Re]=Ie}}for(var Ge in this._retainLoadedChildren(le,w,L,U),Y)U[Ge]||(this._coveredTiles[Ge]=!0,U[Ge]=Y[Ge])}for(var tt in U)this._tiles[tt].clearFadeHold();for(var xt=0,Ht=m.keysDifference(this._tiles,U);xt<Ht.length;xt+=1){var Zt=Ht[xt],Jt=this._tiles[Zt];Jt.hasSymbolBuckets&&!Jt.holdingForFade()?Jt.setHoldDuration(this.map._fadeDuration):Jt.hasSymbolBuckets&&!Jt.symbolFadeFinished()||this._removeTile(Zt)}this._updateLoadedParentTileCache()}},h.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},h.prototype._updateRetainedTiles=function(c,d){for(var E={},w={},M=Math.max(d-h.maxOverzooming,this._source.minzoom),L=Math.max(d+h.maxUnderzooming,this._source.minzoom),U={},Y=0,le=c;Y<le.length;Y+=1){var pe=le[Y],ve=this._addTile(pe);E[pe.key]=pe,ve.hasData()||d<this._source.maxzoom&&(U[pe.key]=pe)}this._retainLoadedChildren(U,d,L,E);for(var Re=0,Ie=c;Re<Ie.length;Re+=1){var je=Ie[Re],we=this._tiles[je.key];if(!we.hasData()){if(d+1>this._source.maxzoom){var Ge=je.children(this._source.maxzoom)[0],tt=this.getTile(Ge);if(tt&&tt.hasData()){E[Ge.key]=Ge;continue}}else{var xt=je.children(this._source.maxzoom);if(E[xt[0].key]&&E[xt[1].key]&&E[xt[2].key]&&E[xt[3].key])continue}for(var Ht=we.wasRequested(),Zt=je.overscaledZ-1;Zt>=M;--Zt){var Jt=je.scaledTo(Zt);if(w[Jt.key]||(w[Jt.key]=!0,!(we=this.getTile(Jt))&&Ht&&(we=this._addTile(Jt)),we&&(E[Jt.key]=Jt,Ht=we.wasRequested(),we.hasData())))break}}}return E},h.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){E=this._loadedParentTiles[w.key];break}d.push(w.key);var M=w.scaledTo(w.overscaledZ-1);if(E=this._getLoadedTile(M))break;w=M}for(var L=0,U=d;L<U.length;L+=1)this._loadedParentTiles[U[L]]=E}},h.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new m.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new m.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},h.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=d.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},w))},h.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},h.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},h.prototype.tilesIn=function(c,d,E){var w=this,M=[],L=this.transform;if(!L)return M;for(var U=E?L.getCameraQueryGeometry(c):c,Y=c.map(function(Zt){return L.pointCoordinate(Zt)}),le=U.map(function(Zt){return L.pointCoordinate(Zt)}),pe=this.getIds(),ve=1/0,Re=1/0,Ie=-1/0,je=-1/0,we=0,Ge=le;we<Ge.length;we+=1){var tt=Ge[we];ve=Math.min(ve,tt.x),Re=Math.min(Re,tt.y),Ie=Math.max(Ie,tt.x),je=Math.max(je,tt.y)}for(var xt=function(Zt){var Jt=w._tiles[pe[Zt]];if(!Jt.holdingForFade()){var mr=Jt.tileID,Br=Math.pow(2,L.zoom-Jt.tileID.overscaledZ),kr=d*Jt.queryPadding*m.EXTENT/Jt.tileSize/Br,un=[mr.getTilePoint(new m.MercatorCoordinate(ve,Re)),mr.getTilePoint(new m.MercatorCoordinate(Ie,je))];if(un[0].x-kr<m.EXTENT&&un[0].y-kr<m.EXTENT&&un[1].x+kr>=0&&un[1].y+kr>=0){var Mn=Y.map(function(Rn){return mr.getTilePoint(Rn)}),Nn=le.map(function(Rn){return mr.getTilePoint(Rn)});M.push({tile:Jt,tileID:mr,queryGeometry:Mn,cameraQueryGeometry:Nn,scale:Br})}}},Ht=0;Ht<pe.length;Ht++)xt(Ht);return M},h.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(U){return d._tiles[U].tileID}),w=0,M=E;w<M.length;w+=1){var L=M[w];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return E},h.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(dr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=m.browser.now())return!0}return!1},h.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},h.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},h.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},h.prototype.setDependencies=function(c,d,E){var w=this._tiles[c];w&&w.setDependencies(d,E)},h.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,d)})},h}(m.Evented);function vt(l,h){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*h.wrap)-+(h.wrap<0);return l.overscaledZ-h.overscaledZ||d-c||h.canonical.y-l.canonical.y||h.canonical.x-l.canonical.x}function dr(l){return l==="raster"||l==="image"||l==="video"}function Ft(){return new m.window.Worker(Hu.workerUrl)}ke.maxOverzooming=10,ke.maxUnderzooming=3;var zt="mapboxgl_preloaded_worker_pool",vr=function(){this.active={}};vr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<vr.workerCount;)this.workers.push(new Ft);return this.active[l]=!0,this.workers.slice()},vr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(h){h.terminate()}),this.workers=null)},vr.prototype.isPreloaded=function(){return!!this.active[zt]},vr.prototype.numActive=function(){return Object.keys(this.active).length};var En,pn=Math.floor(m.browser.hardwareConcurrency/2);function Ot(){return En||(En=new vr),En}function tn(l,h){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return m.refProperties.forEach(function(E){E in h&&(c[E]=h[E])}),c}function Zr(l){l=l.slice();for(var h=Object.create(null),c=0;c<l.length;c++)h[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=tn(l[d],h[l[d].ref]));return l}vr.workerCount=Math.max(Math.min(pn,6),1);var Hr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function gi(l,h,c){c.push({command:Hr.addSource,args:[l,h[l]]})}function rn(l,h,c){h.push({command:Hr.removeSource,args:[l]}),c[l]=!0}function nn(l,h,c,d){rn(l,c,d),gi(l,h,c)}function Wi(l,h,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],h[c][d]))return!1;for(d in h[c])if(h[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],h[c][d]))return!1;return!0}function vi(l,h,c,d,E,w){var M;for(M in h=h||{},l=l||{})l.hasOwnProperty(M)&&(m.deepEqual(l[M],h[M])||c.push({command:w,args:[d,M,h[M],E]}));for(M in h)h.hasOwnProperty(M)&&!l.hasOwnProperty(M)&&(m.deepEqual(l[M],h[M])||c.push({command:w,args:[d,M,h[M],E]}))}function Ti(l){return l.id}function _i(l,h){return l[h.id]=h,l}var ht=function(l,h){this.reset(l,h)};ht.prototype.reset=function(l,h){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ht.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=m.clamp(l,0,1);for(var h=1,c=this._distances[h],d=l*this.paddedLength+this.padding;c<d&&h<this._distances.length;)c=this._distances[++h];var E=h-1,w=this._distances[E],M=c-w,L=M>0?(d-w)/M:0;return this.points[E].mult(1-L).add(this.points[h].mult(L))};var Pt=function(l,h,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(h/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0};function Ma(l,h,c,d,E){var w=m.create();return h?(m.scale(w,w,[1/E,1/E,1]),c||m.rotateZ(w,w,d.angle)):m.multiply(w,d.labelPlaneMatrix,l),w}function Ai(l,h,c,d,E){if(h){var w=m.clone(l);return m.scale(w,w,[E,E,1]),c||m.rotateZ(w,w,-d.angle),w}return d.glCoordMatrix}function Mi(l,h){var c=[l.x,l.y,0,1];Pa(c,c,h);var d=c[3];return{point:new m.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function ji(l,h){return .5+l/h*.5}function Pr(l,h){var c=l[0]/l[3],d=l[1]/l[3];return c>=-h[0]&&c<=h[0]&&d>=-h[1]&&d<=h[1]}function an(l,h,c,d,E,w,M,L){var U=d?l.textSizeData:l.iconSizeData,Y=m.evaluateSizeForZoom(U,c.transform.zoom),le=[256/c.width*2+1,256/c.height*2+1],pe=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;pe.clear();for(var ve=l.lineVertexArray,Re=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Ie=c.transform.width/c.transform.height,je=!1,we=0;we<Re.length;we++){var Ge=Re.get(we);if(Ge.hidden||Ge.writingMode===m.WritingMode.vertical&&!je)Ga(Ge.numGlyphs,pe);else{je=!1;var tt=[Ge.anchorX,Ge.anchorY,0,1];if(m.transformMat4(tt,tt,h),Pr(tt,le)){var xt=ji(c.transform.cameraToCenterDistance,tt[3]),Ht=m.evaluateSizeForFeature(U,Y,Ge),Zt=M?Ht/xt:Ht*xt,Jt=new m.Point(Ge.anchorX,Ge.anchorY),mr=Mi(Jt,E).point,Br={},kr=ue(Ge,Zt,!1,L,h,E,w,l.glyphOffsetArray,ve,pe,mr,Jt,Br,Ie);je=kr.useVertical,(kr.notEnoughRoom||je||kr.needsFlipping&&ue(Ge,Zt,!0,L,h,E,w,l.glyphOffsetArray,ve,pe,mr,Jt,Br,Ie).notEnoughRoom)&&Ga(Ge.numGlyphs,pe)}else Ga(Ge.numGlyphs,pe)}}d?l.text.dynamicLayoutVertexBuffer.updateData(pe):l.icon.dynamicLayoutVertexBuffer.updateData(pe)}function mt(l,h,c,d,E,w,M,L,U,Y,le){var pe=L.glyphStartIndex+L.numGlyphs,ve=L.lineStartIndex,Re=L.lineStartIndex+L.lineLength,Ie=h.getoffsetX(L.glyphStartIndex),je=h.getoffsetX(pe-1),we=ta(l*Ie,c,d,E,w,M,L.segment,ve,Re,U,Y,le);if(!we)return null;var Ge=ta(l*je,c,d,E,w,M,L.segment,ve,Re,U,Y,le);return Ge?{first:we,last:Ge}:null}function aa(l,h,c,d){return l===m.WritingMode.horizontal&&Math.abs(c.y-h.y)>Math.abs(c.x-h.x)*d?{useVertical:!0}:(l===m.WritingMode.vertical?h.y<c.y:h.x>c.x)?{needsFlipping:!0}:null}function ue(l,h,c,d,E,w,M,L,U,Y,le,pe,ve,Re){var Ie,je=h/24,we=l.lineOffsetX*je,Ge=l.lineOffsetY*je;if(l.numGlyphs>1){var tt=l.glyphStartIndex+l.numGlyphs,xt=l.lineStartIndex,Ht=l.lineStartIndex+l.lineLength,Zt=mt(je,L,we,Ge,c,le,pe,l,U,w,ve);if(!Zt)return{notEnoughRoom:!0};var Jt=Mi(Zt.first.point,M).point,mr=Mi(Zt.last.point,M).point;if(d&&!c){var Br=aa(l.writingMode,Jt,mr,Re);if(Br)return Br}Ie=[Zt.first];for(var kr=l.glyphStartIndex+1;kr<tt-1;kr++)Ie.push(ta(je*L.getoffsetX(kr),we,Ge,c,le,pe,l.segment,xt,Ht,U,w,ve));Ie.push(Zt.last)}else{if(d&&!c){var un=Mi(pe,E).point,Mn=l.lineStartIndex+l.segment+1,Nn=new m.Point(U.getx(Mn),U.gety(Mn)),Rn=Mi(Nn,E),Fi=Rn.signedDistanceFromCamera>0?Rn.point:ns(pe,Nn,un,1,E),ln=aa(l.writingMode,un,Fi,Re);if(ln)return ln}var oi=ta(je*L.getoffsetX(l.glyphStartIndex),we,Ge,c,le,pe,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,w,ve);if(!oi)return{notEnoughRoom:!0};Ie=[oi]}for(var si=0,ni=Ie;si<ni.length;si+=1){var Xn=ni[si];m.addDynamicAttributes(Y,Xn.point,Xn.angle)}return{}}function ns(l,h,c,d,E){var w=Mi(l.add(l.sub(h)._unit()),E).point,M=c.sub(w);return c.add(M._mult(d/M.mag()))}function ta(l,h,c,d,E,w,M,L,U,Y,le,pe){var ve=d?l-h:l+h,Re=ve>0?1:-1,Ie=0;d&&(Re*=-1,Ie=Math.PI),Re<0&&(Ie+=Math.PI);for(var je=Re>0?L+M:L+M+1,we=E,Ge=E,tt=0,xt=0,Ht=Math.abs(ve),Zt=[];tt+xt<=Ht;){if((je+=Re)<L||je>=U)return null;if(Ge=we,Zt.push(we),(we=pe[je])===void 0){var Jt=new m.Point(Y.getx(je),Y.gety(je)),mr=Mi(Jt,le);if(mr.signedDistanceFromCamera>0)we=pe[je]=mr.point;else{var Br=je-Re;we=ns(tt===0?w:new m.Point(Y.getx(Br),Y.gety(Br)),Jt,Ge,Ht-tt+1,le)}}tt+=xt,xt=Ge.dist(we)}var kr=(Ht-tt)/xt,un=we.sub(Ge),Mn=un.mult(kr)._add(Ge);Mn._add(un._unit()._perp()._mult(c*Re));var Nn=Ie+Math.atan2(we.y-Ge.y,we.x-Ge.x);return Zt.push(Mn),{point:Mn,angle:Nn,path:Zt}}Pt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Pt.prototype.insert=function(l,h,c,d,E){this._forEachCell(h,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},Pt.prototype.insertCircle=function(l,h,c,d){this._forEachCell(h-d,c-d,h+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(c),this.circles.push(d)},Pt.prototype._insertBoxCell=function(l,h,c,d,E,w){this.boxCells[E].push(w)},Pt.prototype._insertCircleCell=function(l,h,c,d,E,w){this.circleCells[E].push(w)},Pt.prototype._query=function(l,h,c,d,E,w){if(c<0||l>this.width||d<0||h>this.height)return!E&&[];var M=[];if(l<=0&&h<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var L=0;L<this.boxKeys.length;L++)M.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var U=0;U<this.circleKeys.length;U++){var Y=this.circles[3*U],le=this.circles[3*U+1],pe=this.circles[3*U+2];M.push({key:this.circleKeys[U],x1:Y-pe,y1:le-pe,x2:Y+pe,y2:le+pe})}return w?M.filter(w):M}return this._forEachCell(l,h,c,d,this._queryCell,M,{hitTest:E,seenUids:{box:{},circle:{}}},w),E?M.length>0:M},Pt.prototype._queryCircle=function(l,h,c,d,E){var w=l-c,M=l+c,L=h-c,U=h+c;if(M<0||w>this.width||U<0||L>this.height)return!d&&[];var Y=[];return this._forEachCell(w,L,M,U,this._queryCellCircle,Y,{hitTest:d,circle:{x:l,y:h,radius:c},seenUids:{box:{},circle:{}}},E),d?Y.length>0:Y},Pt.prototype.query=function(l,h,c,d,E){return this._query(l,h,c,d,!1,E)},Pt.prototype.hitTest=function(l,h,c,d,E){return this._query(l,h,c,d,!0,E)},Pt.prototype.hitTestCircle=function(l,h,c,d){return this._queryCircle(l,h,c,!0,d)},Pt.prototype._queryCell=function(l,h,c,d,E,w,M,L){var U=M.seenUids,Y=this.boxCells[E];if(Y!==null)for(var le=this.bboxes,pe=0,ve=Y;pe<ve.length;pe+=1){var Re=ve[pe];if(!U.box[Re]){U.box[Re]=!0;var Ie=4*Re;if(l<=le[Ie+2]&&h<=le[Ie+3]&&c>=le[Ie+0]&&d>=le[Ie+1]&&(!L||L(this.boxKeys[Re]))){if(M.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Re],x1:le[Ie],y1:le[Ie+1],x2:le[Ie+2],y2:le[Ie+3]})}}}var je=this.circleCells[E];if(je!==null)for(var we=this.circles,Ge=0,tt=je;Ge<tt.length;Ge+=1){var xt=tt[Ge];if(!U.circle[xt]){U.circle[xt]=!0;var Ht=3*xt;if(this._circleAndRectCollide(we[Ht],we[Ht+1],we[Ht+2],l,h,c,d)&&(!L||L(this.circleKeys[xt]))){if(M.hitTest)return w.push(!0),!0;var Zt=we[Ht],Jt=we[Ht+1],mr=we[Ht+2];w.push({key:this.circleKeys[xt],x1:Zt-mr,y1:Jt-mr,x2:Zt+mr,y2:Jt+mr})}}}},Pt.prototype._queryCellCircle=function(l,h,c,d,E,w,M,L){var U=M.circle,Y=M.seenUids,le=this.boxCells[E];if(le!==null)for(var pe=this.bboxes,ve=0,Re=le;ve<Re.length;ve+=1){var Ie=Re[ve];if(!Y.box[Ie]){Y.box[Ie]=!0;var je=4*Ie;if(this._circleAndRectCollide(U.x,U.y,U.radius,pe[je+0],pe[je+1],pe[je+2],pe[je+3])&&(!L||L(this.boxKeys[Ie])))return w.push(!0),!0}}var we=this.circleCells[E];if(we!==null)for(var Ge=this.circles,tt=0,xt=we;tt<xt.length;tt+=1){var Ht=xt[tt];if(!Y.circle[Ht]){Y.circle[Ht]=!0;var Zt=3*Ht;if(this._circlesCollide(Ge[Zt],Ge[Zt+1],Ge[Zt+2],U.x,U.y,U.radius)&&(!L||L(this.circleKeys[Ht])))return w.push(!0),!0}}},Pt.prototype._forEachCell=function(l,h,c,d,E,w,M,L){for(var U=this._convertToXCellCoord(l),Y=this._convertToYCellCoord(h),le=this._convertToXCellCoord(c),pe=this._convertToYCellCoord(d),ve=U;ve<=le;ve++)for(var Re=Y;Re<=pe;Re++)if(E.call(this,l,h,c,d,this.xCellCount*Re+ve,w,M,L))return},Pt.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Pt.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Pt.prototype._circlesCollide=function(l,h,c,d,E,w){var M=d-l,L=E-h,U=c+w;return U*U>M*M+L*L},Pt.prototype._circleAndRectCollide=function(l,h,c,d,E,w,M){var L=(w-d)/2,U=Math.abs(l-(d+L));if(U>L+c)return!1;var Y=(M-E)/2,le=Math.abs(h-(E+Y));if(le>Y+c)return!1;if(U<=L||le<=Y)return!0;var pe=U-L,ve=le-Y;return pe*pe+ve*ve<=c*c};var bu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ga(l,h){for(var c=0;c<l;c++){var d=h.length;h.resize(d+4),h.float32.set(bu,3*d)}}function Pa(l,h,c){var d=h[0],E=h[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var eo=function(l,h,c){h===void 0&&(h=new Pt(l.width+200,l.height+200,25)),c===void 0&&(c=new Pt(l.width+200,l.height+200,25)),this.transform=l,this.grid=h,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function oa(l,h,c){return h*(m.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}eo.prototype.placeCollisionBox=function(l,h,c,d,E){var w=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),M=c*w.perspectiveRatio,L=l.x1*M+w.point.x,U=l.y1*M+w.point.y,Y=l.x2*M+w.point.x,le=l.y2*M+w.point.y;return!this.isInsideGrid(L,U,Y,le)||!h&&this.grid.hitTest(L,U,Y,le,E)?{box:[],offscreen:!1}:{box:[L,U,Y,le],offscreen:this.isOffscreen(L,U,Y,le)}},eo.prototype.placeCollisionCircles=function(l,h,c,d,E,w,M,L,U,Y,le,pe,ve){var Re=[],Ie=new m.Point(h.anchorX,h.anchorY),je=Mi(Ie,w),we=ji(this.transform.cameraToCenterDistance,je.signedDistanceFromCamera),Ge=(Y?E/we:E*we)/m.ONE_EM,tt=Mi(Ie,M).point,xt=mt(Ge,d,h.lineOffsetX*Ge,h.lineOffsetY*Ge,!1,tt,Ie,h,c,M,{}),Ht=!1,Zt=!1,Jt=!0;if(xt){for(var mr=.5*pe*we+ve,Br=new m.Point(-100,-100),kr=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),un=new ht,Mn=xt.first,Nn=xt.last,Rn=[],Fi=Mn.path.length-1;Fi>=1;Fi--)Rn.push(Mn.path[Fi]);for(var ln=1;ln<Nn.path.length;ln++)Rn.push(Nn.path[ln]);var oi=2.5*mr;if(L){var si=Rn.map(function($o){return Mi($o,L)});Rn=si.some(function($o){return $o.signedDistanceFromCamera<=0})?[]:si.map(function($o){return $o.point})}var ni=[];if(Rn.length>0){for(var Xn=Rn[0].clone(),yi=Rn[0].clone(),Kn=1;Kn<Rn.length;Kn++)Xn.x=Math.min(Xn.x,Rn[Kn].x),Xn.y=Math.min(Xn.y,Rn[Kn].y),yi.x=Math.max(yi.x,Rn[Kn].x),yi.y=Math.max(yi.y,Rn[Kn].y);ni=Xn.x>=Br.x&&yi.x<=kr.x&&Xn.y>=Br.y&&yi.y<=kr.y?[Rn]:yi.x<Br.x||Xn.x>kr.x||yi.y<Br.y||Xn.y>kr.y?[]:m.clipLine([Rn],Br.x,Br.y,kr.x,kr.y)}for(var Yn=0,Co=ni;Yn<Co.length;Yn+=1){var Ya;un.reset(Co[Yn],.25*mr),Ya=un.length<=.5*mr?1:Math.ceil(un.paddedLength/oi)+1;for(var Ao=0;Ao<Ya;Ao++){var Go=Ao/Math.max(Ya-1,1),no=un.lerp(Go),po=no.x+100,Ds=no.y+100;Re.push(po,Ds,mr,0);var ds=po-mr,Wu=Ds-mr,qa=po+mr,du=Ds+mr;if(Jt=Jt&&this.isOffscreen(ds,Wu,qa,du),Zt=Zt||this.isInsideGrid(ds,Wu,qa,du),!l&&this.grid.hitTestCircle(po,Ds,mr,le)&&(Ht=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Ht}}}}return{circles:!U&&Ht||!Zt?[]:Re,offscreen:Jt,collisionDetected:Ht}},eo.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var h=[],c=1/0,d=1/0,E=-1/0,w=-1/0,M=0,L=l;M<L.length;M+=1){var U=L[M],Y=new m.Point(U.x+100,U.y+100);c=Math.min(c,Y.x),d=Math.min(d,Y.y),E=Math.max(E,Y.x),w=Math.max(w,Y.y),h.push(Y)}for(var le={},pe={},ve=0,Re=this.grid.query(c,d,E,w).concat(this.ignoredGrid.query(c,d,E,w));ve<Re.length;ve+=1){var Ie=Re[ve],je=Ie.key;if(le[je.bucketInstanceId]===void 0&&(le[je.bucketInstanceId]={}),!le[je.bucketInstanceId][je.featureIndex]){var we=[new m.Point(Ie.x1,Ie.y1),new m.Point(Ie.x2,Ie.y1),new m.Point(Ie.x2,Ie.y2),new m.Point(Ie.x1,Ie.y2)];m.polygonIntersectsPolygon(h,we)&&(le[je.bucketInstanceId][je.featureIndex]=!0,pe[je.bucketInstanceId]===void 0&&(pe[je.bucketInstanceId]=[]),pe[je.bucketInstanceId].push(je.featureIndex))}}return pe},eo.prototype.insertCollisionBox=function(l,h,c,d,E){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},eo.prototype.insertCollisionCircles=function(l,h,c,d,E){for(var w=h?this.ignoredGrid:this.grid,M={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},L=0;L<l.length;L+=4)w.insertCircle(M,l[L],l[L+1],l[L+2])},eo.prototype.projectAndGetPerspectiveRatio=function(l,h,c){var d=[h,c,0,1];return Pa(d,d,l),{point:new m.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},eo.prototype.isOffscreen=function(l,h,c,d){return c<100||l>=this.screenRightBoundary||d<100||h>this.screenBottomBoundary},eo.prototype.isInsideGrid=function(l,h,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&h<this.gridBottomBoundary},eo.prototype.getViewportMatrix=function(){var l=m.identity([]);return m.translate(l,l,[-100,-100,0]),l};var Io=function(l,h,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):d&&c?1:0,this.placed=c};Io.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var qo=function(l,h,c,d,E){this.text=new Io(l?l.text:null,h,c,E),this.icon=new Io(l?l.icon:null,h,d,E)};qo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Du=function(l,h,c){this.text=l,this.icon=h,this.skipFade=c},yo=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},jo=function(l,h,c,d,E){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},sa=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function to(l,h,c,d,E){var w=m.getAnchorAlignment(l),M=-(w.horizontalAlign-.5)*h,L=-(w.verticalAlign-.5)*c,U=m.evaluateVariableOffset(l,d);return new m.Point(M+U[0]*E,L+U[1]*E)}function Vo(l,h,c,d,E,w){var M=l.x1,L=l.x2,U=l.y1,Y=l.y2,le=l.anchorPointX,pe=l.anchorPointY,ve=new m.Point(h,c);return d&&ve._rotate(E?w:-w),{x1:M+ve.x,y1:U+ve.y,x2:L+ve.x,y2:Y+ve.y,anchorPointX:le,anchorPointY:pe}}sa.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:function(c){return c.collisionGroupID===h}}}return this.collisionGroups[l]};var ro=function(l,h,c,d){this.transform=l.clone(),this.collisionIndex=new eo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new sa(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function Rs(l,h,c,d,E){l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0),l.emplaceBack(h?1:0,c?1:0,d||0,E||0)}ro.prototype.getBucketParts=function(l,h,c,d){var E=c.getBucket(h),w=c.latestFeatureIndex;if(E&&w&&h.id===E.layerIds[0]){var M=c.collisionBoxArray,L=E.layers[0].layout,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),Y=c.tileSize/m.EXTENT,le=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),pe=L.get("text-pitch-alignment")==="map",ve=L.get("text-rotation-alignment")==="map",Re=oa(c,1,this.transform.zoom),Ie=Ma(le,pe,ve,this.transform,Re),je=null;if(pe){var we=Ai(le,pe,ve,this.transform,Re);je=m.multiply([],this.transform.labelPlaneMatrix,we)}this.retainedQueryData[E.bucketInstanceId]=new jo(E.bucketInstanceId,w,E.sourceLayerIndex,E.index,c.tileID);var Ge={bucket:E,layout:L,posMatrix:le,textLabelPlaneMatrix:Ie,labelToScreenMatrix:je,scale:U,textPixelRatio:Y,holdingForFade:c.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var tt=0,xt=E.sortKeyRanges;tt<xt.length;tt+=1){var Ht=xt[tt];l.push({sortKey:Ht.sortKey,symbolInstanceStart:Ht.symbolInstanceStart,symbolInstanceEnd:Ht.symbolInstanceEnd,parameters:Ge})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ge})}},ro.prototype.attemptAnchorPlacement=function(l,h,c,d,E,w,M,L,U,Y,le,pe,ve,Re,Ie){var je,we=[pe.textOffset0,pe.textOffset1],Ge=to(l,c,d,we,E),tt=this.collisionIndex.placeCollisionBox(Vo(h,Ge.x,Ge.y,w,M,this.transform.angle),le,L,U,Y.predicate);if(!Ie||this.collisionIndex.placeCollisionBox(Vo(Ie,Ge.x,Ge.y,w,M,this.transform.angle),le,L,U,Y.predicate).box.length!==0)return tt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[pe.crossTileID]&&this.prevPlacement.placements[pe.crossTileID]&&this.prevPlacement.placements[pe.crossTileID].text&&(je=this.prevPlacement.variableOffsets[pe.crossTileID].anchor),this.variableOffsets[pe.crossTileID]={textOffset:we,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:je},this.markUsedJustification(ve,l,pe,Re),ve.allowVerticalPlacement&&(this.markUsedOrientation(ve,Re,pe),this.placedOrientations[pe.crossTileID]=Re),{shift:Ge,placedGlyphBoxes:tt}):void 0},ro.prototype.placeLayerBucketPart=function(l,h,c){var d=this,E=l.parameters,w=E.bucket,M=E.layout,L=E.posMatrix,U=E.textLabelPlaneMatrix,Y=E.labelToScreenMatrix,le=E.textPixelRatio,pe=E.holdingForFade,ve=E.collisionBoxArray,Re=E.partiallyEvaluatedTextSize,Ie=E.collisionGroup,je=M.get("text-optional"),we=M.get("icon-optional"),Ge=M.get("text-allow-overlap"),tt=M.get("icon-allow-overlap"),xt=M.get("text-rotation-alignment")==="map",Ht=M.get("text-pitch-alignment")==="map",Zt=M.get("icon-text-fit")!=="none",Jt=M.get("symbol-z-order")==="viewport-y",mr=Ge&&(tt||!w.hasIconData()||we),Br=tt&&(Ge||!w.hasTextData()||je);!w.collisionArrays&&ve&&w.deserializeCollisionBoxes(ve);var kr=function(ln,oi){if(!h[ln.crossTileID])if(pe)d.placements[ln.crossTileID]=new Du(!1,!1,!1);else{var si,ni=!1,Xn=!1,yi=!0,Kn=null,Yn={box:null,offscreen:null},Co={box:null,offscreen:null},Ya=null,Ao=null,Go=0,no=0,po=0;oi.textFeatureIndex?Go=oi.textFeatureIndex:ln.useRuntimeCollisionCircles&&(Go=ln.featureIndex),oi.verticalTextFeatureIndex&&(no=oi.verticalTextFeatureIndex);var Ds=oi.textBox;if(Ds){var ds=function(ha){var tu=m.WritingMode.horizontal;if(w.allowVerticalPlacement&&!ha&&d.prevPlacement){var Ts=d.prevPlacement.placedOrientations[ln.crossTileID];Ts&&(d.placedOrientations[ln.crossTileID]=Ts,d.markUsedOrientation(w,tu=Ts,ln))}return tu},Wu=function(ha,tu){if(w.allowVerticalPlacement&&ln.numVerticalGlyphVertices>0&&oi.verticalTextBox)for(var Ts=0,El=w.writingModes;Ts<El.length&&(El[Ts]===m.WritingMode.vertical?(Yn=tu(),Co=Yn):Yn=ha(),!(Yn&&Yn.box&&Yn.box.length));Ts+=1);else Yn=ha()};if(M.get("text-variable-anchor")){var qa=M.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[ln.crossTileID]){var du=d.prevPlacement.variableOffsets[ln.crossTileID];qa.indexOf(du.anchor)>0&&(qa=qa.filter(function(ha){return ha!==du.anchor})).unshift(du.anchor)}var $o=function(ha,tu,Ts){for(var El=ha.x2-ha.x1,mc=ha.y2-ha.y1,Fs=ln.textBoxScale,Wf=Zt&&!tt?tu:null,yu={box:[],offscreen:!1},qc=Ge?2*qa.length:qa.length,vs=0;vs<qc;++vs){var Yu=d.attemptAnchorPlacement(qa[vs%qa.length],ha,El,mc,Fs,xt,Ht,le,L,Ie,vs>=qa.length,ln,w,Ts,Wf);if(Yu&&(yu=Yu.placedGlyphBoxes)&&yu.box&&yu.box.length){ni=!0,Kn=Yu.shift;break}}return yu};Wu(function(){return $o(Ds,oi.iconBox,m.WritingMode.horizontal)},function(){var ha=oi.verticalTextBox;return w.allowVerticalPlacement&&!(Yn&&Yn.box&&Yn.box.length)&&ln.numVerticalGlyphVertices>0&&ha?$o(ha,oi.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),Yn&&(ni=Yn.box,yi=Yn.offscreen);var dc=ds(Yn&&Yn.box);if(!ni&&d.prevPlacement){var vu=d.prevPlacement.variableOffsets[ln.crossTileID];vu&&(d.variableOffsets[ln.crossTileID]=vu,d.markUsedJustification(w,vu.anchor,ln,dc))}}else{var mu=function(ha,tu){var Ts=d.collisionIndex.placeCollisionBox(ha,Ge,le,L,Ie.predicate);return Ts&&Ts.box&&Ts.box.length&&(d.markUsedOrientation(w,tu,ln),d.placedOrientations[ln.crossTileID]=tu),Ts};Wu(function(){return mu(Ds,m.WritingMode.horizontal)},function(){var ha=oi.verticalTextBox;return w.allowVerticalPlacement&&ln.numVerticalGlyphVertices>0&&ha?mu(ha,m.WritingMode.vertical):{box:null,offscreen:null}}),ds(Yn&&Yn.box&&Yn.box.length)}}if(ni=(si=Yn)&&si.box&&si.box.length>0,yi=si&&si.offscreen,ln.useRuntimeCollisionCircles){var Vl=w.text.placedSymbolArray.get(ln.centerJustifiedTextSymbolIndex),vc=m.evaluateSizeForFeature(w.textSizeData,Re,Vl),gu=M.get("text-padding");Ya=d.collisionIndex.placeCollisionCircles(Ge,Vl,w.lineVertexArray,w.glyphOffsetArray,vc,L,U,Y,c,Ht,Ie.predicate,ln.collisionCircleDiameter,gu),ni=Ge||Ya.circles.length>0&&!Ya.collisionDetected,yi=yi&&Ya.offscreen}if(oi.iconFeatureIndex&&(po=oi.iconFeatureIndex),oi.iconBox){var Gl=function(ha){var tu=Zt&&Kn?Vo(ha,Kn.x,Kn.y,xt,Ht,d.transform.angle):ha;return d.collisionIndex.placeCollisionBox(tu,tt,le,L,Ie.predicate)};Xn=Co&&Co.box&&Co.box.length&&oi.verticalIconBox?(Ao=Gl(oi.verticalIconBox)).box.length>0:(Ao=Gl(oi.iconBox)).box.length>0,yi=yi&&Ao.offscreen}var Ra=je||ln.numHorizontalGlyphVertices===0&&ln.numVerticalGlyphVertices===0,qi=we||ln.numIconVertices===0;if(Ra||qi?qi?Ra||(Xn=Xn&&ni):ni=Xn&&ni:Xn=ni=Xn&&ni,ni&&si&&si.box&&d.collisionIndex.insertCollisionBox(si.box,M.get("text-ignore-placement"),w.bucketInstanceId,Co&&Co.box&&no?no:Go,Ie.ID),Xn&&Ao&&d.collisionIndex.insertCollisionBox(Ao.box,M.get("icon-ignore-placement"),w.bucketInstanceId,po,Ie.ID),Ya&&(ni&&d.collisionIndex.insertCollisionCircles(Ya.circles,M.get("text-ignore-placement"),w.bucketInstanceId,Go,Ie.ID),c)){var eu=w.bucketInstanceId,Xu=d.collisionCircleArrays[eu];Xu===void 0&&(Xu=d.collisionCircleArrays[eu]=new yo);for(var Hs=0;Hs<Ya.circles.length;Hs+=4)Xu.circles.push(Ya.circles[Hs+0]),Xu.circles.push(Ya.circles[Hs+1]),Xu.circles.push(Ya.circles[Hs+2]),Xu.circles.push(Ya.collisionDetected?1:0)}d.placements[ln.crossTileID]=new Du(ni||mr,Xn||Br,yi||w.justReloaded),h[ln.crossTileID]=!0}};if(Jt)for(var un=w.getSortedSymbolIndexes(this.transform.angle),Mn=un.length-1;Mn>=0;--Mn){var Nn=un[Mn];kr(w.symbolInstances.get(Nn),w.collisionArrays[Nn])}else for(var Rn=l.symbolInstanceStart;Rn<l.symbolInstanceEnd;Rn++)kr(w.symbolInstances.get(Rn),w.collisionArrays[Rn]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var Fi=this.collisionCircleArrays[w.bucketInstanceId];m.invert(Fi.invProjMatrix,L),Fi.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},ro.prototype.markUsedJustification=function(l,h,c,d){var E;E=d===m.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(h)];for(var w=0,M=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<M.length;w+=1){var L=M[w];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=E>=0&&L!==E?0:c.crossTileID)}},ro.prototype.markUsedOrientation=function(l,h,c){for(var d=h===m.WritingMode.horizontal||h===m.WritingMode.horizontalOnly?h:0,E=h===m.WritingMode.vertical?h:0,w=0,M=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<M.length;w+=1)l.text.placedSymbolArray.get(M[w]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},ro.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var h=this.prevPlacement,c=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;var d=h?h.symbolFadeChange(l):1,E=h?h.opacities:{},w=h?h.variableOffsets:{},M=h?h.placedOrientations:{};for(var L in this.placements){var U=this.placements[L],Y=E[L];Y?(this.opacities[L]=new qo(Y,d,U.text,U.icon),c=c||U.text!==Y.text.placed||U.icon!==Y.icon.placed):(this.opacities[L]=new qo(null,d,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(var le in E){var pe=E[le];if(!this.opacities[le]){var ve=new qo(pe,d,!1,!1);ve.isHidden()||(this.opacities[le]=ve,c=c||pe.text.placed||pe.icon.placed)}}for(var Re in w)this.variableOffsets[Re]||!this.opacities[Re]||this.opacities[Re].isHidden()||(this.variableOffsets[Re]=w[Re]);for(var Ie in M)this.placedOrientations[Ie]||!this.opacities[Ie]||this.opacities[Ie].isHidden()||(this.placedOrientations[Ie]=M[Ie]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)},ro.prototype.updateLayerOpacities=function(l,h){for(var c={},d=0,E=h;d<E.length;d+=1){var w=E[d],M=w.getBucket(l);M&&w.latestFeatureIndex&&l.id===M.layerIds[0]&&this.updateBucketOpacities(M,c,w.collisionBoxArray)}},ro.prototype.updateBucketOpacities=function(l,h,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,w=new qo(null,0,!1,!1,!0),M=E.get("text-allow-overlap"),L=E.get("icon-allow-overlap"),U=E.get("text-variable-anchor"),Y=E.get("text-rotation-alignment")==="map",le=E.get("text-pitch-alignment")==="map",pe=E.get("icon-text-fit")!=="none",ve=new qo(null,0,M&&(L||!l.hasIconData()||E.get("icon-optional")),L&&(M||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Re=function(Ge,tt,xt){for(var Ht=0;Ht<tt/4;Ht++)Ge.opacityVertexArray.emplaceBack(xt)},Ie=function(Ge){var tt=l.symbolInstances.get(Ge),xt=tt.numHorizontalGlyphVertices,Ht=tt.numVerticalGlyphVertices,Zt=tt.crossTileID,Jt=d.opacities[Zt];h[Zt]?Jt=w:Jt||(d.opacities[Zt]=Jt=ve),h[Zt]=!0;var mr=tt.numIconVertices>0,Br=d.placedOrientations[tt.crossTileID],kr=Br===m.WritingMode.vertical,un=Br===m.WritingMode.horizontal||Br===m.WritingMode.horizontalOnly;if(xt>0||Ht>0){var Mn=In(Jt.text);Re(l.text,xt,kr?Pi:Mn),Re(l.text,Ht,un?Pi:Mn);var Nn=Jt.text.isHidden();[tt.rightJustifiedTextSymbolIndex,tt.centerJustifiedTextSymbolIndex,tt.leftJustifiedTextSymbolIndex].forEach(function(Yn){Yn>=0&&(l.text.placedSymbolArray.get(Yn).hidden=Nn||kr?1:0)}),tt.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(tt.verticalPlacedTextSymbolIndex).hidden=Nn||un?1:0);var Rn=d.variableOffsets[tt.crossTileID];Rn&&d.markUsedJustification(l,Rn.anchor,tt,Br);var Fi=d.placedOrientations[tt.crossTileID];Fi&&(d.markUsedJustification(l,"left",tt,Fi),d.markUsedOrientation(l,Fi,tt))}if(mr){var ln=In(Jt.icon),oi=!(pe&&tt.verticalPlacedIconSymbolIndex&&kr);tt.placedIconSymbolIndex>=0&&(Re(l.icon,tt.numIconVertices,oi?ln:Pi),l.icon.placedSymbolArray.get(tt.placedIconSymbolIndex).hidden=Jt.icon.isHidden()),tt.verticalPlacedIconSymbolIndex>=0&&(Re(l.icon,tt.numVerticalIconVertices,oi?Pi:ln),l.icon.placedSymbolArray.get(tt.verticalPlacedIconSymbolIndex).hidden=Jt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var si=l.collisionArrays[Ge];if(si){var ni=new m.Point(0,0);if(si.textBox||si.verticalTextBox){var Xn=!0;if(U){var yi=d.variableOffsets[Zt];yi?(ni=to(yi.anchor,yi.width,yi.height,yi.textOffset,yi.textBoxScale),Y&&ni._rotate(le?d.transform.angle:-d.transform.angle)):Xn=!1}si.textBox&&Rs(l.textCollisionBox.collisionVertexArray,Jt.text.placed,!Xn||kr,ni.x,ni.y),si.verticalTextBox&&Rs(l.textCollisionBox.collisionVertexArray,Jt.text.placed,!Xn||un,ni.x,ni.y)}var Kn=Boolean(!un&&si.verticalIconBox);si.iconBox&&Rs(l.iconCollisionBox.collisionVertexArray,Jt.icon.placed,Kn,pe?ni.x:0,pe?ni.y:0),si.verticalIconBox&&Rs(l.iconCollisionBox.collisionVertexArray,Jt.icon.placed,!Kn,pe?ni.x:0,pe?ni.y:0)}}},je=0;je<l.symbolInstances.length;je++)Ie(je);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var we=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=we.invProjMatrix,l.placementViewportMatrix=we.viewportMatrix,l.collisionCircleArray=we.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},ro.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},ro.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},ro.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},ro.prototype.stillRecent=function(l,h){var c=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*c>l},ro.prototype.setStale=function(){this.stale=!0};var Pl=Math.pow(2,25),_s=Math.pow(2,24),ne=Math.pow(2,17),be=Math.pow(2,16),Ke=Math.pow(2,9),Lt=Math.pow(2,8),Rr=Math.pow(2,1);function In(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var h=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Pl+h*_s+c*ne+h*be+c*Ke+h*Lt+c*Rr+h}var Pi=0,so=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};so.prototype.continuePlacement=function(l,h,c,d,E){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(h.getBucketParts(w,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(M,L){return M.sortKey-L.sortKey}));this._currentPartIndex<w.length;)if(h.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var Da=function(l,h,c,d,E,w,M){this.placement=new ro(l,E,w,M),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};Da.prototype.isDone=function(){return this._done},Da.prototype.continuePlacement=function(l,h,c){for(var d=this,E=m.browser.now(),w=function(){var U=m.browser.now()-E;return!d._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var M=h[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=L)&&(!M.maxzoom||M.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new so(M)),this._inProgressLayer.continuePlacement(c[M.source],this.placement,this._showCollisionBoxes,M,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Da.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Ha=512/m.EXTENT/2,Ko=function(l,h,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<h.length;d++){var E=h.get(d),w=E.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};Ko.prototype.getScaledCoordinates=function(l,h){var c=Ha/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*m.EXTENT+l.anchorX)*c),y:Math.floor((h.canonical.y*m.EXTENT+l.anchorY)*c)}},Ko.prototype.findMatches=function(l,h,c){for(var d=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),E=0;E<l.length;E++){var w=l.get(E);if(!w.crossTileID){var M=this.indexedSymbolInstances[w.key];if(M)for(var L=this.getScaledCoordinates(w,h),U=0,Y=M;U<Y.length;U+=1){var le=Y[U];if(Math.abs(le.coord.x-L.x)<=d&&Math.abs(le.coord.y-L.y)<=d&&!c[le.crossTileID]){c[le.crossTileID]=!0,w.crossTileID=le.crossTileID;break}}}}};var xs=function(){this.maxCrossTileID=0};xs.prototype.generate=function(){return++this.maxCrossTileID};var co=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};co.prototype.handleWrapJump=function(l){var h=Math.round((l-this.lng)/360);if(h!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var w in d){var M=d[w];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),E[M.tileID.key]=M}this.indexes[c]=E}this.lng=l},co.prototype.addBucket=function(l,h,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<h.symbolInstances.length;d++)h.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var M=this.indexes[w];if(Number(w)>l.overscaledZ)for(var L in M){var U=M[L];U.tileID.isChildOf(l)&&U.findMatches(h.symbolInstances,l,E)}else{var Y=M[l.scaledTo(Number(w)).key];Y&&Y.findMatches(h.symbolInstances,l,E)}}for(var le=0;le<h.symbolInstances.length;le++){var pe=h.symbolInstances.get(le);pe.crossTileID||(pe.crossTileID=c.generate(),E[pe.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Ko(l,h.symbolInstances,h.bucketInstanceId),!0},co.prototype.removeBucketCrossTileIDs=function(l,h){for(var c in h.indexedSymbolInstances)for(var d=0,E=h.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},co.prototype.removeStaleBuckets=function(l){var h=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],h=!0)}return h};var Oo=function(){this.layerIndexes={},this.crossTileIDs=new xs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Oo.prototype.addLayer=function(l,h,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new co);var E=!1,w={};d.handleWrapJump(c);for(var M=0,L=h;M<L.length;M+=1){var U=L[M],Y=U.getBucket(l);Y&&l.id===Y.layerIds[0]&&(Y.bucketInstanceId||(Y.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(U.tileID,Y,this.crossTileIDs)&&(E=!0),w[Y.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(E=!0),E},Oo.prototype.pruneUnusedLayers=function(l){var h={};for(var c in l.forEach(function(d){h[d]=!0}),this.layerIndexes)h[c]||delete this.layerIndexes[c]};var bs=function(l,h){return m.emitValidationErrors(l,h&&h.filter(function(c){return c.identifier!=="source.canvas"}))},Ls=m.pick(Hr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Zs=m.pick(Hr,["setCenter","setZoom","setBearing","setPitch"]),au=function(){var l={},h=m.styleSpec.$version;for(var c in m.styleSpec.$root){var d,E=m.styleSpec.$root[c];E.required&&(d=c==="version"?h:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),Es=function(l){function h(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Qt(Ot(),this),this.imageManager=new bt,this.imageManager.setEventedParent(this),this.glyphManager=new $t(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Qe(256,512),this.crossTileSymbolIndex=new Oo,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var w=this;this._rtlTextPluginCallback=h.registerForPluginStateChange(function(M){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},function(L,U){if(m.triggerPluginCompletionEvent(L),U&&U.every(function(le){return le}))for(var Y in w.sourceCaches)w.sourceCaches[Y].reload()})}),this.on("data",function(M){if(M.dataType==="source"&&M.sourceDataType==="metadata"){var L=E.sourceCaches[M.sourceId];if(L){var U=L.getSource();if(U&&U.vectorLayerIds)for(var Y in E._layers){var le=E._layers[Y];le.source===U.id&&E._validateLayer(le)}}}})}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var w=typeof d.validate=="boolean"?d.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var M=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(M,function(L,U){E._request=null,L?E.fire(new m.ErrorEvent(L)):U&&E._load(U,w)})},h.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},h.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(au,!1)},h.prototype._load=function(c,d){if(!d||!bs(this,m.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=Zr(this.stylesheet.layers);this._order=w.map(function(Y){return Y.id}),this._layers={},this._serializedLayers={};for(var M=0,L=w;M<L.length;M+=1){var U=L[M];(U=m.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new wt(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},h.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,w,M){var L,U,Y,le=m.browser.devicePixelRatio>1?"@2x":"",pe=m.getJSON(w.transformRequest(w.normalizeSpriteURL(E,le,".json"),m.ResourceType.SpriteJSON),function(Ie,je){pe=null,Y||(Y=Ie,L=je,Re())}),ve=m.getImage(w.transformRequest(w.normalizeSpriteURL(E,le,".png"),m.ResourceType.SpriteImage),function(Ie,je){ve=null,Y||(Y=Ie,U=je,Re())});function Re(){if(Y)M(Y);else if(L&&U){var Ie=m.browser.getImageData(U),je={};for(var we in L){var Ge=L[we],tt=Ge.width,xt=Ge.height,Ht=Ge.x,Zt=Ge.y,Jt=Ge.sdf,mr=Ge.pixelRatio,Br=Ge.stretchX,kr=Ge.stretchY,un=Ge.content,Mn=new m.RGBAImage({width:tt,height:xt});m.RGBAImage.copy(Ie,Mn,{x:Ht,y:Zt},{x:0,y:0},{width:tt,height:xt}),je[we]={data:Mn,pixelRatio:mr,sdf:Jt,stretchX:Br,stretchY:kr,content:un}}M(null,je)}}return{cancel:function(){pe&&(pe.cancel(),pe=null),ve&&(ve.cancel(),ve=null)}}}(c,this.map._requestManager,function(E,w){if(d._spriteRequest=null,E)d.fire(new m.ErrorEvent(E));else if(w)for(var M in w)d.imageManager.addImage(M,w[M]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new m.Event("data",{dataType:"style"}))})},h.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(E)===-1)&&this.fire(new m.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},h.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},h.prototype._serializeLayers=function(c){for(var d=[],E=0,w=c;E<w.length;E+=1){var M=this._layers[w[E]];M.type!=="custom"&&d.push(M.serialize())}return d},h.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},h.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},h.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var M in(E.length||w.length)&&this._updateWorkerLayers(E,w),this._updatedSources){var L=this._updatedSources[M];L==="reload"?this._reloadSource(M):L==="clear"&&this._clearSource(M)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var Y={};for(var le in this.sourceCaches){var pe=this.sourceCaches[le];Y[le]=pe.used,pe.used=!1}for(var ve=0,Re=this._order;ve<Re.length;ve+=1){var Ie=this._layers[Re[ve]];Ie.recalculate(c,this._availableImages),!Ie.isHidden(c.zoom)&&Ie.source&&(this.sourceCaches[Ie.source].used=!0)}for(var je in Y){var we=this.sourceCaches[je];Y[je]!==we.used&&we.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:je}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new m.Event("data",{dataType:"style"}))}},h.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},h.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},h.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},h.prototype.setState=function(c){var d=this;if(this._checkLoaded(),bs(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=Zr(c.layers);var E=function(M,L){if(!M)return[{command:Hr.setStyle,args:[L]}];var U=[];try{if(!m.deepEqual(M.version,L.version))return[{command:Hr.setStyle,args:[L]}];m.deepEqual(M.center,L.center)||U.push({command:Hr.setCenter,args:[L.center]}),m.deepEqual(M.zoom,L.zoom)||U.push({command:Hr.setZoom,args:[L.zoom]}),m.deepEqual(M.bearing,L.bearing)||U.push({command:Hr.setBearing,args:[L.bearing]}),m.deepEqual(M.pitch,L.pitch)||U.push({command:Hr.setPitch,args:[L.pitch]}),m.deepEqual(M.sprite,L.sprite)||U.push({command:Hr.setSprite,args:[L.sprite]}),m.deepEqual(M.glyphs,L.glyphs)||U.push({command:Hr.setGlyphs,args:[L.glyphs]}),m.deepEqual(M.transition,L.transition)||U.push({command:Hr.setTransition,args:[L.transition]}),m.deepEqual(M.light,L.light)||U.push({command:Hr.setLight,args:[L.light]});var Y={},le=[];(function(ve,Re,Ie,je){var we;for(we in Re=Re||{},ve=ve||{})ve.hasOwnProperty(we)&&(Re.hasOwnProperty(we)||rn(we,Ie,je));for(we in Re)Re.hasOwnProperty(we)&&(ve.hasOwnProperty(we)?m.deepEqual(ve[we],Re[we])||(ve[we].type==="geojson"&&Re[we].type==="geojson"&&Wi(ve,Re,we)?Ie.push({command:Hr.setGeoJSONSourceData,args:[we,Re[we].data]}):nn(we,Re,Ie,je)):gi(we,Re,Ie))})(M.sources,L.sources,le,Y);var pe=[];M.layers&&M.layers.forEach(function(ve){Y[ve.source]?U.push({command:Hr.removeLayer,args:[ve.id]}):pe.push(ve)}),U=U.concat(le),function(ve,Re,Ie){Re=Re||[];var je,we,Ge,tt,xt,Ht,Zt,Jt=(ve=ve||[]).map(Ti),mr=Re.map(Ti),Br=ve.reduce(_i,{}),kr=Re.reduce(_i,{}),un=Jt.slice(),Mn=Object.create(null);for(je=0,we=0;je<Jt.length;je++)kr.hasOwnProperty(Ge=Jt[je])?we++:(Ie.push({command:Hr.removeLayer,args:[Ge]}),un.splice(un.indexOf(Ge,we),1));for(je=0,we=0;je<mr.length;je++)un[un.length-1-je]!==(Ge=mr[mr.length-1-je])&&(Br.hasOwnProperty(Ge)?(Ie.push({command:Hr.removeLayer,args:[Ge]}),un.splice(un.lastIndexOf(Ge,un.length-we),1)):we++,Ie.push({command:Hr.addLayer,args:[kr[Ge],Ht=un[un.length-je]]}),un.splice(un.length-je,0,Ge),Mn[Ge]=!0);for(je=0;je<mr.length;je++)if(tt=Br[Ge=mr[je]],xt=kr[Ge],!Mn[Ge]&&!m.deepEqual(tt,xt))if(m.deepEqual(tt.source,xt.source)&&m.deepEqual(tt["source-layer"],xt["source-layer"])&&m.deepEqual(tt.type,xt.type)){for(Zt in vi(tt.layout,xt.layout,Ie,Ge,null,Hr.setLayoutProperty),vi(tt.paint,xt.paint,Ie,Ge,null,Hr.setPaintProperty),m.deepEqual(tt.filter,xt.filter)||Ie.push({command:Hr.setFilter,args:[Ge,xt.filter]}),m.deepEqual(tt.minzoom,xt.minzoom)&&m.deepEqual(tt.maxzoom,xt.maxzoom)||Ie.push({command:Hr.setLayerZoomRange,args:[Ge,xt.minzoom,xt.maxzoom]}),tt)tt.hasOwnProperty(Zt)&&Zt!=="layout"&&Zt!=="paint"&&Zt!=="filter"&&Zt!=="metadata"&&Zt!=="minzoom"&&Zt!=="maxzoom"&&(Zt.indexOf("paint.")===0?vi(tt[Zt],xt[Zt],Ie,Ge,Zt.slice(6),Hr.setPaintProperty):m.deepEqual(tt[Zt],xt[Zt])||Ie.push({command:Hr.setLayerProperty,args:[Ge,Zt,xt[Zt]]}));for(Zt in xt)xt.hasOwnProperty(Zt)&&!tt.hasOwnProperty(Zt)&&Zt!=="layout"&&Zt!=="paint"&&Zt!=="filter"&&Zt!=="metadata"&&Zt!=="minzoom"&&Zt!=="maxzoom"&&(Zt.indexOf("paint.")===0?vi(tt[Zt],xt[Zt],Ie,Ge,Zt.slice(6),Hr.setPaintProperty):m.deepEqual(tt[Zt],xt[Zt])||Ie.push({command:Hr.setLayerProperty,args:[Ge,Zt,xt[Zt]]}))}else Ie.push({command:Hr.removeLayer,args:[Ge]}),Ht=un[un.lastIndexOf(Ge)+1],Ie.push({command:Hr.addLayer,args:[xt,Ht]})}(pe,L.layers,U)}catch(ve){console.warn("Unable to compute style diff:",ve),U=[{command:Hr.setStyle,args:[L]}]}return U}(this.serialize(),c).filter(function(M){return!(M.command in Zs)});if(E.length===0)return!1;var w=E.filter(function(M){return!(M.command in Ls)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(M){return M.command}).join(", ")+".");return E.forEach(function(M){M.command!=="setTransition"&&d[M.command].apply(d,M.args)}),this.stylesheet=c,!0},h.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},h.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},h.prototype.getImage=function(c){return this.imageManager.getImage(c)},h.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},h.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},h.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},h.prototype.addSource=function(c,d,E){var w=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(m.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var M=this.sourceCaches[c]=new ke(c,d,this.dispatcher);M.style=this,M.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:M.serialize(),sourceId:c}}),M.onAdd(this.map),this._changed=!0}},h.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new m.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},h.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},h.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},h.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new m.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var M;if(c.type==="custom"){if(bs(this,m.validateCustomStyleLayer(c)))return;M=m.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=m.clone$1(c),c=m.extend(c,{source:w})),this._validate(m.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},E))return;M=m.createStyleLayer(c),this._validateLayer(M),M.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[M.id]=M.serialize()}var L=d?this._order.indexOf(d):this._order.length;if(d&&L===-1)this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(L,0,w),this._layerOrderChanged=!0,this._layers[w]=M,this._removedLayers[w]&&M.source&&M.type!=="custom"){var U=this._removedLayers[w];delete this._removedLayers[w],U.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",this.sourceCaches[M.source].pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map)}}},h.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},h.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},h.prototype.getLayer=function(c){return this._layers[c]},h.prototype.hasLayer=function(c){return c in this._layers},h.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===d&&w.maxzoom===E||(d!=null&&(w.minzoom=d),E!=null&&(w.maxzoom=E),this._updateLayer(w)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},h.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!m.deepEqual(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(m.validateStyle.filter,"layers."+w.id+".filter",d,null,E)||(w.filter=m.clone$1(d),this._updateLayer(w)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},h.prototype.getFilter=function(c){return m.clone$1(this.getLayer(c).filter)},h.prototype.setLayoutProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var M=this.getLayer(c);M?m.deepEqual(M.getLayoutProperty(d),E)||(M.setLayoutProperty(d,E,w),this._updateLayer(M)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},h.prototype.setPaintProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var M=this.getLayer(c);M?m.deepEqual(M.getPaintProperty(d),E)||(M.setPaintProperty(d,E,w)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},h.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=c.sourceLayer,M=this.sourceCaches[E];if(M!==void 0){var L=M.getSource().type;L==="geojson"&&w?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||w?(c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),M.setFeatureState(w,c.id,d)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},h.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=this.sourceCaches[E];if(w!==void 0){var M=w.getSource().type,L=M==="vector"?c.sourceLayer:void 0;M!=="vector"||L?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(L,c.id,d):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},h.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,w=this.sourceCaches[d];if(w!==void 0){if(w.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(E,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},h.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},h.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},h.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},h.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(Br){return d._layers[Br].type==="fill-extrusion"},w={},M=[],L=this._order.length-1;L>=0;L--){var U=this._order[L];if(E(U)){w[U]=L;for(var Y=0,le=c;Y<le.length;Y+=1){var pe=le[Y][U];if(pe)for(var ve=0,Re=pe;ve<Re.length;ve+=1)M.push(Re[ve])}}}M.sort(function(Br,kr){return kr.intersectionZ-Br.intersectionZ});for(var Ie=[],je=this._order.length-1;je>=0;je--){var we=this._order[je];if(E(we))for(var Ge=M.length-1;Ge>=0;Ge--){var tt=M[Ge].feature;if(w[tt.layer.id]<je)break;Ie.push(tt),M.pop()}else for(var xt=0,Ht=c;xt<Ht.length;xt+=1){var Zt=Ht[xt][we];if(Zt)for(var Jt=0,mr=Zt;Jt<mr.length;Jt+=1)Ie.push(mr[Jt].feature)}}return Ie},h.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var M=0,L=d.layers;M<L.length;M+=1){var U=L[M],Y=this._layers[U];if(!Y)return this.fire(new m.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];w[Y.source]=!0}}var le=[];for(var pe in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!w[pe]||le.push(vn(this.sourceCaches[pe],this._layers,this._serializedLayers,c,d,E));return this.placement&&le.push(function(ve,Re,Ie,je,we,Ge,tt){for(var xt={},Ht=Ge.queryRenderedSymbols(je),Zt=[],Jt=0,mr=Object.keys(Ht).map(Number);Jt<mr.length;Jt+=1)Zt.push(tt[mr[Jt]]);Zt.sort(fi);for(var Br=function(){var Rn=un[kr],Fi=Rn.featureIndex.lookupSymbolFeatures(Ht[Rn.bucketInstanceId],Re,Rn.bucketIndex,Rn.sourceLayerIndex,we.filter,we.layers,we.availableImages,ve);for(var ln in Fi){var oi=xt[ln]=xt[ln]||[],si=Fi[ln];si.sort(function(yi,Kn){var Yn=Rn.featureSortOrder;if(Yn){var Co=Yn.indexOf(yi.featureIndex);return Yn.indexOf(Kn.featureIndex)-Co}return Kn.featureIndex-yi.featureIndex});for(var ni=0,Xn=si;ni<Xn.length;ni+=1)oi.push(Xn[ni])}},kr=0,un=Zt;kr<un.length;kr+=1)Br();var Mn=function(Rn){xt[Rn].forEach(function(Fi){var ln=Fi.feature,oi=Ie[ve[Rn].source].getFeatureState(ln.layer["source-layer"],ln.id);ln.source=ln.layer.source,ln.layer["source-layer"]&&(ln.sourceLayer=ln.layer["source-layer"]),ln.state=oi})};for(var Nn in xt)Mn(Nn);return xt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(le)},h.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(w,M){for(var L=w.getRenderableIds().map(function(Re){return w.getTileByID(Re)}),U=[],Y={},le=0;le<L.length;le++){var pe=L[le],ve=pe.tileID.canonical.key;Y[ve]||(Y[ve]=!0,pe.querySourceFeatures(U,M))}return U}(E,d):[]},h.prototype.addSourceType=function(c,d,E){return h.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(h.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},h.prototype.getLight=function(){return this.light.getLight()},h.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),w=!1;for(var M in c)if(!m.deepEqual(c[M],E[M])){w=!0;break}if(w){var L={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(L)}},h.prototype._validate=function(c,d,E,w,M){return M===void 0&&(M={}),(!M||M.validate!==!1)&&bs(this,c.call(m.validateStyle,m.extend({key:d,style:this.serialize(),value:E,styleSpec:m.styleSpec},w)))},h.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},h.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},h.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},h.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},h.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},h.prototype._updatePlacement=function(c,d,E,w,M){M===void 0&&(M=!1);for(var L=!1,U=!1,Y={},le=0,pe=this._order;le<pe.length;le+=1){var ve=this._layers[pe[le]];if(ve.type==="symbol"){if(!Y[ve.source]){var Re=this.sourceCaches[ve.source];Y[ve.source]=Re.getRenderableIds(!0).map(function(tt){return Re.getTileByID(tt)}).sort(function(tt,xt){return xt.tileID.overscaledZ-tt.tileID.overscaledZ||(tt.tileID.isLessThan(xt.tileID)?-1:1)})}var Ie=this.crossTileSymbolIndex.addLayer(ve,Y[ve.source],c.center.lng);L=L||Ie}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((M=M||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),c.zoom))&&(this.pauseablePlacement=new Da(c,this._order,M,d,E,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),U=!0),L&&this.pauseablePlacement.placement.setStale()),U||L)for(var je=0,we=this._order;je<we.length;je+=1){var Ge=this._layers[we[je]];Ge.type==="symbol"&&this.placement.updateLayerOpacities(Ge,Y[Ge.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},h.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},h.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)},h.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},h.prototype.getResource=function(c,d,E){return m.makeRequest(d,E)},h}(m.Evented);Es.getSourceType=function(l){return Cr[l]},Es.setSourceType=function(l,h){Cr[l]=h},Es.registerForPluginStateChange=m.registerForPluginStateChange;var ba=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ca=Hi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),fs=Hi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),of=Hi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Il=Hi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),qs=Hi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ac=Hi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Ju=Hi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ks=Hi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),pl=Hi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),P=Hi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),F=Hi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=Hi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),K=Hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),xe=Hi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),We=Hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),pt=Hi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),dt=Hi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),sr=Hi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),cr=Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Pn=Hi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ai=Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),kn=Hi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Xi=Hi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ga=Hi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),wa=Hi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Hi(l,h){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=h.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=w?w.concat(E):E,L={};return{fragmentSource:l=l.replace(c,function(U,Y,le,pe,ve){return L[ve]=!0,Y==="define"?`
#ifndef HAS_UNIFORM_u_`+ve+`
varying `+le+" "+pe+" "+ve+`;
#else
uniform `+le+" "+pe+" u_"+ve+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+ve+`
    `+le+" "+pe+" "+ve+" = u_"+ve+`;
#endif
`}),vertexSource:h=h.replace(c,function(U,Y,le,pe,ve){var Re=pe==="float"?"vec2":"vec4",Ie=ve.match(/color/)?"color":Re;return L[ve]?Y==="define"?`
#ifndef HAS_UNIFORM_u_`+ve+`
uniform lowp float u_`+ve+`_t;
attribute `+le+" "+Re+" a_"+ve+`;
varying `+le+" "+pe+" "+ve+`;
#else
uniform `+le+" "+pe+" u_"+ve+`;
#endif
`:Ie==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ve+`
    `+ve+" = a_"+ve+`;
#else
    `+le+" "+pe+" "+ve+" = u_"+ve+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ve+`
    `+ve+" = unpack_mix_"+Ie+"(a_"+ve+", u_"+ve+`_t);
#else
    `+le+" "+pe+" "+ve+" = u_"+ve+`;
#endif
`:Y==="define"?`
#ifndef HAS_UNIFORM_u_`+ve+`
uniform lowp float u_`+ve+`_t;
attribute `+le+" "+Re+" a_"+ve+`;
#else
uniform `+le+" "+pe+" u_"+ve+`;
#endif
`:Ie==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ve+`
    `+le+" "+pe+" "+ve+" = a_"+ve+`;
#else
    `+le+" "+pe+" "+ve+" = u_"+ve+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ve+`
    `+le+" "+pe+" "+ve+" = unpack_mix_"+Ie+"(a_"+ve+", u_"+ve+`_t);
#else
    `+le+" "+pe+" "+ve+" = u_"+ve+`;
#endif
`}),staticAttributes:d,staticUniforms:M}}var Ss=Object.freeze({__proto__:null,prelude:Ca,background:fs,backgroundPattern:of,circle:Il,clippingMask:qs,heatmap:ac,heatmapTexture:Ju,collisionBox:Ks,collisionCircle:pl,debug:_,fill:P,fillOutline:F,fillOutlinePattern:R,fillPattern:K,fillExtrusion:xe,fillExtrusionPattern:We,hillshadePrepare:pt,hillshade:dt,line:sr,lineGradient:cr,linePattern:Pn,lineSDF:ai,raster:kn,symbolIcon:Xi,symbolSDF:ga,symbolTextAndIcon:wa}),ou=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function el(l){for(var h=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");h.push(d.pop())}return h}ou.prototype.bind=function(l,h,c,d,E,w,M,L){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==d.length,Y=0;!U&&Y<d.length;Y++)this.boundPaintVertexBuffers[Y]!==d[Y]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===c&&!U&&this.boundIndexBuffer===E&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),M&&M.bind(),E&&E.dynamicDraw&&E.bind(),L&&L.bind()):this.freshBind(h,c,d,E,w,M,L)},ou.prototype.freshBind=function(l,h,c,d,E,w,M){var L,U=l.numAttributes,Y=this.context,le=Y.gl;if(Y.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Y.extVertexArrayObject.createVertexArrayOES(),Y.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=M;else{L=Y.currentNumAttributes||0;for(var pe=U;pe<L;pe++)le.disableVertexAttribArray(pe)}h.enableAttributes(le,l);for(var ve=0,Re=c;ve<Re.length;ve+=1)Re[ve].enableAttributes(le,l);w&&w.enableAttributes(le,l),M&&M.enableAttributes(le,l),h.bind(),h.setVertexAttribPointers(le,l,E);for(var Ie=0,je=c;Ie<je.length;Ie+=1){var we=je[Ie];we.bind(),we.setVertexAttribPointers(le,l,E)}w&&(w.bind(),w.setVertexAttribPointers(le,l,E)),d&&d.bind(),M&&(M.bind(),M.setVertexAttribPointers(le,l,E)),Y.currentNumAttributes=U},ou.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var sf=function(l,h,c,d,E,w){var M=l.gl;this.program=M.createProgram();for(var L=el(c.staticAttributes),U=d?d.getBinderAttributes():[],Y=L.concat(U),le=c.staticUniforms?el(c.staticUniforms):[],pe=d?d.getBinderUniforms():[],ve=[],Re=0,Ie=le.concat(pe);Re<Ie.length;Re+=1){var je=Ie[Re];ve.indexOf(je)<0&&ve.push(je)}var we=d?d.defines():[];w&&we.push("#define OVERDRAW_INSPECTOR;");var Ge=we.concat(Ca.fragmentSource,c.fragmentSource).join(`
`),tt=we.concat(Ca.vertexSource,c.vertexSource).join(`
`),xt=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(xt,Ge),M.compileShader(xt),M.attachShader(this.program,xt);var Ht=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(Ht,tt),M.compileShader(Ht),M.attachShader(this.program,Ht),this.attributes={};var Zt={};this.numAttributes=Y.length;for(var Jt=0;Jt<this.numAttributes;Jt++)Y[Jt]&&(M.bindAttribLocation(this.program,Jt,Y[Jt]),this.attributes[Y[Jt]]=Jt);M.linkProgram(this.program),M.deleteShader(Ht),M.deleteShader(xt);for(var mr=0;mr<ve.length;mr++){var Br=ve[mr];if(Br&&!Zt[Br]){var kr=M.getUniformLocation(this.program,Br);kr&&(Zt[Br]=kr)}}this.fixedUniforms=E(l,Zt),this.binderUniforms=d?d.getUniforms(l,Zt):[]}}};function dl(l,h,c){var d=1/oa(c,1,h.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,h.transform.tileZoom)/E,M=w*(c.tileID.canonical.x+c.tileID.wrap*E),L=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[M>>16,L>>16],u_pixel_coord_lower:[65535&M,65535&L]}}sf.prototype.draw=function(l,h,c,d,E,w,M,L,U,Y,le,pe,ve,Re,Ie,je){var we,Ge=l.gl;if(!this.failedToCreate){for(var tt in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[tt].set(M[tt]);Re&&Re.setUniforms(l,this.binderUniforms,pe,{zoom:ve});for(var xt=(we={},we[Ge.LINES]=2,we[Ge.TRIANGLES]=3,we[Ge.LINE_STRIP]=1,we)[h],Ht=0,Zt=le.get();Ht<Zt.length;Ht+=1){var Jt=Zt[Ht],mr=Jt.vaos||(Jt.vaos={});(mr[L]||(mr[L]=new ou)).bind(l,this,U,Re?Re.getPaintVertexBuffers():[],Y,Jt.vertexOffset,Ie,je),Ge.drawElements(h,Jt.primitiveLength*xt,Ge.UNSIGNED_SHORT,Jt.primitiveOffset*xt*2)}}};var Dc=function(l,h,c,d){var E=h.style.light,w=E.properties.get("position"),M=[w.x,w.y,w.z],L=m.create$1();E.properties.get("anchor")==="viewport"&&m.fromRotation(L,-h.transform.angle),m.transformMat3(M,M,L);var U=E.properties.get("color");return{u_matrix:l,u_lightpos:M,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+c,u_opacity:d}},Fu=function(l,h,c,d,E,w,M){return m.extend(Dc(l,h,c,d),dl(w,h,M),{u_height_factor:-Math.pow(2,E.overscaledZ)/M.tileSize/8})},Bu=function(l){return{u_matrix:l}},Nu=function(l,h,c,d){return m.extend(Bu(l),dl(c,h,d))},fo=function(l,h){return{u_matrix:l,u_world:h}},zf=function(l,h,c,d,E){return m.extend(Nu(l,h,c,d),{u_world:E})},Uf=function(l,h,c,d){var E,w,M=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var L=oa(c,1,M.zoom);E=!0,w=[L,L]}else E=!1,w=M.pixelsToGLUnits;return{u_camera_to_center_distance:M.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(h.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:w}},is=function(l,h,c){var d=oa(c,1,h.zoom),E=Math.pow(2,h.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[h.pixelsToGLUnits[0]/(d*E),h.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:w}},Fc=function(l,h,c){return{u_matrix:l,u_inv_matrix:h,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},zu=function(l,h,c){return c===void 0&&(c=1),{u_matrix:l,u_color:h,u_overlay:0,u_overlay_scale:c}},su=function(l){return{u_matrix:l}},uf=function(l,h,c,d){return{u_matrix:l,u_extrude_scale:oa(h,1,c),u_intensity:d}},Ol=function(l,h,c){var d=l.transform;return{u_matrix:Bc(l,h,c),u_ratio:1/oa(h,1,d.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Di=function(l,h,c,d){return m.extend(Ol(l,h,c),{u_image:0,u_image_height:d})},Rl=function(l,h,c,d){var E=l.transform,w=vl(h,E);return{u_matrix:Bc(l,h,c),u_texsize:h.imageAtlasTexture.size,u_ratio:1/oa(h,1,E.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},bh=function(l,h,c,d,E){var w=l.lineAtlas,M=vl(h,l.transform),L=c.layout.get("line-cap")==="round",U=w.getDash(d.from,L),Y=w.getDash(d.to,L),le=U.width*E.fromScale,pe=Y.width*E.toScale;return m.extend(Ol(l,h,c),{u_patternscale_a:[M/le,-U.height/2],u_patternscale_b:[M/pe,-Y.height/2],u_sdfgamma:w.width/(256*Math.min(le,pe)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:Y.y,u_mix:E.t})};function vl(l,h){return 1/oa(l,1,h.tileZoom)}function Bc(l,h,c){return l.translatePosMatrix(h.tileID.posMatrix,h,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Zf=function(l,h,c,d,E){return{u_matrix:l,u_tl_parent:h,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(M=E.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(w=E.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Eh(E.paint.get("raster-hue-rotate"))};var w,M};function Eh(l){l*=Math.PI/180;var h=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*h-c+1)/3,(Math.sqrt(3)*h-c+1)/3]}var jf,Nc=function(l,h,c,d,E,w,M,L,U,Y){var le=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:le.cameraToCenterDistance,u_pitch:le.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:le.width/le.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:M,u_coord_matrix:L,u_is_text:+U,u_pitch_with_map:+d,u_texsize:Y,u_texture:0}},oc=function(l,h,c,d,E,w,M,L,U,Y,le){var pe=E.transform;return m.extend(Nc(l,h,c,d,E,w,M,L,U,Y),{u_gamma_scale:d?Math.cos(pe._pitch)*pe.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+le})},sc=function(l,h,c,d,E,w,M,L,U,Y){return m.extend(oc(l,h,c,d,E,w,M,L,!0,U,!0),{u_texsize_icon:Y,u_texture_icon:1})},Ll=function(l,h,c){return{u_matrix:l,u_opacity:h,u_color:c}},ml=function(l,h,c,d,E,w){return m.extend(function(M,L,U,Y){var le=U.imageManager.getPattern(M.from.toString()),pe=U.imageManager.getPattern(M.to.toString()),ve=U.imageManager.getPixelSize(),Re=ve.width,Ie=ve.height,je=Math.pow(2,Y.tileID.overscaledZ),we=Y.tileSize*Math.pow(2,U.transform.tileZoom)/je,Ge=we*(Y.tileID.canonical.x+Y.tileID.wrap*je),tt=we*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:le.tl,u_pattern_br_a:le.br,u_pattern_tl_b:pe.tl,u_pattern_br_b:pe.br,u_texsize:[Re,Ie],u_mix:L.t,u_pattern_size_a:le.displaySize,u_pattern_size_b:pe.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/oa(Y,1,U.transform.tileZoom),u_pixel_coord_upper:[Ge>>16,tt>>16],u_pixel_coord_lower:[65535&Ge,65535&tt]}}(d,w,c,E),{u_matrix:l,u_opacity:h})},kl={fillExtrusion:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_lightpos:new m.Uniform3f(l,h.u_lightpos),u_lightintensity:new m.Uniform1f(l,h.u_lightintensity),u_lightcolor:new m.Uniform3f(l,h.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,h.u_vertical_gradient),u_opacity:new m.Uniform1f(l,h.u_opacity)}},fillExtrusionPattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_lightpos:new m.Uniform3f(l,h.u_lightpos),u_lightintensity:new m.Uniform1f(l,h.u_lightintensity),u_lightcolor:new m.Uniform3f(l,h.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,h.u_vertical_gradient),u_height_factor:new m.Uniform1f(l,h.u_height_factor),u_image:new m.Uniform1i(l,h.u_image),u_texsize:new m.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,h.u_scale),u_fade:new m.Uniform1f(l,h.u_fade),u_opacity:new m.Uniform1f(l,h.u_opacity)}},fill:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix)}},fillPattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_image:new m.Uniform1i(l,h.u_image),u_texsize:new m.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,h.u_scale),u_fade:new m.Uniform1f(l,h.u_fade)}},fillOutline:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_world:new m.Uniform2f(l,h.u_world)}},fillOutlinePattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_world:new m.Uniform2f(l,h.u_world),u_image:new m.Uniform1i(l,h.u_image),u_texsize:new m.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,h.u_scale),u_fade:new m.Uniform1f(l,h.u_fade)}},circle:function(l,h){return{u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(l,h.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(l,h.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(l,h.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(l,h.u_matrix)}},collisionBox:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(l,h.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(l,h.u_extrude_scale),u_overscale_factor:new m.Uniform1f(l,h.u_overscale_factor)}},collisionCircle:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_inv_matrix:new m.UniformMatrix4f(l,h.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(l,h.u_viewport_size)}},debug:function(l,h){return{u_color:new m.UniformColor(l,h.u_color),u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_overlay:new m.Uniform1i(l,h.u_overlay),u_overlay_scale:new m.Uniform1f(l,h.u_overlay_scale)}},clippingMask:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix)}},heatmap:function(l,h){return{u_extrude_scale:new m.Uniform1f(l,h.u_extrude_scale),u_intensity:new m.Uniform1f(l,h.u_intensity),u_matrix:new m.UniformMatrix4f(l,h.u_matrix)}},heatmapTexture:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_world:new m.Uniform2f(l,h.u_world),u_image:new m.Uniform1i(l,h.u_image),u_color_ramp:new m.Uniform1i(l,h.u_color_ramp),u_opacity:new m.Uniform1f(l,h.u_opacity)}},hillshade:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_image:new m.Uniform1i(l,h.u_image),u_latrange:new m.Uniform2f(l,h.u_latrange),u_light:new m.Uniform2f(l,h.u_light),u_shadow:new m.UniformColor(l,h.u_shadow),u_highlight:new m.UniformColor(l,h.u_highlight),u_accent:new m.UniformColor(l,h.u_accent)}},hillshadePrepare:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_image:new m.Uniform1i(l,h.u_image),u_dimension:new m.Uniform2f(l,h.u_dimension),u_zoom:new m.Uniform1f(l,h.u_zoom),u_unpack:new m.Uniform4f(l,h.u_unpack)}},line:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_ratio:new m.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,h.u_units_to_pixels)}},lineGradient:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_ratio:new m.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,h.u_units_to_pixels),u_image:new m.Uniform1i(l,h.u_image),u_image_height:new m.Uniform1f(l,h.u_image_height)}},linePattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_texsize:new m.Uniform2f(l,h.u_texsize),u_ratio:new m.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_image:new m.Uniform1i(l,h.u_image),u_units_to_pixels:new m.Uniform2f(l,h.u_units_to_pixels),u_scale:new m.Uniform3f(l,h.u_scale),u_fade:new m.Uniform1f(l,h.u_fade)}},lineSDF:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_ratio:new m.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,h.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(l,h.u_patternscale_a),u_patternscale_b:new m.Uniform2f(l,h.u_patternscale_b),u_sdfgamma:new m.Uniform1f(l,h.u_sdfgamma),u_image:new m.Uniform1i(l,h.u_image),u_tex_y_a:new m.Uniform1f(l,h.u_tex_y_a),u_tex_y_b:new m.Uniform1f(l,h.u_tex_y_b),u_mix:new m.Uniform1f(l,h.u_mix)}},raster:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_tl_parent:new m.Uniform2f(l,h.u_tl_parent),u_scale_parent:new m.Uniform1f(l,h.u_scale_parent),u_buffer_scale:new m.Uniform1f(l,h.u_buffer_scale),u_fade_t:new m.Uniform1f(l,h.u_fade_t),u_opacity:new m.Uniform1f(l,h.u_opacity),u_image0:new m.Uniform1i(l,h.u_image0),u_image1:new m.Uniform1i(l,h.u_image1),u_brightness_low:new m.Uniform1f(l,h.u_brightness_low),u_brightness_high:new m.Uniform1f(l,h.u_brightness_high),u_saturation_factor:new m.Uniform1f(l,h.u_saturation_factor),u_contrast_factor:new m.Uniform1f(l,h.u_contrast_factor),u_spin_weights:new m.Uniform3f(l,h.u_spin_weights)}},symbolIcon:function(l,h){return{u_is_size_zoom_constant:new m.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,h.u_size_t),u_size:new m.Uniform1f(l,h.u_size),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,h.u_pitch),u_rotate_symbol:new m.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,h.u_fade_change),u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new m.Uniform1i(l,h.u_is_text),u_pitch_with_map:new m.Uniform1i(l,h.u_pitch_with_map),u_texsize:new m.Uniform2f(l,h.u_texsize),u_texture:new m.Uniform1i(l,h.u_texture)}},symbolSDF:function(l,h){return{u_is_size_zoom_constant:new m.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,h.u_size_t),u_size:new m.Uniform1f(l,h.u_size),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,h.u_pitch),u_rotate_symbol:new m.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,h.u_fade_change),u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new m.Uniform1i(l,h.u_is_text),u_pitch_with_map:new m.Uniform1i(l,h.u_pitch_with_map),u_texsize:new m.Uniform2f(l,h.u_texsize),u_texture:new m.Uniform1i(l,h.u_texture),u_gamma_scale:new m.Uniform1f(l,h.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,h.u_is_halo)}},symbolTextAndIcon:function(l,h){return{u_is_size_zoom_constant:new m.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,h.u_size_t),u_size:new m.Uniform1f(l,h.u_size),u_camera_to_center_distance:new m.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,h.u_pitch),u_rotate_symbol:new m.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,h.u_fade_change),u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new m.Uniform1i(l,h.u_is_text),u_pitch_with_map:new m.Uniform1i(l,h.u_pitch_with_map),u_texsize:new m.Uniform2f(l,h.u_texsize),u_texsize_icon:new m.Uniform2f(l,h.u_texsize_icon),u_texture:new m.Uniform1i(l,h.u_texture),u_texture_icon:new m.Uniform1i(l,h.u_texture_icon),u_gamma_scale:new m.Uniform1f(l,h.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,h.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,h.u_is_halo)}},background:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_opacity:new m.Uniform1f(l,h.u_opacity),u_color:new m.UniformColor(l,h.u_color)}},backgroundPattern:function(l,h){return{u_matrix:new m.UniformMatrix4f(l,h.u_matrix),u_opacity:new m.Uniform1f(l,h.u_opacity),u_image:new m.Uniform1i(l,h.u_image),u_pattern_tl_a:new m.Uniform2f(l,h.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(l,h.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(l,h.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(l,h.u_pattern_br_b),u_texsize:new m.Uniform2f(l,h.u_texsize),u_mix:new m.Uniform1f(l,h.u_mix),u_pattern_size_a:new m.Uniform2f(l,h.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(l,h.u_pattern_size_b),u_scale_a:new m.Uniform1f(l,h.u_scale_a),u_scale_b:new m.Uniform1f(l,h.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,h.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(l,h.u_tile_units_to_pixels)}}};function tl(l,h,c,d,E,w,M){for(var L=l.context,U=L.gl,Y=l.useProgram("collisionBox"),le=[],pe=0,ve=0,Re=0;Re<d.length;Re++){var Ie=d[Re],je=h.getTile(Ie),we=je.getBucket(c);if(we){var Ge=Ie.posMatrix;E[0]===0&&E[1]===0||(Ge=l.translatePosMatrix(Ie.posMatrix,je,E,w));var tt=M?we.textCollisionBox:we.iconCollisionBox,xt=we.collisionCircleArray;if(xt.length>0){var Ht=m.create(),Zt=Ge;m.mul(Ht,we.placementInvProjMatrix,l.transform.glCoordMatrix),m.mul(Ht,Ht,we.placementViewportMatrix),le.push({circleArray:xt,circleOffset:ve,transform:Zt,invTransform:Ht}),ve=pe+=xt.length/4}tt&&Y.draw(L,U.LINES,ye.disabled,Pe.disabled,l.colorModeForRenderPass(),rt.disabled,is(Ge,l.transform,je),c.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,null,l.transform.zoom,null,null,tt.collisionVertexBuffer)}}if(M&&le.length){var Jt=l.useProgram("collisionCircle"),mr=new m.StructArrayLayout2f1f2i16;mr.resize(4*pe),mr._trim();for(var Br=0,kr=0,un=le;kr<un.length;kr+=1)for(var Mn=un[kr],Nn=0;Nn<Mn.circleArray.length/4;Nn++){var Rn=4*Nn,Fi=Mn.circleArray[Rn+0],ln=Mn.circleArray[Rn+1],oi=Mn.circleArray[Rn+2],si=Mn.circleArray[Rn+3];mr.emplace(Br++,Fi,ln,oi,si,0),mr.emplace(Br++,Fi,ln,oi,si,1),mr.emplace(Br++,Fi,ln,oi,si,2),mr.emplace(Br++,Fi,ln,oi,si,3)}(!jf||jf.length<2*pe)&&(jf=function(Ya){var Ao=2*Ya,Go=new m.StructArrayLayout3ui6;Go.resize(Ao),Go._trim();for(var no=0;no<Ao;no++){var po=6*no;Go.uint16[po+0]=4*no+0,Go.uint16[po+1]=4*no+1,Go.uint16[po+2]=4*no+2,Go.uint16[po+3]=4*no+2,Go.uint16[po+4]=4*no+3,Go.uint16[po+5]=4*no+0}return Go}(pe));for(var ni=L.createIndexBuffer(jf,!0),Xn=L.createVertexBuffer(mr,m.collisionCircleLayout.members,!0),yi=0,Kn=le;yi<Kn.length;yi+=1){var Yn=Kn[yi],Co=Fc(Yn.transform,Yn.invTransform,l.transform);Jt.draw(L,U.TRIANGLES,ye.disabled,Pe.disabled,l.colorModeForRenderPass(),rt.disabled,Co,c.id,Xn,ni,m.SegmentVector.simpleSegment(0,2*Yn.circleOffset,Yn.circleArray.length,Yn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Xn.destroy(),ni.destroy()}}var $s=m.identity(new Float32Array(16));function lf(l,h,c,d,E,w){var M=m.getAnchorAlignment(l),L=-(M.horizontalAlign-.5)*h,U=-(M.verticalAlign-.5)*c,Y=m.evaluateVariableOffset(l,d);return new m.Point((L/E+Y[0])*w,(U/E+Y[1])*w)}function cf(l,h,c,d,E,w,M,L,U,Y,le){var pe=l.text.placedSymbolArray,ve=l.text.dynamicLayoutVertexArray,Re=l.icon.dynamicLayoutVertexArray,Ie={};ve.clear();for(var je=0;je<pe.length;je++){var we=pe.get(je),Ge=we.hidden||!we.crossTileID||l.allowVerticalPlacement&&!we.placedOrientation?null:d[we.crossTileID];if(Ge){var tt=new m.Point(we.anchorX,we.anchorY),xt=Mi(tt,c?L:M),Ht=ji(w.cameraToCenterDistance,xt.signedDistanceFromCamera),Zt=E.evaluateSizeForFeature(l.textSizeData,Y,we)*Ht/m.ONE_EM;c&&(Zt*=l.tilePixelRatio/U);for(var Jt=lf(Ge.anchor,Ge.width,Ge.height,Ge.textOffset,Ge.textBoxScale,Zt),mr=c?Mi(tt.add(Jt),M).point:xt.point.add(h?Jt.rotate(-w.angle):Jt),Br=l.allowVerticalPlacement&&we.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,kr=0;kr<we.numGlyphs;kr++)m.addDynamicAttributes(ve,mr,Br);le&&we.associatedIconIndex>=0&&(Ie[we.associatedIconIndex]={shiftedAnchor:mr,angle:Br})}else Ga(we.numGlyphs,ve)}if(le){Re.clear();for(var un=l.icon.placedSymbolArray,Mn=0;Mn<un.length;Mn++){var Nn=un.get(Mn);if(Nn.hidden)Ga(Nn.numGlyphs,Re);else{var Rn=Ie[Mn];if(Rn)for(var Fi=0;Fi<Nn.numGlyphs;Fi++)m.addDynamicAttributes(Re,Rn.shiftedAnchor,Rn.angle);else Ga(Nn.numGlyphs,Re)}}l.icon.dynamicLayoutVertexBuffer.updateData(Re)}l.text.dynamicLayoutVertexBuffer.updateData(ve)}function Vf(l,h,c){return c.iconsInText&&h?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function uu(l,h,c,d,E,w,M,L,U,Y,le,pe){for(var ve=l.context,Re=ve.gl,Ie=l.transform,je=L==="map",we=U==="map",Ge=je&&c.layout.get("symbol-placement")!=="point",tt=je&&!we&&!Ge,xt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ht=!1,Zt=l.depthModeForSublayer(0,ye.ReadOnly),Jt=c.layout.get("text-variable-anchor"),mr=[],Br=0,kr=d;Br<kr.length;Br+=1){var un=kr[Br],Mn=h.getTile(un),Nn=Mn.getBucket(c);if(Nn){var Rn=E?Nn.text:Nn.icon;if(Rn&&Rn.segments.get().length){var Fi=Rn.programConfigurations.get(c.id),ln=E||Nn.sdfIcons,oi=E?Nn.textSizeData:Nn.iconSizeData,si=we||Ie.pitch!==0,ni=l.useProgram(Vf(ln,E,Nn),Fi),Xn=m.evaluateSizeForZoom(oi,Ie.zoom),yi=void 0,Kn=[0,0],Yn=void 0,Co=void 0,Ya=null,Ao=void 0;if(E)Yn=Mn.glyphAtlasTexture,Co=Re.LINEAR,yi=Mn.glyphAtlasTexture.size,Nn.iconsInText&&(Kn=Mn.imageAtlasTexture.size,Ya=Mn.imageAtlasTexture,Ao=si||l.options.rotating||l.options.zooming||oi.kind==="composite"||oi.kind==="camera"?Re.LINEAR:Re.NEAREST);else{var Go=c.layout.get("icon-size").constantOr(0)!==1||Nn.iconsNeedLinear;Yn=Mn.imageAtlasTexture,Co=ln||l.options.rotating||l.options.zooming||Go||si?Re.LINEAR:Re.NEAREST,yi=Mn.imageAtlasTexture.size}var no=oa(Mn,1,l.transform.zoom),po=Ma(un.posMatrix,we,je,l.transform,no),Ds=Ai(un.posMatrix,we,je,l.transform,no),ds=Jt&&Nn.hasTextData(),Wu=c.layout.get("icon-text-fit")!=="none"&&ds&&Nn.hasIconData();Ge&&an(Nn,un.posMatrix,l,E,po,Ds,we,Y);var qa=l.translatePosMatrix(un.posMatrix,Mn,w,M),du=Ge||E&&Jt||Wu?$s:po,$o=l.translatePosMatrix(Ds,Mn,w,M,!0),dc=ln&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,vu={program:ni,buffers:Rn,uniformValues:ln?Nn.iconsInText?sc(oi.kind,Xn,tt,we,l,qa,du,$o,yi,Kn):oc(oi.kind,Xn,tt,we,l,qa,du,$o,E,yi,!0):Nc(oi.kind,Xn,tt,we,l,qa,du,$o,E,yi),atlasTexture:Yn,atlasTextureIcon:Ya,atlasInterpolation:Co,atlasInterpolationIcon:Ao,isSDF:ln,hasHalo:dc};if(xt&&Nn.canOverlap){Ht=!0;for(var mu=0,Vl=Rn.segments.get();mu<Vl.length;mu+=1){var vc=Vl[mu];mr.push({segments:new m.SegmentVector([vc]),sortKey:vc.sortKey,state:vu})}}else mr.push({segments:Rn.segments,sortKey:0,state:vu})}}}Ht&&mr.sort(function(Xu,Hs){return Xu.sortKey-Hs.sortKey});for(var gu=0,Gl=mr;gu<Gl.length;gu+=1){var Ra=Gl[gu],qi=Ra.state;if(ve.activeTexture.set(Re.TEXTURE0),qi.atlasTexture.bind(qi.atlasInterpolation,Re.CLAMP_TO_EDGE),qi.atlasTextureIcon&&(ve.activeTexture.set(Re.TEXTURE1),qi.atlasTextureIcon&&qi.atlasTextureIcon.bind(qi.atlasInterpolationIcon,Re.CLAMP_TO_EDGE)),qi.isSDF){var eu=qi.uniformValues;qi.hasHalo&&(eu.u_is_halo=1,uc(qi.buffers,Ra.segments,c,l,qi.program,Zt,le,pe,eu)),eu.u_is_halo=0}uc(qi.buffers,Ra.segments,c,l,qi.program,Zt,le,pe,qi.uniformValues)}}function uc(l,h,c,d,E,w,M,L,U){var Y=d.context;E.draw(Y,Y.gl.TRIANGLES,w,M,L,rt.disabled,U,c.id,l.layoutVertexBuffer,l.indexBuffer,h,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function zc(l,h,c,d,E,w,M){var L,U,Y,le,pe,ve=l.context.gl,Re=c.paint.get("fill-pattern"),Ie=Re&&Re.constantOr(1),je=c.getCrossfadeParameters();M?(U=Ie&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=ve.LINES):(U=Ie?"fillPattern":"fill",L=ve.TRIANGLES);for(var we=0,Ge=d;we<Ge.length;we+=1){var tt=Ge[we],xt=h.getTile(tt);if(!Ie||xt.patternsLoaded()){var Ht=xt.getBucket(c);if(Ht){var Zt=Ht.programConfigurations.get(c.id),Jt=l.useProgram(U,Zt);Ie&&(l.context.activeTexture.set(ve.TEXTURE0),xt.imageAtlasTexture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),Zt.updatePaintBuffers(je));var mr=Re.constantOr(null);if(mr&&xt.imageAtlas){var Br=xt.imageAtlas,kr=Br.patternPositions[mr.to.toString()],un=Br.patternPositions[mr.from.toString()];kr&&un&&Zt.setConstantPatternPositions(kr,un)}var Mn=l.translatePosMatrix(tt.posMatrix,xt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(M){le=Ht.indexBuffer2,pe=Ht.segments2;var Nn=[ve.drawingBufferWidth,ve.drawingBufferHeight];Y=U==="fillOutlinePattern"&&Ie?zf(Mn,l,je,xt,Nn):fo(Mn,Nn)}else le=Ht.indexBuffer,pe=Ht.segments,Y=Ie?Nu(Mn,l,je,xt):Bu(Mn);Jt.draw(l.context,L,E,l.stencilModeForClipping(tt),w,rt.disabled,Y,c.id,Ht.layoutVertexBuffer,le,pe,c.paint,l.transform.zoom,Zt)}}}}function ff(l,h,c,d,E,w,M){for(var L=l.context,U=L.gl,Y=c.paint.get("fill-extrusion-pattern"),le=Y.constantOr(1),pe=c.getCrossfadeParameters(),ve=c.paint.get("fill-extrusion-opacity"),Re=0,Ie=d;Re<Ie.length;Re+=1){var je=Ie[Re],we=h.getTile(je),Ge=we.getBucket(c);if(Ge){var tt=Ge.programConfigurations.get(c.id),xt=l.useProgram(le?"fillExtrusionPattern":"fillExtrusion",tt);le&&(l.context.activeTexture.set(U.TEXTURE0),we.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),tt.updatePaintBuffers(pe));var Ht=Y.constantOr(null);if(Ht&&we.imageAtlas){var Zt=we.imageAtlas,Jt=Zt.patternPositions[Ht.to.toString()],mr=Zt.patternPositions[Ht.from.toString()];Jt&&mr&&tt.setConstantPatternPositions(Jt,mr)}var Br=l.translatePosMatrix(je.posMatrix,we,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),kr=c.paint.get("fill-extrusion-vertical-gradient"),un=le?Fu(Br,l,kr,ve,je,pe,we):Dc(Br,l,kr,ve);xt.draw(L,L.gl.TRIANGLES,E,w,M,rt.backCCW,un,c.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,c.paint,l.transform.zoom,tt)}}}function Dl(l,h,c,d,E,w){var M=l.context,L=M.gl,U=h.fbo;if(U){var Y=l.useProgram("hillshade");M.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,U.colorAttachment.get());var le=function(pe,ve,Re){var Ie=Re.paint.get("hillshade-shadow-color"),je=Re.paint.get("hillshade-highlight-color"),we=Re.paint.get("hillshade-accent-color"),Ge=Re.paint.get("hillshade-illumination-direction")*(Math.PI/180);Re.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ge-=pe.transform.angle);var tt,xt,Ht,Zt=!pe.options.moving;return{u_matrix:pe.transform.calculatePosMatrix(ve.tileID.toUnwrapped(),Zt),u_image:0,u_latrange:(tt=ve.tileID,xt=Math.pow(2,tt.canonical.z),Ht=tt.canonical.y,[new m.MercatorCoordinate(0,Ht/xt).toLngLat().lat,new m.MercatorCoordinate(0,(Ht+1)/xt).toLngLat().lat]),u_light:[Re.paint.get("hillshade-exaggeration"),Ge],u_shadow:Ie,u_highlight:je,u_accent:we}}(l,h,c);Y.draw(M,L.TRIANGLES,d,E,w,rt.disabled,le,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function np(l,h,c,d,E,w){var M=l.context,L=M.gl,U=h.dem;if(U&&U.data){var Y=U.dim,le=U.stride,pe=U.getPixels();if(M.activeTexture.set(L.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||l.getTileTexture(le),h.demTexture){var ve=h.demTexture;ve.update(pe,{premultiply:!1}),ve.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else h.demTexture=new m.Texture(M,pe,L.RGBA,{premultiply:!1}),h.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);M.activeTexture.set(L.TEXTURE0);var Re=h.fbo;if(!Re){var Ie=new m.Texture(M,{width:Y,height:Y,data:null},L.RGBA);Ie.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Re=h.fbo=M.createFramebuffer(Y,Y,!0)).colorAttachment.set(Ie.texture)}M.bindFramebuffer.set(Re.framebuffer),M.viewport.set([0,0,Y,Y]),l.useProgram("hillshadePrepare").draw(M,L.TRIANGLES,d,E,w,rt.disabled,function(je,we){var Ge=we.stride,tt=m.create();return m.ortho(tt,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(tt,tt,[0,-m.EXTENT,0]),{u_matrix:tt,u_image:1,u_dimension:[Ge,Ge],u_zoom:je.overscaledZ,u_unpack:we.getUnpackVector()}}(h.tileID,U),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function hf(l,h,c,d,E){var w=d.paint.get("raster-fade-duration");if(w>0){var M=m.browser.now(),L=(M-l.timeAdded)/w,U=h?(M-h.timeAdded)/w:-1,Y=c.getSource(),le=E.coveringZoomLevel({tileSize:Y.tileSize,roundZoom:Y.roundZoom}),pe=!h||Math.abs(h.tileID.overscaledZ-le)>Math.abs(l.tileID.overscaledZ-le),ve=pe&&l.refreshedUponExpiration?1:m.clamp(pe?L:1-U,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),h?{opacity:1,mix:1-ve}:{opacity:ve,mix:0}}return{opacity:1,mix:0}}var Fl=new m.Color(1,0,0,1),pf=new m.Color(0,1,0,1),df=new m.Color(0,0,1,1),Bl=new m.Color(1,0,1,1),Uc=new m.Color(0,1,1,1);function Sh(l,h,c,d){lc(l,0,h+c/2,l.transform.width,c,d)}function Ch(l,h,c,d){lc(l,h-c/2,0,c,l.transform.height,d)}function lc(l,h,c,d,E,w){var M=l.context,L=M.gl;L.enable(L.SCISSOR_TEST),L.scissor(h*m.browser.devicePixelRatio,c*m.browser.devicePixelRatio,d*m.browser.devicePixelRatio,E*m.browser.devicePixelRatio),M.clear({color:w}),L.disable(L.SCISSOR_TEST)}function Ah(l,h,c){var d=l.context,E=d.gl,w=c.posMatrix,M=l.useProgram("debug"),L=ye.disabled,U=Pe.disabled,Y=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),M.draw(d,E.LINE_STRIP,L,U,Y,rt.disabled,zu(w,m.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var le=h.getTileByID(c.key).latestRawTileData,pe=Math.floor((le&&le.byteLength||0)/1024),ve=h.getTile(c).tileSize,Re=512/Math.min(ve,512)*(c.overscaledZ/l.transform.zoom)*.5,Ie=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ie+=" => "+c.overscaledZ),function(je,we){je.initDebugOverlayCanvas();var Ge=je.debugOverlayCanvas,tt=je.context.gl,xt=je.debugOverlayCanvas.getContext("2d");xt.clearRect(0,0,Ge.width,Ge.height),xt.shadowColor="white",xt.shadowBlur=2,xt.lineWidth=1.5,xt.strokeStyle="white",xt.textBaseline="top",xt.font="bold 36px Open Sans, sans-serif",xt.fillText(we,5,5),xt.strokeText(we,5,5),je.debugOverlayTexture.update(Ge),je.debugOverlayTexture.bind(tt.LINEAR,tt.CLAMP_TO_EDGE)}(l,Ie+" "+pe+"kb"),M.draw(d,E.TRIANGLES,L,U,He.alphaBlended,rt.disabled,zu(w,m.Color.transparent,Re),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Nl={symbol:function(l,h,c,d,E){if(l.renderPass==="translucent"){var w=Pe.disabled,M=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,U,Y,le,pe,ve,Re){for(var Ie=U.transform,je=pe==="map",we=ve==="map",Ge=0,tt=L;Ge<tt.length;Ge+=1){var xt=tt[Ge],Ht=le.getTile(xt),Zt=Ht.getBucket(Y);if(Zt&&Zt.text&&Zt.text.segments.get().length){var Jt=m.evaluateSizeForZoom(Zt.textSizeData,Ie.zoom),mr=oa(Ht,1,U.transform.zoom),Br=Ma(xt.posMatrix,we,je,U.transform,mr),kr=Y.layout.get("icon-text-fit")!=="none"&&Zt.hasIconData();if(Jt){var un=Math.pow(2,Ie.zoom-Ht.tileID.overscaledZ);cf(Zt,je,we,Re,m.symbolSize,Ie,Br,xt.posMatrix,un,Jt,kr)}}}}(d,l,c,h,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&uu(l,h,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,M),c.paint.get("text-opacity").constantOr(1)!==0&&uu(l,h,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,M),h.map.showCollisionBoxes&&(tl(l,h,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),tl(l,h,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,h,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),M=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||w.constantOr(1)!==0&&M.constantOr(1)!==0){for(var U=l.context,Y=U.gl,le=l.depthModeForSublayer(0,ye.ReadOnly),pe=Pe.disabled,ve=l.colorModeForRenderPass(),Re=[],Ie=0;Ie<d.length;Ie++){var je=d[Ie],we=h.getTile(je),Ge=we.getBucket(c);if(Ge){var tt=Ge.programConfigurations.get(c.id),xt={programConfiguration:tt,program:l.useProgram("circle",tt),layoutVertexBuffer:Ge.layoutVertexBuffer,indexBuffer:Ge.indexBuffer,uniformValues:Uf(l,je,we,c)};if(L)for(var Ht=0,Zt=Ge.segments.get();Ht<Zt.length;Ht+=1){var Jt=Zt[Ht];Re.push({segments:new m.SegmentVector([Jt]),sortKey:Jt.sortKey,state:xt})}else Re.push({segments:Ge.segments,sortKey:0,state:xt})}}L&&Re.sort(function(Mn,Nn){return Mn.sortKey-Nn.sortKey});for(var mr=0,Br=Re;mr<Br.length;mr+=1){var kr=Br[mr],un=kr.state;un.program.draw(U,Y.TRIANGLES,le,pe,ve,rt.disabled,un.uniformValues,c.id,un.layoutVertexBuffer,un.indexBuffer,kr.segments,c.paint,l.transform.zoom,un.programConfiguration)}}}},heatmap:function(l,h,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,w=E.gl,M=Pe.disabled,L=new He([w.ONE,w.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Re,Ie,je){var we=Re.gl;Re.activeTexture.set(we.TEXTURE1),Re.viewport.set([0,0,Ie.width/4,Ie.height/4]);var Ge=je.heatmapFbo;if(Ge)we.bindTexture(we.TEXTURE_2D,Ge.colorAttachment.get()),Re.bindFramebuffer.set(Ge.framebuffer);else{var tt=we.createTexture();we.bindTexture(we.TEXTURE_2D,tt),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_WRAP_S,we.CLAMP_TO_EDGE),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_WRAP_T,we.CLAMP_TO_EDGE),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_MIN_FILTER,we.LINEAR),we.texParameteri(we.TEXTURE_2D,we.TEXTURE_MAG_FILTER,we.LINEAR),Ge=je.heatmapFbo=Re.createFramebuffer(Ie.width/4,Ie.height/4,!1),function(xt,Ht,Zt,Jt){var mr=xt.gl;mr.texImage2D(mr.TEXTURE_2D,0,mr.RGBA,Ht.width/4,Ht.height/4,0,mr.RGBA,xt.extRenderToTextureHalfFloat?xt.extTextureHalfFloat.HALF_FLOAT_OES:mr.UNSIGNED_BYTE,null),Jt.colorAttachment.set(Zt)}(Re,Ie,tt,Ge)}})(E,l,c),E.clear({color:m.Color.transparent});for(var U=0;U<d.length;U++){var Y=d[U];if(!h.hasRenderableParent(Y)){var le=h.getTile(Y),pe=le.getBucket(c);if(pe){var ve=pe.programConfigurations.get(c.id);l.useProgram("heatmap",ve).draw(E,w.TRIANGLES,ye.disabled,M,L,rt.disabled,uf(Y.posMatrix,le,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,c.paint,l.transform.zoom,ve)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Re,Ie){var je=Re.context,we=je.gl,Ge=Ie.heatmapFbo;if(Ge){je.activeTexture.set(we.TEXTURE0),we.bindTexture(we.TEXTURE_2D,Ge.colorAttachment.get()),je.activeTexture.set(we.TEXTURE1);var tt=Ie.colorRampTexture;tt||(tt=Ie.colorRampTexture=new m.Texture(je,Ie.colorRamp,we.RGBA)),tt.bind(we.LINEAR,we.CLAMP_TO_EDGE),Re.useProgram("heatmapTexture").draw(je,we.TRIANGLES,ye.disabled,Pe.disabled,Re.colorModeForRenderPass(),rt.disabled,function(xt,Ht,Zt,Jt){var mr=m.create();m.ortho(mr,0,xt.width,xt.height,0,0,1);var Br=xt.context.gl;return{u_matrix:mr,u_world:[Br.drawingBufferWidth,Br.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ht.paint.get("heatmap-opacity")}}(Re,Ie),Ie.id,Re.viewportBuffer,Re.quadTriangleIndexBuffer,Re.viewportSegments,Ie.paint,Re.transform.zoom)}}(l,c))},line:function(l,h,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(E.constantOr(1)!==0&&w.constantOr(1)!==0)for(var M=l.depthModeForSublayer(0,ye.ReadOnly),L=l.colorModeForRenderPass(),U=c.paint.get("line-dasharray"),Y=c.paint.get("line-pattern"),le=Y.constantOr(1),pe=c.paint.get("line-gradient"),ve=c.getCrossfadeParameters(),Re=le?"linePattern":U?"lineSDF":pe?"lineGradient":"line",Ie=l.context,je=Ie.gl,we=!0,Ge=0,tt=d;Ge<tt.length;Ge+=1){var xt=tt[Ge],Ht=h.getTile(xt);if(!le||Ht.patternsLoaded()){var Zt=Ht.getBucket(c);if(Zt){var Jt=Zt.programConfigurations.get(c.id),mr=l.context.program.get(),Br=l.useProgram(Re,Jt),kr=we||Br.program!==mr,un=Y.constantOr(null);if(un&&Ht.imageAtlas){var Mn=Ht.imageAtlas,Nn=Mn.patternPositions[un.to.toString()],Rn=Mn.patternPositions[un.from.toString()];Nn&&Rn&&Jt.setConstantPatternPositions(Nn,Rn)}var Fi=le?Rl(l,Ht,c,ve):U?bh(l,Ht,c,U,ve):pe?Di(l,Ht,c,Zt.lineClipsArray.length):Ol(l,Ht,c);if(le)Ie.activeTexture.set(je.TEXTURE0),Ht.imageAtlasTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE),Jt.updatePaintBuffers(ve);else if(U&&(kr||l.lineAtlas.dirty))Ie.activeTexture.set(je.TEXTURE0),l.lineAtlas.bind(Ie);else if(pe){var ln=Zt.gradients[c.id],oi=ln.texture;if(c.gradientVersion!==ln.version){var si=256;if(c.stepInterpolant){var ni=h.getSource().maxzoom,Xn=xt.canonical.z===ni?Math.ceil(1<<l.transform.maxZoom-xt.canonical.z):1;si=m.clamp(m.nextPowerOfTwo(Zt.maxLineLength/m.EXTENT*1024*Xn),256,Ie.maxTextureSize)}ln.gradient=m.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:si,image:ln.gradient||void 0,clips:Zt.lineClipsArray}),ln.texture?ln.texture.update(ln.gradient):ln.texture=new m.Texture(Ie,ln.gradient,je.RGBA),ln.version=c.gradientVersion,oi=ln.texture}Ie.activeTexture.set(je.TEXTURE0),oi.bind(c.stepInterpolant?je.NEAREST:je.LINEAR,je.CLAMP_TO_EDGE)}Br.draw(Ie,je.TRIANGLES,M,l.stencilModeForClipping(xt),L,rt.disabled,Fi,c.id,Zt.layoutVertexBuffer,Zt.indexBuffer,Zt.segments,c.paint,l.transform.zoom,Jt,Zt.layoutVertexBuffer2),we=!1}}}}},fill:function(l,h,c,d){var E=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var M=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&E.constantOr(m.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var Y=l.depthModeForSublayer(1,l.renderPass==="opaque"?ye.ReadWrite:ye.ReadOnly);zc(l,h,c,d,Y,M,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var le=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,ye.ReadOnly);zc(l,h,c,d,le,M,!0)}}},"fill-extrusion":function(l,h,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var w=new ye(l.context.gl.LEQUAL,ye.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))ff(l,h,c,d,w,Pe.disabled,He.disabled),ff(l,h,c,d,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var M=l.colorModeForRenderPass();ff(l,h,c,d,w,Pe.disabled,M)}}},hillshade:function(l,h,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,w=l.depthModeForSublayer(0,ye.ReadOnly),M=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],U=L[0],Y=0,le=L[1];Y<le.length;Y+=1){var pe=le[Y],ve=h.getTile(pe);ve.needsHillshadePrepare&&l.renderPass==="offscreen"?np(l,ve,c,w,Pe.disabled,M):l.renderPass==="translucent"&&Dl(l,ve,c,w,U[pe.overscaledZ],M)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,h,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,w=E.gl,M=h.getSource(),L=l.useProgram("raster"),U=l.colorModeForRenderPass(),Y=M instanceof gt?[{},d]:l.stencilConfigForOverlap(d),le=Y[0],pe=Y[1],ve=pe[pe.length-1].overscaledZ,Re=!l.options.moving,Ie=0,je=pe;Ie<je.length;Ie+=1){var we=je[Ie],Ge=l.depthModeForSublayer(we.overscaledZ-ve,c.paint.get("raster-opacity")===1?ye.ReadWrite:ye.ReadOnly,w.LESS),tt=h.getTile(we),xt=l.transform.calculatePosMatrix(we.toUnwrapped(),Re);tt.registerFadeDuration(c.paint.get("raster-fade-duration"));var Ht=h.findLoadedParent(we,0),Zt=hf(tt,Ht,h,c,l.transform),Jt=void 0,mr=void 0,Br=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;E.activeTexture.set(w.TEXTURE0),tt.texture.bind(Br,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(w.TEXTURE1),Ht?(Ht.texture.bind(Br,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),Jt=Math.pow(2,Ht.tileID.overscaledZ-tt.tileID.overscaledZ),mr=[tt.tileID.canonical.x*Jt%1,tt.tileID.canonical.y*Jt%1]):tt.texture.bind(Br,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var kr=Zf(xt,mr||[0,0],Jt||1,Zt,c);M instanceof gt?L.draw(E,w.TRIANGLES,Ge,Pe.disabled,U,rt.disabled,kr,c.id,M.boundsBuffer,l.quadTriangleIndexBuffer,M.boundsSegments):L.draw(E,w.TRIANGLES,Ge,le[we.overscaledZ],U,rt.disabled,kr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,h,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var w=l.context,M=w.gl,L=l.transform,U=L.tileSize,Y=c.paint.get("background-pattern");if(!l.isPatternMissing(Y)){var le=!Y&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===le){var pe=Pe.disabled,ve=l.depthModeForSublayer(0,le==="opaque"?ye.ReadWrite:ye.ReadOnly),Re=l.colorModeForRenderPass(),Ie=l.useProgram(Y?"backgroundPattern":"background"),je=L.coveringTiles({tileSize:U});Y&&(w.activeTexture.set(M.TEXTURE0),l.imageManager.bind(l.context));for(var we=c.getCrossfadeParameters(),Ge=0,tt=je;Ge<tt.length;Ge+=1){var xt=tt[Ge],Ht=l.transform.calculatePosMatrix(xt.toUnwrapped()),Zt=Y?ml(Ht,E,l,Y,{tileID:xt,tileSize:U},we):Ll(Ht,E,d);Ie.draw(w,M.TRIANGLES,ve,pe,Re,rt.disabled,Zt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,h,c){for(var d=0;d<c.length;d++)Ah(l,h,c[d])},custom:function(l,h,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var w=E.prerender;w&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),w.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Pe.disabled);var M=E.renderingMode==="3d"?new ye(l.context.gl.LEQUAL,ye.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ye.ReadOnly);d.setDepthMode(M),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Ji=function(l,h){this.context=new he(l),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=ke.maxUnderzooming+ke.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Oo,this.gpuTimers={}};Ji.prototype.resize=function(l,h){if(this.width=l*m.browser.devicePixelRatio,this.height=h*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},Ji.prototype.setup=function(){var l=this.context,h=new m.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(m.EXTENT,0),h.emplaceBack(0,m.EXTENT),h.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(h,ba.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var c=new m.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(m.EXTENT,0),c.emplaceBack(0,m.EXTENT),c.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=l.createVertexBuffer(c,ba.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var d=new m.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(m.EXTENT,0,m.EXTENT,0),d.emplaceBack(0,m.EXTENT,0,m.EXTENT),d.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,Tt.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var E=new m.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,ba.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var w=new m.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var M=new m.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(M),this.emptyTexture=new m.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Pe({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},Ji.prototype.clearStencil=function(){var l=this.context,h=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=m.create();m.ortho(c,0,this.width,this.height,0,0,1),m.scale(c,c,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,h.TRIANGLES,ye.disabled,this.stencilClearMode,He.disabled,rt.disabled,su(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ji.prototype._renderTileClippingMasks=function(l,h){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&h&&h.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+h.length>256&&this.clearStencil(),c.setColorMode(He.disabled),c.setDepthMode(ye.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,M=h;w<M.length;w+=1){var L=M[w],U=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,ye.disabled,new Pe({func:d.ALWAYS,mask:0},U,255,d.KEEP,d.KEEP,d.REPLACE),He.disabled,rt.disabled,su(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ji.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,h=this.context.gl;return new Pe({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)},Ji.prototype.stencilModeForClipping=function(l){var h=this.context.gl;return new Pe({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)},Ji.prototype.stencilConfigForOverlap=function(l){var h,c=this.context.gl,d=l.sort(function(U,Y){return Y.overscaledZ-U.overscaledZ}),E=d[d.length-1].overscaledZ,w=d[0].overscaledZ-E+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var M={},L=0;L<w;L++)M[L+E]=new Pe({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[M,d]}return[(h={},h[E]=Pe.disabled,h),d]},Ji.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new He([l.CONSTANT_COLOR,l.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?He.unblended:He.alphaBlended},Ji.prototype.depthModeForSublayer=function(l,h,c){if(!this.opaquePassEnabledForLayer())return ye.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ye(c||this.context.gl.LEQUAL,h,[d,d])},Ji.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ji.prototype.render=function(l,h){var c=this;this.style=l,this.options=h,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var w in E){var M=E[w];M.used&&M.prepare(this.context)}var L,U,Y={},le={},pe={};for(var ve in E){var Re=E[ve];Y[ve]=Re.getVisibleCoordinates(),le[ve]=Y[ve].slice().reverse(),pe[ve]=Re.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ie=0;Ie<d.length;Ie++)if(this.style._layers[d[Ie]].is3D()){this.opaquePassCutoff=Ie;break}this.renderPass="offscreen";for(var je=0,we=d;je<we.length;je+=1){var Ge=this.style._layers[we[je]];if(Ge.hasOffscreenPass()&&!Ge.isHidden(this.transform.zoom)){var tt=le[Ge.source];(Ge.type==="custom"||tt.length)&&this.renderLayer(this,E[Ge.source],Ge,tt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var xt=this.style._layers[d[this.currentLayer]],Ht=E[xt.source],Zt=Y[xt.source];this._renderTileClippingMasks(xt,Zt),this.renderLayer(this,Ht,xt,Zt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Jt=this.style._layers[d[this.currentLayer]],mr=E[Jt.source],Br=(Jt.type==="symbol"?pe:le)[Jt.source];this._renderTileClippingMasks(Jt,Y[Jt.source]),this.renderLayer(this,mr,Jt,Br)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function(kr){kr.source&&!kr.isHidden(c.transform.zoom)&&(kr.source!==(U&&U.id)&&(U=c.style.sourceCaches[kr.source]),(!L||L.getSource().maxzoom<U.getSource().maxzoom)&&(L=U))}),L&&Nl.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(kr){var un=kr.transform.padding;Sh(kr,kr.transform.height-(un.top||0),3,Fl),Sh(kr,un.bottom||0,3,pf),Ch(kr,un.left||0,3,df),Ch(kr,kr.transform.width-(un.right||0),3,Bl);var Mn=kr.transform.centerPoint;(function(Nn,Rn,Fi,ln){lc(Nn,Rn-1,Fi-10,2,20,ln),lc(Nn,Rn-10,Fi-1,20,2,ln)})(kr,Mn.x,kr.transform.height-Mn.y,Uc)}(this),this.context.setDefault()},Ji.prototype.renderLayer=function(l,h,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),Nl[c.type](l,h,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ji.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var h=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),c.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,c.query)}},Ji.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Ji.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Ji.prototype.queryGpuTimers=function(l){var h={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,w=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),h[c]=w}return h},Ji.prototype.translatePosMatrix=function(l,h,c,d,E){if(!c[0]&&!c[1])return l;var w=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){var M=Math.sin(w),L=Math.cos(w);c=[c[0]*L-c[1]*M,c[0]*M+c[1]*L]}var U=[E?c[0]:oa(h,c[0],this.transform.zoom),E?c[1]:oa(h,c[1],this.transform.zoom),0],Y=new Float32Array(16);return m.translate(Y,l,U),Y},Ji.prototype.saveTileTexture=function(l){var h=this._tileTextures[l.size[0]];h?h.push(l):this._tileTextures[l.size[0]]=[l]},Ji.prototype.getTileTexture=function(l){var h=this._tileTextures[l];return h&&h.length>0?h.pop():null},Ji.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var h=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!h||!c},Ji.prototype.useProgram=function(l,h){this.cache=this.cache||{};var c=""+l+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new sf(this.context,l,Ss[l],h,kl[l],this._showOverdrawInspector)),this.cache[c]},Ji.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ji.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Ji.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ji.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var cc=function(l,h){this.points=l,this.planes=h};cc.fromInvProjectionMatrix=function(l,h,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(M){return m.transformMat4([],M,l)}).map(function(M){return m.scale$1([],M,1/M[3]/h*d)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(M){var L=m.sub([],E[M[0]],E[M[1]]),U=m.sub([],E[M[2]],E[M[1]]),Y=m.normalize([],m.cross([],L,U)),le=-m.dot(Y,E[M[1]]);return Y.concat(le)});return new cc(E,w)};var fa=function(l,h){this.min=l,this.max=h,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};fa.prototype.quadrant=function(l){for(var h=[l%2==0,l<2],c=m.clone$2(this.min),d=m.clone$2(this.max),E=0;E<h.length;E++)c[E]=h[E]?this.min[E]:this.center[E],d[E]=h[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new fa(c,d)},fa.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},fa.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},fa.prototype.intersects=function(l){for(var h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],w=0,M=0;M<h.length;M++)w+=m.dot$1(E,h[M])>=0;if(w===0)return 0;w!==h.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var U=Number.MAX_VALUE,Y=-Number.MAX_VALUE,le=0;le<l.points.length;le++){var pe=l.points[le][L]-this.min[L];U=Math.min(U,pe),Y=Math.max(Y,pe)}if(Y<0||U>this.max[L]-this.min[L])return 0}return 1};var Uu=function(l,h,c,d){if(l===void 0&&(l=0),h===void 0&&(h=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(h)||h<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=c,this.right=d};Uu.prototype.interpolate=function(l,h,c){return h.top!=null&&l.top!=null&&(this.top=m.number(l.top,h.top,c)),h.bottom!=null&&l.bottom!=null&&(this.bottom=m.number(l.bottom,h.bottom,c)),h.left!=null&&l.left!=null&&(this.left=m.number(l.left,h.left,c)),h.right!=null&&l.right!=null&&(this.right=m.number(l.right,h.right,c)),this},Uu.prototype.getCenter=function(l,h){var c=m.clamp((this.left+l-this.right)/2,0,l),d=m.clamp((this.top+h-this.bottom)/2,0,h);return new m.Point(c,d)},Uu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Uu.prototype.clone=function(){return new Uu(this.top,this.bottom,this.left,this.right)},Uu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Yi=function(l,h,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Uu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ia={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Yi.prototype.clone=function(){var l=new Yi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Ia.minZoom.get=function(){return this._minZoom},Ia.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Ia.maxZoom.get=function(){return this._maxZoom},Ia.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Ia.minPitch.get=function(){return this._minPitch},Ia.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Ia.maxPitch.get=function(){return this._maxPitch},Ia.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Ia.renderWorldCopies.get=function(){return this._renderWorldCopies},Ia.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Ia.worldSize.get=function(){return this.tileSize*this.scale},Ia.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ia.size.get=function(){return new m.Point(this.width,this.height)},Ia.bearing.get=function(){return-this.angle/Math.PI*180},Ia.bearing.set=function(l){var h=-m.wrap(l,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ia.pitch.get=function(){return this._pitch/Math.PI*180},Ia.pitch.set=function(l){var h=m.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())},Ia.fov.get=function(){return this._fov/Math.PI*180},Ia.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Ia.zoom.get=function(){return this._zoom},Ia.zoom.set=function(l){var h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())},Ia.center.get=function(){return this._center},Ia.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Ia.padding.get=function(){return this._edgeInsets.toJSON()},Ia.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Ia.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Yi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Yi.prototype.interpolatePadding=function(l,h,c){this._unmodified=!1,this._edgeInsets.interpolate(l,h,c),this._constrain(),this._calcMatrices()},Yi.prototype.coveringZoomLevel=function(l){var h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)},Yi.prototype.getVisibleUnwrappedCoordinates=function(l){var h=[new m.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new m.Point(0,0)),d=this.pointCoordinate(new m.Point(this.width,0)),E=this.pointCoordinate(new m.Point(this.width,this.height)),w=this.pointCoordinate(new m.Point(0,this.height)),M=Math.floor(Math.min(c.x,d.x,E.x,w.x)),L=Math.floor(Math.max(c.x,d.x,E.x,w.x)),U=M-1;U<=L+1;U++)U!==0&&h.push(new m.UnwrappedTileID(U,l));return h},Yi.prototype.coveringTiles=function(l){var h=this.coveringZoomLevel(l),c=h;if(l.minzoom!==void 0&&h<l.minzoom)return[];l.maxzoom!==void 0&&h>l.maxzoom&&(h=l.maxzoom);var d=m.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,h),w=[E*d.x,E*d.y,0],M=cc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=h);var U=function(kr){return{aabb:new fa([kr*E,0,0],[(kr+1)*E,E,0]),zoom:0,x:0,y:0,wrap:kr,fullyVisible:!1}},Y=[],le=[],pe=h,ve=l.reparseOverscaled?c:h;if(this._renderWorldCopies)for(var Re=1;Re<=3;Re++)Y.push(U(-Re)),Y.push(U(Re));for(Y.push(U(0));Y.length>0;){var Ie=Y.pop(),je=Ie.x,we=Ie.y,Ge=Ie.fullyVisible;if(!Ge){var tt=Ie.aabb.intersects(M);if(tt===0)continue;Ge=tt===2}var xt=Ie.aabb.distanceX(w),Ht=Ie.aabb.distanceY(w),Zt=Math.max(Math.abs(xt),Math.abs(Ht));if(Ie.zoom===pe||Zt>3+(1<<pe-Ie.zoom)-2&&Ie.zoom>=L)le.push({tileID:new m.OverscaledTileID(Ie.zoom===pe?ve:Ie.zoom,Ie.wrap,Ie.zoom,je,we),distanceSq:m.sqrLen([w[0]-.5-je,w[1]-.5-we])});else for(var Jt=0;Jt<4;Jt++){var mr=(je<<1)+Jt%2,Br=(we<<1)+(Jt>>1);Y.push({aabb:Ie.aabb.quadrant(Jt),zoom:Ie.zoom+1,x:mr,y:Br,wrap:Ie.wrap,fullyVisible:Ge})}}return le.sort(function(kr,un){return kr.distanceSq-un.distanceSq}).map(function(kr){return kr.tileID})},Yi.prototype.resize=function(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()},Ia.unmodified.get=function(){return this._unmodified},Yi.prototype.zoomScale=function(l){return Math.pow(2,l)},Yi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Yi.prototype.project=function(l){var h=m.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(l.lng)*this.worldSize,m.mercatorYfromLat(h)*this.worldSize)},Yi.prototype.unproject=function(l){return new m.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Ia.point.get=function(){return this.project(this.center)},Yi.prototype.setLocationAtPoint=function(l,h){var c=this.pointCoordinate(h),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),w=new m.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Yi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Yi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Yi.prototype.locationCoordinate=function(l){return m.MercatorCoordinate.fromLngLat(l)},Yi.prototype.coordinateLocation=function(l){return l.toLngLat()},Yi.prototype.pointCoordinate=function(l){var h=[l.x,l.y,0,1],c=[l.x,l.y,1,1];m.transformMat4(h,h,this.pixelMatrixInverse),m.transformMat4(c,c,this.pixelMatrixInverse);var d=h[3],E=c[3],w=h[1]/d,M=c[1]/E,L=h[2]/d,U=c[2]/E,Y=L===U?0:(0-L)/(U-L);return new m.MercatorCoordinate(m.number(h[0]/d,c[0]/E,Y)/this.worldSize,m.number(w,M,Y)/this.worldSize)},Yi.prototype.coordinatePoint=function(l){var h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(h,h,this.pixelMatrix),new m.Point(h[0]/h[3],h[1]/h[3])},Yi.prototype.getBounds=function(){return new m.LngLatBounds().extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},Yi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Yi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Yi.prototype.calculatePosMatrix=function(l,h){h===void 0&&(h=!1);var c=l.key,d=h?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,w=this.worldSize/this.zoomScale(E.z),M=E.x+Math.pow(2,E.z)*l.wrap,L=m.identity(new Float64Array(16));return m.translate(L,L,[M*w,E.y*w,0]),m.scale(L,L,[w/m.EXTENT,w/m.EXTENT,1]),m.multiply(L,h?this.alignedProjMatrix:this.projMatrix,L),d[c]=new Float32Array(L),d[c]},Yi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Yi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,h,c,d,E=-90,w=90,M=-180,L=180,U=this.size,Y=this._unmodified;if(this.latRange){var le=this.latRange;E=m.mercatorYfromLat(le[1])*this.worldSize,l=(w=m.mercatorYfromLat(le[0])*this.worldSize)-E<U.y?U.y/(w-E):0}if(this.lngRange){var pe=this.lngRange;M=m.mercatorXfromLng(pe[0])*this.worldSize,h=(L=m.mercatorXfromLng(pe[1])*this.worldSize)-M<U.x?U.x/(L-M):0}var ve=this.point,Re=Math.max(h||0,l||0);if(Re)return this.center=this.unproject(new m.Point(h?(L+M)/2:ve.x,l?(w+E)/2:ve.y)),this.zoom+=this.scaleZoom(Re),this._unmodified=Y,void(this._constraining=!1);if(this.latRange){var Ie=ve.y,je=U.y/2;Ie-je<E&&(d=E+je),Ie+je>w&&(d=w-je)}if(this.lngRange){var we=ve.x,Ge=U.x/2;we-Ge<M&&(c=M+Ge),we+Ge>L&&(c=L-Ge)}c===void 0&&d===void 0||(this.center=this.unproject(new m.Point(c!==void 0?c:ve.x,d!==void 0?d:ve.y))),this._unmodified=Y,this._constraining=!1}},Yi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var h=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-h-c,.01,Math.PI-.01)),E=this.point,w=E.x,M=E.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),U=this.height/50,Y=new Float64Array(16);m.perspective(Y,this._fov,this.width/this.height,U,L),Y[8]=2*-l.x/this.width,Y[9]=2*l.y/this.height,m.scale(Y,Y,[1,-1,1]),m.translate(Y,Y,[0,0,-this.cameraToCenterDistance]),m.rotateX(Y,Y,this._pitch),m.rotateZ(Y,Y,this.angle),m.translate(Y,Y,[-w,-M,0]),this.mercatorMatrix=m.scale([],Y,[this.worldSize,this.worldSize,this.worldSize]),m.scale(Y,Y,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=Y,this.invProjMatrix=m.invert([],this.projMatrix);var le=this.width%2/2,pe=this.height%2/2,ve=Math.cos(this.angle),Re=Math.sin(this.angle),Ie=w-Math.round(w)+ve*le+Re*pe,je=M-Math.round(M)+ve*pe+Re*le,we=new Float64Array(Y);if(m.translate(we,we,[Ie>.5?Ie-1:Ie,je>.5?je-1:je,0]),this.alignedProjMatrix=we,Y=m.create(),m.scale(Y,Y,[this.width/2,-this.height/2,1]),m.translate(Y,Y,[1,-1,0]),this.labelPlaneMatrix=Y,Y=m.create(),m.scale(Y,Y,[1,-1,1]),m.translate(Y,Y,[-1,-1,0]),m.scale(Y,Y,[2/this.width,2/this.height,1]),this.glCoordMatrix=Y,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(Y=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=Y,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Yi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new m.Point(0,0)),h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance},Yi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,l))},Yi.prototype.getCameraQueryGeometry=function(l){var h=this.getCameraPoint();if(l.length===1)return[l[0],h];for(var c=h.x,d=h.y,E=h.x,w=h.y,M=0,L=l;M<L.length;M+=1){var U=L[M];c=Math.min(c,U.x),d=Math.min(d,U.y),E=Math.max(E,U.x),w=Math.max(w,U.y)}return[new m.Point(c,d),new m.Point(E,d),new m.Point(E,w),new m.Point(c,w),new m.Point(c,d)]},Object.defineProperties(Yi.prototype,Ia);var Cs=function(l){var h,c,d,E;this._hashName=l&&encodeURIComponent(l),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(h=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(h(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};Cs.prototype.addTo=function(l){return this._map=l,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Cs.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Cs.prototype.getHashString=function(l){var h=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),w=Math.round(h.lng*E)/E,M=Math.round(h.lat*E)/E,L=this._map.getBearing(),U=this._map.getPitch(),Y="";if(Y+=l?"/"+w+"/"+M+"/"+c:c+"/"+M+"/"+w,(L||U)&&(Y+="/"+Math.round(10*L)/10),U&&(Y+="/"+Math.round(U)),this._hashName){var le=this._hashName,pe=!1,ve=m.window.location.hash.slice(1).split("&").map(function(Re){var Ie=Re.split("=")[0];return Ie===le?(pe=!0,Ie+"="+Y):Re}).filter(function(Re){return Re});return pe||ve.push(le+"="+Y),"#"+ve.join("&")}return"#"+Y},Cs.prototype._getCurrentHash=function(){var l,h=this,c=m.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===h._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},Cs.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:h,pitch:+(l[4]||0)}),!0}return!1},Cs.prototype._updateHashUnthrottled=function(){var l=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,l)}catch(h){}};var Zc={linearity:.3,easing:m.bezier(0,0,.3,1)},rl=m.extend({deceleration:2500,maxSpeed:1400},Zc),Wa=m.extend({deceleration:20,maxSpeed:1400},Zc),fc=m.extend({deceleration:1e3,maxSpeed:360},Zc),zl=m.extend({deceleration:1e3,maxSpeed:90},Zc),nl=function(l){this._map=l,this.clear()};function jc(l,h){(!l.duration||l.duration<h.duration)&&(l.duration=h.duration,l.easing=h.easing)}function Zu(l,h,c){var d=c.maxSpeed,E=c.linearity,w=c.deceleration,M=m.clamp(l*E/(h/1e3),-d,d),L=Math.abs(M)/(w*E);return{easing:c.easing,duration:1e3*L,amount:M*(L/2)}}nl.prototype.clear=function(){this._inertiaBuffer=[]},nl.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:l})},nl.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,h=m.browser.now();l.length>0&&h-l[0].time>160;)l.shift()},nl.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var h={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;h.zoom+=E.zoomDelta||0,h.bearing+=E.bearingDelta||0,h.pitch+=E.pitchDelta||0,E.panDelta&&h.pan._add(E.panDelta),E.around&&(h.around=E.around),E.pinchAround&&(h.pinchAround=E.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(h.pan.mag()){var L=Zu(h.pan.mag(),w,m.extend({},rl,l||{}));M.offset=h.pan.mult(L.amount/h.pan.mag()),M.center=this._map.transform.center,jc(M,L)}if(h.zoom){var U=Zu(h.zoom,w,Wa);M.zoom=this._map.transform.zoom+U.amount,jc(M,U)}if(h.bearing){var Y=Zu(h.bearing,w,fc);M.bearing=this._map.transform.bearing+m.clamp(Y.amount,-179,179),jc(M,Y)}if(h.pitch){var le=Zu(h.pitch,w,zl);M.pitch=this._map.transform.pitch+le.amount,jc(M,le)}if(M.zoom||M.bearing){var pe=h.pinchAround===void 0?h.around:h.pinchAround;M.around=pe?this._map.unproject(pe):this._map.getCenter()}return this.clear(),m.extend(M,{noMoveStart:!0})}};var _o=function(l){function h(d,E,w,M){M===void 0&&(M={});var L=Z.mousePos(E.getCanvasContainer(),w),U=E.unproject(L);l.call(this,d,m.extend({point:L,lngLat:U,originalEvent:w},M)),this._defaultPrevented=!1,this.target=E}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(m.Event),Ul=function(l){function h(d,E,w){var M=d==="touchend"?w.changedTouches:w.touches,L=Z.touchPos(E.getCanvasContainer(),M),U=L.map(function(pe){return E.unproject(pe)}),Y=L.reduce(function(pe,ve,Re,Ie){return pe.add(ve.div(Ie.length))},new m.Point(0,0)),le=E.unproject(Y);l.call(this,d,{points:L,point:Y,lngLats:U,lngLat:le,originalEvent:w}),this._defaultPrevented=!1}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(m.Event),hc=function(l){function h(d,E,w){l.call(this,d,{originalEvent:w}),this._defaultPrevented=!1}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(m.Event),xo=function(l,h){this._map=l,this._clickTolerance=h.clickTolerance};xo.prototype.reset=function(){delete this._mousedownPos},xo.prototype.wheel=function(l){return this._firePreventable(new hc(l.type,this._map,l))},xo.prototype.mousedown=function(l,h){return this._mousedownPos=h,this._firePreventable(new _o(l.type,this._map,l))},xo.prototype.mouseup=function(l){this._map.fire(new _o(l.type,this._map,l))},xo.prototype.click=function(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new _o(l.type,this._map,l))},xo.prototype.dblclick=function(l){return this._firePreventable(new _o(l.type,this._map,l))},xo.prototype.mouseover=function(l){this._map.fire(new _o(l.type,this._map,l))},xo.prototype.mouseout=function(l){this._map.fire(new _o(l.type,this._map,l))},xo.prototype.touchstart=function(l){return this._firePreventable(new Ul(l.type,this._map,l))},xo.prototype.touchmove=function(l){this._map.fire(new Ul(l.type,this._map,l))},xo.prototype.touchend=function(l){this._map.fire(new Ul(l.type,this._map,l))},xo.prototype.touchcancel=function(l){this._map.fire(new Ul(l.type,this._map,l))},xo.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},xo.prototype.isEnabled=function(){return!0},xo.prototype.isActive=function(){return!1},xo.prototype.enable=function(){},xo.prototype.disable=function(){};var yn=function(l){this._map=l};yn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},yn.prototype.mousemove=function(l){this._map.fire(new _o(l.type,this._map,l))},yn.prototype.mousedown=function(){this._delayContextMenu=!0},yn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _o("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},yn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new _o(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},yn.prototype.isEnabled=function(){return!0},yn.prototype.isActive=function(){return!1},yn.prototype.enable=function(){},yn.prototype.disable=function(){};var ho=function(l,h){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1};function il(l,h){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=h[d];return c}ho.prototype.isEnabled=function(){return!!this._enabled},ho.prototype.isActive=function(){return!!this._active},ho.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ho.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ho.prototype.mousedown=function(l,h){this.isEnabled()&&l.shiftKey&&l.button===0&&(Z.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)},ho.prototype.mousemoveWindow=function(l,h){if(this._active){var c=h;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=Z.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),w=Math.max(d.x,c.x),M=Math.min(d.y,c.y),L=Math.max(d.y,c.y);Z.setTransform(this._box,"translate("+E+"px,"+M+"px)"),this._box.style.width=w-E+"px",this._box.style.height=L-M+"px"}}},ho.prototype.mouseupWindow=function(l,h){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=h;if(this.reset(),Z.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},ho.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},ho.prototype.blur=function(){this.reset()},ho.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Z.remove(this._box),this._box=null),Z.enableDrag(),delete this._startPos,delete this._lastPos},ho.prototype._fireEvent=function(l,h){return this._map.fire(new m.Event(l,{originalEvent:h}))};var Fa=function(l){this.reset(),this.numTouches=l.numTouches};Fa.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Fa.prototype.touchstart=function(l,h,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new m.Point(0,0),w=0,M=d;w<M.length;w+=1)E._add(M[w]);return E.div(d.length)}(h),this.touches=il(c,h)))},Fa.prototype.touchmove=function(l,h,c){if(!this.aborted&&this.centroid){var d=il(c,h);for(var E in this.touches){var w=d[E];(!w||w.dist(this.touches[E])>30)&&(this.aborted=!0)}}},Fa.prototype.touchend=function(l,h,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var lu=function(l){this.singleTap=new Fa(l),this.numTaps=l.numTaps,this.reset()};lu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},lu.prototype.touchstart=function(l,h,c){this.singleTap.touchstart(l,h,c)},lu.prototype.touchmove=function(l,h,c){this.singleTap.touchmove(l,h,c)},lu.prototype.touchend=function(l,h,c){var d=this.singleTap.touchend(l,h,c);if(d){var E=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(E&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var ks=function(){this._zoomIn=new lu({numTouches:1,numTaps:2}),this._zoomOut=new lu({numTouches:2,numTaps:1}),this.reset()};ks.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ks.prototype.touchstart=function(l,h,c){this._zoomIn.touchstart(l,h,c),this._zoomOut.touchstart(l,h,c)},ks.prototype.touchmove=function(l,h,c){this._zoomIn.touchmove(l,h,c),this._zoomOut.touchmove(l,h,c)},ks.prototype.touchend=function(l,h,c){var d=this,E=this._zoomIn.touchend(l,h,c),w=this._zoomOut.touchend(l,h,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(E)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(w)},{originalEvent:l})}}):void 0},ks.prototype.touchcancel=function(){this.reset()},ks.prototype.enable=function(){this._enabled=!0},ks.prototype.disable=function(){this._enabled=!1,this.reset()},ks.prototype.isEnabled=function(){return this._enabled},ks.prototype.isActive=function(){return this._active};var Vc={0:1,2:2},Yr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Yr.prototype.blur=function(){this.reset()},Yr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Yr.prototype._correctButton=function(l,h){return!1},Yr.prototype._move=function(l,h){return{}},Yr.prototype.mousedown=function(l,h){if(!this._lastPoint){var c=Z.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=h,this._eventButton=c)}},Yr.prototype.mousemoveWindow=function(l,h){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var w=Vc[E];return d.buttons===void 0||(d.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(h.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(c,h)}},Yr.prototype.mouseupWindow=function(l){this._lastPoint&&Z.mouseButton(l)===this._eventButton&&(this._moved&&Z.suppressClick(),this.reset())},Yr.prototype.enable=function(){this._enabled=!0},Yr.prototype.disable=function(){this._enabled=!1,this.reset()},Yr.prototype.isEnabled=function(){return this._enabled},Yr.prototype.isActive=function(){return this._active};var vf=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},h.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},h.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},h}(Yr),pc=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},h.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},h.prototype.contextmenu=function(c){c.preventDefault()},h}(Yr),ju=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},h.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},h.prototype.contextmenu=function(c){c.preventDefault()},h}(Yr),Ba=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Ba.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},Ba.prototype.touchstart=function(l,h,c){return this._calculateTransform(l,h,c)},Ba.prototype.touchmove=function(l,h,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,h,c)},Ba.prototype.touchend=function(l,h,c){this._calculateTransform(l,h,c),this._active&&c.length<this._minTouches&&this.reset()},Ba.prototype.touchcancel=function(){this.reset()},Ba.prototype._calculateTransform=function(l,h,c){c.length>0&&(this._active=!0);var d=il(c,h),E=new m.Point(0,0),w=new m.Point(0,0),M=0;for(var L in d){var U=d[L],Y=this._touches[L];Y&&(E._add(U),w._add(U.sub(Y)),M++,d[L]=U)}if(this._touches=d,!(M<this._minTouches)&&w.mag()){var le=w.div(M);if(this._sum._add(le),!(this._sum.mag()<this._clickTolerance))return{around:E.div(M),panDelta:le}}},Ba.prototype.enable=function(){this._enabled=!0},Ba.prototype.disable=function(){this._enabled=!1,this.reset()},Ba.prototype.isEnabled=function(){return this._enabled},Ba.prototype.isActive=function(){return this._active};var As=function(){this.reset()};function Gc(l,h,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return h[d]}function Vu(l,h){return Math.log(l/h)/Math.LN2}As.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},As.prototype._start=function(l){},As.prototype._move=function(l,h,c){return{}},As.prototype.touchstart=function(l,h,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([h[0],h[1]]))},As.prototype.touchmove=function(l,h,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],w=Gc(c,h,d[0]),M=Gc(c,h,E);if(w&&M){var L=this._aroundCenter?null:w.add(M).div(2);return this._move([w,M],L,l)}}},As.prototype.touchend=function(l,h,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],w=Gc(c,h,d[0]),M=Gc(c,h,E);w&&M||(this._active&&Z.suppressClick(),this.reset())}},As.prototype.touchcancel=function(){this.reset()},As.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},As.prototype.disable=function(){this._enabled=!1,this.reset()},As.prototype.isEnabled=function(){return this._enabled},As.prototype.isActive=function(){return this._active};var as=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},h.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},h.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Vu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Vu(this._distance,E),pinchAround:d}},h}(As);function cu(l,h){return 180*l.angleWith(h)/Math.PI}var wh=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},h.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},h.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:cu(this._vector,E),pinchAround:d}},h.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=cu(c,this._startVector);return Math.abs(E)<d},h}(As);function Hc(l){return Math.abs(l.y)>Math.abs(l.x)}var Wc=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},h.prototype._start=function(c){this._lastPoints=c,Hc(c[0].sub(c[1]))&&(this._valid=!1)},h.prototype._move=function(c,d,E){var w=c[0].sub(this._lastPoints[0]),M=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,M,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+M.y)/2*-.5}},h.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,M=d.mag()>=2;if(w||M){if(!w||!M)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var L=c.y>0==d.y>0;return Hc(c)&&Hc(d)&&L}},h}(As),mf={panStep:100,bearingStep:15,pitchStep:10},fu=function(){var l=mf;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function js(l){return l*(2-l)}fu.prototype.blur=function(){this.reset()},fu.prototype.reset=function(){this._active=!1},fu.prototype.keydown=function(l){var h=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,w=0,M=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),M=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(L){var U=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:js,zoom:c?Math.round(U)+c*(l.shiftKey?2:1):U,bearing:L.getBearing()+d*h._bearingStep,pitch:L.getPitch()+E*h._pitchStep,offset:[-w*h._panStep,-M*h._panStep],center:L.getCenter()},{originalEvent:l})}}}},fu.prototype.enable=function(){this._enabled=!0},fu.prototype.disable=function(){this._enabled=!1,this.reset()},fu.prototype.isEnabled=function(){return this._enabled},fu.prototype.isActive=function(){return this._active},fu.prototype.disableRotation=function(){this._rotationDisabled=!0},fu.prototype.enableRotation=function(){this._rotationDisabled=!1};var ki=function(l,h){this._map=l,this._el=l.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};ki.prototype.setZoomRate=function(l){this._defaultZoomRate=l},ki.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},ki.prototype.isEnabled=function(){return!!this._enabled},ki.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},ki.prototype.isZooming=function(){return!!this._zooming},ki.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},ki.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ki.prototype.wheel=function(l){if(this.isEnabled()){var h=l.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=m.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,h!==0&&h%4.000244140625==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}},ki.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},ki.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var h=Z.mousePos(this._el,l);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ki.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var h=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,M=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,L=this._startZoom,U=this._easing,Y=!1;if(this._type==="wheel"&&L&&U){var le=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),pe=U(le);w=m.number(L,M,pe),le<1?this._frameId||(this._frameId=!0):Y=!0}else w=M,Y=!0;return this._active=!0,Y&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Y,zoomDelta:w-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ki.prototype._smoothOutEasing=function(l){var h=m.ease;if(this._prevEase){var c=this._prevEase,d=(m.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),w=.27/Math.sqrt(E*E+1e-4)*.01,M=Math.sqrt(.0729-w*w);h=m.bezier(w,M,.25,1)}return this._prevEase={start:m.browser.now(),duration:l,easing:h},h},ki.prototype.blur=function(){this.reset()},ki.prototype.reset=function(){this._active=!1};var Eu=function(l,h){this._clickZoom=l,this._tapZoom=h};Eu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Eu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Eu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Eu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Vs=function(){this.reset()};Vs.prototype.reset=function(){this._active=!1},Vs.prototype.blur=function(){this.reset()},Vs.prototype.dblclick=function(l,h){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(h)},{originalEvent:l})}}},Vs.prototype.enable=function(){this._enabled=!0},Vs.prototype.disable=function(){this._enabled=!1,this.reset()},Vs.prototype.isEnabled=function(){return this._enabled},Vs.prototype.isActive=function(){return this._active};var So=function(){this._tap=new lu({numTouches:1,numTaps:1}),this.reset()};So.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},So.prototype.touchstart=function(l,h,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=h[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,h,c))},So.prototype.touchmove=function(l,h,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=h[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,h,c)},So.prototype.touchend=function(l,h,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,h,c)&&(this._tapTime=l.timeStamp)},So.prototype.touchcancel=function(){this.reset()},So.prototype.enable=function(){this._enabled=!0},So.prototype.disable=function(){this._enabled=!1,this.reset()},So.prototype.isEnabled=function(){return this._enabled},So.prototype.isActive=function(){return this._active};var gl=function(l,h,c){this._el=l,this._mousePan=h,this._touchPan=c};gl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},gl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},gl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},gl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var al=function(l,h,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=c};al.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},al.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},al.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},al.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Qs=function(l,h,c,d){this._el=l,this._touchZoom=h,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Qs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Qs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Qs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Qs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Qs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Qs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var hs=function(l){return l.zoom||l.drag||l.pitch||l.rotate},Gs=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h}(m.Event);function Fn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var Tn=function(l,h){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new nl(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),m.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[m.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var w=E[d],M=w[0];Z.addEventListener(M,w[1],M===m.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};Tn.prototype.destroy=function(){for(var l=0,h=this._listeners;l<h.length;l+=1){var c=h[l],d=c[0];Z.removeEventListener(d,c[1],d===m.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},Tn.prototype._addDefaultHandlers=function(l){var h=this._map,c=h.getCanvasContainer();this._add("mapEvent",new xo(h,l));var d=h.boxZoom=new ho(h,l);this._add("boxZoom",d);var E=new ks,w=new Vs;h.doubleClickZoom=new Eu(w,E),this._add("tapZoom",E),this._add("clickZoom",w);var M=new So;this._add("tapDragZoom",M);var L=h.touchPitch=new Wc;this._add("touchPitch",L);var U=new pc(l),Y=new ju(l);h.dragRotate=new al(l,U,Y),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate"]);var le=new vf(l),pe=new Ba(l);h.dragPan=new gl(c,le,pe),this._add("mousePan",le),this._add("touchPan",pe,["touchZoom","touchRotate"]);var ve=new wh,Re=new as;h.touchZoomRotate=new Qs(c,Re,ve,M),this._add("touchRotate",ve,["touchPan","touchZoom"]),this._add("touchZoom",Re,["touchPan","touchRotate"]);var Ie=h.scrollZoom=new ki(h,this);this._add("scrollZoom",Ie,["mousePan"]);var je=h.keyboard=new fu;this._add("keyboard",je),this._add("blockableMapEvent",new yn(h));for(var we=0,Ge=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];we<Ge.length;we+=1){var tt=Ge[we];l.interactive&&l[tt]&&h[tt].enable(l[tt])}},Tn.prototype._add=function(l,h,c){this._handlers.push({handlerName:l,handler:h,allowed:c}),this._handlersById[l]=h},Tn.prototype.stop=function(l){if(!this._updatingCamera){for(var h=0,c=this._handlers;h<c.length;h+=1)c[h].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},Tn.prototype.isActive=function(){for(var l=0,h=this._handlers;l<h.length;l+=1)if(h[l].handler.isActive())return!0;return!1},Tn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Tn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Tn.prototype.isMoving=function(){return Boolean(hs(this._eventsInProgress))||this.isZooming()},Tn.prototype._blockedByActive=function(l,h,c){for(var d in l)if(d!==c&&(!h||h.indexOf(d)<0))return!0;return!1},Tn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},Tn.prototype._getMapTouches=function(l){for(var h=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&h.push(E)}return h},Tn.prototype.handleEvent=function(l,h){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},w={},M=l.touches?this._getMapTouches(l.touches):void 0,L=M?Z.touchPos(this._el,M):Z.mousePos(this._el,l),U=0,Y=this._handlers;U<Y.length;U+=1){var le=Y[U],pe=le.handlerName,ve=le.handler,Re=le.allowed;if(ve.isEnabled()){var Ie=void 0;this._blockedByActive(w,Re,pe)?ve.reset():ve[h||l.type]&&(Ie=ve[h||l.type](l,L,M),this.mergeHandlerResult(d,E,Ie,pe,c),Ie&&Ie.needsRenderFrame&&this._triggerRenderFrame()),(Ie||ve.isActive())&&(w[pe]=ve)}}var je={};for(var we in this._previousActiveHandlers)w[we]||(je[we]=c);this._previousActiveHandlers=w,(Object.keys(je).length||Fn(d))&&(this._changes.push([d,E,je]),this._triggerRenderFrame()),(Object.keys(w).length||Fn(d))&&this._map._stop(!0),this._updatingCamera=!1;var Ge=d.cameraAnimation;Ge&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ge(this._map))},Tn.prototype.mergeHandlerResult=function(l,h,c,d,E){if(c){m.extend(l,c);var w={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(h.zoom=w),c.panDelta!==void 0&&(h.drag=w),c.pitchDelta!==void 0&&(h.pitch=w),c.bearingDelta!==void 0&&(h.rotate=w)}},Tn.prototype._applyChanges=function(){for(var l={},h={},c={},d=0,E=this._changes;d<E.length;d+=1){var w=E[d],M=w[0],L=w[1],U=w[2];M.panDelta&&(l.panDelta=(l.panDelta||new m.Point(0,0))._add(M.panDelta)),M.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+M.pitchDelta),M.around!==void 0&&(l.around=M.around),M.pinchAround!==void 0&&(l.pinchAround=M.pinchAround),M.noInertia&&(l.noInertia=M.noInertia),m.extend(h,L),m.extend(c,U)}this._updateMapTransform(l,h,c),this._changes=[]},Tn.prototype._updateMapTransform=function(l,h,c){var d=this._map,E=d.transform;if(!Fn(l))return this._fireEvents(h,c,!0);var w=l.panDelta,M=l.zoomDelta,L=l.bearingDelta,U=l.pitchDelta,Y=l.around,le=l.pinchAround;le!==void 0&&(Y=le),d._stop(!0),Y=Y||d.transform.centerPoint;var pe=E.pointLocation(w?Y.sub(w):Y);L&&(E.bearing+=L),U&&(E.pitch+=U),M&&(E.zoom+=M),E.setLocationAtPoint(pe,Y),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,c,!0)},Tn.prototype._fireEvents=function(l,h,c){var d=this,E=hs(this._eventsInProgress),w=hs(l),M={};for(var L in l)this._eventsInProgress[L]||(M[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var U in!E&&w&&this._fireEvent("movestart",w.originalEvent),M)this._fireEvent(U,M[U]);for(var Y in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(Y,l[Y].originalEvent);var le,pe={};for(var ve in this._eventsInProgress){var Re=this._eventsInProgress[ve],Ie=Re.handlerName,je=Re.originalEvent;this._handlersById[Ie].isActive()||(delete this._eventsInProgress[ve],pe[ve+"end"]=le=h[Ie]||je)}for(var we in pe)this._fireEvent(we,pe[we]);var Ge=hs(this._eventsInProgress);if(c&&(E||w)&&!Ge){this._updatingCamera=!0;var tt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),xt=function(Ht){return Ht!==0&&-d._bearingSnap<Ht&&Ht<d._bearingSnap};tt?(xt(tt.bearing||this._map.getBearing())&&(tt.bearing=0),this._map.easeTo(tt,{originalEvent:le})):(this._map.fire(new m.Event("moveend",{originalEvent:le})),xt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Tn.prototype._fireEvent=function(l,h){this._map.fire(new m.Event(l,h?{originalEvent:h}:{}))},Tn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(h){delete l._frameId,l.handleEvent(new Gs("renderFrame",{timeStamp:h})),l._applyChanges()})},Tn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Xc=function(l){function h(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},h.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},h.prototype.panBy=function(c,d,E){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},d),E)},h.prototype.panTo=function(c,d,E){return this.easeTo(m.extend({center:c},d),E)},h.prototype.getZoom=function(){return this.transform.zoom},h.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},h.prototype.zoomTo=function(c,d,E){return this.easeTo(m.extend({zoom:c},d),E)},h.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},h.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},h.prototype.getBearing=function(){return this.transform.bearing},h.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},h.prototype.getPadding=function(){return this.transform.padding},h.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},h.prototype.rotateTo=function(c,d,E){return this.easeTo(m.extend({bearing:c},d),E)},h.prototype.resetNorth=function(c,d){return this.rotateTo(0,m.extend({duration:1e3},c),d),this},h.prototype.resetNorthPitch=function(c,d){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),d),this},h.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},h.prototype.getPitch=function(){return this.transform.pitch},h.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},h.prototype.cameraForBounds=function(c,d){c=m.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},h.prototype._cameraForBoxAndBearing=function(c,d,E,w){var M={top:0,bottom:0,right:0,left:0};if(typeof(w=m.extend({padding:M,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var L=w.padding;w.padding={top:L,bottom:L,right:L,left:L}}w.padding=m.extend(M,w.padding);var U=this.transform,Y=U.padding,le=U.project(m.LngLat.convert(c)),pe=U.project(m.LngLat.convert(d)),ve=le.rotate(-E*Math.PI/180),Re=pe.rotate(-E*Math.PI/180),Ie=new m.Point(Math.max(ve.x,Re.x),Math.max(ve.y,Re.y)),je=new m.Point(Math.min(ve.x,Re.x),Math.min(ve.y,Re.y)),we=Ie.sub(je),Ge=(U.width-(Y.left+Y.right+w.padding.left+w.padding.right))/we.x,tt=(U.height-(Y.top+Y.bottom+w.padding.top+w.padding.bottom))/we.y;if(!(tt<0||Ge<0)){var xt=Math.min(U.scaleZoom(U.scale*Math.min(Ge,tt)),w.maxZoom),Ht=typeof w.offset.x=="number"?new m.Point(w.offset.x,w.offset.y):m.Point.convert(w.offset),Zt=new m.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(E*Math.PI/180),Jt=Ht.add(Zt).mult(U.scale/U.zoomScale(xt));return{center:U.unproject(le.add(pe).div(2).sub(Jt)),zoom:xt,bearing:E}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},h.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},h.prototype.fitScreenCoordinates=function(c,d,E,w,M){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(c)),this.transform.pointLocation(m.Point.convert(d)),E,w),w,M)},h.prototype._fitInternal=function(c,d,E){return c?(delete(d=m.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},h.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,w=!1,M=!1,L=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(w=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=m.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(M=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(L=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),w&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),M&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),L&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d))},h.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate===!1||!c.essential&&m.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,M=this.getZoom(),L=this.getBearing(),U=this.getPitch(),Y=this.getPadding(),le="zoom"in c?+c.zoom:M,pe="bearing"in c?this._normalizeBearing(c.bearing,L):L,ve="pitch"in c?+c.pitch:U,Re="padding"in c?c.padding:w.padding,Ie=m.Point.convert(c.offset),je=w.centerPoint.add(Ie),we=w.pointLocation(je),Ge=m.LngLat.convert(c.center||we);this._normalizeCenter(Ge);var tt,xt,Ht=w.project(we),Zt=w.project(Ge).sub(Ht),Jt=w.zoomScale(le-M);c.around&&(tt=m.LngLat.convert(c.around),xt=w.locationPoint(tt));var mr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||le!==M,this._rotating=this._rotating||L!==pe,this._pitching=this._pitching||ve!==U,this._padding=!w.isPaddingEqual(Re),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,mr),this._ease(function(Br){if(E._zooming&&(w.zoom=m.number(M,le,Br)),E._rotating&&(w.bearing=m.number(L,pe,Br)),E._pitching&&(w.pitch=m.number(U,ve,Br)),E._padding&&(w.interpolatePadding(Y,Re,Br),je=w.centerPoint.add(Ie)),tt)w.setLocationAtPoint(tt,xt);else{var kr=w.zoomScale(w.zoom-M),un=le>M?Math.min(2,Jt):Math.max(.5,Jt),Mn=Math.pow(un,1-Br),Nn=w.unproject(Ht.add(Zt.mult(Br*Mn)).mult(kr));w.setLocationAtPoint(w.renderWorldCopies?Nn.wrap():Nn,je)}E._fireMoveEvents(d)},function(Br){E._afterEase(d,Br)},c),this},h.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new m.Event("pitchstart",c))},h.prototype._fireMoveEvents=function(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))},h.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,w=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new m.Event("zoomend",c)),w&&this.fire(new m.Event("rotateend",c)),M&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}},h.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&m.browser.prefersReducedMotion){var w=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,d)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);var M=this.transform,L=this.getZoom(),U=this.getBearing(),Y=this.getPitch(),le=this.getPadding(),pe="zoom"in c?m.clamp(+c.zoom,M.minZoom,M.maxZoom):L,ve="bearing"in c?this._normalizeBearing(c.bearing,U):U,Re="pitch"in c?+c.pitch:Y,Ie="padding"in c?c.padding:M.padding,je=M.zoomScale(pe-L),we=m.Point.convert(c.offset),Ge=M.centerPoint.add(we),tt=M.pointLocation(Ge),xt=m.LngLat.convert(c.center||tt);this._normalizeCenter(xt);var Ht=M.project(tt),Zt=M.project(xt).sub(Ht),Jt=c.curve,mr=Math.max(M.width,M.height),Br=mr/je,kr=Zt.mag();if("minZoom"in c){var un=m.clamp(Math.min(c.minZoom,L,pe),M.minZoom,M.maxZoom),Mn=mr/M.zoomScale(un-L);Jt=Math.sqrt(Mn/kr*2)}var Nn=Jt*Jt;function Rn(Kn){var Yn=(Br*Br-mr*mr+(Kn?-1:1)*Nn*Nn*kr*kr)/(2*(Kn?Br:mr)*Nn*kr);return Math.log(Math.sqrt(Yn*Yn+1)-Yn)}function Fi(Kn){return(Math.exp(Kn)-Math.exp(-Kn))/2}function ln(Kn){return(Math.exp(Kn)+Math.exp(-Kn))/2}var oi=Rn(0),si=function(Kn){return ln(oi)/ln(oi+Jt*Kn)},ni=function(Kn){return mr*((ln(oi)*(Fi(Yn=oi+Jt*Kn)/ln(Yn))-Fi(oi))/Nn)/kr;var Yn},Xn=(Rn(1)-oi)/Jt;if(Math.abs(kr)<1e-6||!isFinite(Xn)){if(Math.abs(mr-Br)<1e-6)return this.easeTo(c,d);var yi=Br<mr?-1:1;Xn=Math.abs(Math.log(Br/mr))/Jt,ni=function(){return 0},si=function(Kn){return Math.exp(yi*Jt*Kn)}}return c.duration="duration"in c?+c.duration:1e3*Xn/("screenSpeed"in c?+c.screenSpeed/Jt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==ve,this._pitching=Re!==Y,this._padding=!M.isPaddingEqual(Ie),this._prepareEase(d,!1),this._ease(function(Kn){var Yn=Kn*Xn,Co=1/si(Yn);M.zoom=Kn===1?pe:L+M.scaleZoom(Co),E._rotating&&(M.bearing=m.number(U,ve,Kn)),E._pitching&&(M.pitch=m.number(Y,Re,Kn)),E._padding&&(M.interpolatePadding(le,Ie,Kn),Ge=M.centerPoint.add(we));var Ya=Kn===1?xt:M.unproject(Ht.add(Zt.mult(ni(Yn))).mult(Co));M.setLocationAtPoint(M.renderWorldCopies?Ya.wrap():Ya,Ge),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},h.prototype.isEasing=function(){return!!this._easeFrameId},h.prototype.stop=function(){return this._stop()},h.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},h.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=m.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},h.prototype._renderFrameCallback=function(){var c=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},h.prototype._normalizeBearing=function(c,d){c=m.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},h.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},h}(m.Evented),ps=function(l){l===void 0&&(l={}),this.options=l,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ps.prototype.getDefaultPosition=function(){return"bottom-right"},ps.prototype.onAdd=function(l){var h=this.options&&this.options.compact;return this._map=l,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ps.prototype.onRemove=function(){Z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ps.prototype._setElementTitle=function(l,h){var c=this._map._getUIString("AttributionControl."+h);l.title=c,l.setAttribute("aria-label",c)},ps.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ps.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(l){var c=h.reduce(function(d,E,w){return E.value&&(d+=E.key+"="+E.value+(w<h.length-1?"&":"")),d},"?");l.href=m.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},ps.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ps.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var w=E.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(L,U){return L.length-U.length});var M=(l=l.filter(function(L,U){for(var Y=U+1;Y<l.length;Y++)if(l[Y].indexOf(L)>=0)return!1;return!0})).join(" | ");M!==this._attribHTML&&(this._attribHTML=M,l.length?(this._innerContainer.innerHTML=M,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ps.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Ro=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};Ro.prototype.onAdd=function(l){this._map=l,this._container=Z.create("div","mapboxgl-ctrl");var h=Z.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Ro.prototype.onRemove=function(){Z.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Ro.prototype.getDefaultPosition=function(){return"bottom-left"},Ro.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Ro.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var h in l)if(l[h].getSource().mapbox_logo)return!0;return!1}},Ro.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var h=l[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}};var os=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};os.prototype.add=function(l){var h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h},os.prototype.remove=function(l){for(var h=this._currentlyRunning,c=0,d=h?this._queue.concat(h):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},os.prototype.run=function(l){l===void 0&&(l=0);var h=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=h;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},os.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Gu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},gf=m.window.HTMLImageElement,yf=m.window.HTMLElement,ra=m.window.ImageBitmap,Oa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Gf=function(l){function h(d){var E=this;if((d=m.extend({},Oa,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Yi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,w,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new os,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},Gu,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new m.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=m.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof yf))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),m.window!==void 0&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Tn(this,d),this._hash=d.hash&&new Cs(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,m.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new ps({customAttribution:d.customAttribution})),this.addControl(new Ro,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(M){E._update(M.dataType==="style"),E.fire(new m.Event(M.dataType+"data",M))}),this.on("dataloading",function(M){E.fire(new m.Event(M.dataType+"dataloading",M))})}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return h.prototype._getMapId=function(){return this._mapId},h.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=d.onAdd(this);this._controls.push(d);var M=this._controlPositions[E];return E.indexOf("bottom")!==-1?M.insertBefore(w,M.firstChild):M.appendChild(w),this},h.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},h.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},h.prototype.resize=function(d){var E=this._containerDimensions(),w=E[0],M=E[1];if(w===this.transform.width&&M===this.transform.height)return this;this._resizeCanvas(w,M),this.transform.resize(w,M),this.painter.resize(w,M);var L=!this._moving;return L&&this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),this.fire(new m.Event("resize",d)),L&&this.fire(new m.Event("moveend",d)),this},h.prototype.getBounds=function(){return this.transform.getBounds()},h.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},h.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(m.LngLatBounds.convert(d)),this._update()},h.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},h.prototype.getMinZoom=function(){return this.transform.minZoom},h.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},h.prototype.getMaxZoom=function(){return this.transform.maxZoom},h.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},h.prototype.getMinPitch=function(){return this.transform.minPitch},h.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},h.prototype.getMaxPitch=function(){return this.transform.maxPitch},h.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},h.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},h.prototype.project=function(d){return this.transform.locationPoint(m.LngLat.convert(d))},h.prototype.unproject=function(d){return this.transform.pointLocation(m.Point.convert(d))},h.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},h.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},h.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},h.prototype._createDelegatedListener=function(d,E,w){var M,L=this;if(d==="mouseenter"||d==="mouseover"){var U=!1;return{layer:E,listener:w,delegates:{mousemove:function(le){var pe=L.getLayer(E)?L.queryRenderedFeatures(le.point,{layers:[E]}):[];pe.length?U||(U=!0,w.call(L,new _o(d,L,le.originalEvent,{features:pe}))):U=!1},mouseout:function(){U=!1}}}}if(d==="mouseleave"||d==="mouseout"){var Y=!1;return{layer:E,listener:w,delegates:{mousemove:function(le){(L.getLayer(E)?L.queryRenderedFeatures(le.point,{layers:[E]}):[]).length?Y=!0:Y&&(Y=!1,w.call(L,new _o(d,L,le.originalEvent)))},mouseout:function(le){Y&&(Y=!1,w.call(L,new _o(d,L,le.originalEvent)))}}}}return{layer:E,listener:w,delegates:(M={},M[d]=function(le){var pe=L.getLayer(E)?L.queryRenderedFeatures(le.point,{layers:[E]}):[];pe.length&&(le.features=pe,w.call(L,le),delete le.features)},M)}},h.prototype.on=function(d,E,w){if(w===void 0)return l.prototype.on.call(this,d,E);var M=this._createDelegatedListener(d,E,w);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(M),M.delegates)this.on(L,M.delegates[L]);return this},h.prototype.once=function(d,E,w){if(w===void 0)return l.prototype.once.call(this,d,E);var M=this._createDelegatedListener(d,E,w);for(var L in M.delegates)this.once(L,M.delegates[L]);return this},h.prototype.off=function(d,E,w){var M=this;return w===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(L){for(var U=L[d],Y=0;Y<U.length;Y++){var le=U[Y];if(le.layer===E&&le.listener===w){for(var pe in le.delegates)M.off(pe,le.delegates[pe]);return U.splice(Y,1),M}}}(this._delegatedListeners),this)},h.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var w;if(E!==void 0||d===void 0||d instanceof m.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||typeof d[0]=="number")w=[m.Point.convert(d)];else{var M=m.Point.convert(d[0]),L=m.Point.convert(d[1]);w=[M,new m.Point(L.x,M.y),L,new m.Point(M.x,L.y),M]}return this.style.queryRenderedFeatures(w,E,this.transform)},h.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},h.prototype.setStyle=function(d,E){return(E=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},h.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},h.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new Es(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},h.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Es(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},h.prototype._diffStyle=function(d,E){var w=this;if(typeof d=="string"){var M=this._requestManager.normalizeStyleURL(d),L=this._requestManager.transformRequest(M,m.ResourceType.Style);m.getJSON(L,function(U,Y){U?w.fire(new m.ErrorEvent(U)):Y&&w._updateDiff(Y,E)})}else typeof d=="object"&&this._updateDiff(d,E)},h.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(w){m.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},h.prototype.getStyle=function(){if(this.style)return this.style.serialize()},h.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},h.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},h.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},h.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var w=d[E]._tiles;for(var M in w){var L=w[M];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},h.prototype.addSourceType=function(d,E,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,w)},h.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},h.prototype.getSource=function(d){return this.style.getSource(d)},h.prototype.addImage=function(d,E,w){w===void 0&&(w={});var M=w.pixelRatio;M===void 0&&(M=1);var L=w.sdf;L===void 0&&(L=!1);var U=w.stretchX,Y=w.stretchY,le=w.content;if(this._lazyInitEmptyStyle(),E instanceof gf||ra&&E instanceof ra){var pe=m.browser.getImageData(E);this.style.addImage(d,{data:new m.RGBAImage({width:pe.width,height:pe.height},pe.data),pixelRatio:M,stretchX:U,stretchY:Y,content:le,sdf:L,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var ve=E;this.style.addImage(d,{data:new m.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:M,stretchX:U,stretchY:Y,content:le,sdf:L,version:0,userImage:ve}),ve.onAdd&&ve.onAdd(this,d)}},h.prototype.updateImage=function(d,E){var w=this.style.getImage(d);if(!w)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var M=E instanceof gf||ra&&E instanceof ra?m.browser.getImageData(E):E,L=M.width,U=M.height,Y=M.data;return L===void 0||U===void 0?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==w.data.width||U!==w.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(Y,!(E instanceof gf||ra&&E instanceof ra)),void this.style.updateImage(d,w))},h.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},h.prototype.removeImage=function(d){this.style.removeImage(d)},h.prototype.loadImage=function(d,E){m.getImage(this._requestManager.transformRequest(d,m.ResourceType.Image),E)},h.prototype.listImages=function(){return this.style.listImages()},h.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},h.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},h.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},h.prototype.getLayer=function(d){return this.style.getLayer(d)},h.prototype.setLayerZoomRange=function(d,E,w){return this.style.setLayerZoomRange(d,E,w),this._update(!0)},h.prototype.setFilter=function(d,E,w){return w===void 0&&(w={}),this.style.setFilter(d,E,w),this._update(!0)},h.prototype.getFilter=function(d){return this.style.getFilter(d)},h.prototype.setPaintProperty=function(d,E,w,M){return M===void 0&&(M={}),this.style.setPaintProperty(d,E,w,M),this._update(!0)},h.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},h.prototype.setLayoutProperty=function(d,E,w,M){return M===void 0&&(M={}),this.style.setLayoutProperty(d,E,w,M),this._update(!0)},h.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},h.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},h.prototype.getLight=function(){return this.style.getLight()},h.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},h.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},h.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},h.prototype.getContainer=function(){return this._container},h.prototype.getCanvasContainer=function(){return this._canvasContainer},h.prototype.getCanvas=function(){return this._canvas},h.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},h.prototype._detectMissingCSS=function(){m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},h.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=Z.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=Z.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var M=this._controlContainer=Z.create("div","mapboxgl-control-container",d),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){L[U]=Z.create("div","mapboxgl-ctrl-"+U,M)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},h.prototype._resizeCanvas=function(d,E){var w=m.browser.devicePixelRatio||1;this._canvas.width=w*d,this._canvas.height=w*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},h.prototype._setupPainter=function(){var d=m.extend({},de.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new Ji(E,this.transform),m.webpSupported.testSupport(E)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},h.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:d}))},h.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:d}))},h.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},h.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},h.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},h.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},h.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},h.prototype._render=function(d){var E,w=this,M=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,E),M=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var Y=this.transform.zoom,le=m.browser.now();this.style.zoomHistory.update(Y,le);var pe=new m.EvaluationParameters(Y,{now:le,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ve=pe.crossFadingFactor();ve===1&&ve===this._crossFadingFactor||(U=!0,this._crossFadingFactor=ve),this.style.update(pe)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Re=m.browser.now()-M;L.endQueryEXT(L.TIME_ELAPSED_EXT,E),setTimeout(function(){var we=L.getQueryObjectEXT(E,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(E),w.fire(new m.Event("gpu-timing-frame",{cpuTime:Re,gpuTime:we}))},50)}if(this.listens("gpu-timing-layer")){var Ie=this.painter.collectGpuTimers();setTimeout(function(){var we=w.painter.queryGpuTimers(Ie);w.fire(new m.Event("gpu-timing-layer",{layerTimes:we}))},50)}var je=this._sourcesDirty||this._styleDirty||this._placementDirty;return je||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||je||(this._fullyLoaded=!0),this}},h.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),m.window!==void 0&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),yl(this._canvasContainer),yl(this._controlContainer),yl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},h.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(E){d._frame=null,d._render(E)}))},h.prototype._onWindowOnline=function(){this._update()},h.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},h.prototype._setCacheLimits=function(d,E){m.setCacheLimits(d,E)},c.version.get=function(){return m.version},Object.defineProperties(h.prototype,c),h}(Xc);function yl(l){l.parentNode&&l.parentNode.removeChild(l)}var hu={showCompass:!0,showZoom:!0,visualizePitch:!1},Su=function(l){var h=this;this.options=m.extend({},hu,l),this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return h._map.zoomIn({},{originalEvent:c})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return h._map.zoomOut({},{originalEvent:c})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){h.options.visualizePitch?h._map.resetNorthPitch({},{originalEvent:c}):h._map.resetNorth({},{originalEvent:c})}),this._compassIcon=Z.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Su.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),h=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},Su.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},Su.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Lo(this._map,this._compass,this.options.visualizePitch)),this._container},Su.prototype.onRemove=function(){Z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Su.prototype._createButton=function(l,h){var c=Z.create("button",l,this._container);return c.type="button",c.addEventListener("click",h),c},Su.prototype._setButtonTitle=function(l,h){var c=this._map._getUIString("NavigationControl."+h);l.title=c,l.setAttribute("aria-label",c)};var Lo=function(l,h,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=h,this.mouseRotate=new pc({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new ju({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Z.addEventListener(h,"mousedown",this.mousedown),Z.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),Z.addEventListener(h,"touchmove",this.touchmove),Z.addEventListener(h,"touchend",this.touchend),Z.addEventListener(h,"touchcancel",this.reset)};function _l(l,h,c){if(l=new m.LngLat(l.lng,l.lat),h){var d=new m.LngLat(l.lng-360,l.lat),E=new m.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(h);c.locationPoint(d).distSqr(h)<w?l=d:c.locationPoint(E).distSqr(h)<w&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var M=c.locationPoint(l);if(M.x>=0&&M.y>=0&&M.x<=c.width&&M.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}Lo.prototype.down=function(l,h){this.mouseRotate.mousedown(l,h),this.mousePitch&&this.mousePitch.mousedown(l,h),Z.disableDrag()},Lo.prototype.move=function(l,h){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,h);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,h);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},Lo.prototype.off=function(){var l=this.element;Z.removeEventListener(l,"mousedown",this.mousedown),Z.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),Z.removeEventListener(l,"touchmove",this.touchmove),Z.removeEventListener(l,"touchend",this.touchend),Z.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},Lo.prototype.offTemp=function(){Z.enableDrag(),Z.removeEventListener(m.window,"mousemove",this.mousemove),Z.removeEventListener(m.window,"mouseup",this.mouseup)},Lo.prototype.mousedown=function(l){this.down(m.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),Z.mousePos(this.element,l)),Z.addEventListener(m.window,"mousemove",this.mousemove),Z.addEventListener(m.window,"mouseup",this.mouseup)},Lo.prototype.mousemove=function(l){this.move(l,Z.mousePos(this.element,l))},Lo.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},Lo.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Z.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},Lo.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=Z.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},Lo.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Lo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Cu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function _f(l,h,c){var d=l.classList;for(var E in Cu)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+h)}var Zl,Au=function(l){function h(c,d){if(l.call(this),(c instanceof m.window.HTMLElement||d)&&(c=m.extend({element:c},d)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z.create("div"),this._element.setAttribute("aria-label","Map marker");var E=Z.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var w=Z.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var M=Z.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");var L=Z.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var U=0,Y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<Y.length;U+=1){var le=Y[U],pe=Z.createNS("http://www.w3.org/2000/svg","ellipse");pe.setAttributeNS(null,"opacity","0.04"),pe.setAttributeNS(null,"cx","10.5"),pe.setAttributeNS(null,"cy","5.80029008"),pe.setAttributeNS(null,"rx",le.rx),pe.setAttributeNS(null,"ry",le.ry),L.appendChild(pe)}var ve=Z.createNS("http://www.w3.org/2000/svg","g");ve.setAttributeNS(null,"fill",this._color);var Re=Z.createNS("http://www.w3.org/2000/svg","path");Re.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ve.appendChild(Re);var Ie=Z.createNS("http://www.w3.org/2000/svg","g");Ie.setAttributeNS(null,"opacity","0.25"),Ie.setAttributeNS(null,"fill","#000000");var je=Z.createNS("http://www.w3.org/2000/svg","path");je.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ie.appendChild(je);var we=Z.createNS("http://www.w3.org/2000/svg","g");we.setAttributeNS(null,"transform","translate(6.0, 7.0)"),we.setAttributeNS(null,"fill","#FFFFFF");var Ge=Z.createNS("http://www.w3.org/2000/svg","g");Ge.setAttributeNS(null,"transform","translate(8.0, 8.0)");var tt=Z.createNS("http://www.w3.org/2000/svg","circle");tt.setAttributeNS(null,"fill","#000000"),tt.setAttributeNS(null,"opacity","0.25"),tt.setAttributeNS(null,"cx","5.5"),tt.setAttributeNS(null,"cy","5.5"),tt.setAttributeNS(null,"r","5.4999962");var xt=Z.createNS("http://www.w3.org/2000/svg","circle");xt.setAttributeNS(null,"fill","#FFFFFF"),xt.setAttributeNS(null,"cx","5.5"),xt.setAttributeNS(null,"cy","5.5"),xt.setAttributeNS(null,"r","5.4999962"),Ge.appendChild(tt),Ge.appendChild(xt),M.appendChild(L),M.appendChild(ve),M.appendChild(Ie),M.appendChild(we),M.appendChild(Ge),E.appendChild(M),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ht){Ht.preventDefault()}),this._element.addEventListener("mousedown",function(Ht){Ht.preventDefault()}),_f(this._element,this._anchor,"marker"),this._popup=null}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},h.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Z.remove(this._element),this._popup&&this._popup.remove(),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},h.prototype.getElement=function(){return this._element},h.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},h.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},h.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},h.prototype.getPopup=function(){return this._popup},h.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},h.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=_l(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),Z.setTransform(this._element,Cu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},h.prototype.getOffset=function(){return this._offset},h.prototype.setOffset=function(c){return this._offset=m.Point.convert(c),this._update(),this},h.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},h.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new m.Event("dragend")),this._state="inactive"},h.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},h.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},h.prototype.isDraggable=function(){return this._draggable},h.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},h.prototype.getRotation=function(){return this._rotation},h.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},h.prototype.getRotationAlignment=function(){return this._rotationAlignment},h.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},h.prototype.getPitchAlignment=function(){return this._pitchAlignment},h}(m.Evented),Hf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},xl=0,bl=!1,Ea=function(l){function h(c){l.call(this),this.options=m.extend({},Hf,c),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.onAdd=function(c){var d;return this._map=c,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Zl!==void 0?d(Zl):m.window.navigator.permissions!==void 0?m.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(Zl=E.state!=="denied")}):d(Zl=!!m.window.navigator.geolocation),this._container},h.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,xl=0,bl=!1},h.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},h.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},h.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",c)),this._finish()}},h.prototype._updateCamera=function(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,w=this._map.getBearing(),M=m.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),M,{geolocateSource:!0})},h.prototype._updateMarker=function(c){if(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},h.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),w=d.distanceTo(E),M=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=M+"px",this._circleElement.style.height=M+"px"},h.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},h.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&bl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",c)),this._finish()}},h.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},h.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(M){return M.preventDefault()}),this._geolocateButton=Z.create("button","mapboxgl-ctrl-geolocate",this._container),Z.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Au(this._dotElement),this._circleElement=Z.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Au({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(M){M.geolocateSource||d._watchState!=="ACTIVE_LOCK"||M.originalEvent&&M.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new m.Event("trackuserlocationend")))})},h.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":xl--,bl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++xl>1?(c={maximumAge:6e5,timeout:0},bl=!0):(c=this.options.positionOptions,bl=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},h.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},h}(m.Evented),Js={maxWidth:100,unit:"metric"},pu=function(l){this.options=m.extend({},Js,l),m.bindAll(["_onMove","setUnit"],this)};function jl(l,h,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,w=l.unproject([0,E]),M=l.unproject([d,E]),L=w.distanceTo(M);if(c&&c.unit==="imperial"){var U=3.2808*L;U>5280?wu(h,d,U/5280,l._getUIString("ScaleControl.Miles")):wu(h,d,U,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?wu(h,d,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?wu(h,d,L/1e3,l._getUIString("ScaleControl.Kilometers")):wu(h,d,L,l._getUIString("ScaleControl.Meters"))}function wu(l,h,c,d){var E,w,M,L=(E=c,(w=Math.pow(10,(""+Math.floor(E)).length-1))*(M=(M=E/w)>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(U){var Y=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*Y)/Y}(M)));l.style.width=h*(L/c)+"px",l.innerHTML=L+"&nbsp;"+d}pu.prototype.getDefaultPosition=function(){return"bottom-left"},pu.prototype._onMove=function(){jl(this._map,this._container,this.options)},pu.prototype.onAdd=function(l){return this._map=l,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},pu.prototype.onRemove=function(){Z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},pu.prototype.setUnit=function(l){this.options.unit=l,jl(this._map,this._container,this.options)};var ws=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof m.window.HTMLElement?this._container=l.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};ws.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},ws.prototype.onRemove=function(){Z.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},ws.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},ws.prototype._setupUI=function(){var l=this._fullscreenButton=Z.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},ws.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},ws.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},ws.prototype._isFullscreen=function(){return this._fullscreen},ws.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},ws.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Yc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Na=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),ol=function(l){function h(c){l.call(this),this.options=m.extend(Object.create(Yc),c),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},h.prototype.isOpen=function(){return!!this._map},h.prototype.remove=function(){return this._content&&Z.remove(this._content),this._container&&(Z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},h.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},h.prototype.getElement=function(){return this._container},h.prototype.setText=function(c){return this.setDOMContent(m.window.document.createTextNode(c))},h.prototype.setHTML=function(c){var d,E=m.window.document.createDocumentFragment(),w=m.window.document.createElement("body");for(w.innerHTML=c;d=w.firstChild;)E.appendChild(d);return this.setDOMContent(E)},h.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},h.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},h.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Z.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},h.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},h.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},h.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},h.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},h.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Z.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},h.prototype._onMouseUp=function(c){this._update(c.point)},h.prototype._onMouseMove=function(c){this._update(c.point)},h.prototype._onDrag=function(c){this._update(c.point)},h.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Z.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Z.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(pe){return d._container.classList.add(pe)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=_l(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,M=function pe(ve){if(ve){if(typeof ve=="number"){var Re=Math.round(Math.sqrt(.5*Math.pow(ve,2)));return{center:new m.Point(0,0),top:new m.Point(0,ve),"top-left":new m.Point(Re,Re),"top-right":new m.Point(-Re,Re),bottom:new m.Point(0,-ve),"bottom-left":new m.Point(Re,-Re),"bottom-right":new m.Point(-Re,-Re),left:new m.Point(ve,0),right:new m.Point(-ve,0)}}if(ve instanceof m.Point||Array.isArray(ve)){var Ie=m.Point.convert(ve);return{center:Ie,top:Ie,"top-left":Ie,"top-right":Ie,bottom:Ie,"bottom-left":Ie,"bottom-right":Ie,left:Ie,right:Ie}}return{center:m.Point.convert(ve.center||[0,0]),top:m.Point.convert(ve.top||[0,0]),"top-left":m.Point.convert(ve["top-left"]||[0,0]),"top-right":m.Point.convert(ve["top-right"]||[0,0]),bottom:m.Point.convert(ve.bottom||[0,0]),"bottom-left":m.Point.convert(ve["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(ve["bottom-right"]||[0,0]),left:m.Point.convert(ve.left||[0,0]),right:m.Point.convert(ve.right||[0,0])}}return pe(new m.Point(0,0))}(this.options.offset);if(!w){var L,U=this._container.offsetWidth,Y=this._container.offsetHeight;L=E.y+M.bottom.y<Y?["top"]:E.y>this._map.transform.height-Y?["bottom"]:[],E.x<U/2?L.push("left"):E.x>this._map.transform.width-U/2&&L.push("right"),w=L.length===0?"bottom":L.join("-")}var le=E.add(M[w]).round();Z.setTransform(this._container,Cu[w]+" translate("+le.x+"px,"+le.y+"px)"),_f(this._container,w,"popup")}},h.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Na);c&&c.focus()}},h.prototype._onClose=function(){this.remove()},h}(m.Evented),Hu={version:m.version,supported:de,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:Gf,NavigationControl:Su,GeolocateControl:Ea,AttributionControl:ps,ScaleControl:pu,FullscreenControl:ws,Popup:ol,Marker:Au,Style:Es,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){Ot().acquire(zt)},clearPrewarmedResources:function(){var l=En;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(zt),En=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(l){m.config.ACCESS_TOKEN=l},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(l){m.config.API_URL=l},get workerCount(){return vr.workerCount},set workerCount(l){vr.workerCount=l},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){m.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){m.clearTileCache(l)},workerUrl:""};return Hu}),ie})},28660:function(It,$,z){var ie=z(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var re;(function(m){(function(de){var Z=typeof z.g=="object"?z.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ce=fe(m);typeof Z.Reflect=="undefined"?Z.Reflect=m:ce=fe(Z.Reflect,ce),de(ce);function fe(Le,J){return function(Xe,et){typeof Le[Xe]!="function"&&Object.defineProperty(Le,Xe,{configurable:!0,writable:!0,value:et}),J&&J(Xe,et)}}})(function(de){var Z=Object.prototype.hasOwnProperty,ce=typeof Symbol=="function",fe=ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Le=ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",J=typeof Object.create=="function",Xe={__proto__:[]}instanceof Array,et=!J&&!Xe,Ze={create:J?function(){return cs(Object.create(null))}:Xe?function(){return cs({__proto__:null})}:function(){return cs({})},has:et?function(Nt,nr){return Z.call(Nt,nr)}:function(Nt,nr){return nr in Nt},get:et?function(Nt,nr){return Z.call(Nt,nr)?Nt[nr]:void 0}:function(Nt,nr){return Nt[nr]}},yt=Object.getPrototypeOf(Function),rr=typeof ie=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",bt=!rr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:me(),Xt=!rr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Dn(),Ct=!rr&&typeof WeakMap=="function"?WeakMap:Xa(),at=new Ct;function it(Nt,nr,Ar,en){if(vn(Ar)){if(!Oi(Nt))throw new TypeError;if(!ca(nr))throw new TypeError;return Fr(Nt,nr)}else{if(!Oi(Nt))throw new TypeError;if(!ii(nr))throw new TypeError;if(!ii(en)&&!vn(en)&&!fi(en))throw new TypeError;return fi(en)&&(en=void 0),Ar=Gi(Ar),Jr(Nt,nr,Ar,en)}}de("decorate",it);function Vt(Nt,nr){function Ar(en,wn){if(!ii(en))throw new TypeError;if(!vn(wn)&&!wi(wn))throw new TypeError;Bt(Nt,nr,en,wn)}return Ar}de("metadata",Vt);function q(Nt,nr,Ar,en){if(!ii(Ar))throw new TypeError;return vn(en)||(en=Gi(en)),Bt(Nt,nr,Ar,en)}de("defineMetadata",q);function $t(Nt,nr,Ar){if(!ii(nr))throw new TypeError;return vn(Ar)||(Ar=Gi(Ar)),Ce(Nt,nr,Ar)}de("hasMetadata",$t);function ft(Nt,nr,Ar){if(!ii(nr))throw new TypeError;return vn(Ar)||(Ar=Gi(Ar)),De(Nt,nr,Ar)}de("hasOwnMetadata",ft);function Je(Nt,nr,Ar){if(!ii(nr))throw new TypeError;return vn(Ar)||(Ar=Gi(Ar)),Tt(Nt,nr,Ar)}de("getMetadata",Je);function wt(Nt,nr,Ar){if(!ii(nr))throw new TypeError;return vn(Ar)||(Ar=Gi(Ar)),gt(Nt,nr,Ar)}de("getOwnMetadata",wt);function Qe(Nt,nr){if(!ii(Nt))throw new TypeError;return vn(nr)||(nr=Gi(nr)),Kt(Nt,nr)}de("getMetadataKeys",Qe);function Qt(Nt,nr){if(!ii(Nt))throw new TypeError;return vn(nr)||(nr=Gi(nr)),Cr(Nt,nr)}de("getOwnMetadataKeys",Qt);function Er(Nt,nr,Ar){if(!ii(nr))throw new TypeError;vn(Ar)||(Ar=Gi(Ar));var en=A(nr,Ar,!1);if(vn(en)||!en.delete(Nt))return!1;if(en.size>0)return!0;var wn=at.get(nr);return wn.delete(Ar),wn.size>0||at.delete(nr),!0}de("deleteMetadata",Er);function Fr(Nt,nr){for(var Ar=Nt.length-1;Ar>=0;--Ar){var en=Nt[Ar],wn=en(nr);if(!vn(wn)&&!fi(wn)){if(!ca(wn))throw new TypeError;nr=wn}}return nr}function Jr(Nt,nr,Ar,en){for(var wn=Nt.length-1;wn>=0;--wn){var Bn=Nt[wn],di=Bn(nr,Ar,en);if(!vn(di)&&!fi(di)){if(!ii(di))throw new TypeError;en=di}}return en}function A(Nt,nr,Ar){var en=at.get(Nt);if(vn(en)){if(!Ar)return;en=new bt,at.set(Nt,en)}var wn=en.get(nr);if(vn(wn)){if(!Ar)return;wn=new bt,en.set(nr,wn)}return wn}function Ce(Nt,nr,Ar){var en=De(Nt,nr,Ar);if(en)return!0;var wn=Zo(nr);return fi(wn)?!1:Ce(Nt,wn,Ar)}function De(Nt,nr,Ar){var en=A(nr,Ar,!1);return vn(en)?!1:pi(en.has(Nt))}function Tt(Nt,nr,Ar){var en=De(Nt,nr,Ar);if(en)return gt(Nt,nr,Ar);var wn=Zo(nr);if(!fi(wn))return Tt(Nt,wn,Ar)}function gt(Nt,nr,Ar){var en=A(nr,Ar,!1);if(!vn(en))return en.get(Nt)}function Bt(Nt,nr,Ar,en){var wn=A(Ar,en,!0);wn.set(Nt,nr)}function Kt(Nt,nr){var Ar=Cr(Nt,nr),en=Zo(Nt);if(en===null)return Ar;var wn=Kt(en,nr);if(wn.length<=0)return Ar;if(Ar.length<=0)return wn;for(var Bn=new Xt,di=[],Jn=0,cn=Ar;Jn<cn.length;Jn++){var Li=cn[Jn],Ri=Bn.has(Li);Ri||(Bn.add(Li),di.push(Li))}for(var oo=0,ys=wn;oo<ys.length;oo++){var Li=ys[oo],Ri=Bn.has(Li);Ri||(Bn.add(Li),di.push(Li))}return di}function Cr(Nt,nr){var Ar=[],en=A(Nt,nr,!1);if(vn(en))return Ar;for(var wn=en.keys(),Bn=qn(wn),di=0;;){var Jn=Zi(Bn);if(!Jn)return Ar.length=di,Ar;var cn=Ci(Jn);try{Ar[di]=cn}catch(Li){try{Qi(Bn)}finally{throw Li}}di++}}function Qn(Nt){if(Nt===null)return 1;switch(typeof Nt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Nt===null?1:6;default:return 6}}function vn(Nt){return Nt===void 0}function fi(Nt){return Nt===null}function Gn(Nt){return typeof Nt=="symbol"}function ii(Nt){return typeof Nt=="object"?Nt!==null:typeof Nt=="function"}function hi(Nt,nr){switch(Qn(Nt)){case 0:return Nt;case 1:return Nt;case 2:return Nt;case 3:return Nt;case 4:return Nt;case 5:return Nt}var Ar=nr===3?"string":nr===5?"number":"default",en=xa(Nt,fe);if(en!==void 0){var wn=en.call(Nt,Ar);if(ii(wn))throw new TypeError;return wn}return Wn(Nt,Ar==="default"?"number":Ar)}function Wn(Nt,nr){if(nr==="string"){var Ar=Nt.toString;if($i(Ar)){var en=Ar.call(Nt);if(!ii(en))return en}var wn=Nt.valueOf;if($i(wn)){var en=wn.call(Nt);if(!ii(en))return en}}else{var wn=Nt.valueOf;if($i(wn)){var en=wn.call(Nt);if(!ii(en))return en}var Bn=Nt.toString;if($i(Bn)){var en=Bn.call(Nt);if(!ii(en))return en}}throw new TypeError}function pi(Nt){return!!Nt}function la(Nt){return""+Nt}function Gi(Nt){var nr=hi(Nt,3);return Gn(nr)?nr:la(nr)}function Oi(Nt){return Array.isArray?Array.isArray(Nt):Nt instanceof Object?Nt instanceof Array:Object.prototype.toString.call(Nt)==="[object Array]"}function $i(Nt){return typeof Nt=="function"}function ca(Nt){return typeof Nt=="function"}function wi(Nt){switch(Qn(Nt)){case 3:return!0;case 4:return!0;default:return!1}}function xa(Nt,nr){var Ar=Nt[nr];if(Ar!=null){if(!$i(Ar))throw new TypeError;return Ar}}function qn(Nt){var nr=xa(Nt,Le);if(!$i(nr))throw new TypeError;var Ar=nr.call(Nt);if(!ii(Ar))throw new TypeError;return Ar}function Ci(Nt){return Nt.value}function Zi(Nt){var nr=Nt.next();return nr.done?!1:nr}function Qi(Nt){var nr=Nt.return;nr&&nr.call(Nt)}function Zo(Nt){var nr=Object.getPrototypeOf(Nt);if(typeof Nt!="function"||Nt===yt||nr!==yt)return nr;var Ar=Nt.prototype,en=Ar&&Object.getPrototypeOf(Ar);if(en==null||en===Object.prototype)return nr;var wn=en.constructor;return typeof wn!="function"||wn===Nt?nr:wn}function me(){var Nt={},nr=[],Ar=function(){function di(Jn,cn,Li){this._index=0,this._keys=Jn,this._values=cn,this._selector=Li}return di.prototype["@@iterator"]=function(){return this},di.prototype[Le]=function(){return this},di.prototype.next=function(){var Jn=this._index;if(Jn>=0&&Jn<this._keys.length){var cn=this._selector(this._keys[Jn],this._values[Jn]);return Jn+1>=this._keys.length?(this._index=-1,this._keys=nr,this._values=nr):this._index++,{value:cn,done:!1}}return{value:void 0,done:!0}},di.prototype.throw=function(Jn){throw this._index>=0&&(this._index=-1,this._keys=nr,this._values=nr),Jn},di.prototype.return=function(Jn){return this._index>=0&&(this._index=-1,this._keys=nr,this._values=nr),{value:Jn,done:!0}},di}();return function(){function di(){this._keys=[],this._values=[],this._cacheKey=Nt,this._cacheIndex=-2}return Object.defineProperty(di.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),di.prototype.has=function(Jn){return this._find(Jn,!1)>=0},di.prototype.get=function(Jn){var cn=this._find(Jn,!1);return cn>=0?this._values[cn]:void 0},di.prototype.set=function(Jn,cn){var Li=this._find(Jn,!0);return this._values[Li]=cn,this},di.prototype.delete=function(Jn){var cn=this._find(Jn,!1);if(cn>=0){for(var Li=this._keys.length,Ri=cn+1;Ri<Li;Ri++)this._keys[Ri-1]=this._keys[Ri],this._values[Ri-1]=this._values[Ri];return this._keys.length--,this._values.length--,Jn===this._cacheKey&&(this._cacheKey=Nt,this._cacheIndex=-2),!0}return!1},di.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Nt,this._cacheIndex=-2},di.prototype.keys=function(){return new Ar(this._keys,this._values,en)},di.prototype.values=function(){return new Ar(this._keys,this._values,wn)},di.prototype.entries=function(){return new Ar(this._keys,this._values,Bn)},di.prototype["@@iterator"]=function(){return this.entries()},di.prototype[Le]=function(){return this.entries()},di.prototype._find=function(Jn,cn){return this._cacheKey!==Jn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Jn)),this._cacheIndex<0&&cn&&(this._cacheIndex=this._keys.length,this._keys.push(Jn),this._values.push(void 0)),this._cacheIndex},di}();function en(di,Jn){return di}function wn(di,Jn){return Jn}function Bn(di,Jn){return[di,Jn]}}function Dn(){return function(){function Nt(){this._map=new bt}return Object.defineProperty(Nt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Nt.prototype.has=function(nr){return this._map.has(nr)},Nt.prototype.add=function(nr){return this._map.set(nr,nr),this},Nt.prototype.delete=function(nr){return this._map.delete(nr)},Nt.prototype.clear=function(){this._map.clear()},Nt.prototype.keys=function(){return this._map.keys()},Nt.prototype.values=function(){return this._map.values()},Nt.prototype.entries=function(){return this._map.entries()},Nt.prototype["@@iterator"]=function(){return this.keys()},Nt.prototype[Le]=function(){return this.keys()},Nt}()}function Xa(){var Nt=16,nr=Ze.create(),Ar=en();return function(){function cn(){this._key=en()}return cn.prototype.has=function(Li){var Ri=wn(Li,!1);return Ri!==void 0?Ze.has(Ri,this._key):!1},cn.prototype.get=function(Li){var Ri=wn(Li,!1);return Ri!==void 0?Ze.get(Ri,this._key):void 0},cn.prototype.set=function(Li,Ri){var oo=wn(Li,!0);return oo[this._key]=Ri,this},cn.prototype.delete=function(Li){var Ri=wn(Li,!1);return Ri!==void 0?delete Ri[this._key]:!1},cn.prototype.clear=function(){this._key=en()},cn}();function en(){var cn;do cn="@@WeakMap@@"+Jn();while(Ze.has(nr,cn));return nr[cn]=!0,cn}function wn(cn,Li){if(!Z.call(cn,Ar)){if(!Li)return;Object.defineProperty(cn,Ar,{value:Ze.create()})}return cn[Ar]}function Bn(cn,Li){for(var Ri=0;Ri<Li;++Ri)cn[Ri]=Math.random()*255|0;return cn}function di(cn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(cn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(cn)):Bn(new Uint8Array(cn),cn):Bn(new Array(cn),cn)}function Jn(){var cn=di(Nt);cn[6]=cn[6]&79|64,cn[8]=cn[8]&191|128;for(var Li="",Ri=0;Ri<Nt;++Ri){var oo=cn[Ri];(Ri===4||Ri===6||Ri===8)&&(Li+="-"),oo<16&&(Li+="0"),Li+=oo.toString(16).toLowerCase()}return Li}}function cs(Nt){return Nt.__=void 0,delete Nt.__,Nt}})})(re||(re={}))},69848:function(It){(function($,z){It.exports=z()})(this,function(){"use strict";function $(ft,Je,wt,Qe,Qt,Er){if(!(Qt-Qe<=wt)){var Fr=Qe+Qt>>1;z(ft,Je,Fr,Qe,Qt,Er%2),$(ft,Je,wt,Qe,Fr-1,Er+1),$(ft,Je,wt,Fr+1,Qt,Er+1)}}function z(ft,Je,wt,Qe,Qt,Er){for(;Qt>Qe;){if(Qt-Qe>600){var Fr=Qt-Qe+1,Jr=wt-Qe+1,A=Math.log(Fr),Ce=.5*Math.exp(2*A/3),De=.5*Math.sqrt(A*Ce*(Fr-Ce)/Fr)*(Jr-Fr/2<0?-1:1),Tt=Math.max(Qe,Math.floor(wt-Jr*Ce/Fr+De)),gt=Math.min(Qt,Math.floor(wt+(Fr-Jr)*Ce/Fr+De));z(ft,Je,wt,Tt,gt,Er)}var Bt=Je[2*wt+Er],Kt=Qe,Cr=Qt;for(ie(ft,Je,Qe,wt),Je[2*Qt+Er]>Bt&&ie(ft,Je,Qe,Qt);Kt<Cr;){for(ie(ft,Je,Kt,Cr),Kt++,Cr--;Je[2*Kt+Er]<Bt;)Kt++;for(;Je[2*Cr+Er]>Bt;)Cr--}Je[2*Qe+Er]===Bt?ie(ft,Je,Qe,Cr):(Cr++,ie(ft,Je,Cr,Qt)),Cr<=wt&&(Qe=Cr+1),wt<=Cr&&(Qt=Cr-1)}}function ie(ft,Je,wt,Qe){re(ft,wt,Qe),re(Je,2*wt,2*Qe),re(Je,2*wt+1,2*Qe+1)}function re(ft,Je,wt){var Qe=ft[Je];ft[Je]=ft[wt],ft[wt]=Qe}function m(ft,Je,wt,Qe,Qt,Er,Fr){for(var Jr=[0,ft.length-1,0],A=[],Ce,De;Jr.length;){var Tt=Jr.pop(),gt=Jr.pop(),Bt=Jr.pop();if(gt-Bt<=Fr){for(var Kt=Bt;Kt<=gt;Kt++)Ce=Je[2*Kt],De=Je[2*Kt+1],Ce>=wt&&Ce<=Qt&&De>=Qe&&De<=Er&&A.push(ft[Kt]);continue}var Cr=Math.floor((Bt+gt)/2);Ce=Je[2*Cr],De=Je[2*Cr+1],Ce>=wt&&Ce<=Qt&&De>=Qe&&De<=Er&&A.push(ft[Cr]);var Qn=(Tt+1)%2;(Tt===0?wt<=Ce:Qe<=De)&&(Jr.push(Bt),Jr.push(Cr-1),Jr.push(Qn)),(Tt===0?Qt>=Ce:Er>=De)&&(Jr.push(Cr+1),Jr.push(gt),Jr.push(Qn))}return A}function de(ft,Je,wt,Qe,Qt,Er){for(var Fr=[0,ft.length-1,0],Jr=[],A=Qt*Qt;Fr.length;){var Ce=Fr.pop(),De=Fr.pop(),Tt=Fr.pop();if(De-Tt<=Er){for(var gt=Tt;gt<=De;gt++)Z(Je[2*gt],Je[2*gt+1],wt,Qe)<=A&&Jr.push(ft[gt]);continue}var Bt=Math.floor((Tt+De)/2),Kt=Je[2*Bt],Cr=Je[2*Bt+1];Z(Kt,Cr,wt,Qe)<=A&&Jr.push(ft[Bt]);var Qn=(Ce+1)%2;(Ce===0?wt-Qt<=Kt:Qe-Qt<=Cr)&&(Fr.push(Tt),Fr.push(Bt-1),Fr.push(Qn)),(Ce===0?wt+Qt>=Kt:Qe+Qt>=Cr)&&(Fr.push(Bt+1),Fr.push(De),Fr.push(Qn))}return Jr}function Z(ft,Je,wt,Qe){var Qt=ft-wt,Er=Je-Qe;return Qt*Qt+Er*Er}var ce=function(ft){return ft[0]},fe=function(ft){return ft[1]},Le=function(Je,wt,Qe,Qt,Er){wt===void 0&&(wt=ce),Qe===void 0&&(Qe=fe),Qt===void 0&&(Qt=64),Er===void 0&&(Er=Float64Array),this.nodeSize=Qt,this.points=Je;for(var Fr=Je.length<65536?Uint16Array:Uint32Array,Jr=this.ids=new Fr(Je.length),A=this.coords=new Er(Je.length*2),Ce=0;Ce<Je.length;Ce++)Jr[Ce]=Ce,A[2*Ce]=wt(Je[Ce]),A[2*Ce+1]=Qe(Je[Ce]);$(Jr,A,Qt,0,Jr.length-1,0)};Le.prototype.range=function(Je,wt,Qe,Qt){return m(this.ids,this.coords,Je,wt,Qe,Qt,this.nodeSize)},Le.prototype.within=function(Je,wt,Qe){return de(this.ids,this.coords,Je,wt,Qe,this.nodeSize)};var J={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ft){return ft}},Xe=Math.fround||function(ft){return function(Je){return ft[0]=+Je,ft[0]}}(new Float32Array(1)),et=function(Je){this.options=Vt(Object.create(J),Je),this.trees=new Array(this.options.maxZoom+1)};et.prototype.load=function(Je){var wt=this.options,Qe=wt.log,Qt=wt.minZoom,Er=wt.maxZoom,Fr=wt.nodeSize;Qe&&console.time("total time");var Jr="prepare "+Je.length+" points";Qe&&console.time(Jr),this.points=Je;for(var A=[],Ce=0;Ce<Je.length;Ce++)!Je[Ce].geometry||A.push(yt(Je[Ce],Ce));this.trees[Er+1]=new Le(A,q,$t,Fr,Float32Array),Qe&&console.timeEnd(Jr);for(var De=Er;De>=Qt;De--){var Tt=+Date.now();A=this._cluster(A,De),this.trees[De]=new Le(A,q,$t,Fr,Float32Array),Qe&&console.log("z%d: %d clusters in %dms",De,A.length,+Date.now()-Tt)}return Qe&&console.timeEnd("total time"),this},et.prototype.getClusters=function(Je,wt){var Qe=((Je[0]+180)%360+360)%360-180,Qt=Math.max(-90,Math.min(90,Je[1])),Er=Je[2]===180?180:((Je[2]+180)%360+360)%360-180,Fr=Math.max(-90,Math.min(90,Je[3]));if(Je[2]-Je[0]>=360)Qe=-180,Er=180;else if(Qe>Er){var Jr=this.getClusters([Qe,Qt,180,Fr],wt),A=this.getClusters([-180,Qt,Er,Fr],wt);return Jr.concat(A)}for(var Ce=this.trees[this._limitZoom(wt)],De=Ce.range(Xt(Qe),Ct(Fr),Xt(Er),Ct(Qt)),Tt=[],gt=0,Bt=De;gt<Bt.length;gt+=1){var Kt=Bt[gt],Cr=Ce.points[Kt];Tt.push(Cr.numPoints?rr(Cr):this.points[Cr.index])}return Tt},et.prototype.getChildren=function(Je){var wt=this._getOriginId(Je),Qe=this._getOriginZoom(Je),Qt="No cluster with the specified id.",Er=this.trees[Qe];if(!Er)throw new Error(Qt);var Fr=Er.points[wt];if(!Fr)throw new Error(Qt);for(var Jr=this.options.radius/(this.options.extent*Math.pow(2,Qe-1)),A=Er.within(Fr.x,Fr.y,Jr),Ce=[],De=0,Tt=A;De<Tt.length;De+=1){var gt=Tt[De],Bt=Er.points[gt];Bt.parentId===Je&&Ce.push(Bt.numPoints?rr(Bt):this.points[Bt.index])}if(Ce.length===0)throw new Error(Qt);return Ce},et.prototype.getLeaves=function(Je,wt,Qe){wt=wt||10,Qe=Qe||0;var Qt=[];return this._appendLeaves(Qt,Je,wt,Qe,0),Qt},et.prototype.getTile=function(Je,wt,Qe){var Qt=this.trees[this._limitZoom(Je)],Er=Math.pow(2,Je),Fr=this.options,Jr=Fr.extent,A=Fr.radius,Ce=A/Jr,De=(Qe-Ce)/Er,Tt=(Qe+1+Ce)/Er,gt={features:[]};return this._addTileFeatures(Qt.range((wt-Ce)/Er,De,(wt+1+Ce)/Er,Tt),Qt.points,wt,Qe,Er,gt),wt===0&&this._addTileFeatures(Qt.range(1-Ce/Er,De,1,Tt),Qt.points,Er,Qe,Er,gt),wt===Er-1&&this._addTileFeatures(Qt.range(0,De,Ce/Er,Tt),Qt.points,-1,Qe,Er,gt),gt.features.length?gt:null},et.prototype.getClusterExpansionZoom=function(Je){for(var wt=this._getOriginZoom(Je)-1;wt<=this.options.maxZoom;){var Qe=this.getChildren(Je);if(wt++,Qe.length!==1)break;Je=Qe[0].properties.cluster_id}return wt},et.prototype._appendLeaves=function(Je,wt,Qe,Qt,Er){for(var Fr=this.getChildren(wt),Jr=0,A=Fr;Jr<A.length;Jr+=1){var Ce=A[Jr],De=Ce.properties;if(De&&De.cluster?Er+De.point_count<=Qt?Er+=De.point_count:Er=this._appendLeaves(Je,De.cluster_id,Qe,Qt,Er):Er<Qt?Er++:Je.push(Ce),Je.length===Qe)break}return Er},et.prototype._addTileFeatures=function(Je,wt,Qe,Qt,Er,Fr){for(var Jr=0,A=Je;Jr<A.length;Jr+=1){var Ce=A[Jr],De=wt[Ce],Tt=De.numPoints,gt=void 0,Bt=void 0,Kt=void 0;if(Tt)gt=bt(De),Bt=De.x,Kt=De.y;else{var Cr=this.points[De.index];gt=Cr.properties,Bt=Xt(Cr.geometry.coordinates[0]),Kt=Ct(Cr.geometry.coordinates[1])}var Qn={type:1,geometry:[[Math.round(this.options.extent*(Bt*Er-Qe)),Math.round(this.options.extent*(Kt*Er-Qt))]],tags:gt},vn=void 0;Tt?vn=De.id:this.options.generateId?vn=De.index:this.points[De.index].id&&(vn=this.points[De.index].id),vn!==void 0&&(Qn.id=vn),Fr.features.push(Qn)}},et.prototype._limitZoom=function(Je){return Math.max(this.options.minZoom,Math.min(Math.floor(+Je),this.options.maxZoom+1))},et.prototype._cluster=function(Je,wt){for(var Qe=[],Qt=this.options,Er=Qt.radius,Fr=Qt.extent,Jr=Qt.reduce,A=Qt.minPoints,Ce=Er/(Fr*Math.pow(2,wt)),De=0;De<Je.length;De++){var Tt=Je[De];if(!(Tt.zoom<=wt)){Tt.zoom=wt;for(var gt=this.trees[wt+1],Bt=gt.within(Tt.x,Tt.y,Ce),Kt=Tt.numPoints||1,Cr=Kt,Qn=0,vn=Bt;Qn<vn.length;Qn+=1){var fi=vn[Qn],Gn=gt.points[fi];Gn.zoom>wt&&(Cr+=Gn.numPoints||1)}if(Cr>Kt&&Cr>=A){for(var ii=Tt.x*Kt,hi=Tt.y*Kt,Wn=Jr&&Kt>1?this._map(Tt,!0):null,pi=(De<<5)+(wt+1)+this.points.length,la=0,Gi=Bt;la<Gi.length;la+=1){var Oi=Gi[la],$i=gt.points[Oi];if(!($i.zoom<=wt)){$i.zoom=wt;var ca=$i.numPoints||1;ii+=$i.x*ca,hi+=$i.y*ca,$i.parentId=pi,Jr&&(Wn||(Wn=this._map(Tt,!0)),Jr(Wn,this._map($i)))}}Tt.parentId=pi,Qe.push(Ze(ii/Cr,hi/Cr,pi,Cr,Wn))}else if(Qe.push(Tt),Cr>1)for(var wi=0,xa=Bt;wi<xa.length;wi+=1){var qn=xa[wi],Ci=gt.points[qn];Ci.zoom<=wt||(Ci.zoom=wt,Qe.push(Ci))}}}return Qe},et.prototype._getOriginId=function(Je){return Je-this.points.length>>5},et.prototype._getOriginZoom=function(Je){return(Je-this.points.length)%32},et.prototype._map=function(Je,wt){if(Je.numPoints)return wt?Vt({},Je.properties):Je.properties;var Qe=this.points[Je.index].properties,Qt=this.options.map(Qe);return wt&&Qt===Qe?Vt({},Qt):Qt};function Ze(ft,Je,wt,Qe,Qt){return{x:Xe(ft),y:Xe(Je),zoom:Infinity,id:wt,parentId:-1,numPoints:Qe,properties:Qt}}function yt(ft,Je){var wt=ft.geometry.coordinates,Qe=wt[0],Qt=wt[1];return{x:Xe(Xt(Qe)),y:Xe(Ct(Qt)),zoom:Infinity,index:Je,parentId:-1}}function rr(ft){return{type:"Feature",id:ft.id,properties:bt(ft),geometry:{type:"Point",coordinates:[at(ft.x),it(ft.y)]}}}function bt(ft){var Je=ft.numPoints,wt=Je>=1e4?Math.round(Je/1e3)+"k":Je>=1e3?Math.round(Je/100)/10+"k":Je;return Vt(Vt({},ft.properties),{cluster:!0,cluster_id:ft.id,point_count:Je,point_count_abbreviated:wt})}function Xt(ft){return ft/360+.5}function Ct(ft){var Je=Math.sin(ft*Math.PI/180),wt=.5-.25*Math.log((1+Je)/(1-Je))/Math.PI;return wt<0?0:wt>1?1:wt}function at(ft){return(ft-.5)*360}function it(ft){var Je=(180-ft*360)*Math.PI/180;return 360*Math.atan(Math.exp(Je))/Math.PI-90}function Vt(ft,Je){for(var wt in Je)ft[wt]=Je[wt];return ft}function q(ft){return ft.x}function $t(ft){return ft.y}return et})},75752:function(It){It.exports.RADIUS=6378137,It.exports.FLATTENING=1/298.257223563,It.exports.POLAR_RADIUS=63567523142e-4}}]);
